---
title: 非同期ワークフロー (F#)
description: サポートに関する情報、f# のプログラミング言語を非同期的に、計算を実行するその他の作業の実行をブロックせずに実行されます。
author: cartermp
ms.author: phcart
ms.date: 05/16/2016
ms.topic: language-reference
ms.prod: dotnet-fsharp
ms.devlang: fsharp
ms.openlocfilehash: 1521ea3719f906a45b11d19a27256e87c5643e28
ms.sourcegitcommit: 03ee570f6f528a7d23a4221dcb26a9498edbdf8c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2018
---
# <a name="asynchronous-workflows"></a><span data-ttu-id="316e6-103">非同期ワークフロー</span><span class="sxs-lookup"><span data-stu-id="316e6-103">Asynchronous Workflows</span></span>

> [!NOTE]
<span data-ttu-id="316e6-104">API リファレンスのリンクをクリックすると MSDN に移動します。</span><span class="sxs-lookup"><span data-stu-id="316e6-104">The API reference link will take you to MSDN.</span></span>  <span data-ttu-id="316e6-105">docs.microsoft.com API リファレンスは完全ではありません。</span><span class="sxs-lookup"><span data-stu-id="316e6-105">The docs.microsoft.com API reference is not complete.</span></span>

<span data-ttu-id="316e6-106">このトピックでは、計算を実行する、非同期的には、その他の作業の実行をブロックすることがなく f# でサポートについて説明します。</span><span class="sxs-lookup"><span data-stu-id="316e6-106">This topic describes support in F# for performing computations asynchronously, that is, without blocking execution of other work.</span></span> <span data-ttu-id="316e6-107">たとえば、アプリケーションがその他の作業を実行をユーザーに応答性を維持するための Ui があるアプリケーションを作成する非同期計算を使用できます。</span><span class="sxs-lookup"><span data-stu-id="316e6-107">For example, asynchronous computations can be used to write applications that have UIs that remain responsive to users as the application performs other work.</span></span>

## <a name="syntax"></a><span data-ttu-id="316e6-108">構文</span><span class="sxs-lookup"><span data-stu-id="316e6-108">Syntax</span></span>

```fsharp
async { expression }
```

## <a name="remarks"></a><span data-ttu-id="316e6-109">コメント</span><span class="sxs-lookup"><span data-stu-id="316e6-109">Remarks</span></span>

<span data-ttu-id="316e6-110">前の構文では、によって表される、計算`expression`は、スリープ状態の非同期操作、I/O、およびその他の非同期操作が実行されるときに、計算の現在のスレッドをブロックすることがなく、非同期的に実行するように設定します。</span><span class="sxs-lookup"><span data-stu-id="316e6-110">In the previous syntax, the computation represented by `expression` is set up to run asynchronously, that is, without blocking the current computation thread when asynchronous sleep operations, I/O, and other asynchronous operations are performed.</span></span> <span data-ttu-id="316e6-111">非同期計算を現在のスレッドで実行が続行中に、多くの場合、バック グラウンド スレッドで開始されます。</span><span class="sxs-lookup"><span data-stu-id="316e6-111">Asynchronous computations are often started on a background thread while execution continues on the current thread.</span></span> <span data-ttu-id="316e6-112">式の型は`Async<'T>`ここで、`'T`式によって返される型は、ときに、`return`キーワードを使用します。</span><span class="sxs-lookup"><span data-stu-id="316e6-112">The type of the expression is `Async<'T>`, where `'T` is the type returned by the expression when the `return` keyword is used.</span></span> <span data-ttu-id="316e6-113">このような式の中でコードを呼びます、*非同期ブロック*、または*async ブロック*です。</span><span class="sxs-lookup"><span data-stu-id="316e6-113">The code in such an expression is referred to as an *asynchronous block*, or *async block*.</span></span>

<span data-ttu-id="316e6-114">さまざまな非同期プログラミングの方法があると、 [ `Async` ](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7)クラスがいくつかのシナリオをサポートするメソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="316e6-114">There are a variety of ways of programming asynchronously, and the [`Async`](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) class provides methods that support several scenarios.</span></span> <span data-ttu-id="316e6-115">一般的な方法は、作成する`Async`トリガーを起動する関数のいずれかを使用して開始し、これらの計算の計算などに、非同期的に実行する計算を表すオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="316e6-115">The general approach is to create `Async` objects that represent the computation or computations that you want to run asynchronously, and then start these computations by using one of the triggering functions.</span></span> <span data-ttu-id="316e6-116">さまざまなトリガーを起動する関数が、非同期計算を実行中のさまざまな方法を提供し、現在のスレッド、バック グラウンド スレッド、または、.NET Framework タスク オブジェクトを使用するかどうかに依存した 1 つを使用して、継続があるかどうか計算の終了時に実行する関数。</span><span class="sxs-lookup"><span data-stu-id="316e6-116">The various triggering functions provide different ways of running asynchronous computations, and which one you use depends on whether you want to use the current thread, a background thread, or a .NET Framework task object, and whether there are continuation functions that should run when the computation finishes.</span></span> <span data-ttu-id="316e6-117">たとえば、非同期計算を開始するには、現在のスレッドを行うこともできます[ `Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-117">For example, to start an asynchronous computation on the current thread, you can use [`Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span></span> <span data-ttu-id="316e6-118">UI スレッドから非同期計算を開始する場合、キーストロークやマウスのアクティビティなどのユーザー アクションを処理するため、アプリケーションが応答する主要なイベント ループはブロックされません。</span><span class="sxs-lookup"><span data-stu-id="316e6-118">When you start an asynchronous computation from the UI thread, you do not block the main event loop that processes user actions such as keystrokes and mouse activity, so your application remains responsive.</span></span>

## <a name="asynchronous-binding-by-using-let"></a><span data-ttu-id="316e6-119">Let を使用して非同期バインドは!</span><span class="sxs-lookup"><span data-stu-id="316e6-119">Asynchronous Binding by Using let!</span></span>

<span data-ttu-id="316e6-120">非同期のワークフローでは、一部の式と操作は同期的でし、一部が非同期的に結果を返すよう設計されている長い計算します。</span><span class="sxs-lookup"><span data-stu-id="316e6-120">In an asynchronous workflow, some expressions and operations are synchronous, and some are longer computations that are designed to return a result asynchronously.</span></span> <span data-ttu-id="316e6-121">メソッドを呼び出す場合、非同期的に、通常ではなく`let`使用するバインディング、`let!`です。</span><span class="sxs-lookup"><span data-stu-id="316e6-121">When you call a method asynchronously, instead of an ordinary `let` binding, you use `let!`.</span></span> <span data-ttu-id="316e6-122">効果`let!`は計算が実行されている他の計算やスレッドで継続して実行を有効にします。</span><span class="sxs-lookup"><span data-stu-id="316e6-122">The effect of `let!` is to enable execution to continue on other computations or threads as the computation is being performed.</span></span> <span data-ttu-id="316e6-123">右側にある後、`let!`バインディングを返します、非同期のワークフローの残りの部分が実行を再開します。</span><span class="sxs-lookup"><span data-stu-id="316e6-123">After the right side of the `let!` binding returns, the rest of the asynchronous workflow resumes execution.</span></span>

<span data-ttu-id="316e6-124">次のコード間の違いを示しています。`let`と`let!`です。</span><span class="sxs-lookup"><span data-stu-id="316e6-124">The following code shows the difference between `let` and `let!`.</span></span> <span data-ttu-id="316e6-125">使用するコードの行`let`実行できる後で使用すると、たとえば、オブジェクトとして非同期計算を作成します`Async.StartImmediate`または[ `Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-125">The line of code that uses `let` just creates an asynchronous computation as an object that you can run later by using, for example, `Async.StartImmediate` or [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span></span> <span data-ttu-id="316e6-126">使用するコードの行`let!`計算を開始し、スレッドが、結果が入手可能にするポイントの実行を継続するまで中断します。</span><span class="sxs-lookup"><span data-stu-id="316e6-126">The line of code that uses `let!` starts the computation, and then the thread is suspended until the result is available, at which point execution continues.</span></span>

```fsharp
// let just stores the result as an asynchronous operation.
let (result1 : Async<byte[]>) = stream.AsyncRead(bufferSize)
// let! completes the asynchronous operation and returns the data.
let! (result2 : byte[])  = stream.AsyncRead(bufferSize)
```

<span data-ttu-id="316e6-127">加え`let!`、使用することができます`use!`非同期バインドを実行します。</span><span class="sxs-lookup"><span data-stu-id="316e6-127">In addition to `let!`, you can use `use!` to perform asynchronous bindings.</span></span> <span data-ttu-id="316e6-128">間の違い`let!`と`use!`間の差として同じ`let`と`use`です。</span><span class="sxs-lookup"><span data-stu-id="316e6-128">The difference between `let!` and `use!` is the same as the difference between `let` and `use`.</span></span> <span data-ttu-id="316e6-129">`use!`、現在のスコープの終了時のオブジェクトが破棄されます。</span><span class="sxs-lookup"><span data-stu-id="316e6-129">For `use!`, the object is disposed of at the close of the current scope.</span></span> <span data-ttu-id="316e6-130">F# 言語の現在のリリースで`use!`いなくても、null に初期化する値を許可しない`use`はします。</span><span class="sxs-lookup"><span data-stu-id="316e6-130">Note that in the current release of the F# language, `use!` does not allow a value to be initialized to null, even though `use` does.</span></span>

## <a name="asynchronous-primitives"></a><span data-ttu-id="316e6-131">非同期プリミティブ</span><span class="sxs-lookup"><span data-stu-id="316e6-131">Asynchronous Primitives</span></span>

<span data-ttu-id="316e6-132">1 つの非同期タスクを実行し、結果を返すメソッドが呼び出された、*非同期プリミティブ*で使用する専用に設計された、これらと`let!`です。</span><span class="sxs-lookup"><span data-stu-id="316e6-132">A method that performs a single asynchronous task and returns the result is called an *asynchronous primitive*, and these are designed specifically for use with `let!`.</span></span> <span data-ttu-id="316e6-133">複数の非同期プリミティブは、f# コア ライブラリで定義されます。</span><span class="sxs-lookup"><span data-stu-id="316e6-133">Several asynchronous primitives are defined in the F# core library.</span></span> <span data-ttu-id="316e6-134">Web アプリケーションのような 2 つのメソッドは、モジュールで定義されて[ `Microsoft.FSharp.Control.WebExtensions` ](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [ `WebRequest.AsyncGetResponse` ](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c)と[ `WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-134">Two such methods for Web applications are defined in the module [`Microsoft.FSharp.Control.WebExtensions`](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [`WebRequest.AsyncGetResponse`](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) and [`WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span></span> <span data-ttu-id="316e6-135">両方のプリミティブは、指定された URL の Web ページからデータをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="316e6-135">Both primitives download data from a Web page, given a URL.</span></span> <span data-ttu-id="316e6-136">`AsyncGetResponse` 生成、`System.Net.WebResponse`オブジェクト、および`AsyncDownloadString`を Web ページの HTML を表す文字列を生成します。</span><span class="sxs-lookup"><span data-stu-id="316e6-136">`AsyncGetResponse` produces a `System.Net.WebResponse` object, and `AsyncDownloadString` produces a string that represents the HTML for a Web page.</span></span>

<span data-ttu-id="316e6-137">非同期 I/O 操作のいくつかのプリミティブに含まれる、 [ `Microsoft.FSharp.Control.CommonExtensions` ](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396)モジュール。</span><span class="sxs-lookup"><span data-stu-id="316e6-137">Several primitives for asynchronous I/O operations are included in the [`Microsoft.FSharp.Control.CommonExtensions`](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span></span> <span data-ttu-id="316e6-138">これらの拡張メソッドの`System.IO.Stream`クラスが[ `Stream.AsyncRead` ](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e)と[ `Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-138">These extension methods of the `System.IO.Stream` class are [`Stream.AsyncRead`](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) and [`Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span></span>

<span data-ttu-id="316e6-139">使用可能なその他の非同期プリミティブ、 [f# パワー ツール](https://fsprojects.github.io/VisualFSharpPowerTools/)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-139">Additional asynchronous primitives are available in the [F# PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span></span> <span data-ttu-id="316e6-140">完全な本体を持つが非同期ブロックで囲まれている関数を定義することで、独自の非同期プリミティブを記述することもできます。</span><span class="sxs-lookup"><span data-stu-id="316e6-140">You can also write your own asynchronous primitives by defining a function whose complete body is enclosed in an async block.</span></span>

<span data-ttu-id="316e6-141">返す、f# の関数を作成する f# 非同期プログラミング モデルとその他の非同期モデルのように設計されて .NET Framework での非同期のメソッドを使用する`Async`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="316e6-141">To use asynchronous methods in the .NET Framework that are designed for other asynchronous models with the F# asynchronous programming model, you create a function that returns an F# `Async` object.</span></span> <span data-ttu-id="316e6-142">F# ライブラリでは、これを行うには簡単にできるようにする機能が備わっています。</span><span class="sxs-lookup"><span data-stu-id="316e6-142">The F# library has functions that make this easy to do.</span></span>

<span data-ttu-id="316e6-143">非同期のワークフローを使用しての一例が含まれるです。内にあるその他の多くのメソッドのドキュメント、 [Async クラス](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7)です。</span><span class="sxs-lookup"><span data-stu-id="316e6-143">One example of using asynchronous workflows is included here; there are many others in the documentation for the methods of the [Async class](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span></span>

<span data-ttu-id="316e6-144">この例では、非同期のワークフローを使用して、並列で計算を実行する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="316e6-144">This example shows how to use asynchronous workflows to perform computations in parallel.</span></span>

<span data-ttu-id="316e6-145">次のコード例で、関数`fetchAsync`Web 要求から返される HTML テキストを取得します。</span><span class="sxs-lookup"><span data-stu-id="316e6-145">In the following code example, a function `fetchAsync` gets the HTML text returned from a Web request.</span></span> <span data-ttu-id="316e6-146">`fetchAsync`関数には、非同期コードのブロックが含まれています。</span><span class="sxs-lookup"><span data-stu-id="316e6-146">The `fetchAsync` function contains an asynchronous block of code.</span></span> <span data-ttu-id="316e6-147">ときに、バインドされる非同期のプリミティブの結果をここでは[ `AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a)できます!</span><span class="sxs-lookup"><span data-stu-id="316e6-147">When a binding is made to the result of an asynchronous primitive, in this case [`AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span></span> <span data-ttu-id="316e6-148">let の代わりに使用されます。</span><span class="sxs-lookup"><span data-stu-id="316e6-148">is used instead of let.</span></span>

<span data-ttu-id="316e6-149">関数を使用する[ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b)に非同期操作を実行し、その結果を待機します。</span><span class="sxs-lookup"><span data-stu-id="316e6-149">You use the function [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) to execute an asynchronous operation and wait for its result.</span></span> <span data-ttu-id="316e6-150">例として、することが複数の非同期操作で並列に実行を使用して、 [ `Async.Parallel` ](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4)関数を`Async.RunSynchronously`関数。</span><span class="sxs-lookup"><span data-stu-id="316e6-150">As an example, you can execute multiple asynchronous operations in parallel by using the [`Async.Parallel`](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) function together with the `Async.RunSynchronously` function.</span></span> <span data-ttu-id="316e6-151">`Async.Parallel`関数の一覧には、`Async`オブジェクトをそれぞれのコードを設定`Async`parallel、および返しますを実行するタスク オブジェクト、`Async`並列計算を表すオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="316e6-151">The `Async.Parallel` function takes a list of the `Async` objects, sets up the code for each `Async` task object to run in parallel, and returns an `Async` object that represents the parallel computation.</span></span> <span data-ttu-id="316e6-152">1 つの操作と同じ動作を呼び出す`Async.RunSynchronously`実行を開始します。</span><span class="sxs-lookup"><span data-stu-id="316e6-152">Just as for a single operation, you call `Async.RunSynchronously` to start the execution.</span></span>

<span data-ttu-id="316e6-153">`runAll`関数は、次の 3 つの非同期ワークフローを並列でを起動し、これらがすべて完了するまで待機します。</span><span class="sxs-lookup"><span data-stu-id="316e6-153">The `runAll` function launches three asynchronous workflows in parallel and waits until they have all completed.</span></span>

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet8003.fs)]

## <a name="see-also"></a><span data-ttu-id="316e6-154">関連項目</span><span class="sxs-lookup"><span data-stu-id="316e6-154">See Also</span></span>

[<span data-ttu-id="316e6-155">F# 言語リファレンス</span><span class="sxs-lookup"><span data-stu-id="316e6-155">F# Language Reference</span></span>](index.md)

[<span data-ttu-id="316e6-156">コンピュテーション式</span><span class="sxs-lookup"><span data-stu-id="316e6-156">Computation Expressions</span></span>](computation-expressions.md)

[<span data-ttu-id="316e6-157">Control.Async クラス</span><span class="sxs-lookup"><span data-stu-id="316e6-157">Control.Async Class</span></span>](https://msdn.microsoft.com/visualfsharpdocs/conceptual/control.async-class-%5bfsharp%5d)
