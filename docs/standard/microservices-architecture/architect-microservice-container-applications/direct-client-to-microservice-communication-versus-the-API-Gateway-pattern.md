---
title: "API ゲートウェイ パターンとの直接のクライアント-マイクロ-サービスの通信"
description: "コンテナーの .NET アプリケーションの .NET Microservices アーキテクチャ |API ゲートウェイ パターンとの直接のクライアント-マイクロ-サービスの通信"
keywords: "Docker, Microservices、ASP.NET、コンテナー、API のゲートウェイ"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: c8227ec47888c7cf361f34c4c85a09c0666f886e
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2017
---
# <a name="direct-client-to-microservice-communication-versus-the-api-gateway-pattern"></a>API ゲートウェイ パターンとの直接のクライアント-マイクロ-サービスの通信

Microservices アーキテクチャでは、各マイクロ サービスは、一連の fine‑grained エンドポイント (通常) を公開します。 このファクトには、このセクションで説明したように client‑to‑microservice 通信は影響します。

## <a name="direct-client-to-microservice-communication"></a>マイクロ サービスでのクライアントへの直接的な通信

可能なアプローチでは、マイクロ サービスでのクライアントへの直接的な通信アーキテクチャを使用します。 この方法は、クライアント アプリケーションが、図 4-12 のように、microservices の一部に直接要求を作成できます。

![](./media/image12.png)

**図 4-12**です。 マイクロ サービスでのクライアントへの直接的な通信アーキテクチャを使用します。

このアプローチです。 各マイクロ サービスでは、各マイクロ サービスを別の TCP ポートでも、パブリック エンドポイントがあります。 特定のサービスの URL の例は、Azure では、次の URL になります。

<http://eshoponcontainers.westus.cloudapp.azure.com:88/>

クラスターでは、URL は、クラスターで使用されているロード バランサーにマップされるに基づいて実稼働環境でをさらに、microservices に要求を分散します。 実稼働環境でのようにアプリケーションの配信コント ローラー (ADC) がある可能性があります[Azure Application Gateway](https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction) microservices とインターネットの間です。 これは、負荷分散を実行するだけでなく、SSL ターミネーション機能を提供することにより、サービスをセキュリティで保護する透過的な層として機能します。 これにより、CPU 負荷の高い SSL ターミネーション機能と、Azure アプリケーション ゲートウェイを他のルーティング処理をオフロードすることで、ホストの負荷が向上します。 いずれの場合は、ロード バランサーと ADC は、アプリケーションの論理アーキテクチャの観点から透過的です。

マイクロ サービスでのクライアントへの直接的な通信アーキテクチャは、これで十分小さなマイクロ サービスに基づくアプリケーション、クライアント アプリケーションが ASP.NET MVC アプリのようにサーバー側の web アプリケーションである場合に特に可能性があります。 ただし、大規模で複雑なマイクロ サービス ベースのアプリケーション (たとえば、数十マイクロ サービスの種類を処理する場合) をビルドするときに、クライアント アプリは、リモートのモバイル アプリまたは web アプリケーションの SPA ときに特にアプローチはいくつかの問題に直面します。

Microservices に基づいて大規模なアプリケーションを開発する際に、次の事項を考慮してください。

-   *方法をクライアント アプリ バックエンドを要求の数を最小限に抑えるし、複数 microservices chatty な通信を減らすか。*

1 つの UI 画面を構築する複数の microservices と対話すると、インターネット経由でのラウンド トリップ数が増加します。 これは、待機時間と、UI 側での複雑性が向上します。 理想的には、応答を効率的に集計サーバー側で、こう待機時間、データの複数の部分は並列で返され、準備が整うとすぐに、一部の UI でデータを表示できます。

-   *横断的関心事認証、データ変換、および動的な要求のディスパッチなどの対処方法*

セキュリティおよび承認すべてマイクロ サービスが重要な開発作業を必要と同じように、セキュリティと横断的関心事を実装します。 可能なアプローチは、外部からの直接アクセスを制限するために、1 か所で、API ゲートウェイと同様にこれら横断的関心事を実装する、Docker ホストまたは内部のクラスター内でそれらのサービスをことです。

-   *クライアント アプリが非インターネット対応のプロトコルを使用するサービスと通信する方法をしますか。*

(AMQP またはバイナリ プロトコル) など、サーバー側で使用されるプロトコルは通常はクライアント アプリでサポートされません。 そのため、要求を HTTP、HTTPS などのプロトコルを使用して実行し、その後、他のプロトコルに変換する必要があります。 A*で中間*アプローチにこのような状況で役立ちます。

-   *モバイル アプリに対する特にファサードを整形するにはどうできますか。*

複数のクライアント アプリケーションのニーズに対応する複数 microservices の API が適切にデザインいない可能性があります。 たとえば、モバイル アプリのニーズは、web アプリのニーズよりも異なる可能性があります。 モバイル アプリの場合は、応答データをより効率的なことができるように、さらに最適化する必要があります。 これは、複数 microservices からデータを集計して、データの 1 つのセットを返すことがありますが、モバイル アプリが必要としない、応答内のデータを排除することによって行うことがあります。 また、当然ながら、そのデータを圧縮する場合があります。 もう一度、ファサードまたはモバイル アプリと、microservices 間の API がこのシナリオに適したがあります。

## <a name="using-an-api-gateway"></a>API ゲートウェイを使用します。

検討に適した方法を指定できますを設計して大規模または複雑なマイクロ サービス ベースのアプリケーションで複数のクライアントでアプリをビルドすると、 [API ゲートウェイ](http://microservices.io/patterns/apigateway.html)です。 これは、特定の microservices のグループの 1 つのエントリ ポイントを提供するサービスです。 に似ていますが、[ファサード パターン](https://en.wikipedia.org/wiki/Facade_pattern)object‑oriented デザインからがここでは、分散システムの一部です。 API ゲートウェイ パターンは、"backend フロント エンド"と呼ばれることもあります[(BFF)](http://samnewman.io/patterns/architectural/bff/)クライアント アプリケーションのニーズを考える時にビルドするためです。

図 4-13 では、カスタム API ゲートウェイがマイクロ サービス ベースのアーキテクチャに収まる方法を示しています。
複数が直面している 1 つのカスタム API のゲートウェイ サービスを使用するは、その図で強調表示をすることが重要と別のクライアント アプリ。 クライアント アプリから多くのさまざまな要件に基づく API ゲートウェイ サービスが拡大され、変化し続けるために、ファクトが重要なリスクを指定できます。 最終的には、ことが肥大化さまざまなニーズのためと、効果的にある可能性がありますをモノリシック アプリケーションまたはモノリシック サービスとよく似てです。 非常によくをお勧めのインスタンスで複数のサービスまたはフォーム ファクターの種類ごとに 1 つ複数の小さい API ゲートウェイ API ゲートウェイを分割するためです。

![](./media/image13.png)

**図 4-13**です。 カスタムの Web API サービスとして実装 API ゲートウェイを使用します。

この例では、API ゲートウェイがコンテナーとして実行されているカスタムの Web API サービスとして実装します。

前述のように、できるようにする各クライアント アプリケーションのニーズに対応する異なるファサード API のいくつかのゲートウェイを実装する必要があります。 各 API ゲートウェイは別に指定できますもに基づいてクライアントのフォーム ファクターどの下が複数の内部 microservices を呼び出し、特定のアダプター コードを実装することによって、各クライアント アプリの API に対応しました。

カスタム API ゲートウェイとデータ アグリゲーターは通常後、は、ことに注意する必要があります。 通常、1 つのアプリケーションのすべての内部 microservices を集計する API のゲートウェイがあることをお勧めはありません。 場合は、そのモノリシック アグリゲーターまたは orchestrator として機能し、すべての microservices を結合することによりマイクロ サービスの自律性に違反しています。 そのため、アプリケーション全体の集合として、API ゲートウェイをに基づいてビジネス境界と act ではありません分離されます必要があります。

場合もあります細分化された API ゲートウェイは、マイクロ サービスを単独でもありもドメインやビジネス名および関連データがあることがことができます。 ビジネスまたはドメインで使用される API ゲートウェイの境界を持つより優れた設計を取得するのに役立ちます。

API ゲートウェイ層内の粒度は、粒度の細かい API ゲートウェイの概念が UI コンポジション サービスと同様にため microservices、に基づいてより高度な複合 UI アプリケーションに特に便利ですがあります。 この後で触れ、 [microservices に基づく複合 UI の作成](#creating-composite-ui-based-on-microservices-including-visual-ui-shape-and-layout-generated-by-multiple-microservices)です。

したがって、多くのメディア、およびサイズの大きなアプリケーションでは、カスタム API のゲートウェイを使用して、通常適した方法では、単一モノリシック アグリゲーターまたは一意の中央のカスタム API ゲートウェイではありません。

別の方法としては、のような製品を使用する[Azure API Management](https://azure.microsoft.com/services/api-management/)図 4-14 に示すようにします。 この方法は、API ゲートウェイ ニーズを解決だけでなく、独自の Api から洞察の収集などの機能を提供します。 API 管理ソリューションを使用している場合、API ゲートウェイはその完全な API 管理ソリューション内でコンポーネントのみです。

![](./media/image14.png)

**図 4-14**です。 API ゲートウェイ用の Azure API Management の使用

これらの API のゲートウェイは「薄型」ために Azure API Management、1 つの API ゲートウェイがあります、ファクトのような製品を使用するため危険性の高いがと、をモノリシックに向かって進化でしたカスタムの c# コードを実装しないことを意味するこの例では、コンポーネント。 

このタイプの製品は、ここですることができますも内部 microservices から Api をフィルター処理し、この 1 つの層で公開された Api に承認を適用、ingress 通信用のリバース プロキシに近い動作をします。

API Management システムのヘルプから使用可能な洞察独自の API の使用方法の理解を取得する方法を実行しているとします。 ユーザーはほぼリアルタイムの分析レポートを表示することと、ビジネスに影響を与える可能性がありますの傾向を識別します。 さらに、さらにオンラインおよびオフライン分析用の要求と応答のアクティビティに関するログことができます。

Azure API Management では、キー、トークン、および IP フィルタ リングを使用して独自の Api をセキュリティで保護できます。 これらの機能では、柔軟かつ詳細なクォータを適用し、転送率の制限、図形とポリシーを使用して、Api の動作を変更し、応答のキャッシュによるパフォーマンスの向上できます。

このガイドとリファレンスのサンプル アプリケーション (eShopOnContainers) では、Azure API Management などの製品の PaaS を使用せずにプレーンなコンテナーに注目するために、アーキテクチャを簡素化され、ユーザーが作成したコンテナー化アーキテクチャを限定します。 大きなマイクロ サービス ベースのアプリケーションで Microsoft Azure に配置されている、ことをお勧めを確認し、API のゲートウェイのベースとして Azure API Management を採用します。

## <a name="drawbacks-of-the-api-gateway-pattern"></a>API ゲートウェイ パターンの欠点

-   最も重要な欠点は、こと、API のゲートウェイを実装するときにするはその層と結合内部 microservices です。 次のように結合には、アプリケーションの深刻な問題がありますについて紹介します。 Clemens Vaster、Azure Service Bus チームでの設計者は、彼の"新しい ESB"としてこの潜在的な問題を参照"[Messaging and Microservices](https://www.youtube.com/watch?v=rXi5CLjIQ9k)"GOTO 2016 でのセッションです。

-   Microservices API ゲートウェイを使用して、追加可能な単一障害点を作成します。

-   API ゲートウェイは、応答時間の増加により、追加のネットワーク呼び出しを導入できます。 ただし、通常、この余分な呼び出しでは、インターフェイスをクライアントが内部 microservices を直接呼び出す chatty なすぎますよりも少ない影響があります。

-   掛けませんを正しく、API のゲートウェイがボトルネックになります。

-   カスタム ロジックとデータの集計が含まれている場合、API ゲートウェイにより追加の開発コストと今後のメンテナンスが必要です。 開発者は、各マイクロ サービスのエンドポイントを公開するために、API のゲートウェイを更新する必要があります。 さらに、内部 microservices の実装の変更には、ゲートウェイの API レベルでコードの変更があります。 ただし、セキュリティ、ログ、およびバージョン管理 API のゲートウェイが適用した場合 (として Azure API Management を使用する場合)、この追加の開発コストを適用できません。

-   API ゲートウェイは、1 つのチームによって開発されたが、開発のボトルネックがあります。 これより適切な方法がいくつか罰金-設定が可能な API のゲートウェイにさまざまなクライアントのニーズに対応する別の理由です。 API ゲートウェイは複数の領域または内部 microservices で作業して別のチームによって所有されているレイヤーに内部的に分離することも可能性があります。

## <a name="additional-resources"></a>その他の技術情報

-   **Charles Richardson です。パターン: API ゲートウェイ/のバックエンドでフロント エンド**
    [*http://microservices.io/patterns/apigateway.html*](http://microservices.io/patterns/apigateway.html)

-   **Azure API Management**
    [*https://azure.microsoft.com/services/api-management/*](https://azure.microsoft.com/services/api-management/)

-   **Udi Dahan です。サービス指向の合成**\
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)

-   **Clemens Vasters です。メッセージングと GOTO 2016 で Microservices** (ビデオ) [ *https://www.youtube.com/watch?v=rXi5CLjIQ9k*](https://www.youtube.com/watch?v=rXi5CLjIQ9k)


>[!div class="step-by-step"]
[前](特定のマイクロ サービスのドメイン-モデル-boundaries.md) [次へ] (通信-で-マイクロ サービス-architecture.md)
