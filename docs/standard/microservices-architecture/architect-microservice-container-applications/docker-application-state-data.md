---
title: "状態と Docker のアプリケーションでのデータ"
description: "コンテナーの .NET アプリケーションの .NET Microservices アーキテクチャ |状態と Docker のアプリケーションでのデータ"
keywords: "Docker, Microservices、ASP.NET、コンテナー、SQL、CosmosDB、Docker"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/18/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 36d0fb9f27ef56b36c380e2fc972c79cff77003e
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2017
---
# <a name="state-and-data-in-docker-applications"></a><span data-ttu-id="c3024-104">状態と Docker のアプリケーションでのデータ</span><span class="sxs-lookup"><span data-stu-id="c3024-104">State and data in Docker applications</span></span>

<span data-ttu-id="c3024-105">ほとんどの場合は、プロセスのインスタンスとコンテナーの考えることができます。</span><span class="sxs-lookup"><span data-stu-id="c3024-105">In most cases, you can think of a container as an instance of a process.</span></span> <span data-ttu-id="c3024-106">プロセスでは、永続的な状態は保持されません。</span><span class="sxs-lookup"><span data-stu-id="c3024-106">A process does not maintain persistent state.</span></span> <span data-ttu-id="c3024-107">コンテナーは、そのローカル ストレージに書き込むことができます、中には、メモリ内の 1 つの場所が持続的にすると仮定した場合のようになりますインスタンスがなるを無期限と仮定した場合します。</span><span class="sxs-lookup"><span data-stu-id="c3024-107">While a container can write to its local storage, assuming that an instance will be around indefinitely would be like assuming that a single location in memory will be durable.</span></span> <span data-ttu-id="c3024-108">プロセスと同様に、コンテナー イメージを複数のインスタンスを持つ見なさまたは強制終了最終的にはコンテナー オーケストレータで管理されています、その必要がありますと見なされます、可能性があります取得から移動である 1 つのノードまたは VM 間。</span><span class="sxs-lookup"><span data-stu-id="c3024-108">Container images, like processes, should be assumed to have multiple instances or that they will eventually be killed; if they’re managed with a container orchestrator, it should be assumed that they might get moved from one node or VM to another.</span></span>

<span data-ttu-id="c3024-109">Docker と呼ばれる機能を提供する、*ファイル システムをオーバーレイ*です。</span><span class="sxs-lookup"><span data-stu-id="c3024-109">Docker provides a feature named the *overlay file system*.</span></span> <span data-ttu-id="c3024-110">これは、ストアが、ルート ファイル システムにコンテナーの情報を更新するコピー オン ライト タスクを実装します。</span><span class="sxs-lookup"><span data-stu-id="c3024-110">This implements a copy-on-write task that stores updated information to the root file system of the container.</span></span> <span data-ttu-id="c3024-111">情報は、コンテナーの基になる元のイメージにはさらにします。</span><span class="sxs-lookup"><span data-stu-id="c3024-111">That information is in addition to the original image on which the container is based.</span></span> <span data-ttu-id="c3024-112">コンテナーが削除された場合、システムから、それらの変更は失われます。</span><span class="sxs-lookup"><span data-stu-id="c3024-112">If the container is deleted from the system, those changes are lost.</span></span> <span data-ttu-id="c3024-113">そのため、そのローカル記憶域内のコンテナーの状態を保存することはできますが、この問題を回避システムの設計と競合コンテナー設計では既定ではステートレスの内部設置型です。</span><span class="sxs-lookup"><span data-stu-id="c3024-113">Therefore, while it is possible to save the state of a container within its local storage, designing a system around this would conflict with the premise of container design, which by default is stateless.</span></span>

<span data-ttu-id="c3024-114">次のソリューションを使用すると、Docker のアプリケーションで永続的なデータを管理します。</span><span class="sxs-lookup"><span data-stu-id="c3024-114">The following solutions are used to manage persistent data in Docker applications:</span></span>

-   <span data-ttu-id="c3024-115">[データ ボリューム](https://docs.docker.com/engine/tutorials/dockervolumes/)ホストにマウントします。</span><span class="sxs-lookup"><span data-stu-id="c3024-115">[Data volumes](https://docs.docker.com/engine/tutorials/dockervolumes/) that mount to the host.</span></span>

-   <span data-ttu-id="c3024-116">[データ ボリューム コンテナー](https://docs.docker.com/engine/tutorials/dockervolumes/#creating-and-mounting-a-data-volume-container)外部のコンテナーを使用してコンテナー間で共有記憶域を提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-116">[Data volume containers](https://docs.docker.com/engine/tutorials/dockervolumes/#creating-and-mounting-a-data-volume-container) that provide shared storage across containers using an external container.</span></span>

-   <span data-ttu-id="c3024-117">[ボリューム プラグイン](https://docs.docker.com/engine/tutorials/dockervolumes/)長期的な永続化を提供するリモート サービスにボリュームをマウントします。</span><span class="sxs-lookup"><span data-stu-id="c3024-117">[Volume plugins](https://docs.docker.com/engine/tutorials/dockervolumes/) that mount volumes to remote services, providing long-term persistence.</span></span>

-   <span data-ttu-id="c3024-118">[Azure ストレージ](https://docs.microsoft.com/azure/storage/)、コンテナーに対する適切な長期的な永続化ソリューションを提供する、geo 配布可能な記憶域を提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-118">[Azure Storage](https://docs.microsoft.com/azure/storage/), which provides geo-distributable storage, providing a good long-term persistence solution for containers.</span></span>

-   <span data-ttu-id="c3024-119">リモートのリレーショナル データベースと同様に[Azure SQL Database](https://azure.microsoft.com/services/sql-database/)などの NoSQL データベースまたは[Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction)、やなどのサービスをキャッシュ[Redis](https://redis.io/)です。</span><span class="sxs-lookup"><span data-stu-id="c3024-119">Remote relational databases like [Azure SQL Database](https://azure.microsoft.com/services/sql-database/) or NoSQL databases like [Azure Cosmos DB](https://docs.microsoft.com/azure/cosmos-db/introduction), or cache services like [Redis](https://redis.io/).</span></span>

<span data-ttu-id="c3024-120">次に、これらのオプションについての詳細を提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-120">The following provides more detail about these options.</span></span>

<span data-ttu-id="c3024-121">**データ ボリューム**コンテナー内のディレクトリに、ホスト OS からマップされたディレクトリであります。</span><span class="sxs-lookup"><span data-stu-id="c3024-121">**Data volumes** are directories mapped from the host OS to directories in containers.</span></span> <span data-ttu-id="c3024-122">ときに、コンテナー内のコードは、アクセスは、ホスト OS 上のディレクトリに実際には、ディレクトリへのアクセスを持っています。</span><span class="sxs-lookup"><span data-stu-id="c3024-122">When code in the container has access to the directory, that access is actually to a directory on the host OS.</span></span> <span data-ttu-id="c3024-123">このディレクトリは、コンテナー、自体の有効期間に関連付けられていないと、ディレクトリに直接ホスト OS で実行されているコードからアクセスできるまたは別のコンテナーでそれ自体に、同じホストのディレクトリをマップします。</span><span class="sxs-lookup"><span data-stu-id="c3024-123">This directory is not tied to the lifetime of the container itself, and the directory can be accessed from code running directly on the host OS or by another container that maps the same host directory to itself.</span></span> <span data-ttu-id="c3024-124">したがって、データ ボリュームは、コンテナーの有効期間とは別にデータを保持する設計されています。</span><span class="sxs-lookup"><span data-stu-id="c3024-124">Thus, data volumes are designed to persist data independently of the life of the container.</span></span> <span data-ttu-id="c3024-125">コンテナーを削除するかで Docker ホストのデータからイメージが保存される場合、データ ボリュームは削除されません。</span><span class="sxs-lookup"><span data-stu-id="c3024-125">If you delete a container or an image from the Docker host, the data persisted in the data volume is not deleted.</span></span> <span data-ttu-id="c3024-126">ボリュームのデータは、ホスト OS もからアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c3024-126">The data in a volume can be accessed from the host OS as well.</span></span>

<span data-ttu-id="c3024-127">**データ ボリューム コンテナー**の通常のデータ ボリュームの発展させたものです。</span><span class="sxs-lookup"><span data-stu-id="c3024-127">**Data volume containers** are an evolution of regular data volumes.</span></span> <span data-ttu-id="c3024-128">データ ボリューム コンテナーとは、その中の 1 つまたは複数のデータ ボリュームのある単純なコンテナーです。</span><span class="sxs-lookup"><span data-stu-id="c3024-128">A data volume container is a simple container that has one or more data volumes within it.</span></span> <span data-ttu-id="c3024-129">データ ボリューム コンテナーは、中央のマウント ポイントから、コンテナーにアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-129">The data volume container provides access to containers from a central mount point.</span></span> <span data-ttu-id="c3024-130">データ アクセスのこのメソッドは、元のデータの場所を抽象化ので便利です。</span><span class="sxs-lookup"><span data-stu-id="c3024-130">This method of data access is convenient because it abstracts the location of the original data.</span></span> <span data-ttu-id="c3024-131">それを除けば、その動作は、アプリケーションのコンテナーのライフ サイクルとは無関係に、この専用コンテナー内のデータが永続化されるため、通常のデータ ボリュームに似ています。</span><span class="sxs-lookup"><span data-stu-id="c3024-131">Other than that, its behavior is similar to that of a regular data volume, so data is persisted in this dedicated container independently of the lifecycle of the application’s containers.</span></span>

<span data-ttu-id="c3024-132">図 4-5 に示すように、コンテナー自体の外部では、ホスト サーバーまたは VM の物理的な境界内で正規の Docker ボリュームに格納できます。</span><span class="sxs-lookup"><span data-stu-id="c3024-132">As shown in Figure 4-5, regular Docker volumes can be stored outside of the containers themselves but within the physical boundaries of the host server or VM.</span></span> <span data-ttu-id="c3024-133">ただし、Docker コンテナーは、別に、1 つのホスト サーバーまたは VM からボリュームをアクセスできません。</span><span class="sxs-lookup"><span data-stu-id="c3024-133">However, Docker containers cannot access a volume from one host server or VM to another.</span></span> <span data-ttu-id="c3024-134">つまり、これらのボリュームでことはできませんを別の Docker ホストに実行しているコンテナー間で共有データを管理するには</span><span class="sxs-lookup"><span data-stu-id="c3024-134">In other words, with these volumes, it is not possible to manage data shared between containers that run on different Docker hosts</span></span>

![](./media/image5.png)

<span data-ttu-id="c3024-135">**図 4-5**です。</span><span class="sxs-lookup"><span data-stu-id="c3024-135">**Figure 4-5**.</span></span> <span data-ttu-id="c3024-136">データのボリュームとコンテナー ベースのアプリケーションの外部データ ソース</span><span class="sxs-lookup"><span data-stu-id="c3024-136">Data volumes and external data sources for container-based applications</span></span>

<span data-ttu-id="c3024-137">さらに、Docker コンテナーは、orchestrator によって管理されている、ときにコンテナー可能性があります""ホスト間で移動、クラスターによって行われる最適化によって異なります。</span><span class="sxs-lookup"><span data-stu-id="c3024-137">In addition, when Docker containers are managed by an orchestrator, containers might “move” between hosts, depending on the optimizations performed by the cluster.</span></span> <span data-ttu-id="c3024-138">したがって、ビジネス データをデータ ボリュームを使用することをいないお勧めします。</span><span class="sxs-lookup"><span data-stu-id="c3024-138">Therefore, it is not recommended that you use data volumes for business data.</span></span> <span data-ttu-id="c3024-139">トレース ファイル、テンポラル ファイルを使用する適切なメカニズムはまたはも、類似するには影響しませんビジネス データの一貫性。</span><span class="sxs-lookup"><span data-stu-id="c3024-139">But they are a good mechanism to work with trace files, temporal files, or similar that will not impact business data consistency.</span></span>

<span data-ttu-id="c3024-140">**ボリューム プラグイン**など[Flocker](https://clusterhq.com/flocker/)クラスター内のすべてのホスト間でデータ アクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-140">**Volume plugins** like [Flocker](https://clusterhq.com/flocker/) provide data access across all hosts in a cluster.</span></span> <span data-ttu-id="c3024-141">すべてのボリューム プラグインが同様に作成される、中にボリュームのプラグインは通常外部化された永続的な信頼性の高い記憶域の変更できないコンテナーを提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-141">While not all volume plugins are created equally, volume plugins typically provide externalized persistent reliable storage from immutable containers.</span></span>

<span data-ttu-id="c3024-142">**リモート データ ソースとキャッシュ**コンテナー詰めアプリケーション コンテナーせずを開発するときの使用は Azure SQL Database、Azure Cosmos DB、またはリモートのキャッシュで Redis を使用できるようになどのツールです。</span><span class="sxs-lookup"><span data-stu-id="c3024-142">**Remote data sources and cache** tools like Azure SQL Database, Azure Cosmos DB, or a remote cache like Redis can be used in containerized applications the same way they are used when developing without containers.</span></span> <span data-ttu-id="c3024-143">これは、実績のあるビジネス アプリケーション データの格納方法です。</span><span class="sxs-lookup"><span data-stu-id="c3024-143">This is a proven way to store business application data.</span></span>

<span data-ttu-id="c3024-144">**Azure のストレージです。**</span><span class="sxs-lookup"><span data-stu-id="c3024-144">**Azure Storage.**</span></span> <span data-ttu-id="c3024-145">ビジネス データは、通常を外部のリソースまたは Azure Storage などのデータベースに配置する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c3024-145">Business data usually will need to be placed in external resources or databases, like Azure Storage.</span></span> <span data-ttu-id="c3024-146">具象型での azure ストレージでは、クラウド内の次のサービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-146">Azure Storage, in concrete, provides the following services in the cloud:</span></span>

-   <span data-ttu-id="c3024-147">Blob ストレージでは、非構造化オブジェクト データを格納します。</span><span class="sxs-lookup"><span data-stu-id="c3024-147">Blob storage stores unstructured object data.</span></span> <span data-ttu-id="c3024-148">Blob は、ドキュメントやメディアのファイル (画像、オーディオ、およびビデオ ファイル) などのテキストまたはバイナリ データの任意の型にすることができます。</span><span class="sxs-lookup"><span data-stu-id="c3024-148">A blob can be any type of text or binary data, such as document or media files (images, audio, and video files).</span></span> <span data-ttu-id="c3024-149">Blob ストレージは、オブジェクトの格納とも呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="c3024-149">Blob storage is also referred to as Object storage.</span></span>

-   <span data-ttu-id="c3024-150">ファイル記憶域は、標準の SMB プロトコルを使用してレガシ アプリケーション用の共有記憶域を提供します。</span><span class="sxs-lookup"><span data-stu-id="c3024-150">File storage offers shared storage for legacy applications using standard SMB protocol.</span></span> <span data-ttu-id="c3024-151">Azure の仮想マシンおよびクラウド サービスは、マウントされた共有を介してアプリケーション コンポーネント間で、ファイル データを共有することができます。</span><span class="sxs-lookup"><span data-stu-id="c3024-151">Azure virtual machines and cloud services can share file data across application components via mounted shares.</span></span> <span data-ttu-id="c3024-152">内部設置型アプリケーションは、ファイル サービス REST API を介して、共有内のファイル データにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="c3024-152">On-premises applications can access file data in a share via the File service REST API.</span></span>

-   <span data-ttu-id="c3024-153">テーブル ストレージは、構造化されたデータセットを格納します。</span><span class="sxs-lookup"><span data-stu-id="c3024-153">Table storage stores structured datasets.</span></span> <span data-ttu-id="c3024-154">テーブル ストレージは、迅速な開発と大量のデータを高速アクセスを許可する NoSQL キー属性データ ストア、です。</span><span class="sxs-lookup"><span data-stu-id="c3024-154">Table storage is a NoSQL key-attribute data store, which allows rapid development and fast access to large quantities of data.</span></span>

<span data-ttu-id="c3024-155">**リレーショナル データベースおよび NoSQL データベース。**</span><span class="sxs-lookup"><span data-stu-id="c3024-155">**Relational databases and NoSQL databases.**</span></span> <span data-ttu-id="c3024-156">SQL Server、PostgreSQL、Oracle、または NoSQL データベースと Azure Cosmos DB、MongoDB などのようなリレーショナル データベースから、外部のデータベースを使用する場合は、多くの選択肢があります。これらのデータベースは、まったく異なるサブジェクトであるため、このガイドの一部として説明する予定がないです。</span><span class="sxs-lookup"><span data-stu-id="c3024-156">There are many choices for external databases, from relational databases like SQL Server, PostgreSQL, Oracle, or NoSQL databases like Azure Cosmos DB, MongoDB, etc. These databases are not going to be explained as part of this guide since they are in a completely different subject.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="c3024-157">[前](containerize-モノリシック-applications.md) [次へ] (サービス-指向-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="c3024-157">[Previous] (containerize-monolithic-applications.md) [Next] (service-oriented-architecture.md)</span></span>
