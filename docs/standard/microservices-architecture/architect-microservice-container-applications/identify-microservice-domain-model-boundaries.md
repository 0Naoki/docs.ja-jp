---
title: "各マイクロ サービスのドメイン モデルの境界を識別します。"
description: "コンテナーの .NET アプリケーションの .NET Microservices アーキテクチャ |各マイクロ サービスのドメイン モデルの境界を識別します。"
keywords: "Docker, マイクロサービス, ASP.NET, コンテナー"
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 6fef11e5718706701abb29149c4c4a23ba39bde0
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2017
---
# <a name="identify-domain-model-boundaries-for-each-microservice"></a><span data-ttu-id="27e89-104">各マイクロ サービスをドメイン モデルの境界を特定します。</span><span class="sxs-lookup"><span data-stu-id="27e89-104">Identify domain-model boundaries for each microservice</span></span>

<span data-ttu-id="27e89-105">モデルの境界と各マイクロ サービスのサイズを特定するときに目標は、可能であれば小さな microservices に向かってが多く必要がありますが、できませんを最も細かい分離を実現するためです。</span><span class="sxs-lookup"><span data-stu-id="27e89-105">The goal when identifying model boundaries and size for each microservice is not to get to the most granular separation possible, although you should tend toward small microservices if possible.</span></span> <span data-ttu-id="27e89-106">代わりに、目標は、ドメインのナレッジによって実行される最も意味のある分離を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-106">Instead, your goal should be to get to the most meaningful separation guided by your domain knowledge.</span></span> <span data-ttu-id="27e89-107">重点を置いてされませんサイズには、代わりにビジネス機能にします。</span><span class="sxs-lookup"><span data-stu-id="27e89-107">The emphasis is not on the size, but instead on business capabilities.</span></span> <span data-ttu-id="27e89-108">さらに、依存関係の数が多いに基づいて、アプリケーションの特定の部分に必要な凝集度クリアが場合を示す単一のマイクロ サービスの必要性すぎます。</span><span class="sxs-lookup"><span data-stu-id="27e89-108">In addition, if there is clear cohesion needed for a certain area of the application based on a high number of dependencies, that indicates the need for a single microservice, too.</span></span> <span data-ttu-id="27e89-109">凝集度は、グループ化 microservices または分解する方法を識別する方法です。</span><span class="sxs-lookup"><span data-stu-id="27e89-109">Cohesion is a way to identify how to break apart or group together microservices.</span></span> <span data-ttu-id="27e89-110">最終的には、さらに、ドメインに関するナレッジを取得するときに、マイクロ サービスのサイズを繰り返し調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-110">Ultimately, while you gain more knowledge about the domain, you should adapt the size of your microservice, iteratively.</span></span> <span data-ttu-id="27e89-111">適切なサイズを検索することは、1 回限りプロセスではありません。</span><span class="sxs-lookup"><span data-stu-id="27e89-111">Finding the right size is not a one-shot process.</span></span>

<span data-ttu-id="27e89-112">[Sam ようにしてください](http://samnewman.io/)、microservices とブックの作成者の認識されたプロモーター[構築 Microservices](http://samnewman.io/books/building_microservices/)、範囲指定されたコンテキスト (BC) パターン (の一部に基づいて、microservices を設計することを強調表示。ドメイン ベースの設計)、以前に導入されました。</span><span class="sxs-lookup"><span data-stu-id="27e89-112">[Sam Newman](http://samnewman.io/), a recognized promoter of microservices and author of the book [Building Microservices](http://samnewman.io/books/building_microservices/), highlights that you should design your microservices based on the Bounded Context (BC) pattern (part of domain-driven design), as introduced earlier.</span></span> <span data-ttu-id="27e89-113">場合によっては、いくつかの物理サービス、その逆は、ビジネス継続性を構成することでした。</span><span class="sxs-lookup"><span data-stu-id="27e89-113">Sometimes, a BC could be composed of several physical services, but not vice versa.</span></span>

<span data-ttu-id="27e89-114">具体的なビジネス継続性内で特定のドメイン エンティティとドメイン モデルを適用またはマイクロ サービス。</span><span class="sxs-lookup"><span data-stu-id="27e89-114">A domain model with specific domain entities applies within a concrete BC or microservice.</span></span> <span data-ttu-id="27e89-115">A BC ドメイン モデルの適用性を取り出すためし、示しています。 開発者のチーム メンバー、はっきりと共有の理解結束力とする必要があり、新機能を別途開発します。</span><span class="sxs-lookup"><span data-stu-id="27e89-115">A BC delimits the applicability of a domain model and gives developer team members a clear and shared understanding of what must be cohesive and what can be developed independently.</span></span> <span data-ttu-id="27e89-116">これらは、microservices の目的は同じです。</span><span class="sxs-lookup"><span data-stu-id="27e89-116">These are the same goals for microservices.</span></span>

<span data-ttu-id="27e89-117">設計で選択に通知する別のツールは[Conway の法則](https://en.wikipedia.org/wiki/Conway%27s_law)アプリケーションがこれを生成した組織のソーシャル境界を示すことを示すです。</span><span class="sxs-lookup"><span data-stu-id="27e89-117">Another tool that informs your design choice is [Conway’s law](https://en.wikipedia.org/wiki/Conway%27s_law), which states that an application will reflect the social boundaries of the organization that produced it.</span></span> <span data-ttu-id="27e89-118">場合によってはその反対ですが、-、会社の組織は、ソフトウェアを作成します。</span><span class="sxs-lookup"><span data-stu-id="27e89-118">But sometimes the opposite is true—the company’s organization is formed by the software.</span></span> <span data-ttu-id="27e89-119">必要があります Conway の法則を取り消すし、会社を整理することを希望どおりに境界をビルドするビジネス プロセスのコンサルティングに向かって傾いた。</span><span class="sxs-lookup"><span data-stu-id="27e89-119">You might need to reverse Conway’s law and build the boundaries the way you want the company to be organized, leaning toward business process consulting.</span></span>

<span data-ttu-id="27e89-120">これを使用できる DDD パターンは、境界のあるコンテキストを特定するために、[コンテキスト マッピング パターン](https://www.infoq.com/articles/ddd-contextmapping)です。</span><span class="sxs-lookup"><span data-stu-id="27e89-120">In order to identify bounded contexts, a DDD pattern that can be used for this is the [Context Mapping pattern](https://www.infoq.com/articles/ddd-contextmapping).</span></span> <span data-ttu-id="27e89-121">コンテキストのマッピングを使用すると、アプリケーションとその境界にさまざまなコンテキストを確認します。</span><span class="sxs-lookup"><span data-stu-id="27e89-121">With Context Mapping, you identify the various contexts in the application and their boundaries.</span></span> <span data-ttu-id="27e89-122">一般に、別のコンテキストと各小規模のサブシステムの境界をインスタンスがあります。</span><span class="sxs-lookup"><span data-stu-id="27e89-122">It is common to have a different context and boundary for each small subsystem, for instance.</span></span> <span data-ttu-id="27e89-123">コンテキストのマッピングを定義し、明示的なこれらの境界内のドメイン間で方法です。</span><span class="sxs-lookup"><span data-stu-id="27e89-123">The Context Map is a way to define and make explicit those boundaries between domains.</span></span> <span data-ttu-id="27e89-124">A BC 自律的なは、1 つのドメインの詳細が含まれています: などのドメイン エンティティの詳細: し、その他の BCs で統合コントラクトを定義します。</span><span class="sxs-lookup"><span data-stu-id="27e89-124">A BC is autonomous and includes the details of a single domain—details like the domain entities—and defines integration contracts with other BCs.</span></span> <span data-ttu-id="27e89-125">これは、マイクロ サービスの定義に似ています。 は自律と特定のドメインの機能を実装して、インターフェイスを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-125">This is similar to the definition of a microservice: it is autonomous, it implements certain domain capability, and it must provide interfaces.</span></span> <span data-ttu-id="27e89-126">これは、コンテキストのマッピングとコンテキストの境界を付けられたパターンが、microservices のドメイン モデルの境界を識別するための適切な方法である理由。</span><span class="sxs-lookup"><span data-stu-id="27e89-126">This is why Context Mapping and the Bounded Context pattern are good approaches for identifying the domain model boundaries of your microservices.</span></span>

<span data-ttu-id="27e89-127">大規模なアプリケーションを設計すると、ドメイン モデルをフラグメント化する方法が表示されます — カタログ ドメインからドメイン エキスパートという名前のエンティティ配布ドメインの専門家よりカタログおよび在庫のドメインでは異なる方法でのインスタンス。</span><span class="sxs-lookup"><span data-stu-id="27e89-127">When designing a large application, you will see how its domain model can be fragmented — a domain expert from the catalog domain will name entities differently in the catalog and inventory domains than a shipping domain expert, for instance.</span></span> <span data-ttu-id="27e89-128">またはよりも、順序付けドメインの専門家で顧客に関するデータの一部に必要なだけの顧客に関するすべての詳細を格納したい CRM 専門家を処理する場合、ユーザーのドメイン エンティティが属性のサイズと数で異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-128">Or the user domain entity might be different in size and number of attributes when dealing with a CRM expert who wants to store every detail about the customer than for an ordering domain expert who just needs partial data about the customer.</span></span> <span data-ttu-id="27e89-129">大規模なアプリケーションに関連するすべてのドメイン間ですべてのドメインの用語を区別するために非常に困難です。</span><span class="sxs-lookup"><span data-stu-id="27e89-129">It is very hard to disambiguate all domain terms across all the domains related to a large application.</span></span> <span data-ttu-id="27e89-130">最も重要な点は、実行しないでください。 条項の統一を代わりに、各ドメインで提供される豊富な機能と相違点を受け入れます。</span><span class="sxs-lookup"><span data-stu-id="27e89-130">But the most important thing is that you should not try to unify the terms; instead, accept the differences and richness provided by each domain.</span></span> <span data-ttu-id="27e89-131">アプリケーション全体の統一されたデータベースが存在する場合に、統一されたボキャブラリの試みは不適切ななり音は再生されません複数ドメインの専門家のいずれかにされます。</span><span class="sxs-lookup"><span data-stu-id="27e89-131">If you try to have a unified database for the whole application, attempts at a unified vocabulary will be awkward and will not sound right to any of the multiple domain experts.</span></span> <span data-ttu-id="27e89-132">したがって、BCs (microservices として実装) では、特定ドメインの用語を使用して、システムを分割し、別のドメインと追加 BCs を作成する必要を明確にすることができます。</span><span class="sxs-lookup"><span data-stu-id="27e89-132">Therefore, BCs (implemented as microservices) will help you to clarify where you can use certain domain terms and where you will need to split the system and create additional BCs with different domains.</span></span>

<span data-ttu-id="27e89-133">右側の境界と各ビジネス継続性のサイズを取得して、ドメイン モデル ドメイン モデルの間でのいくつかの強力な関係があり、通常は操作を行う場合必要がある一般的なアプリケーションを実行するときに、複数のドメイン モデルからの情報をマージすることがわかっては操作です。</span><span class="sxs-lookup"><span data-stu-id="27e89-133">You will know that you got the right boundaries and sizes of each BC and domain model if you have few strong relationships between domain models, and you do not usually need to merge information from multiple domain models when performing typical application operations.</span></span>

<span data-ttu-id="27e89-134">おそらく、各マイクロ サービスのドメイン モデルはどのくらいはずの質問への回答は、次: 自律的なビジネス継続性がある限り、常に他のコンテキスト (その他に切り替えることがなく動作することができます、分離マイクロ サービスのモデルの場合)。</span><span class="sxs-lookup"><span data-stu-id="27e89-134">Perhaps the best answer to the question of how big a domain model for each microservice should be is the following: it should have an autonomous BC, as isolated as possible, that enables you to work without having to constantly switch to other contexts (other microservice’s models).</span></span> <span data-ttu-id="27e89-135">図 4-10 ご覧複数 microservices (複数 BCs) 各がある独自のモデルと方法、エンティティを定義する各アプリケーションで識別されたドメインの特定の要件に応じてどのようにします。</span><span class="sxs-lookup"><span data-stu-id="27e89-135">In Figure 4-10 you can see how multiple microservices (multiple BCs) each have their own model and how their entities can be defined, depending on the specific requirements for each of the identified domains in your application.</span></span>

![](./media/image10.png)

<span data-ttu-id="27e89-136">**図 4-10**です。</span><span class="sxs-lookup"><span data-stu-id="27e89-136">**Figure 4-10**.</span></span> <span data-ttu-id="27e89-137">エンティティとマイクロ サービス モデルの境界を識別します。</span><span class="sxs-lookup"><span data-stu-id="27e89-137">Identifying entities and microservice model boundaries</span></span>

<span data-ttu-id="27e89-138">図 4-10 は、オンライン会議管理システムに関連するサンプル シナリオを示しています。</span><span class="sxs-lookup"><span data-stu-id="27e89-138">Figure 4-10 illustrates a sample scenario related to an online conference management system.</span></span> <span data-ttu-id="27e89-139">ドメインの専門家が定義されているドメインに基づく microservices として実装することがいくつかの BCs を特定しておきます。</span><span class="sxs-lookup"><span data-stu-id="27e89-139">You have identified several BCs that could be implemented as microservices, based on domains that domain experts defined for you.</span></span> <span data-ttu-id="27e89-140">ご覧のように、支払いマイクロ サービスで支払いを処理などの単一のマイクロ サービス モデルにのみ存在するエンティティがあります。</span><span class="sxs-lookup"><span data-stu-id="27e89-140">As you can see, there are entities that are present just in a single microservice model, like Payments in the Payment microservice.</span></span> <span data-ttu-id="27e89-141">実装する簡単なものになります。</span><span class="sxs-lookup"><span data-stu-id="27e89-141">Those will be easy to implement.</span></span>

<span data-ttu-id="27e89-142">ただし、別の図形が複数の microservices から複数のドメイン モデル間で同じ id を共有するエンティティを設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="27e89-142">However, you might also have entities that have a different shape but share the same identity across the multiple domain models from the multiple microservices.</span></span> <span data-ttu-id="27e89-143">たとえば、ユーザー エンティティは、会議管理マイクロ サービスで識別されます。</span><span class="sxs-lookup"><span data-stu-id="27e89-143">For example, the User entity is identified in the Conferences Management microservice.</span></span> <span data-ttu-id="27e89-144">同じ id を使用してその同じユーザーも、1 つは、順序付けマイクロ サービスの購入者率をという名前の 1 つで支払いマイクロ サービスおよびカスタマー サービス マイクロ サービスの 1 つの名前付きユーザーでも Payer をという名前です。</span><span class="sxs-lookup"><span data-stu-id="27e89-144">That same user, with the same identity, is the one named Buyers in the Ordering microservice, or the one named Payer in the Payment microservice, and even the one named Customer in the Customer Service microservice.</span></span> <span data-ttu-id="27e89-145">これは、理由は、によって、[ユビキタス言語](https://martinfowler.com/bliki/UbiquitousLanguage.html)が各ドメインの専門家が使用されているは、ユーザーことがありますの異なる属性を使用しても異なるパースペクティブです。</span><span class="sxs-lookup"><span data-stu-id="27e89-145">This is because, depending on the [ubiquitous language](https://martinfowler.com/bliki/UbiquitousLanguage.html) that each domain expert is using, a user might have a different perspective even with different attributes.</span></span> <span data-ttu-id="27e89-146">会議 Management という名前のマイクロ サービス モデルのユーザー エンティティは、ほとんどの個人データ属性を含めることができます。</span><span class="sxs-lookup"><span data-stu-id="27e89-146">The user entity in the microservice model named Conferences Management might have most of its personal data attributes.</span></span> <span data-ttu-id="27e89-147">ただし、マイクロ サービスの支払いまたはマイクロ サービス顧客サービスの顧客の図形に Payer の形でそのユーザーに同じでは、同じ属性の一覧が必要ありません可能性があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-147">However, that same user in the shape of Payer in the microservice Payment or in the shape of Customer in the microservice Customer Service might not need the same list of attributes.</span></span>

<span data-ttu-id="27e89-148">同様のアプローチでは、図 4-11 を示しています。</span><span class="sxs-lookup"><span data-stu-id="27e89-148">A similar approach is illustrated in Figure 4-11.</span></span>

![](./media/image11.png)

<span data-ttu-id="27e89-149">**図 4-11**です。</span><span class="sxs-lookup"><span data-stu-id="27e89-149">**Figure 4-11**.</span></span> <span data-ttu-id="27e89-150">複数のドメイン モデルへの従来のデータ モデルの分解</span><span class="sxs-lookup"><span data-stu-id="27e89-150">Decomposing traditional data models into multiple domain models</span></span>

<span data-ttu-id="27e89-151">方法は、ユーザーのエンティティとして会議管理マイクロ サービス モデル内にあるとは、ユーザーも価格マイクロ サービスの代替の属性または購入者に実際にあるときにユーザーの詳細での購入者エンティティの形式で存在を確認できます。</span><span class="sxs-lookup"><span data-stu-id="27e89-151">You can see how the user is present in the Conferences Management microservice model as the User entity and is also present in the form of the Buyer entity in the Pricing microservice, with alternate attributes or details about the user when it is actually a buyer.</span></span> <span data-ttu-id="27e89-152">各マイクロ サービスまたはビジネス継続性では、一部のみ、その問題を解決するか、コンテキストに応じて、ユーザーのエンティティに関連するすべてのデータは必要ありません可能性があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-152">Each microservice or BC might not need all the data related to a User entity, just part of it, depending on the problem to solve or the context.</span></span> <span data-ttu-id="27e89-153">たとえば、価格マイクロ サービス モデルで必要はありませんアドレス、または (id) として ID と状態で、buyer ごとのライセンスの価格と割引に、悪影響を与えるだけのユーザーの ID。</span><span class="sxs-lookup"><span data-stu-id="27e89-153">For instance, in the Pricing microservice model, you do not need the address or the ID of the user, just ID (as identity) and Status, which will have an impact on discounts when pricing the seats per buyer.</span></span>

<span data-ttu-id="27e89-154">接続クライアント ライセンス エンティティには、同じ名前で各ドメイン モデルで異なる属性。</span><span class="sxs-lookup"><span data-stu-id="27e89-154">The Seat entity has the same name but different attributes in each domain model.</span></span> <span data-ttu-id="27e89-155">ただし、接続クライアント数が、同じ ID に基づく id を共有のユーザーと購入者が発生するとします。</span><span class="sxs-lookup"><span data-stu-id="27e89-155">However, Seat shares identity based on the same ID, as happens with User and Buyer.</span></span>

<span data-ttu-id="27e89-156">基本的には、そのユーザーの id を共有する複数のサービス (ドメイン) に存在するユーザーの共有の概念があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-156">Basically, there is a shared concept of a user that exists in multiple services (domains), which all share the identity of that user.</span></span> <span data-ttu-id="27e89-157">各ドメイン モデルでは、ユーザー エンティティに関する詳細を追加または変更する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-157">But in each domain model there might be additional or different details about the user entity.</span></span> <span data-ttu-id="27e89-158">そのため、1 つのドメイン (マイクロ サービス) から別のユーザー エンティティにマップする方法が必要です。</span><span class="sxs-lookup"><span data-stu-id="27e89-158">Therefore, there needs to be a way to map a user entity from one domain (microservice) to another.</span></span>

<span data-ttu-id="27e89-159">これにはないドメイン間で同じ数の属性のと同じユーザー エンティティを共有するいくつかの利点があります。</span><span class="sxs-lookup"><span data-stu-id="27e89-159">There are several benefits to not sharing the same user entity with the same number of attributes across domains.</span></span> <span data-ttu-id="27e89-160">1 つの利点は、重複を減らすようにするマイクロ サービス モデルには、必要がないすべてのデータはありません。</span><span class="sxs-lookup"><span data-stu-id="27e89-160">One benefit is to reduce duplication, so that microservice models do not have any data that they do not need.</span></span> <span data-ttu-id="27e89-161">もう 1 つ利点には、そのマイクロ サービスによってのみの更新プログラムとその種類のデータに対するクエリの実行できるように、特定の種類のエンティティごとのデータを所有しているマスター マイクロ サービスが発生しました。</span><span class="sxs-lookup"><span data-stu-id="27e89-161">Another benefit is having a master microservice that owns a certain type of data per entity so that updates and queries for that type of data are driven only by that microservice.</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="27e89-162">[前](分散-データ-management.md) [次へ] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="27e89-162">[Previous] (distributed-data-management.md) [Next] (direct-client-to-microservice-communication-versus-the-api-gateway-pattern.md)</span></span>
