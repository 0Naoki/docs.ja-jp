---
title: "スレッドおよびスレッド処理"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- multiple threads
- threading [.NET Framework]
- threading [.NET Framework], multiple threads
ms.assetid: 5baac3aa-e603-4fa6-9f89-0f2c1084e6b1
caps.latest.revision: "14"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: b57cac34009e13c27c6d34a0ab402f9ecbe08305
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/21/2017
---
# <a name="threads-and-threading"></a>スレッドおよびスレッド処理
オペレーティング システムでは、プロセスを使用して、実行されている別のアプリケーションを区切ります。 スレッドは、オペレーティング システムが、プロセッサ時間を割り当てる基本単位と、複数のスレッドが、プロセス内でコードを実行することができます。 各スレッドは、例外ハンドラー、スケジューリング優先順位、およびシステムを使用して保存のスレッド コンテキストがスケジュールされるまで構造のセットを保持します。 スレッド コンテキストには、シームレスに実行を再開する、スレッドのホスト プロセスのアドレス空間内の CPU レジスタおよびスタック、スレッドのセットを含む、スレッドが必要なすべての情報が含まれます。  
  
 さらに、.NET Framework、オペレーティング システム プロセスに細分化によって表される、アプリケーション ドメインと呼ばれる、軽量のマネージ サブプロセス<xref:System.AppDomain?displayProperty=nameWithType>です。 1 つ以上のマネージ スレッド (によって表される<xref:System.Threading.Thread?displayProperty=nameWithType>)、同じ管理対象プロセス内のアプリケーション ドメインの 1 つまたは任意の数で実行できます。 各アプリケーション ドメインは 1 つのスレッドを開始、そのアプリケーション ドメイン内のコードは追加のアプリケーション ドメインと追加のスレッドを作成できます。 結果は、マネージ スレッドが同じマネージ プロセス; 内のアプリケーション ドメイン間で自由に移動できます。1 つのスレッドが複数のアプリケーション ドメイン間を移動するがあります。  
  
 Preemptive マルチタスク処理をサポートするオペレーティング システムでは、複数のプロセスから複数のスレッドの同時実行の効果を作成します。 これで必要なスレッド間で利用可能なプロセッサ時間の分割、各スレッドにプロセッサ時間スライスを 1 つずつ割り当ています。 スライスを過ぎると、その時間と別のスレッドの実行を再開、実行中のスレッドが中断されます。 システムは、別に 1 つのスレッドから切り替える、ときに優先されたスレッドのスレッド コンテキストを保存し、[次へ] のスレッドのスレッドのキューに保存されているスレッドのコンテキストを再読み込みします。  
  
 タイム スライスの長さは、オペレーティング システムと、プロセッサーによって異なります。 各タイム スライスが小さいために、複数のスレッドは、1 つだけのプロセッサがある場合でも、同時に実行されているに見えます。 場合は、実際には、マルチプロセッサ システムで使用できるプロセッサ間での実行可能なスレッドの配布先です。  
  
## <a name="when-to-use-multiple-threads"></a>複数のスレッドを使用するには、場合  
 ユーザーの介入を必要とするソフトウェアが、豊富なユーザー エクスペリエンスを提供できる限り早くのユーザーのアクティビティに反応する必要があります。 ただし、同時には、できるだけ高速のユーザーにデータを提示するために必要な計算を実行にする必要があります。 アプリケーションでは、実行のスレッドを 1 つだけを使用する場合は、結合[非同期プログラミング](../../../docs/standard/asynchronous-programming-patterns/calling-synchronous-methods-asynchronously.md)で[.NET Framework リモート処理](http://msdn.microsoft.com/en-us/eccb1d31-0a22-417a-97fd-f4f1f3aa4462)または[XML Web サービス](http://msdn.microsoft.com/en-us/1e64af78-d705-4384-b08d-591a45f4379c)ASP を使用して作成されました。ユーザーと、アプリケーションのデータの処理時間が低下するを増やすには独自の応答性をさらに、他のコンピューターの処理時間を使用する .NET します。 入力/出力を要する処理を実行する場合は、アプリケーションの応答性を向上させる、また I/O 完了ポートを使用することができます。  
  
### <a name="advantages-of-multiple-threads"></a>複数のスレッドの利点  
 複数のスレッドを使用して、データがユーザーへの応答性の向上し、ほぼ同時に実行するジョブを取得するために必要なデータの処理に使用できる最も強力な方法です。 1 つのプロセッサを搭載したコンピューターに複数のスレッドがバック グラウンドでデータを処理するユーザーのイベント間の時間の短い時間の利用によって、この効果を作成できます。 たとえば、ユーザーは、別のスレッドが同じアプリケーション内でワークシートの他の部分を再計算中に、スプレッドシートを編集できます。  
  
 変更しない限り、同じアプリケーションの場合は、1 つ以上のプロセッサを搭載したコンピューター上で実行時にユーザーの満足度に著しくです。 1 つのアプリケーション ドメインでは、次のタスクを実行するのに複数のスレッドを使用できます。  
  
-   データベース、Web サーバーに、ネットワーク経由で通信します。  
  
-   大量の時間がかかる操作を実行します。  
  
-   さまざまな優先順位のタスクを識別します。 たとえば、優先度の高いスレッドがタイム クリティカルなタスクを管理し、優先度の低いスレッドが他のタスクを実行します。  
  
-   応答性を維持、バック グラウンド タスクに時間を割り当てているときに、ユーザー インターフェイスを使用できます。  
  
### <a name="disadvantages-of-multiple-threads"></a>複数のスレッドの短所  
 可能な限りは、オペレーティング システム リソースの使用を最小限に抑えるため、パフォーマンスを向上させると、少数のスレッドを使用することをお勧めします。 スレッド処理と、アプリケーションの設計時に考慮すには、リソースの要件と競合の可能性もあります。 リソース要件は次のとおりです。  
  
-   システム プロセス、必要なコンテキスト情報のためのメモリを消費する**AppDomain**オブジェクト、およびスレッドです。 プロセスの数ではそのため、 **AppDomain**オブジェクト、および作成できるスレッドが使用可能なメモリによって制限されます。  
  
-   大量のプロセッサ時間を消費の多数のスレッドを追跡します。 スレッドが多すぎるがある場合、それらのほとんどは重要な進行状況を加えないでます。 現在のスレッドのほとんどは、1 つのプロセスでは、他のプロセス内のスレッドが頻繁にスケジュールされます。  
  
-   コードが実行される多数のスレッドの制御は複雑であり、多くのバグのソースを指定できます。  
  
-   スレッドの破棄するには、発生する可能性が知ることと、それらの問題を処理する必要があります。  
  
 リソースへの共有アクセスを提供すると、競合を作成できます。 競合を避けるためには、同期、か、共有リソースへのアクセスを制御する必要があります。 (2 つのスレッドで応答を停止するには、他のそれぞれが待機中に) デッドロックなどの問題につながる可能性が正しく (同じまたは別のアプリケーション ドメイン) でのアクセスを同期するためにエラーや (ために異常な結果が発生したときに競合状態予測できない動作の 2 つのイベントのタイミングで)。 システムでは、複数のスレッド間の共有リソースを調整するために使用する同期オブジェクトを提供します。 スレッドの数を減らすと、リソースを同期するためにやすくなります。  
  
 同期が必要なリソースは次のとおりです。  
  
-   システム リソース (通信ポートなど)。  
  
-   リソース (ファイル ハンドル) などの複数のプロセスと共有します。  
  
-   1 つのアプリケーション ドメインのリソース (など、グローバルの静的インスタンス フィールドと) 複数のスレッドによってアクセスします。  
  
### <a name="threading-and-application-design"></a>スレッド処理とアプリケーションのデザイン  
 一般を使用して、<xref:System.Threading.ThreadPool>クラスは、他のスレッドがブロックされていないことと、ときに予期しない特定のタスクのスケジューリング、比較的短いタスクに複数のスレッドを処理する最も簡単な方法です。 ただし、これには、独自のスレッドを作成する理由の数があります。  
  
-   特定の優先順位に作業する場合。  
  
-   ある場合は、タスクを実行時間の長い (およびその他のタスクをブロックするため) ことがあります。  
  
-   シングル スレッド アパートメント スレッドに配置する必要があるかどうか (すべて**ThreadPool**スレッドがマルチ スレッド アパートメント内)。  
  
-   場合は、安定した id をスレッドに関連付けられている必要があります。 たとえば、そのスレッドの中止、中断したり、または名前で探索を専用のスレッドを使用する必要があります。  
  
-   .NET Framework version 2.0 は、ユーザー インターフェイスと対話するバック グラウンド スレッドを実行する必要がある場合、<xref:System.ComponentModel.BackgroundWorker>スレッド間のユーザー インターフェイス スレッドにマーシャ リングと、イベントを使用して通信するコンポーネントです。  
  
### <a name="threading-and-exceptions"></a>スレッド処理および例外  
 スレッドで例外を処理します。 偶数のバック グラウンド スレッドでのスレッドでハンドルされない例外は、一般に、プロセスを終了します。 この規則には、次の 3 つの例外があります。  
  
-   A<xref:System.Threading.ThreadAbortException>ためのスレッドでスローされる<xref:System.Threading.Thread.Abort%2A>が呼び出されました。  
  
-   <xref:System.AppDomainUnloadedException>が、アプリケーション ドメインがアンロードされるため、スレッドでスローされます。  
  
-   共通言語ランタイムまたはホスト プロセスがスレッドを終了する。  
  
 詳細については、次を参照してください。[マネージ スレッドの例外](../../../docs/standard/threading/exceptions-in-managed-threads.md)です。  
  
> [!NOTE]
>  .NET Framework バージョン 1.0 および 1.1 では、共通言語ランタイムはサイレント モードでスレッド プールのスレッドの例では、いくつかの例外をトラップします。 これはアプリケーションの状態が破損し、デバッグが困難に可能性のあるアプリケーションが停止するされます。  
  
## <a name="see-also"></a>関連項目  
 <xref:System.Threading.ThreadPool>  
 <xref:System.ComponentModel.BackgroundWorker>  
 [マルチスレッド処理のためのデータの同期](../../../docs/standard/threading/synchronizing-data-for-multithreading.md)  
 [マネージ スレッド プール](../../../docs/standard/threading/the-managed-thread-pool.md)
