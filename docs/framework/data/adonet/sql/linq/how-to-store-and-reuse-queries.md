---
title: '方法: クエリを格納および再利用する'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a012bd79-1809-45e3-adea-0229532396cc
ms.openlocfilehash: 1aac20c3f9c421d353938a83b9e321d35abd244e
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/18/2019
ms.locfileid: "59084195"
---
# <a name="how-to-store-and-reuse-queries"></a><span data-ttu-id="a6375-102">方法: クエリを格納および再利用する</span><span class="sxs-lookup"><span data-stu-id="a6375-102">How to: Store and Reuse Queries</span></span>
<span data-ttu-id="a6375-103">同じ構造のクエリを何回も実行するアプリケーションでは、1 回コンパイルしたクエリを、パラメーターを変えて何回も実行する方が、多くの場合にパフォーマンスを向上できます。</span><span class="sxs-lookup"><span data-stu-id="a6375-103">When you have an application that executes structurally similar queries many times, you can often increase performance by compiling the query one time and executing it several times with different parameters.</span></span> <span data-ttu-id="a6375-104">たとえば、特定の市に住むすべての顧客を取得するアプリケーションで、ユーザーが、対象の市を実行時にフォームで指定するとします。</span><span class="sxs-lookup"><span data-stu-id="a6375-104">For example, an application might have to retrieve all the customers who are in a particular city, where the city is specified at runtime by the user in a form.</span></span> [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="a6375-105">はこの目的のために *コンパイル済みクエリ* の使用をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="a6375-105">supports the use of *compiled queries* for this purpose.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a6375-106">コンパイル済みクエリは、このパターンの使用法が最も一般的です。</span><span class="sxs-lookup"><span data-stu-id="a6375-106">This pattern of usage represents the most common use for compiled queries.</span></span> <span data-ttu-id="a6375-107">その他にも方法は考えられます。</span><span class="sxs-lookup"><span data-stu-id="a6375-107">Other approaches are possible.</span></span> <span data-ttu-id="a6375-108">たとえば、デザイナーによって生成されたコードを継承した部分クラスの静的メンバーとしてコンパイル済みクエリを格納するなどです。</span><span class="sxs-lookup"><span data-stu-id="a6375-108">For example, compiled queries can be stored as static members on a partial class that extends the code generated by the designer.</span></span>  
  
## <a name="example"></a><span data-ttu-id="a6375-109">例</span><span class="sxs-lookup"><span data-stu-id="a6375-109">Example</span></span>  
 <span data-ttu-id="a6375-110">スレッド境界を越えてクエリを再利用することが必要となる場合もよくあります。</span><span class="sxs-lookup"><span data-stu-id="a6375-110">In many scenarios you might want to reuse the queries across thread boundaries.</span></span> <span data-ttu-id="a6375-111">その場合には、コンパイル済みクエリを静的変数に格納することは特に有効です。</span><span class="sxs-lookup"><span data-stu-id="a6375-111">In such cases, storing the compiled queries in static variables is especially effective.</span></span> <span data-ttu-id="a6375-112">次のコード例では、`Queries` クラスはコンパイル済みクエリを格納するためのクラスで、厳密に型指定された <xref:System.Data.Linq.DataContext> を表す Northwind クラスを使用することを想定しています。</span><span class="sxs-lookup"><span data-stu-id="a6375-112">The following code example assumes a `Queries` class designed to store compiled queries, and assumes a Northwind class that represents a strongly typed <xref:System.Data.Linq.DataContext>.</span></span>  
  
 [!code-csharp[DLinqQuerying#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#6)]
 [!code-vb[DLinqQuerying#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#6)]  
  
 [!code-csharp[DLinqQuerying#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#7)]
 [!code-vb[DLinqQuerying#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#7)]  
  
## <a name="example"></a><span data-ttu-id="a6375-113">例</span><span class="sxs-lookup"><span data-stu-id="a6375-113">Example</span></span>  
 <span data-ttu-id="a6375-114">現在できません (静的変数) 内のストアのクエリを返す、*匿名型*型はジェネリック引数として指定する名前があるないため、します。</span><span class="sxs-lookup"><span data-stu-id="a6375-114">You cannot currently store (in static variables) queries that return an *anonymous type*, because type has no name to provide as a generic argument.</span></span> <span data-ttu-id="a6375-115">この問題を回避する方法を次の例に示します。結果を表すことのできる型を作成し、それを汎用引数として使用しています。</span><span class="sxs-lookup"><span data-stu-id="a6375-115">The following example shows how you can work around the issue by creating a type that can represent the result, and then use it as a generic argument.</span></span>  
  
 [!code-csharp[DLinqQuerying#8](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqQuerying/cs/Program.cs#8)]
 [!code-vb[DLinqQuerying#8](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqQuerying/vb/Module1.vb#8)]  
  
## <a name="see-also"></a><span data-ttu-id="a6375-116">関連項目</span><span class="sxs-lookup"><span data-stu-id="a6375-116">See also</span></span>

- <xref:System.Data.Linq.CompiledQuery>
- [<span data-ttu-id="a6375-117">クエリの概念</span><span class="sxs-lookup"><span data-stu-id="a6375-117">Query Concepts</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/query-concepts.md)
- [<span data-ttu-id="a6375-118">データベースに対するクエリの実行</span><span class="sxs-lookup"><span data-stu-id="a6375-118">Querying the Database</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md)
