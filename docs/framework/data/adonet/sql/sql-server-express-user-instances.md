---
title: SQL Server Express ユーザー インスタンス
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 00c12376-cb26-4317-86ad-e6e9c089be57
ms.openlocfilehash: 4546ce2a08fc2ac20717bbaa55d4688b43d34b47
ms.sourcegitcommit: d2ccb199ae6bc5787b4762e9ea6d3f6fe88677af
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/12/2019
ms.locfileid: "56093815"
---
# <a name="sql-server-express-user-instances"></a><span data-ttu-id="a8245-102">SQL Server Express ユーザー インスタンス</span><span class="sxs-lookup"><span data-stu-id="a8245-102">SQL Server Express User Instances</span></span>
<span data-ttu-id="a8245-103">Microsoft SQL Server Express Edition (SQL Server Express) でサポートされる機能に、ユーザー インスタンスがあります。ユーザー インスタンスは、.NET Framework Data Provider for SQL Server (`SqlClient`) を使用している場合にしか利用できません。</span><span class="sxs-lookup"><span data-stu-id="a8245-103">Microsoft SQL Server Express Edition (SQL Server Express) supports the user instance feature, which is only available when using the .NET Framework Data Provider for SQL Server (`SqlClient`).</span></span> <span data-ttu-id="a8245-104">ユーザー インスタンスは、親インスタンスによって生成される SQL Server Express データベース エンジンの独立したインスタンスです。</span><span class="sxs-lookup"><span data-stu-id="a8245-104">A user instance is a separate instance of the SQL Server Express Database Engine that is generated by a parent instance.</span></span> <span data-ttu-id="a8245-105">ユーザー インスタンスを使用すると、ローカル コンピューターの管理者以外のユーザーが、SQL Server Express データベースにアタッチして接続できます。</span><span class="sxs-lookup"><span data-stu-id="a8245-105">User instances allow users who are not administrators on their local computers to attach and connect to SQL Server Express databases.</span></span> <span data-ttu-id="a8245-106">それぞれのインスタンスは、1 ユーザーあたり 1 インスタンスの原則に基づいて、個々のユーザーのセキュリティ コンテキストで実行されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-106">Each instance runs under the security context of the individual user, on a one-instance-per-user basis.</span></span>  
  
## <a name="user-instance-capabilities"></a><span data-ttu-id="a8245-107">ユーザー インスタンスの機能</span><span class="sxs-lookup"><span data-stu-id="a8245-107">User Instance Capabilities</span></span>  
 <span data-ttu-id="a8245-108">Windows を LUA (最小限の特権しか持たないユーザー アカウント) で実行しているユーザーにとっては、ユーザー インスタンスは特に有効な手段です。なぜなら、各ユーザーには、そのコンピューター上で実行されているインスタンスに対して SQL Server システム管理者 (`sysadmin`) の権限が割り当てられ、Windows 管理者として実行する必要がないためです。</span><span class="sxs-lookup"><span data-stu-id="a8245-108">User instances are useful for users who are running Windows under a least-privilege user account (LUA) because each user has SQL Server system administrator (`sysadmin`) privileges over the instance running on her computer without needing to run as a Windows administrator as well.</span></span> <span data-ttu-id="a8245-109">SQL Server Express のユーザー インスタンスは、サービスではなく、そのユーザーの非管理者 Windows アカウントで実行されるため、ユーザー インスタンス上で実行されているソフトウェアは権限が限定され、システム全体に及ぶ変更を行うことはできません。</span><span class="sxs-lookup"><span data-stu-id="a8245-109">Software executing on a user instance with limited permissions cannot make system-wide changes because the instance of SQL Server Express is running under the non-administrator Windows account of the user, not as a service.</span></span> <span data-ttu-id="a8245-110">各ユーザー インスタンスは、その親インスタンスや同じコンピューター上で実行されている他のユーザー インスタンスとは分離されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-110">Each user instance is isolated from its parent instance and from any other user instances running on the same computer.</span></span> <span data-ttu-id="a8245-111">ユーザー インスタンスで実行されているデータベースは、シングル ユーザー モードでのみ開くことができ、複数のユーザーが同じユーザー インスタンス上のデータベースに接続することはできません。</span><span class="sxs-lookup"><span data-stu-id="a8245-111">Databases running on a user instance are opened in single-user mode only, and it is not possible for multiple users to connect to databases running on a user instance.</span></span> <span data-ttu-id="a8245-112">ユーザー インスタンスでは、レプリケーションと分散クエリも無効になります。</span><span class="sxs-lookup"><span data-stu-id="a8245-112">Replication and distributed queries are also disabled for user instances.</span></span>  
  
 <span data-ttu-id="a8245-113">詳細については、SQL Server オンライン ブックの「ユーザー インスタンス」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8245-113">For more information, see "User Instances" in SQL Server Books Online.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a8245-114">既にコンピューターの管理者であるユーザーが、ユーザー インスタンスを使用する必要はありません。また、複数のデータベース ユーザーが関係する場合もユーザー インスタンスは不要です。</span><span class="sxs-lookup"><span data-stu-id="a8245-114">User instances are not needed for users who are already administrators on their own computers, or for scenarios involving multiple database users.</span></span>  
  
## <a name="enabling-user-instances"></a><span data-ttu-id="a8245-115">ユーザー インスタンスの有効化</span><span class="sxs-lookup"><span data-stu-id="a8245-115">Enabling User Instances</span></span>  
 <span data-ttu-id="a8245-116">ユーザー インスタンスを生成するには、SQL Server Express の親インスタンスが実行されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-116">To generate user instances, a parent instance of SQL Server Express must be running.</span></span> <span data-ttu-id="a8245-117">SQL Server Express がインストールされ、明示的に有効にしたりできますを実行するシステム管理者によって無効になっているときに、ユーザー インスタンスは既定で有効に、 **sp_configure**親インスタンス上のシステム ストアド プロシージャ。</span><span class="sxs-lookup"><span data-stu-id="a8245-117">User instances are enabled by default when SQL Server Express is installed, and they can be explicitly enabled or disabled by a system administrator executing the **sp_configure** system stored procedure on the parent instance.</span></span>  
  
```  
-- Enable user instances.  
sp_configure 'user instances enabled','1'   
  
-- Disable user instances.  
sp_configure 'user instances enabled','0'  
```  
  
 <span data-ttu-id="a8245-118">ユーザー インスタンスのネットワーク プロトコルは、ローカルの名前付きパイプにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-118">The network protocol for user instances must be local Named Pipes.</span></span> <span data-ttu-id="a8245-119">ユーザー インスタンスを SQL Server のリモート インスタンスで開始することはできません。また、SQL Server ログインは許可されません。</span><span class="sxs-lookup"><span data-stu-id="a8245-119">A user instance cannot be started on a remote instance of SQL Server, and SQL Server logins are not allowed.</span></span>  
  
## <a name="connecting-to-a-user-instance"></a><span data-ttu-id="a8245-120">ユーザー インスタンスへの接続</span><span class="sxs-lookup"><span data-stu-id="a8245-120">Connecting to a User Instance</span></span>  
 <span data-ttu-id="a8245-121">`User Instance`と`AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>キーワードを使用する、<xref:System.Data.SqlClient.SqlConnection>ユーザー インスタンスに接続します。</span><span class="sxs-lookup"><span data-stu-id="a8245-121">The `User Instance` and `AttachDBFilename`<xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> keywords allow a <xref:System.Data.SqlClient.SqlConnection> to connect to a user instance.</span></span> <span data-ttu-id="a8245-122">ユーザー インスタンスは、<xref:System.Data.SqlClient.SqlConnectionStringBuilder> の `UserInstance` プロパティおよび `AttachDBFilename` プロパティでもサポートされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-122">User instances are also supported by the <xref:System.Data.SqlClient.SqlConnectionStringBuilder>`UserInstance` and `AttachDBFilename` properties.</span></span>  
  
 <span data-ttu-id="a8245-123">以下にサンプルの接続文字列を示します。次の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="a8245-123">Note the following about the sample connection string shown below:</span></span>  
  
-   <span data-ttu-id="a8245-124">
  `Data Source\` キーワードは、ユーザー インスタンスを生成している SQL Server Express の親インスタンスを指します。</span><span class="sxs-lookup"><span data-stu-id="a8245-124">The `Data Source` keyword refers to the parent instance of SQL Server Express that is generating the user instance.</span></span> <span data-ttu-id="a8245-125">既定のインスタンスは、.\sqlexpress です。</span><span class="sxs-lookup"><span data-stu-id="a8245-125">The default instance is .\sqlexpress.</span></span>  
  
-   <span data-ttu-id="a8245-126">`Integrated Security` が `true` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-126">`Integrated Security` is set to `true`.</span></span> <span data-ttu-id="a8245-127">ユーザー インスタンスに接続するには Windows 認証が必要です。SQL Server ログインはサポートされません。</span><span class="sxs-lookup"><span data-stu-id="a8245-127">To connect to a user instance, Windows Authentication is required; SQL Server logins are not supported.</span></span>  
  
-   <span data-ttu-id="a8245-128">`User Instance` は `true` に設定されます。これにより、ユーザー インスタンスが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-128">The `User Instance` is set to `true`, which invokes a user instance.</span></span> <span data-ttu-id="a8245-129">既定値は `false` です。</span><span class="sxs-lookup"><span data-stu-id="a8245-129">(The default is `false`.)</span></span>  
  
-   <span data-ttu-id="a8245-130">プライマリ データベース ファイル (.mdf) にアタッチするには、`AttachDbFileName` 接続文字列キーワードで完全パス名を指定します。</span><span class="sxs-lookup"><span data-stu-id="a8245-130">The `AttachDbFileName` connection string keyword is used to attach the primary database file (.mdf), which must include the full path name.</span></span> <span data-ttu-id="a8245-131">また、`AttachDbFileName` は、<xref:System.Data.SqlClient.SqlConnection> 接続文字列内の "extended properties" キーおよび "initial file name" キーに対応しています。</span><span class="sxs-lookup"><span data-stu-id="a8245-131">`AttachDbFileName` also corresponds to the "extended properties" and "initial file name" keys within a <xref:System.Data.SqlClient.SqlConnection> connection string.</span></span>  
  
-   <span data-ttu-id="a8245-132">パイプ記号で囲まれた `|DataDirectory|` の部分には、接続元のアプリケーションのデータ ディレクトリを表す文字列が入ります。データベース ファイルである .mdf と .ldf、およびログ ファイルの格納場所を相対パスで指定します。</span><span class="sxs-lookup"><span data-stu-id="a8245-132">The `|DataDirectory|` substitution string enclosed in the pipe symbols refers to the data directory of the application opening the connection and provides a relative path indicating the location of the .mdf and .ldf database and log files.</span></span> <span data-ttu-id="a8245-133">これらのファイルを別の場所に移す場合は、ファイルの完全パスを指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-133">If you want to locate these files elsewhere, you must provide the full path to the files.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;AttachDBFilename=|DataDirectory|\InstanceDB.mdf;  
Initial Catalog=InstanceDB;  
```  
  
> [!NOTE]
>  <span data-ttu-id="a8245-134">実行時に接続文字列を作成するために <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> および <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> プロパティを使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="a8245-134">You can also use the <xref:System.Data.SqlClient.SqlConnectionStringBuilder><xref:System.Data.SqlClient.SqlConnectionStringBuilder.UserInstance%2A> and <xref:System.Data.SqlClient.SqlConnectionStringBuilder.AttachDBFilename%2A> properties to build a connection string at run time.</span></span>  
  
### <a name="using-the-124datadirectory124-substitution-string"></a><span data-ttu-id="a8245-135">使用して、 &#124;DataDirectory&#124;置換文字列</span><span class="sxs-lookup"><span data-stu-id="a8245-135">Using the &#124;DataDirectory&#124; Substitution String</span></span>  
 <span data-ttu-id="a8245-136">ADO.NET 2.0 では、`AttachDbFileName` が拡張されて、`|DataDirectory|` というパイプ記号で囲まれた置換文字列が導入されました。</span><span class="sxs-lookup"><span data-stu-id="a8245-136">`AttachDbFileName` was extended in ADO.NET 2.0 with the introduction of the `|DataDirectory|` (enclosed in pipe symbols) substitution string.</span></span> <span data-ttu-id="a8245-137">`DataDirectory` に `AttachDbFileName` を組み合わせて使用することで、データ ファイルへの相対パスを指定でき、完全パスを使用する代わりに、データ ソースの相対パスに基づいて接続文字列を作成できます。</span><span class="sxs-lookup"><span data-stu-id="a8245-137">`DataDirectory` is used in conjunction with `AttachDbFileName` to indicate a relative path to a data file, allowing developers to create connection strings that are based on a relative path to the data source instead of being required to specify a full path.</span></span>  
  
 <span data-ttu-id="a8245-138">`DataDirectory` が表す物理的な場所は、アプリケーションの種類によって異なります。</span><span class="sxs-lookup"><span data-stu-id="a8245-138">The physical location that `DataDirectory` points to depends on the type of application.</span></span> <span data-ttu-id="a8245-139">次の例では、アタッチする Northwind.mdf ファイルが、アプリケーションの \app_data フォルダーに格納されています。</span><span class="sxs-lookup"><span data-stu-id="a8245-139">In this example, the Northwind.mdf file to be attached is located in the application's \app_data folder.</span></span>  
  
```  
Data Source=.\\SQLExpress;Integrated Security=true;  
User Instance=true;  
AttachDBFilename=|DataDirectory|\app_data\Northwind.mdf;  
Initial Catalog=Northwind;  
```  
  
 <span data-ttu-id="a8245-140">`DataDirectory` を使用する場合、最終的なファイル パスが、必ずその置換文字列が表すディレクトリのサブディレクトリとなるように指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-140">When `DataDirectory` is used, the resulting file path cannot be higher in the directory structure than the directory pointed to by the substitution string.</span></span> <span data-ttu-id="a8245-141">たとえば、`DataDirectory` を展開した結果が C:\AppDirectory\app_data である場合、app_data は c:\AppDirectory よりも下位であるため、上の例の接続文字列は適切に動作します。</span><span class="sxs-lookup"><span data-stu-id="a8245-141">For example, if the fully expanded `DataDirectory` is C:\AppDirectory\app_data, then the sample connection string shown above works because it is below c:\AppDirectory.</span></span> <span data-ttu-id="a8245-142">しかし、`DataDirectory` を「`|DataDirectory|\..\data`」として指定すると、\data が \AppDirectory のサブディレクトリではないため、エラーが発生します。</span><span class="sxs-lookup"><span data-stu-id="a8245-142">However, attempting to specify `DataDirectory` as `|DataDirectory|\..\data` will result in an error because \data is not a subdirectory of \AppDirectory.</span></span>  
  
 <span data-ttu-id="a8245-143">接続文字列に指定した置換文字列の形式が正しくない場合、<xref:System.ArgumentException> がスローされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-143">If the connection string has an improperly formatted substitution string, an <xref:System.ArgumentException> will be thrown.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a8245-144">置換文字列は、<xref:System.Data.SqlClient> によってローカル コンピューターのファイル システムと照合されて完全パスに解決されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-144"><xref:System.Data.SqlClient> resolves the substitution strings into full paths against the local computer file system.</span></span> <span data-ttu-id="a8245-145">したがって、リモート サーバー、HTTP、および UNC のパス名はサポートされません。</span><span class="sxs-lookup"><span data-stu-id="a8245-145">Therefore, remote server, HTTP, and UNC path names are not supported.</span></span> <span data-ttu-id="a8245-146">サーバーがローカル コンピューター上に存在しない場合、接続を開こうとすると例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-146">An exception is thrown when the connection is opened if the server is not located on the local computer.</span></span>  
  
 <span data-ttu-id="a8245-147"><xref:System.Data.SqlClient.SqlConnection> を開くと、この接続文字列が、既定の SQL Server Express インスタンスから、実行時に開始された (呼び出し元のアカウントで実行される) インスタンスへとリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-147">When the <xref:System.Data.SqlClient.SqlConnection> is opened, it is redirected from the default SQL Server Express instance to a run-time initiated instance running under the caller's account.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a8245-148">ユーザー インスタンスは、通常のインスタンスよりも読み込みに時間がかかる場合があります。その場合は、<xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> の値を増やす必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-148">It may be necessary to increase the <xref:System.Data.SqlClient.SqlConnection.ConnectionTimeout%2A> value since user instances may take longer to load than regular instances.</span></span>  
  
 <span data-ttu-id="a8245-149">次のコード フラグメントでは、新しい `SqlConnection` を開き、接続文字列をコンソール ウィンドウに表示した後、`using` コード ブロックを終了した時点で接続を閉じます。</span><span class="sxs-lookup"><span data-stu-id="a8245-149">The following code fragment opens a new `SqlConnection`, displays the connection string in the console window, and then closes the connection when exiting the `using` code block.</span></span>  
  
```vb  
Private Sub OpenSqlConnection()  
    ' Retrieve the connection string.  
    Dim connectionString As String = GetConnectionString()  
  
    Using connection As New SqlConnection(connectionString)  
        connection.Open()  
        Console.WriteLine("ConnectionString: {0}", _  
           connection.ConnectionString)  
    End Using  
End Sub  
```  
  
```csharp  
private static void OpenSqlConnection()  
{  
    // Retrieve the connection string.  
    string connectionString = GetConnectionString();  
  
    using (SqlConnection connection =   
        new SqlConnection(connectionString))  
    {  
        connection.Open();  
        Console.WriteLine("ConnectionString: {0}",   
             connection.ConnectionString);  
    }  
}  
```  
  
> [!NOTE]
>  <span data-ttu-id="a8245-150">SQL Server の内部で実行される共通言語ランタイム (CLR) コードでは、ユーザー インスタンスはサポートされません。</span><span class="sxs-lookup"><span data-stu-id="a8245-150">User instances are not supported in common language runtime (CLR) code that is running inside of SQL Server.</span></span> <span data-ttu-id="a8245-151"><xref:System.InvalidOperationException> の接続文字列で `Open` を指定して <xref:System.Data.SqlClient.SqlConnection> を呼び出すと、`User Instance=true` がスローされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-151">An <xref:System.InvalidOperationException> is thrown if `Open` is called on a <xref:System.Data.SqlClient.SqlConnection> that has `User Instance=true` in the connection string.</span></span>  
  
## <a name="lifetime-of-a-user-instance-connection"></a><span data-ttu-id="a8245-152">ユーザー インスタンスの接続の有効期間</span><span class="sxs-lookup"><span data-stu-id="a8245-152">Lifetime of a User Instance Connection</span></span>  
 <span data-ttu-id="a8245-153">SQL Server にはサービスとして実行されるバージョンもありますが、それらのバージョンとは異なり、SQL Server Express のインスタンスは、開始と停止を手動で行う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a8245-153">Unlike versions of SQL Server that run as a service, SQL Server Express instances do not need to be manually started and stopped.</span></span> <span data-ttu-id="a8245-154">既に実行されている場合を除き、ユーザーがログインして接続するたびにユーザー インスタンスが開始されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-154">Each time a user logs in and connects to a user instance, the user instance is started if it is not already running.</span></span> <span data-ttu-id="a8245-155">ユーザー インスタンス データベースには `AutoClose` オプションが用意されており、アクティブでない状態が一定期間続くとデータベースが自動的にシャットダウンされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-155">User instance databases have the `AutoClose` option set so that the database is automatically shut down after a period of inactivity.</span></span> <span data-ttu-id="a8245-156">開始された sqlservr.exe プロセスは、そのインスタンスに対する最後の接続が閉じられた後も、タイムアウトの期限が切れるまで引き続き実行されます。したがって、タイムアウトの期限が切れる前であれば、再開しなくても、新たに接続を開くことができます。</span><span class="sxs-lookup"><span data-stu-id="a8245-156">The sqlservr.exe process that is started is kept running for a limited time-out period after the last connection to the instance is closed, so it does not need to be restarted if another connection is opened before the time-out has expired.</span></span> <span data-ttu-id="a8245-157">タイムアウトの期限が切れるまでの間に新しい接続が開かれなかった場合、ユーザー インスタンスは自動的にシャットダウンされます。</span><span class="sxs-lookup"><span data-stu-id="a8245-157">The user instance automatically shuts down if no new connection opens before that time-out period has expired.</span></span> <span data-ttu-id="a8245-158">親インスタンス上のシステム管理者を使用して、ユーザー インスタンスのタイムアウト期間を設定することができます**sp_configure**を変更する、**ユーザー インスタンス タイムアウト**オプション。</span><span class="sxs-lookup"><span data-stu-id="a8245-158">A system administrator on the parent instance can set the duration of the time-out period for a user instance by using **sp_configure** to change the **user instance timeout** option.</span></span> <span data-ttu-id="a8245-159">既定値は、60 分です。</span><span class="sxs-lookup"><span data-stu-id="a8245-159">The default is 60 minutes.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a8245-160">接続文字列の `Min Pool Size` に 0 を超える値を指定した場合、接続プーラーは、開かれているいくつかの接続を常に保持するようになります。この場合、ユーザー インスタンスは自動的にはシャットダウンされません。</span><span class="sxs-lookup"><span data-stu-id="a8245-160">If `Min Pool Size` is used in the connection string with a value greater than zero, the connection pooler will always maintain a few opened connections, and the user instance will not automatically shut down.</span></span>  
  
## <a name="how-user-instances-work"></a><span data-ttu-id="a8245-161">ユーザー インスタンスの動作</span><span class="sxs-lookup"><span data-stu-id="a8245-161">How User Instances Work</span></span>  
 <span data-ttu-id="a8245-162">最初に、各ユーザーのユーザー インスタンスが生成された時点、**マスター**と**msdb**システム データベースは、ユーザーのローカル アプリケーション データ リポジトリの下のパスに、Template Data フォルダーからコピーされますユーザー インスタンスによって排他的に使用のディレクトリです。</span><span class="sxs-lookup"><span data-stu-id="a8245-162">The first time a user instance is generated for each user, the **master** and **msdb** system databases are copied from the Template Data folder to a path under the user's local application data repository directory for exclusive use by the user instance.</span></span> <span data-ttu-id="a8245-163">通常、このパスは `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS` です。</span><span class="sxs-lookup"><span data-stu-id="a8245-163">This path is typically `C:\Documents and Settings\<UserName>\Local Settings\Application Data\Microsoft\Microsoft SQL Server Data\SQLEXPRESS`.</span></span> <span data-ttu-id="a8245-164">ユーザー インスタンスの起動時に、 **tempdb**、ログ、およびトレース ファイルは、このディレクトリにも書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="a8245-164">When a user instance starts up, the **tempdb**, log, and trace files are also written to this directory.</span></span> <span data-ttu-id="a8245-165">ユーザー インスタンスには、ユーザーごとに一意の名前が生成されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-165">A name is generated for the instance, which is guaranteed to be unique for each user.</span></span>  
  
 <span data-ttu-id="a8245-166">既定では、Windows Builtin\Users グループのすべてのメンバーには、ローカル インスタンスへの接続のほか、SQL Server プログラム ファイルの読み取りと実行のための権限が付与されます。</span><span class="sxs-lookup"><span data-stu-id="a8245-166">By default all members of the Windows Builtin\Users group are granted permissions to connect on the local instance as well as read and execute permissions on the SQL Server binaries.</span></span> <span data-ttu-id="a8245-167">ユーザー インスタンスをホストする呼び出し元ユーザーの資格情報が検証されると、そのユーザーは、そのインスタンスの `sysadmin` になります。</span><span class="sxs-lookup"><span data-stu-id="a8245-167">Once the credentials of the calling user hosting the user instance have been verified, that user becomes the `sysadmin` on that instance.</span></span> <span data-ttu-id="a8245-168">ユーザー インスタンスに対して有効になるのは共有メモリだけです。つまり、ローカル コンピューター上の操作以外は実行できません。</span><span class="sxs-lookup"><span data-stu-id="a8245-168">Only shared memory is enabled for user instances, which means that only operations on the local machine are possible.</span></span>  
  
 <span data-ttu-id="a8245-169">ユーザーには、接続文字列で指定された .mdf ファイルと .ldf ファイルについて、読み取りと書き込みの両方の権限が付与されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-169">Users must be granted both read and write permissions on the .mdf and .ldf files specified in the connection string.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a8245-170">.mdf ファイルと .ldf ファイルは、それぞれデータベース ファイルおよびログ ファイルを表します。</span><span class="sxs-lookup"><span data-stu-id="a8245-170">The .mdf and .ldf files represent the database and log files, respectively.</span></span> <span data-ttu-id="a8245-171">この 2 つのファイルはペアで存在するため、バックアップや復元操作を行う際は注意が必要です。</span><span class="sxs-lookup"><span data-stu-id="a8245-171">These two files are a matched set, so care must be taken during backup and restore operations.</span></span> <span data-ttu-id="a8245-172">データベース ファイルには、ログ ファイルの正確なバージョンについての情報が格納されており、間違ったログ ファイルとペアになっていると、データベースを開くことはできません。</span><span class="sxs-lookup"><span data-stu-id="a8245-172">The database file contains information about the exact version of the log file, and the database will not open if it is coupled with the wrong log file.</span></span>  
  
 <span data-ttu-id="a8245-173">データの破損を防ぐため、ユーザー インスタンスのデータベースは排他アクセスで開かれます。</span><span class="sxs-lookup"><span data-stu-id="a8245-173">To avoid data corruption, a database in the user instance is opened with exclusive access.</span></span> <span data-ttu-id="a8245-174">同じコンピューター上の同じデータベースを 2 つの異なるユーザー インスタンスで共有する場合は、一方のインスタンスのユーザーがデータベースを閉じる必要があります。データベースを閉じない限り、もう一方のインスタンスでそのデータベースを開くことはできません。</span><span class="sxs-lookup"><span data-stu-id="a8245-174">If two different user instances share the same database on the same computer, the user on the first instance must close the database before it can be opened in a second instance.</span></span>  
  
## <a name="user-instance-scenarios"></a><span data-ttu-id="a8245-175">ユーザー インスタンスのシナリオ</span><span class="sxs-lookup"><span data-stu-id="a8245-175">User Instance Scenarios</span></span>  
 <span data-ttu-id="a8245-176">データベース アプリケーションの開発者は、ユーザー インスタンスを使用することで、開発コンピューター上に自分の管理者アカウントがなくても、SQL Server のデータ ストアを自由に利用できるようになります。</span><span class="sxs-lookup"><span data-stu-id="a8245-176">User instances provide developers of database applications with a SQL Server data store that does not depend on developers having administrative accounts on their development computers.</span></span> <span data-ttu-id="a8245-177">ユーザー インスタンスは Access/Jet モデルをベースとしています。つまり、データベース アプリケーションは単にファイルにアクセスするだけです。ユーザーには、すべてのデータベース オブジェクトに対する完全な権限が自動的に割り当てられます。システム管理者に権限を付与してもらう必要はありません。</span><span class="sxs-lookup"><span data-stu-id="a8245-177">User instances are based on the Access/Jet model, where the database application simply connects to a file, and the user automatically has full permissions on all of the database objects without needing the intervention of a system administrator to grant permissions.</span></span> <span data-ttu-id="a8245-178">サーバー コンピューターまたはローカル コンピューター上の管理特権を持たず、LUA (最小限の特権しか持たないユーザー アカウント) を使用しているユーザーが、データベース オブジェクトやアプリケーションを作成するケースもあります。ユーザー インスタンスには、こうした作業が想定されています。</span><span class="sxs-lookup"><span data-stu-id="a8245-178">It is intended to work in situations where the user is running under a least-privilege user account (LUA) and does not have administrative privileges on the server or local machine, yet needs to create database objects and applications.</span></span> <span data-ttu-id="a8245-179">ユーザー インスタンスを使って実行時にインスタンスを作成することで、より高い特権を持つシステム サービスのセキュリティ コンテキストではなく、そのユーザー自身のセキュリティ コンテキストでインスタンスを実行できます。</span><span class="sxs-lookup"><span data-stu-id="a8245-179">User instances allow users to create instances at run time that run under the user's own security context, and not in the security context of a more privileged system service.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="a8245-180">ユーザー インスタンスは、それを使用するすべてのアプリケーションが完全に信頼できる場合以外は使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="a8245-180">User instances should only be used in scenarios where all the applications using it are fully trusted.</span></span>  
  
 <span data-ttu-id="a8245-181">ユーザー インスタンスのシナリオ</span><span class="sxs-lookup"><span data-stu-id="a8245-181">User instance scenarios include:</span></span>  
  
-   <span data-ttu-id="a8245-182">データの共有を必要としないシングル ユーザー アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="a8245-182">Any single-user application where sharing data is not required.</span></span>  
  
-   <span data-ttu-id="a8245-183">ClickOnce 配置。</span><span class="sxs-lookup"><span data-stu-id="a8245-183">ClickOnce deployment.</span></span> <span data-ttu-id="a8245-184">.NET Framework 2.0 以降および SQL Server Express が既にターゲット コンピューターにインストールされている場合、管理者以外のユーザーでも、ClickOnce アクションの結果としてダウンロードされたインストール パッケージをインストールして使用できます。</span><span class="sxs-lookup"><span data-stu-id="a8245-184">If the .NET Framework 2.0 (or later) and SQL Server Express are already installed on the target computer, the installation package downloaded as a result of a ClickOnce action can be installed and used by non-administrator users.</span></span> <span data-ttu-id="a8245-185">ただし、SQL Server Express がセットアップの一部として含まれている場合は、管理者が SQL Server Express をインストールする必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8245-185">Note that an administrator must install SQL Server Express if that is part of the setup.</span></span> <span data-ttu-id="a8245-186">詳細については、次を参照してください。 [Windows フォームの ClickOnce 配置](../../../winforms/clickonce-deployment-for-windows-forms.md)します。</span><span class="sxs-lookup"><span data-stu-id="a8245-186">For more information, see [ClickOnce Deployment for Windows Forms](../../../winforms/clickonce-deployment-for-windows-forms.md).</span></span>
  
-   <span data-ttu-id="a8245-187">Windows 認証を使用した ASP.NET 専用ホスティング。</span><span class="sxs-lookup"><span data-stu-id="a8245-187">Dedicated ASP.NET hosting using Windows Authentication.</span></span> <span data-ttu-id="a8245-188">イントラネット上で、単一の SQL Server Express インスタンスをホストできます。</span><span class="sxs-lookup"><span data-stu-id="a8245-188">A single SQL Server Express instance can be hosted on an intranet.</span></span> <span data-ttu-id="a8245-189">アプリケーションは、権限の借用ではなく、ASPNET Windows アカウントを使ってこのインスタンスに接続することになります。</span><span class="sxs-lookup"><span data-stu-id="a8245-189">The application connects using the ASPNET Windows account, not by using impersonation.</span></span> <span data-ttu-id="a8245-190">サードパーティ製品を使ったホスティングや共有ホスティングのシナリオでユーザー インスタンスを使用することは避けてください。すべてのアプリケーションで同じユーザー インスタンスが使用され、アプリケーションを互いに分離することができなくなります。</span><span class="sxs-lookup"><span data-stu-id="a8245-190">User instances should not be used for third-party or shared hosting scenarios where all applications would share the same user instance and would no longer remain isolated from each other.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a8245-191">関連項目</span><span class="sxs-lookup"><span data-stu-id="a8245-191">See also</span></span>
- [<span data-ttu-id="a8245-192">SQL Server と ADO.NET</span><span class="sxs-lookup"><span data-stu-id="a8245-192">SQL Server and ADO.NET</span></span>](../../../../../docs/framework/data/adonet/sql/index.md)
- [<span data-ttu-id="a8245-193">接続文字列</span><span class="sxs-lookup"><span data-stu-id="a8245-193">Connection Strings</span></span>](../../../../../docs/framework/data/adonet/connection-strings.md)
- [<span data-ttu-id="a8245-194">データ ソースへの接続</span><span class="sxs-lookup"><span data-stu-id="a8245-194">Connecting to a Data Source</span></span>](../../../../../docs/framework/data/adonet/connecting-to-a-data-source.md)
- [<span data-ttu-id="a8245-195">ADO.NET のマネージド プロバイダーと DataSet デベロッパー センター</span><span class="sxs-lookup"><span data-stu-id="a8245-195">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
