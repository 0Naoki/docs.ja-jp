---
title: WCF Data Services のセキュリティ保護
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- securing application [WCF Data Services]
- WCF Data Services, security
ms.assetid: 99fc2baa-a040-4549-bc4d-f683d60298af
ms.openlocfilehash: ae62441bf0c8460413e18dd7fc1b1315af1ba00c
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/23/2019
ms.locfileid: "54726950"
---
# <a name="securing-wcf-data-services"></a><span data-ttu-id="a4c4c-102">WCF Data Services のセキュリティ保護</span><span class="sxs-lookup"><span data-stu-id="a4c4c-102">Securing WCF Data Services</span></span>
<span data-ttu-id="a4c4c-103">このトピックでは、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] と、[!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] をサポートするサービスにアクセスするアプリケーションの開発、配置、および実行に特有のセキュリティの注意点について説明します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-103">This topic describes security considerations that are specific to developing, deploying, and running [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] and applications that access services that support the [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)].</span></span> <span data-ttu-id="a4c4c-104">このほかに、安全な [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] アプリケーションを作成するための推奨事項にも従うようにしてください。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-104">You should also follow recommendations for creating secure [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] applications.</span></span>  
  
 <span data-ttu-id="a4c4c-105">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ベースの [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] サービスをセキュリティで保護する方法を計画するときには、認証 (プリンシパルの ID を発見および確認するプロセス) と承認 (認証されたプリンシパルが要求されたリソースにアクセスできるかどうかを判断するプロセス) の両方を解決する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-105">When planning how to secure a [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]-based [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service, you must address both authentication, the process of discovering and verifying the identity of a principal, and authorization, the process of determining whether an authenticated principal is allowed to access the requested resources.</span></span> <span data-ttu-id="a4c4c-106">また、SSL を使用してメッセージを暗号化するかどうかを検討する必要もあります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-106">You should also consider whether to encrypt the message by using SSL.</span></span>  
  
## <a name="authenticating-client-requests"></a><span data-ttu-id="a4c4c-107">クライアント要求の認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-107">Authenticating Client Requests</span></span>  
 [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] <span data-ttu-id="a4c4c-108">は、認証を独自に実装する代わりにデータ サービス ホストに依存しています。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-108">does not implement any kind of authentication of its own, but rather relies on the authentication provisions of the data service host.</span></span> <span data-ttu-id="a4c4c-109">したがって、ネットワーク ホストによって受信要求が既に認証されていること、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] によって提供されるインターフェイスを使用して要求のプリンシパルが正しく識別されていることが前提とされます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-109">This means that the service assumes that any request that it receives has already been authenticated by the network host and that the host has correctly identified the principle for the request appropriately via the interfaces provided by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="a4c4c-110">これらの認証オプションとアプローチの詳細については[OData および認証シリーズ](https://go.microsoft.com/fwlink/?LinkId=200381)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-110">These authentication options and approaches are detailed in [OData and Authentication series](https://go.microsoft.com/fwlink/?LinkId=200381).</span></span>  
  
### <a name="authentication-options-for-a-wcf-data-service"></a><span data-ttu-id="a4c4c-111">WCF Data Service の認証オプション</span><span class="sxs-lookup"><span data-stu-id="a4c4c-111">Authentication Options for a WCF Data Service</span></span>  
 <span data-ttu-id="a4c4c-112">次の表に、WCF Data Service への要求を認証するために使用できる認証メカニズムを示します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-112">The following table lists some of the authentication mechanisms that are available to help you authenticate requests to a WCF Data Service.</span></span>  
  
|<span data-ttu-id="a4c4c-113">認証オプション</span><span class="sxs-lookup"><span data-stu-id="a4c4c-113">Authentication Options</span></span>|<span data-ttu-id="a4c4c-114">説明</span><span class="sxs-lookup"><span data-stu-id="a4c4c-114">Description</span></span>|  
|----------------------------|-----------------|  
|<span data-ttu-id="a4c4c-115">匿名認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-115">Anonymous authentication</span></span>|<span data-ttu-id="a4c4c-116">匿名 HTTP 認証が有効になっている場合は、すべてのプリンシパルがデータ サービスに接続できます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-116">When HTTP anonymous authentication is enabled, any principle is able to connect to the data service.</span></span> <span data-ttu-id="a4c4c-117">匿名アクセスには資格情報は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-117">Credentials are not required for anonymous access.</span></span> <span data-ttu-id="a4c4c-118">このオプションは、だれでもデータ サービスにアクセスできるようにする場合にのみ使用します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-118">Use this option only when you want to allow anyone to access the data service.</span></span>|  
|<span data-ttu-id="a4c4c-119">基本認証とダイジェスト認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-119">Basic and digest authentication</span></span>|<span data-ttu-id="a4c4c-120">ユーザー名とパスワードで構成される資格情報が認証に必要です。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-120">Credentials consisting of a user name and password are required for authentication.</span></span> <span data-ttu-id="a4c4c-121">Windows 以外のクライアントの認証がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-121">Supports authentication of non-Windows clients.</span></span> <span data-ttu-id="a4c4c-122">**セキュリティに関するメモ:** 基本認証の資格情報 (ユーザー名とパスワード) はクリア テキストで送信されるので、傍受される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-122">**Security Note:**  Basic authentication credentials (user name and password) are sent in the clear and can be intercepted.</span></span> <span data-ttu-id="a4c4c-123">ダイジェスト認証では、指定された資格情報に基づくハッシュが送信されるため、基本認証に比べて安全です。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-123">Digest authentication sends a hash based-on the supplied credentials, which makes it more secure than basic authentication.</span></span> <span data-ttu-id="a4c4c-124">ただし、どちらの方法も man-in-the-middle 攻撃を受ける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-124">Both are susceptible to man-in-the-middle attacks.</span></span> <span data-ttu-id="a4c4c-125">これらの認証方法を使用する場合は、SSL (Secure Sockets Layer) を使用してクライアントとデータ サービスの間の通信を暗号化することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-125">When using these authentication methods, you should consider encrypting communication between client and the data service by using the Secure Sockets Layer (SSL).</span></span> <br /><br /> <span data-ttu-id="a4c4c-126">Microsoft インターネット インフォメーション サービス (IIS) には、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] アプリケーションの HTTP 要求に対する基本認証とダイジェスト認証の実装が用意されています。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-126">Microsoft Internet Information Services (IIS) provides an implementation of both basic and digest authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="a4c4c-127">この Windows 認証プロバイダーの実装を使用すると、.NET Framework クライアント アプリケーションで、資格情報を要求の HTTP ヘッダーでデータ サービスに渡して Windows ユーザーの認証をシームレスにネゴシエートできます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-127">This Windows Authentication Provider implementation enables a .NET Framework client application to supply credentials in the HTTP header of the request to the data service to seamlessly negotiate authentication of a Windows user.</span></span> <span data-ttu-id="a4c4c-128">詳細については、次を参照してください。[ダイジェスト認証のテクニカル リファレンス](https://go.microsoft.com/fwlink/?LinkId=200408)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-128">For more information, see [Digest Authentication Technical Reference](https://go.microsoft.com/fwlink/?LinkId=200408).</span></span><br /><br /> <span data-ttu-id="a4c4c-129">データ サービスで Windows 資格情報以外のカスタム認証サービスに基づく基本認証を使用する場合は、認証用のカスタム [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] HTTP モジュールを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-129">When you want to have your data service use basic authentication based on some custom authentication service and not Windows credentials, you must implement a custom [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] HTTP Module for authentication.</span></span><br /><br /> <span data-ttu-id="a4c4c-130">カスタム基本認証スキームを使用する方法の例については[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]、投稿をご覧ください[カスタム基本認証](https://go.microsoft.com/fwlink/?LinkID=200388)で、[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]および認証シリーズ。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-130">For an example of how to use a custom basic authentication scheme with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Custom Basic Authentication](https://go.microsoft.com/fwlink/?LinkID=200388) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="a4c4c-131">Windows 認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-131">Windows authentication</span></span>|<span data-ttu-id="a4c4c-132">Windows ベースの資格情報の交換には、NTLM または Kerberos が使用されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-132">Windows-based credentials are exchanged by using NTLM or Kerberos.</span></span> <span data-ttu-id="a4c4c-133">このメカニズムは基本認証やダイジェスト認証より安全ですが、クライアントが Windows ベースのアプリケーションである必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-133">This mechanism is more secure than basic or digest authentication, but it requires that the client be a Windows-based application.</span></span> <span data-ttu-id="a4c4c-134">IIS には、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] アプリケーションの HTTP 要求に対する Windows 認証の実装も用意されています。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-134">IIS also provides an implementation of Windows authentication for HTTP requests in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application.</span></span> <span data-ttu-id="a4c4c-135">詳細については、次を参照してください。 [ASP.NET フォーム認証の概要](https://msdn.microsoft.com/library/099c1587-6934-476e-ac95-28f534bc9708)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-135">For more information, see [ASP.NET Forms Authentication Overview](https://msdn.microsoft.com/library/099c1587-6934-476e-ac95-28f534bc9708).</span></span><br /><br /> <span data-ttu-id="a4c4c-136">Windows 認証を使用する方法の例については[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]、投稿をご覧ください[Windows 認証](https://go.microsoft.com/fwlink/?LinkID=200384)で、[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]および認証シリーズ。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-136">For an example of how to use Windows authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Windows Authentication](https://go.microsoft.com/fwlink/?LinkID=200384) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] <span data-ttu-id="a4c4c-137">フォーム認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-137">forms authentication</span></span>|<span data-ttu-id="a4c4c-138">フォーム認証では、独自のコードを使用してユーザーを認証し、認証トークンをクッキーまたはページ URL に保存できます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-138">Forms authentication lets you authenticate users by using your own code and then maintain an authentication token in a cookie or in the page URL.</span></span> <span data-ttu-id="a4c4c-139">作成したログイン フォームを使用してユーザーのユーザー名とパスワードを認証します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-139">You authenticate the user name and password of your users using a login form that you create.</span></span> <span data-ttu-id="a4c4c-140">認証されない要求はログイン ページにリダイレクトされ、ここでユーザーが資格情報を入力してフォームを送信します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-140">Unauthenticated requests are redirected to a login page, where the user provides credentials and submits the form.</span></span> <span data-ttu-id="a4c4c-141">アプリケーションで要求を認証する場合、後続の要求で使用する ID を再確立するためのキーが含まれたチケットをシステムが発行します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-141">If the application authenticates the request, the system issues a ticket that contains a key for reestablishing the identity for subsequent requests.</span></span> <span data-ttu-id="a4c4c-142">詳細については、次を参照してください。[フォーム認証プロバイダー](https://msdn.microsoft.com/library/77e21ba2-bad1-4967-a8ec-74942dea7e47)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-142">For more information, see [Forms Authentication Provider](https://msdn.microsoft.com/library/77e21ba2-bad1-4967-a8ec-74942dea7e47).</span></span> <span data-ttu-id="a4c4c-143">**セキュリティに関するメモ:** [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web アプリケーションでフォーム認証を使用する場合、既定では、フォーム認証チケットを含むクッキーはセキュリティで保護されません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-143">**Security Note:**  By default, the cookie that contains the forms authentication ticket is not secured when you use forms authentication in a [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web application.</span></span> <span data-ttu-id="a4c4c-144">認証チケットと最初のログイン資格情報の両方を保護するには、SSL を要求することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-144">You should consider requiring SSL to protect both the authentication ticket and the initial login credentials.</span></span> <br /><br /> <span data-ttu-id="a4c4c-145">使用する方法の例のフォームでの認証の[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]、投稿をご覧ください[フォーム認証](https://go.microsoft.com/fwlink/?LinkID=200389)で、[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]および認証シリーズ。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-145">For an example of how to use forms authentication with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [Forms Authentication](https://go.microsoft.com/fwlink/?LinkID=200389) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
|<span data-ttu-id="a4c4c-146">クレーム ベースの認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-146">Claims-based authentication</span></span>|<span data-ttu-id="a4c4c-147">クレーム ベースの認証では、データ サービスは、ユーザーの認証に、「サードパーティ」の信頼できる id プロバイダー サービスに依存します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-147">In claims-based authentication, the data service relies on a trusted "third-party" identity provider service to authenticate the user.</span></span> <span data-ttu-id="a4c4c-148">ID プロバイダーは、データ サービス リソースへのアクセスを要求しているユーザーを確実に認証し、要求されたリソースへのアクセスを許可するトークンを発行します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-148">The identity provider positively authenticates the user that is requesting access to data service resources and issues a token that grants access to the requested resources.</span></span> <span data-ttu-id="a4c4c-149">このトークンがデータ サービスに提示され、そのアクセス トークンを発行した識別情報サービスとの信頼関係に基づいてユーザーのアクセスが許可されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-149">This token is then presented to the data service, which then grants access to the user based on the trust relationship with the identity service that issued the access token.</span></span><br /><br /> <span data-ttu-id="a4c4c-150">クレーム ベースの認証プロバイダーの利点は、信頼ドメイン間でさまざまな種類のクライアントの認証に使用できることです。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-150">The benefit of using a claims-based authentication provider is that they can be used to authenticate various types of clients across trust domains.</span></span> <span data-ttu-id="a4c4c-151">このようなサードパーティ プロバイダーを使用することにより、ユーザーの管理と認証の要件をデータ サービスからオフロードできます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-151">By employing such a third-party provider, a data service can offload the requirements of maintaining and authenticating users.</span></span> <span data-ttu-id="a4c4c-152">OAuth 2.0 は、サービスとしてのフェデレーション認証のために Microsoft Azure AppFabric アクセス制御によってサポートされているクレーム ベースの認証プロトコルであり、</span><span class="sxs-lookup"><span data-stu-id="a4c4c-152">OAuth 2.0 is a claims-based authentication protocol that is supported by Windows Azure AppFabric Access Control for federated authorization as a service.</span></span> <span data-ttu-id="a4c4c-153">REST ベースのサービスをサポートします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-153">This protocol supports REST-based services.</span></span> <span data-ttu-id="a4c4c-154">OAuth 2.0 を使用する方法の例については[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)]、投稿をご覧ください[OData と OAuth](https://go.microsoft.com/fwlink/?LinkId=200514)で、[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]および認証シリーズ。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-154">For an example of how to use OAuth 2.0 with [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], see the post on [OData and OAuth](https://go.microsoft.com/fwlink/?LinkId=200514) in the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] and authentication series.</span></span>|  
  
<a name="clientAuthentication"></a>   
### <a name="authentication-in-the-client-library"></a><span data-ttu-id="a4c4c-155">クライアント ライブラリの認証</span><span class="sxs-lookup"><span data-stu-id="a4c4c-155">Authentication in the Client Library</span></span>  
 <span data-ttu-id="a4c4c-156">既定では、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] サービスに要求を送信する際、[!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] クライアント ライブラリから資格情報は提供されません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-156">By default, the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library does not supply credentials when making a request to an [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] service.</span></span> <span data-ttu-id="a4c4c-157">データ サービスでユーザー認証のためにログイン資格情報が要求されている場合は、<xref:System.Net.NetworkCredential> の <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> プロパティからアクセスできる <xref:System.Data.Services.Client.DataServiceContext> で資格情報を渡すことができます。以下に例を示します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-157">When login credentials are required by the data service to authenticate a user, these credentials can be supplied in a <xref:System.Net.NetworkCredential> accessed from the <xref:System.Data.Services.Client.DataServiceContext.Credentials%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, as in the following example:</span></span>  
  
```csharp  
// Set the client authentication credentials.  
context.Credentials =  
    new NetworkCredential(userName, password, domain);  
```  
  
```vb  
' Set the client authentication credentials.  
context.Credentials = _  
    New NetworkCredential(userName, password, domain)  
```  
  
 <span data-ttu-id="a4c4c-158">詳細については、「[方法 :データ サービス要求のクライアント資格情報の指定](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-158">For more information, see [How to: Specify Client Credentials for a Data Service Request](../../../../docs/framework/data/wcf/specify-client-creds-for-a-data-service-request-wcf.md).</span></span>  
  
 <span data-ttu-id="a4c4c-159">クレーム ベースのトークンやクッキーなど、<xref:System.Net.NetworkCredential> オブジェクトでは指定できないログイン資格情報がデータ サービスで要求されている場合は、手動で HTTP 要求のヘッダー (通常は `Authorization` と `Cookie`) を設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-159">When the data service requires login credentials that cannot be specified by using a <xref:System.Net.NetworkCredential> object, such as a claims-based token or cookie, you must manually set headers in the HTTP request, usually the `Authorization` and `Cookie` headers.</span></span> <span data-ttu-id="a4c4c-160">この種の認証シナリオの詳細については、投稿を参照してください。 [OData と認証。クライアント側フック](https://go.microsoft.com/fwlink/?LinkID=200385)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-160">For more information about this kind of authentication scenario, see the post [OData and Authentication: Client-Side Hooks](https://go.microsoft.com/fwlink/?LinkID=200385).</span></span> <span data-ttu-id="a4c4c-161">要求メッセージの HTTP ヘッダーを設定する方法の例は、次を参照してください。[方法。クライアント要求のヘッダーを設定](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-161">For an example of how to set HTTP headers in a request message, see [How to: Set Headers in the Client Request](../../../../docs/framework/data/wcf/how-to-set-headers-in-the-client-request-wcf-data-services.md).</span></span>  
  
## <a name="impersonation"></a><span data-ttu-id="a4c4c-162">偽装</span><span class="sxs-lookup"><span data-stu-id="a4c4c-162">Impersonation</span></span>  
 <span data-ttu-id="a4c4c-163">データ サービスは通常、データ サービスをホストしているワーカー プロセスの資格情報を使用して、要求されたリソース (サーバー上のファイル、データベースなど) にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-163">Generally, the data service accesses required resources, such as files on the server or a database, by using the credentials of the worker process that is hosting the data service.</span></span> <span data-ttu-id="a4c4c-164">偽装を使用しているときは、要求を出しているユーザーの Window ID (ユーザー アカウント) で [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] アプリケーションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-164">When using impersonation, [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applications can execute with the Windows identity (user account) of the user making the request.</span></span> <span data-ttu-id="a4c4c-165">偽装は、IIS を使用してユーザーを認証するアプリケーションで使用されるのが一般的です。この場合、要求されたリソースへのアクセスにそのプリンシパルの資格情報が使用されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-165">Impersonation is commonly used in applications that rely on IIS to authenticate the user, and the credentials of this principle are used to access the required resources.</span></span> <span data-ttu-id="a4c4c-166">詳細については、次を参照してください。 [ASP.NET 偽装](https://msdn.microsoft.com/library/a0cb3024-562f-4184-9d3c-095504787d3d)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-166">For more information, see [ASP.NET Impersonation](https://msdn.microsoft.com/library/a0cb3024-562f-4184-9d3c-095504787d3d).</span></span>  
  
## <a name="configuring-data-service-authorization"></a><span data-ttu-id="a4c4c-167">データ サービスの承認の構成</span><span class="sxs-lookup"><span data-stu-id="a4c4c-167">Configuring Data Service Authorization</span></span>  
 <span data-ttu-id="a4c4c-168">承認とは、事前に行われた認証に基づいて識別されるプリンシパルまたはプロセスにアプリケーション リソースへのアクセスを許可することです。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-168">Authorization is the granting of access to application resources to a principle or process that is identified based on a previously successful authentication.</span></span> <span data-ttu-id="a4c4c-169">一般に、データ サービスのユーザーには、クライアント アプリケーションで必要とされている操作を実行するのに十分な権限のみを与えるようにします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-169">As a general practice, you should only grant sufficient rights to users of the data service to perform the operations required by client applications.</span></span>  
  
### <a name="restrict-access-to-data-service-resources"></a><span data-ttu-id="a4c4c-170">データ サービス リソースへのアクセスの制限</span><span class="sxs-lookup"><span data-stu-id="a4c4c-170">Restrict Access to Data Service Resources</span></span>  
 <span data-ttu-id="a4c4c-171">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] では、データ サービスにアクセスできるすべてのユーザーにデータ サービス リソース (エンティティ セットおよびサービス操作) に対する共通の読み取りおよび書き込みのアクセス権が既定で付与されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-171">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] enables you to grant common read and write access against data service resources (entity set and service operations) to any user that is able to access the data service.</span></span> <span data-ttu-id="a4c4c-172">読み取りおよび書き込みのアクセスを定義する規則は、データ サービスによって公開される各エンティティ セットおよびサービス操作に対して個別に定義できます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-172">Rules that define read and write access can be defined separately for each entity set exposed by the data service, as well as to any service operations.</span></span> <span data-ttu-id="a4c4c-173">読み取りおよび書き込みの両方のアクセスを、クライアント アプリケーションで必要なリソースのみに制限することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-173">We recommend limiting both read and write access to only the resources required by the client application.</span></span> <span data-ttu-id="a4c4c-174">詳細については、次を参照してください。[リソースへのアクセスの最小要件](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-174">For more information, see [Minimum Resource Access Requirements](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md#accessRequirements).</span></span>  
  
### <a name="implement-role-based-interceptors"></a><span data-ttu-id="a4c4c-175">ロール ベースのインターセプターの実装</span><span class="sxs-lookup"><span data-stu-id="a4c4c-175">Implement Role-Based Interceptors</span></span>  
 <span data-ttu-id="a4c4c-176">インターセプターを使用すると、データ サービス リソースに対する要求を、データ サービスによって処理される前にインターセプトすることができます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-176">Interceptors enable you to intercept requests against data service resources before they are acted on by the data service.</span></span> <span data-ttu-id="a4c4c-177">詳細については、次を参照してください。[インターセプター](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-177">For more information, see [Interceptors](../../../../docs/framework/data/wcf/interceptors-wcf-data-services.md).</span></span> <span data-ttu-id="a4c4c-178">インターセプターを使用すると、要求を行っている認証されたユーザーに基づいて承認決定を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-178">Interceptors enable you to make authorization decisions based the authenticated user that is making the request.</span></span> <span data-ttu-id="a4c4c-179">認証されたユーザー id に基づくデータ サービス リソースへのアクセスを制限する方法の例は、次を参照してください。[方法。データ サービス メッセージを途中受信](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-179">For an example of how to restrict access to data service resources based on an authenticated user identity, see [How to: Intercept Data Service Messages](../../../../docs/framework/data/wcf/how-to-intercept-data-service-messages-wcf-data-services.md).</span></span>  
  
### <a name="restrict-access-to-the-persisted-data-store-and-local-resources"></a><span data-ttu-id="a4c4c-180">永続化データ ストアとローカル リソースへのアクセスの制限</span><span class="sxs-lookup"><span data-stu-id="a4c4c-180">Restrict Access to the Persisted Data Store and Local Resources</span></span>  
 <span data-ttu-id="a4c4c-181">永続化ストアにアクセスするためのアカウントには、データベースまたはファイル システムでデータ サービスの要件をサポートするのに十分な権限のみを与えるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-181">The accounts that are used to access the persisted store should be granted only enough rights in a database or the file system to support the requirements of the data service.</span></span> <span data-ttu-id="a4c4c-182">匿名認証が使用されている場合は、そのアカウントがホスト アプリケーションの実行に使用されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-182">When anonymous authentication is used, this is the account used to run the hosting application.</span></span> <span data-ttu-id="a4c4c-183">詳細については、「[方法 :IIS で実行されている WCF データ サービスを開発](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-183">For more information, see [How to: Develop a WCF Data Service Running on IIS](../../../../docs/framework/data/wcf/how-to-develop-a-wcf-data-service-running-on-iis.md).</span></span> <span data-ttu-id="a4c4c-184">偽装を使用する場合は、認証されたユーザーにそれらのリソースへのアクセスを (通常は Windows グループの一部として) 許可する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-184">When impersonation is used, authenticated users must be granted access to these resources, usually as part of a Windows group.</span></span>  
  
## <a name="other-security-considerations"></a><span data-ttu-id="a4c4c-185">その他のセキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="a4c4c-185">Other Security Considerations</span></span>  
  
### <a name="secure-the-data-in-the-payload"></a><span data-ttu-id="a4c4c-186">ペイロードのデータの保護</span><span class="sxs-lookup"><span data-stu-id="a4c4c-186">Secure the Data in the Payload</span></span>  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] <span data-ttu-id="a4c4c-187">は HTTP プロトコルに基づいています。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-187">is based on the HTTP protocol.</span></span> <span data-ttu-id="a4c4c-188">データ サービスで実装されている認証によっては、HTTP メッセージのヘッダーに重要なユーザー資格情報が含まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-188">In an HTTP message, the header may contain valuable user credentials, depending on the authentication implemented by the data service.</span></span> <span data-ttu-id="a4c4c-189">メッセージの本文にも、保護する必要がある貴重な顧客データが含まれている場合があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-189">The message body may also contain valuable customer data that must be protected.</span></span> <span data-ttu-id="a4c4c-190">いずれの場合も、SSL を使用してその情報をネットワークで保護することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-190">In both of these cases, we recommend that you use SSL to protect this information over the wire.</span></span>  
  
### <a name="ignored-message-headers-and-cookies"></a><span data-ttu-id="a4c4c-191">無視されるメッセージ ヘッダーとクッキー</span><span class="sxs-lookup"><span data-stu-id="a4c4c-191">Ignored Message Headers and Cookies</span></span>  
 <span data-ttu-id="a4c4c-192">HTTP 要求のヘッダーは、コンテンツ タイプとリソースの場所を宣言するもの以外は無視されます。また、データ サービスによって設定されることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-192">HTTP request headers, other than those that declare content types and resource locations, are ignored and are never set by the data service.</span></span>  
  
 <span data-ttu-id="a4c4c-193">クッキーは、認証方式の一部としては使用できますが ([!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] フォーム認証を使用する場合など)、</span><span class="sxs-lookup"><span data-stu-id="a4c4c-193">Cookies can be used as part of an authentication scheme, such as with [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Forms Authentication.</span></span> <span data-ttu-id="a4c4c-194">[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] では無視されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-194">However, any HTTP cookies set on an incoming request are ignored by [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)].</span></span> <span data-ttu-id="a4c4c-195">データ サービスのホストによって処理されることはありますが、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ランタイムによって分析されたり返されたりすることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-195">The host of a data service may process the cookie, but the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime never analyzes or returns cookies.</span></span> <span data-ttu-id="a4c4c-196">応答で送信されたクッキーが [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] クライアント ライブラリで処理されることもありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-196">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library also does not process cookies sent in the response.</span></span>  
  
### <a name="custom-hosting-requirements"></a><span data-ttu-id="a4c4c-197">カスタム ホストの要件</span><span class="sxs-lookup"><span data-stu-id="a4c4c-197">Custom Hosting Requirements</span></span>  
 <span data-ttu-id="a4c4c-198">既定では、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] は IIS でホストされる [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] アプリケーションとして作成されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-198">By default, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] is created as an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] application hosted in IIS.</span></span> <span data-ttu-id="a4c4c-199">そのため、データ サービスでこのプラットフォームのセキュリティ動作を活用できます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-199">This enables the data service to leverage the secure behaviors of this platform.</span></span> <span data-ttu-id="a4c4c-200">カスタム ホストによってホストされる [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] を定義することもできます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-200">You can define [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] that are hosted by a custom host.</span></span> <span data-ttu-id="a4c4c-201">詳細については、次を参照してください。[データ サービスのホスティング](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md)します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-201">For more information, see [Hosting the Data Service](../../../../docs/framework/data/wcf/hosting-the-data-service-wcf-data-services.md).</span></span> <span data-ttu-id="a4c4c-202">データ サービスをホストするコンポーネントとプラットフォームでは、データ サービスへの攻撃を防ぐために次のセキュリティ動作を確保する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-202">The components and platform hosting a data service must ensure the following security behaviors to prevent attacks on the data service:</span></span>  
  
-   <span data-ttu-id="a4c4c-203">可能なすべての操作について、データ サービス要求で受け入れる URI の長さを制限します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-203">Limit the length of the URI accepted in a data service request for all possible operations.</span></span>  
  
-   <span data-ttu-id="a4c4c-204">着信および発信の両方の HTTP メッセージのサイズを制限します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-204">Limit the size of both incoming and outgoing HTTP messages.</span></span>  
  
-   <span data-ttu-id="a4c4c-205">任意の時点の未処理の要求の総数を制限します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-205">Limit the total number of outstanding requests at any given time.</span></span>  
  
-   <span data-ttu-id="a4c4c-206">HTTP ヘッダーとその値のサイズを制限し、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] でヘッダーのデータにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-206">Limit the size of HTTP headers and their values, and provide [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] access to header data.</span></span>  
  
-   <span data-ttu-id="a4c4c-207">TCP SYN 攻撃やメッセージ リプレイ攻撃などの既知の攻撃を検出して阻止します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-207">Detect and counter known attacks, such as TCP SYN and message replay attacks.</span></span>  
  
### <a name="values-are-not-further-encoded"></a><span data-ttu-id="a4c4c-208">値のさらなるエンコード</span><span class="sxs-lookup"><span data-stu-id="a4c4c-208">Values Are Not Further Encoded</span></span>  
 <span data-ttu-id="a4c4c-209">データ サービスに送信されたプロパティ値が [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] ランタイムによってさらにエンコードされることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-209">Property values sent to the data service are not further encoded by the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime.</span></span> <span data-ttu-id="a4c4c-210">たとえば、書式設定された HTML コンテンツがエンティティの文字列プロパティに含まれていた場合、データ サービスによってタグが HTML エンコードされることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-210">For example, when a string property of an entity contains formatted HTML content, the tags are not HTML encoded by the data service.</span></span> <span data-ttu-id="a4c4c-211">応答のプロパティ値についても、データ サービスによってさらなるエンコードが行われることはありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-211">The data service also does not further encode property values in the response.</span></span> <span data-ttu-id="a4c4c-212">クライアント ライブラリで追加のエンコードが行われることもありません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-212">The client library also does not perform any additional encoding.</span></span>  
  
### <a name="considerations-for-client-applications"></a><span data-ttu-id="a4c4c-213">クライアント アプリケーションに関する注意点</span><span class="sxs-lookup"><span data-stu-id="a4c4c-213">Considerations for Client Applications</span></span>  
 <span data-ttu-id="a4c4c-214">以下のセキュリティの注意点は、[!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] クライアントを使用して [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] サービスにアクセスするアプリケーションに当てはまります。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-214">The following security considerations apply to applications that use the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client to access [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] services:</span></span>  
  
-   <span data-ttu-id="a4c4c-215">クライアント ライブラリは、データ サービスへのアクセスに使用されるプロトコルで十分なレベルのセキュリティが確保されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-215">The client library assumes that the protocols used to access the data service provide an appropriate level of security.</span></span>  
  
-   <span data-ttu-id="a4c4c-216">クライアント ライブラリは、基になるプラットフォームによって提供されるトランスポート スタックのタイムアウトや解析のすべてのオプションに対して既定値を使用します。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-216">The client library uses all the default values for timeouts and parsing options of the underlying platform-provided transport stacks.</span></span>  
  
-   <span data-ttu-id="a4c4c-217">クライアント ライブラリはアプリケーション構成ファイルの設定を読み取りません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-217">The client library does not read any settings from application configuration files.</span></span>  
  
-   <span data-ttu-id="a4c4c-218">クライアント ライブラリにはドメイン間アクセスのメカニズムは実装されていません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-218">The client library does not implement any cross domain access mechanisms.</span></span> <span data-ttu-id="a4c4c-219">基になる HTTP スタックによって提供されるメカニズムが使用されます。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-219">Instead, it relies on the mechanisms provided by the underlying HTTP stack.</span></span>  
  
-   <span data-ttu-id="a4c4c-220">クライアント ライブラリにはユーザー インターフェイス要素はありません。送受信されるデータの表示は行われません。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-220">The client library has no user interface elements, and it never tries to display or render the data that it receives or sends.</span></span>  
  
-   <span data-ttu-id="a4c4c-221">クライアント アプリケーションで常にユーザー入力と信頼されていないサービスからのデータを検証することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a4c4c-221">We recommend that client applications always validate user input as well as data accepted from untrusted services.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4c4c-222">関連項目</span><span class="sxs-lookup"><span data-stu-id="a4c4c-222">See also</span></span>
- [<span data-ttu-id="a4c4c-223">WCF Data Services の定義</span><span class="sxs-lookup"><span data-stu-id="a4c4c-223">Defining WCF Data Services</span></span>](../../../../docs/framework/data/wcf/defining-wcf-data-services.md)
- [<span data-ttu-id="a4c4c-224">WCF Data Services クライアント ライブラリ</span><span class="sxs-lookup"><span data-stu-id="a4c4c-224">WCF Data Services Client Library</span></span>](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
