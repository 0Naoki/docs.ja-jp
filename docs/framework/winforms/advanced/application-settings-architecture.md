---
title: アプリケーション設定アーキテクチャ
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: c2a62b61cb7b31c978a84a3d3f41c24f9fafb84d
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/09/2019
ms.locfileid: "59312567"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="7f0a5-102">アプリケーション設定アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="7f0a5-102">Application Settings Architecture</span></span>
<span data-ttu-id="7f0a5-103">このトピックでは、アプリケーション設定アーキテクチャのしくみについて説明します。また、グループ化された設定や設定キーなど、アーキテクチャの高度な機能についても説明します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>  
  
 <span data-ttu-id="7f0a5-104">アプリケーション設定アーキテクチャでは、アプリケーション スコープまたはユーザー スコープで厳密に型指定された設定の定義と、アプリケーション セッション間での設定の永続化をサポートします。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="7f0a5-105">このアーキテクチャは、ローカル ファイル システムに設定を保存し、ローカル ファイル システムから設定を読み込むための既定の永続化エンジンを提供します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="7f0a5-106">また、カスタム永続化エンジンを指定するためのインターフェイスも定義します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>  
  
 <span data-ttu-id="7f0a5-107">アプリケーションでカスタム コンポーネントがホストされているときに、そのコンポーネントの独自の設定を永続化できるようにするインターフェイスが提供されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="7f0a5-108">設定キーを使用することで、各コンポーネントはそのコンポーネントの複数のインスタンスの設定を区別できます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>  
  
## <a name="defining-settings"></a><span data-ttu-id="7f0a5-109">設定の定義</span><span class="sxs-lookup"><span data-stu-id="7f0a5-109">Defining Settings</span></span>  
 <span data-ttu-id="7f0a5-110">アプリケーション設定アーキテクチャは、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 内と Windows フォーム内で使用されます。アーキテクチャには、この両方の環境で共有される多数の基本クラスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-110">The application settings architecture is used within both [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="7f0a5-111">最も重要なの<xref:System.Configuration.SettingsBase>のコレクションを介して設定にアクセスと低レベルのメソッドの読み込みと保存の設定を提供します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="7f0a5-112">各環境から派生した独自のクラスを実装する<xref:System.Configuration.SettingsBase>その環境の追加の設定機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="7f0a5-113">派生したクラスで Windows フォーム ベースのアプリケーションでは、すべてのアプリケーション設定を定義する必要があります、<xref:System.Configuration.ApplicationSettingsBase>クラスは、基底クラスに次の機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>  
  
-   <span data-ttu-id="7f0a5-114">上位レベルの読み込み操作と保存操作</span><span class="sxs-lookup"><span data-stu-id="7f0a5-114">Higher-level loading and saving operations</span></span>  
  
-   <span data-ttu-id="7f0a5-115">ユーザー スコープの設定のサポート</span><span class="sxs-lookup"><span data-stu-id="7f0a5-115">Support for user-scoped settings</span></span>  
  
-   <span data-ttu-id="7f0a5-116">ユーザーの設定を定義済みの既定値に戻す機能</span><span class="sxs-lookup"><span data-stu-id="7f0a5-116">Reverting a user's settings to the predefined defaults</span></span>  
  
-   <span data-ttu-id="7f0a5-117">以前のバージョンのアプリケーションの設定のアップグレード</span><span class="sxs-lookup"><span data-stu-id="7f0a5-117">Upgrading settings from a previous application version</span></span>  
  
-   <span data-ttu-id="7f0a5-118">設定の変更前または保存前の検証</span><span class="sxs-lookup"><span data-stu-id="7f0a5-118">Validating settings, either before they are changed or before they are saved</span></span>  
  
 <span data-ttu-id="7f0a5-119">設定の説明は、さまざまな内で定義されている属性を使用して、<xref:System.Configuration>名前空間は、後述[アプリケーション設定の属性](application-settings-attributes.md)します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="7f0a5-120">設定を定義するときに、いずれかで適用する必要があります<xref:System.Configuration.ApplicationScopedSettingAttribute>または<xref:System.Configuration.UserScopedSettingAttribute>、アプリケーション全体または現在のユーザーにのみ、設定が適用されるかどうかについて説明します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>  
  
 <span data-ttu-id="7f0a5-121">次のコード例では、`BackgroundColor` という 1 つの設定を指定してカスタム設定クラスを定義しています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>  
  
 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]  
  
## <a name="settings-persistence"></a><span data-ttu-id="7f0a5-122">設定の永続化</span><span class="sxs-lookup"><span data-stu-id="7f0a5-122">Settings Persistence</span></span>  
 <span data-ttu-id="7f0a5-123"><xref:System.Configuration.ApplicationSettingsBase>クラス自体を永続化またはしていない設定を読み込めません。 このジョブが設定プロバイダーから派生したクラスには<xref:System.Configuration.SettingsProvider>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="7f0a5-124">場合の派生クラス<xref:System.Configuration.ApplicationSettingsBase>を通じて設定プロバイダーを指定しない、 <xref:System.Configuration.SettingsProviderAttribute>、し、既定のプロバイダー <xref:System.Configuration.LocalFileSettingsProvider>、使用されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>  
  
 <span data-ttu-id="7f0a5-125">[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] と共にリリースされた構成システムでは、ローカル コンピューターの machine.config ファイルまたはアプリケーションと共に配置される `app.`exe.config ファイルを使用した静的なアプリケーション構成データの提供をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-125">The configuration system that was originally released with the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="7f0a5-126"><xref:System.Configuration.LocalFileSettingsProvider>クラスは、次の方法でこのネイティブ サポートを拡張します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>  
  
-   <span data-ttu-id="7f0a5-127">アプリケーション スコープの設定は、machine.config ファイルまたは `app.`exe.config ファイルに保存できます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="7f0a5-128">machine.config は常に読み取り専用です。`app`.exe.config は、セキュリティを考慮して、ほとんどのアプリケーションで読み取り専用に制限されています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>  
  
-   <span data-ttu-id="7f0a5-129">ユーザー スコープの設定は、`app`.exe.config ファイルに保存できます。この場合、設定は静的な既定値として扱われます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>  
  
-   <span data-ttu-id="7f0a5-130">既定値以外のユーザー スコープの設定は、*user*.config という新しいファイルに保存されます。*user* は、アプリケーションを現在実行しているユーザーのユーザー名です。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="7f0a5-131">ユーザー スコープの設定で、既定値を指定する<xref:System.Configuration.DefaultSettingValueAttribute>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="7f0a5-132">ユーザー スコープの設定はアプリケーションの実行時に変更されることが多いため、`user`.config は常に読み取り/書き込みになります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>  
  
 <span data-ttu-id="7f0a5-133">この 3 つの構成ファイルはいずれも XML 形式で設定を保存します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="7f0a5-134">アプリケーション スコープの設定の最上位の XML 要素は `<appSettings>` であり、ユーザー スコープの設定には `<userSettings>` が使用されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="7f0a5-135">アプリケーション スコープの設定と、ユーザー スコープの設定の既定値が含まれた `app`.exe.config ファイルは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>  
  
```xml  
<?xml version="1.0" encoding="utf-8" ?>  
<configuration>  
    <configSections>  
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />  
        </sectionGroup>  
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >  
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />  
        </sectionGroup>  
    </configSections>  
    <applicationSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="Cursor" serializeAs="String">  
                <value>Default</value>  
            </setting>  
            <setting name="DoubleBuffering" serializeAs="String">  
                <value>False</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </applicationSettings>  
    <userSettings>  
        <WindowsApplication1.Properties.Settings>  
            <setting name="FormTitle" serializeAs="String">  
                <value>Form1</value>  
            </setting>  
            <setting name="FormSize" serializeAs="String">  
                <value>595, 536</value>  
            </setting>  
        </WindowsApplication1.Properties.Settings>  
    </userSettings>  
</configuration>  
```  
  
 <span data-ttu-id="7f0a5-136">構成ファイルのアプリケーション設定セクション内の要素の定義については、「[アプリケーション設定のスキーマ](../../configure-apps/file-schema/application-settings-schema.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>  
  
### <a name="settings-bindings"></a><span data-ttu-id="7f0a5-137">設定のバインド</span><span class="sxs-lookup"><span data-stu-id="7f0a5-137">Settings Bindings</span></span>  
 <span data-ttu-id="7f0a5-138">アプリケーション設定では、Windows フォーム データ バインド アーキテクチャを使用して、設定オブジェクトとコンポーネント間で設定の更新の双方向通信を行います。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="7f0a5-139">Visual Studio を使用してアプリケーション設定を作成し、設定をコンポーネントのプロパティに割り当てると、これらのバインドが自動的に生成されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>  
  
 <span data-ttu-id="7f0a5-140">アプリケーションの設定をサポートするコンポーネントにしかバインド、<xref:System.Windows.Forms.IBindableComponent>インターフェイス。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="7f0a5-141">また、コンポーネントを特定のバインド プロパティの変更イベントを実装またはアプリケーションの設定で、プロパティが変更されたことを通知する必要があります、<xref:System.ComponentModel.INotifyPropertyChanged>インターフェイス。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="7f0a5-142">コンポーネントが実装していない場合<xref:System.Windows.Forms.IBindableComponent>Visual Studio でバインドして、バインドされたプロパティは、最初に設定されますが、更新されません。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="7f0a5-143">コンポーネントが実装されている場合<xref:System.Windows.Forms.IBindableComponent>が、変更通知をサポート プロパティではないが、設定ファイルでは、プロパティが変更されたときに、バインドは更新されません。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>  
  
 <span data-ttu-id="7f0a5-144">Windows フォームの一部のコンポーネントなど<xref:System.Windows.Forms.ToolStripItem>設定のバインドをサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>  
  
### <a name="settings-serialization"></a><span data-ttu-id="7f0a5-145">設定のシリアル化</span><span class="sxs-lookup"><span data-stu-id="7f0a5-145">Settings Serialization</span></span>  
 <span data-ttu-id="7f0a5-146">ときに<xref:System.Configuration.LocalFileSettingsProvider>をディスクに設定を保存する必要があります、次の操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>  
  
1. <span data-ttu-id="7f0a5-147">リフレクションを使用して、すべてで定義されたプロパティを調べて、<xref:System.Configuration.ApplicationSettingsBase>派生クラスでいずれかで適用されるものを見つける<xref:System.Configuration.ApplicationScopedSettingAttribute>または<xref:System.Configuration.UserScopedSettingAttribute>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>  
  
2. <span data-ttu-id="7f0a5-148">プロパティをディスクにシリアル化します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-148">Serializes the property to disk.</span></span> <span data-ttu-id="7f0a5-149">最初に呼び出すしよう、<xref:System.ComponentModel.TypeConverter.ConvertToString%2A>または<xref:System.ComponentModel.TypeConverter.ConvertFromString%2A>の種類の関連付けられた<xref:System.ComponentModel.TypeConverter>。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="7f0a5-150">この呼び出しが失敗すると、代わりに XML シリアル化を使用します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-150">If this does not succeed, it uses XML serialization instead.</span></span>  
  
3. <span data-ttu-id="7f0a5-151">設定の属性に基づいて、どの設定がどのファイルに指定されているかを判断します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-151">Determines which settings go in which files, based on the setting's attribute.</span></span>  
  
 <span data-ttu-id="7f0a5-152">使用することができます独自設定クラスを実装する場合、<xref:System.Configuration.SettingsSerializeAsAttribute>バイナリまたはカスタムのシリアル化を使用するかの設定をマークする、<xref:System.Configuration.SettingsSerializeAs>列挙体。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="7f0a5-153">コードで設定クラスを作成する方法の詳細については、次を参照してください。[方法。アプリケーション設定を作成する](how-to-create-application-settings.md)します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>  
  
### <a name="settings-file-locations"></a><span data-ttu-id="7f0a5-154">設定ファイルの場所</span><span class="sxs-lookup"><span data-stu-id="7f0a5-154">Settings File Locations</span></span>  
 <span data-ttu-id="7f0a5-155">`app`.exe.config ファイルと *user*.config ファイルの場所は、アプリケーションのインストール方法によって異なります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="7f0a5-156">ローカルのコンピューターにコピーする Windows フォーム ベースのアプリケーションの`app`. exe.config はアプリケーションのメイン実行可能ファイルのベース ディレクトリと同じディレクトリに存在し、*ユーザー*.config に存在、指定された場所、<xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType>プロパティ。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="7f0a5-157">[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] を使用してインストールされたアプリケーションの場合、どちらのファイルも %InstallRoot%\Documents and Settings\\*username*\Local Settings の下の [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] データ ディレクトリに配置されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-157">For an application installed by means of [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)], both of these files will reside in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>  
  
 <span data-ttu-id="7f0a5-158">ユーザーが移動プロファイルを有効にしている場合、これらのファイルの格納場所は若干異なります。移動プロファイルを使用すると、ユーザーはドメイン内の他のコンピューターを使用するときに Windows とアプリケーションの異なる設定を定義できます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="7f0a5-159">この場合、[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] アプリケーションと [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] 以外のアプリケーションのどちらについても、`app`.exe.config ファイルと *user*.config ファイルが %InstallRoot%\Documents and Settings\\*username*\Application Data に格納されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-159">In that case, both [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications and non-[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>  
  
 <span data-ttu-id="7f0a5-160">アプリケーション設定機能と新しい配置テクノロジの連携の詳細については、「[ClickOnce とアプリケーション設定](/visualstudio/deployment/clickonce-and-application-settings)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="7f0a5-161">[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] データ ディレクトリの詳細については、「[ClickOnce アプリケーションにおけるローカル データおよびリモート データへのアクセス](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-161">For more information about the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>  
  
## <a name="application-settings-and-security"></a><span data-ttu-id="7f0a5-162">アプリケーション設定とセキュリティ</span><span class="sxs-lookup"><span data-stu-id="7f0a5-162">Application Settings and Security</span></span>  
 <span data-ttu-id="7f0a5-163">アプリケーション設定は部分信頼で機能するように設計されています。部分信頼は、インターネットまたはイントラネット上でホストされる Windows フォーム アプリケーションの既定の制限された環境です。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="7f0a5-164">既定の設定プロバイダーでアプリケーション設定を使用する場合、部分信頼以外の特別なアクセス許可は不要です。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>  
  
 <span data-ttu-id="7f0a5-165">アプリケーション設定を [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] アプリケーション内で使用する場合、`user`.config ファイルは [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] データ ディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-165">When application settings are used in a [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] application, the `user`.config file is stored in the [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] data directory.</span></span> <span data-ttu-id="7f0a5-166">アプリケーションの `user`.config ファイルのサイズは、[!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)] で設定されたデータ ディレクトリ クォータを超えることはできません。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-166">The size of the application's `user`.config file cannot exceed the data directory quota set by [!INCLUDE[ndptecclick](../../../../includes/ndptecclick-md.md)].</span></span> <span data-ttu-id="7f0a5-167">詳細については、「[ClickOnce とアプリケーション設定](/visualstudio/deployment/clickonce-and-application-settings)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>  
  
## <a name="custom-settings-providers"></a><span data-ttu-id="7f0a5-168">カスタム設定プロバイダー</span><span class="sxs-lookup"><span data-stu-id="7f0a5-168">Custom Settings Providers</span></span>  
 <span data-ttu-id="7f0a5-169">アプリケーション設定アーキテクチャでは、アプリケーション設定間の疎結合から派生したラッパー クラス<xref:System.Configuration.ApplicationSettingsBase>、および関連付けられた設定プロバイダーまたはプロバイダーから派生<xref:System.Configuration.SettingsProvider>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="7f0a5-170">この関連付けはでのみ定義されている、<xref:System.Configuration.SettingsProviderAttribute>ラッパー クラスまたはその個々 のプロパティに適用します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="7f0a5-171">プロバイダーが明示的に設定を指定すると、既定のプロバイダー場合<xref:System.Configuration.LocalFileSettingsProvider>、使用されます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="7f0a5-172">そのため、このアーキテクチャではカスタム設定プロバイダーの作成と使用がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-172">As a result, this architecture supports creating and using custom settings providers.</span></span>  
  
 <span data-ttu-id="7f0a5-173">たとえば、すべての設定データを Microsoft SQL Server データベースに格納するプロバイダーである `SqlSettingsProvider` を開発して使用するとします。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="7f0a5-174"><xref:System.Configuration.SettingsProvider>-派生クラスでは、この情報を受け取るその`Initialize`型のパラメーターとしてメソッド<xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="7f0a5-175">実装し、 <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> 、データ ストアからの設定を取得するメソッドをおよび<xref:System.Configuration.SettingsProvider.SetPropertyValues%2A>に保存します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="7f0a5-176">プロバイダーを使用して、<xref:System.Configuration.SettingsPropertyCollection>に指定された<xref:System.Configuration.SettingsProvider.GetPropertyValues%2A>そのプロパティのプロパティの名前、種類、およびスコープを確認するだけでなく、他の設定の属性が定義されています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>  
  
 <span data-ttu-id="7f0a5-177">カスタム プロバイダーでは、1 つのプロパティと 1 つのメソッドを実装する必要がありますが、この実装はわかりにくいことがあります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="7f0a5-178"><xref:System.Configuration.SettingsProvider.ApplicationName%2A>プロパティの抽象プロパティは、 <xref:System.Configuration.SettingsProvider>; を返す、次をプログラムする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]  
  
 <span data-ttu-id="7f0a5-179">派生クラスでは、引数を受け取らず値を返さない `Initialize` メソッドも実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="7f0a5-180">このメソッドは、によって定義されていない<xref:System.Configuration.SettingsProvider>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>  
  
 <span data-ttu-id="7f0a5-181">最後に、実装<xref:System.Configuration.IApplicationSettingsProvider>設定の更新のサポートを提供する、プロバイダーで、既定値に設定を元に戻すと、別の設定の 1 つのアプリケーションのバージョンからアップグレードします。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>  
  
 <span data-ttu-id="7f0a5-182">カスタム プロバイダーを実装してコンパイルしたら、既定のプロバイダーではなく、このプロバイダーを使用するよう設定クラスに指示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="7f0a5-183">これを実現する、<xref:System.Configuration.SettingsProviderAttribute>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="7f0a5-184">クラスが定義される各設定に、プロバイダーを使用する設定クラス全体に適用する場合アプリケーション設定アーキテクチャがのみ、これらの設定をそのプロバイダーを使用しを使用して個々 の設定に適用される場合<xref:System.Configuration.LocalFileSettingsProvider>残りの部分。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="7f0a5-185">次のコード例は、カスタム プロバイダーを使用するよう設定クラスに指示する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>  
  
 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]  
  
 <span data-ttu-id="7f0a5-186">プロバイダーを複数のスレッドから同時に呼び出すことができますが、プロバイダーは常に同じ格納場所に書き込みを行います。したがって、アプリケーション設定アーキテクチャによってインスタンス化されるカスタム プロバイダー クラスのインスタンスは 1 つに限られます。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="7f0a5-187">カスタム プロバイダーがスレッドセーフであり、構成ファイルへの書き込みを実行できるスレッドが一度に 1 つだけであることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>  
  
 <span data-ttu-id="7f0a5-188">ご利用のプロバイダーがすべての設定で定義されている属性をサポートする必要はありません、<xref:System.Configuration?displayProperty=nameWithType>名前空間には、最小のサポートがあります<xref:System.Configuration.ApplicationScopedSettingAttribute>と<xref:System.Configuration.UserScopedSettingAttribute>ともサポートする必要があります<xref:System.Configuration.DefaultSettingValueAttribute>します。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="7f0a5-189">サポートされていない属性がある場合、カスタム プロバイダーは通知なしに失敗します。例外をスローする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="7f0a5-190">設定クラスがただし属性の無効な組み合わせを使用するかどうか、適用など<xref:System.Configuration.ApplicationScopedSettingAttribute>と<xref:System.Configuration.UserScopedSettingAttribute>の同じ設定を:、プロバイダーが例外をスローし、操作を停止する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7f0a5-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7f0a5-191">関連項目</span><span class="sxs-lookup"><span data-stu-id="7f0a5-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="7f0a5-192">アプリケーション設定の概要</span><span class="sxs-lookup"><span data-stu-id="7f0a5-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="7f0a5-193">カスタム コントロールのアプリケーション設定</span><span class="sxs-lookup"><span data-stu-id="7f0a5-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="7f0a5-194">ClickOnce とアプリケーション設定</span><span class="sxs-lookup"><span data-stu-id="7f0a5-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="7f0a5-195">アプリケーション設定スキーマ</span><span class="sxs-lookup"><span data-stu-id="7f0a5-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
