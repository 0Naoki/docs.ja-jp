---
title: Windows フォーム DataGridView コントロールでの Just-In-Time データ読み込みによる仮想モードの実装
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- examples [Windows Forms], just-in-time data loading
- data [Windows Forms], managing large data sets
- DataGridView control [Windows Forms], virtual mode
- just-in-time data loading
- DataGridView control [Windows Forms], large data sets
- virtual mode [Windows Forms], just-in-time data loading
ms.assetid: c2a052b9-423c-4ff7-91dc-d8c7c79345f6
ms.openlocfilehash: 641db19cc6493a20c9f9a34622f466e3623c32ad
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "61973824"
---
# <a name="implementing-virtual-mode-with-just-in-time-data-loading-in-the-windows-forms-datagridview-control"></a><span data-ttu-id="e5d3e-102">Windows フォーム DataGridView コントロールでの Just-In-Time データ読み込みによる仮想モードの実装</span><span class="sxs-lookup"><span data-stu-id="e5d3e-102">Implementing Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>
<span data-ttu-id="e5d3e-103">仮想モードを実装する理由の 1 つ、<xref:System.Windows.Forms.DataGridView>コントロールは、必要な場合にのみデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-103">One reason to implement virtual mode in the <xref:System.Windows.Forms.DataGridView> control is to retrieve data only as it is needed.</span></span> <span data-ttu-id="e5d3e-104">これは呼び出されます*ジャストイン タイムのデータの読み込み*します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-104">This is called *just-in-time data loading*.</span></span>  
  
 <span data-ttu-id="e5d3e-105">リモート データベースで非常に大きなテーブルを使用する場合はなどを表示するために必要なデータのみを取得し、ユーザーのビューに新しい行をスクロールする場合にのみ、追加のデータを取得するスタートアップの遅延を回避するために必要する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-105">If you are working with a very large table in a remote database, for example, you might want to avoid startup delays by retrieving only the data that is necessary for display and retrieving additional data only when the user scrolls new rows into view.</span></span> <span data-ttu-id="e5d3e-106">アプリケーションを実行しているクライアント コンピューターの限られた量のデータを格納するために使用可能なメモリの場合は、データベースから新しい値を取得するときに使用されていないデータを破棄する場合がありますもします。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-106">If the client computers running your application have a limited amount of memory available for storing data, you might also want to discard unused data when retrieving new values from the database.</span></span>  
  
 <span data-ttu-id="e5d3e-107">次のセクションでは、使用方法を説明します、<xref:System.Windows.Forms.DataGridView>ジャストイン タイムのキャッシュを制御します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-107">The following sections describe how to use a <xref:System.Windows.Forms.DataGridView> control with a just-in-time cache.</span></span>  
  
 <span data-ttu-id="e5d3e-108">このトピックのコードを単一のリストとしてコピーするには、「[方法:フォームの DataGridView コントロールの Windows でジャストイン タイムのデータ読み込みによる仮想モードの実装](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-108">To copy the code in this topic as a single listing, see [How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md).</span></span>  
  
## <a name="the-form"></a><span data-ttu-id="e5d3e-109">フォーム</span><span class="sxs-lookup"><span data-stu-id="e5d3e-109">The Form</span></span>  
 <span data-ttu-id="e5d3e-110">次のコード例は、読み取り専用を含むフォームを定義します。<xref:System.Windows.Forms.DataGridView>とやり取りするコントロールを`Cache`オブジェクト、<xref:System.Windows.Forms.DataGridView.CellValueNeeded>イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-110">The following code example defines a form containing a read-only <xref:System.Windows.Forms.DataGridView> control that interacts with a `Cache` object through a <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler.</span></span> <span data-ttu-id="e5d3e-111">`Cache`オブジェクトがローカルに保存された値を管理しを使用して、 `DataRetriever` Northwind サンプル データベースの Orders テーブルから値を取得するオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-111">The `Cache` object manages the locally stored values and uses a `DataRetriever` object to retrieve values from the Orders table of the sample Northwind database.</span></span> <span data-ttu-id="e5d3e-112">`DataRetriever`実装しているオブジェクト、`IDataPageRetriever`で必要なインターフェイス、`Cache`クラスは、初期化するためにも使用、<xref:System.Windows.Forms.DataGridView>行および列を制御します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-112">The `DataRetriever` object, which implements the `IDataPageRetriever` interface required by the `Cache` class, is also used to initialize the <xref:System.Windows.Forms.DataGridView> control rows and columns.</span></span>  
  
 <span data-ttu-id="e5d3e-113">`IDataPageRetriever`、 `DataRetriever`、および`Cache`型はこのトピックの後半で説明します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-113">The `IDataPageRetriever`, `DataRetriever`, and `Cache` types are described later in this topic.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e5d3e-114">接続文字列内に機密情報 (パスワードなど) を格納すると、アプリケーションのセキュリティに影響を及ぼすことがあります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-114">Storing sensitive information, such as a password, within the connection string can affect the security of your application.</span></span> <span data-ttu-id="e5d3e-115">データベースへのアクセスを制御する方法としては、Windows 認証 (統合セキュリティとも呼ばれます) を使用する方が安全です。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-115">Using Windows Authentication (also known as integrated security) is a more secure way to control access to a database.</span></span> <span data-ttu-id="e5d3e-116">詳細については、「[接続情報の保護](../../data/adonet/protecting-connection-information.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-116">For more information, see [Protecting Connection Information](../../data/adonet/protecting-connection-information.md).</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#100)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#100](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#100)]  
  
## <a name="the-idatapageretriever-interface"></a><span data-ttu-id="e5d3e-117">示しますインターフェイス</span><span class="sxs-lookup"><span data-stu-id="e5d3e-117">The IDataPageRetriever Interface</span></span>  
 <span data-ttu-id="e5d3e-118">次のコード例を定義、`IDataPageRetriever`インターフェイスによって実装される、`DataRetriever`クラス。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-118">The following code example defines the `IDataPageRetriever` interface, which is implemented by the `DataRetriever` class.</span></span> <span data-ttu-id="e5d3e-119">このインターフェイスで宣言されている唯一の方法が、`SupplyPageOfData`メソッドは、最初の行インデックスおよびデータの 1 つのページ内の行の数が必要です。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-119">The only method declared in this interface is the `SupplyPageOfData` method, which requires an initial row index and a count of the number of rows in a single page of data.</span></span> <span data-ttu-id="e5d3e-120">これらの値は、データ ソースからデータのサブセットを取得する、実装者が使用されます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-120">These values are used by the implementer to retrieve a subset of data from a data source.</span></span>  
  
 <span data-ttu-id="e5d3e-121">A`Cache`オブジェクトは、データの最初の 2 つのページの読み込みに構築時にこのインターフェイスの実装を使用します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-121">A `Cache` object uses an implementation of this interface during construction to load two initial pages of data.</span></span> <span data-ttu-id="e5d3e-122">キャッシュがこれらのページのいずれかを破棄しから値を含む新しいページを要求にキャッシュされていない値が必要に応じていつでも、`IDataPageRetriever`します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-122">Whenever an uncached value is needed, the cache discards one of these pages and requests a new page containing the value from the `IDataPageRetriever`.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#201)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#201](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#201)]  
  
## <a name="the-dataretriever-class"></a><span data-ttu-id="e5d3e-123">DataRetriever クラス</span><span class="sxs-lookup"><span data-stu-id="e5d3e-123">The DataRetriever Class</span></span>  
 <span data-ttu-id="e5d3e-124">次のコード例を定義、`DataRetriever`クラスを実装、`IDataPageRetriever`サーバーからのデータ ページを取得するインターフェイス。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-124">The following code example defines the `DataRetriever` class, which implements the `IDataPageRetriever` interface to retrieve pages of data from a server.</span></span> <span data-ttu-id="e5d3e-125">`DataRetriever`クラスも用意されています。`Columns`と`RowCount`プロパティを、<xref:System.Windows.Forms.DataGridView>ために必要な列を作成すると、適切な数の空の行を追加するコントロールを使用して、<xref:System.Windows.Forms.DataGridView.Rows%2A>コレクション。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-125">The `DataRetriever` class also provides `Columns` and `RowCount` properties, which the <xref:System.Windows.Forms.DataGridView> control uses to create the necessary columns and to add the appropriate number of empty rows to the <xref:System.Windows.Forms.DataGridView.Rows%2A> collection.</span></span> <span data-ttu-id="e5d3e-126">空の行を追加すると、テーブル内のすべてのデータが含まれている場合と同様に、コントロールできるように必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-126">Adding the empty rows is necessary so that the control will behave as though it contains all the data in the table.</span></span> <span data-ttu-id="e5d3e-127">これは、スクロール バーのスクロール ボックスは、適切なサイズになり、ユーザーは、テーブルの任意の行にアクセスできることを意味します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-127">This means that the scroll box in the scroll bar will have the appropriate size, and the user will be able to access any row in the table.</span></span> <span data-ttu-id="e5d3e-128">によって、行がいっぱいになる、<xref:System.Windows.Forms.DataGridView.CellValueNeeded>ビューにスクロールする場合にのみ、イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-128">The rows are filled by the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event handler only when they are scrolled into view.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#200)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#200](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#200)]  
  
## <a name="the-cache-class"></a><span data-ttu-id="e5d3e-129">キャッシュ クラス</span><span class="sxs-lookup"><span data-stu-id="e5d3e-129">The Cache Class</span></span>  
 <span data-ttu-id="e5d3e-130">次のコード例を定義、`Cache`クラスを介して作成されるデータの 2 つのページ、`IDataPageRetriever`実装します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-130">The following code example defines the `Cache` class, which manages two pages of data populated through an `IDataPageRetriever` implementation.</span></span> <span data-ttu-id="e5d3e-131">`Cache`クラス定義内部`DataPage`を含む構造を<xref:System.Data.DataTable>値を 1 つのキャッシュに格納するページと行のインデックスを作成する計算を表すページの上限と下限の境界。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-131">The `Cache` class defines an inner `DataPage` structure, which contains a <xref:System.Data.DataTable> to store the values in a single cache page and which calculates the row indexes that represent the upper and lower boundaries of the page.</span></span>  
  
 <span data-ttu-id="e5d3e-132">`Cache`クラスは、構築時にデータの 2 つのページを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-132">The `Cache` class loads two pages of data at construction time.</span></span> <span data-ttu-id="e5d3e-133">たびに、<xref:System.Windows.Forms.DataGridView.CellValueNeeded>イベントは、値を要求、`Cache`オブジェクトかどうかを値が表示されます。 その 2 つのいずれかのページを、必要な場合は、を返します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-133">Whenever the <xref:System.Windows.Forms.DataGridView.CellValueNeeded> event requests a value, the `Cache` object determines if the value is available in one of its two pages and, if so, returns it.</span></span> <span data-ttu-id="e5d3e-134">値が使用できないローカルで場合、`Cache`オブジェクトを調べ、その 2 つのページの惑星現在表示されている行がページし、返される要求の値を含む、新しいものに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-134">If the value is not available locally, the `Cache` object determines which of its two pages is farthest from the currently displayed rows and replaces the page with a new one containing the requested value, which it then returns.</span></span>  
  
 <span data-ttu-id="e5d3e-135">データ ページ内の行の数は、画面に一度に表示できる行の数と同じが、このモデルは効率的に、最も最近表示したページに戻るには、テーブルのページング ユーザーをできます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-135">Assuming that the number of rows in a data page is the same as the number of rows that can be displayed on screen at once, this model allows users paging through the table to efficiently return to the most recently viewed page.</span></span>  
  
 [!code-csharp[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](~/samples/snippets/csharp/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/CS/lazyloading.cs#300)]
 [!code-vb[System.Windows.Forms.DataGridView.Virtual_lazyloading#300](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.Windows.Forms.DataGridView.Virtual_lazyloading/VB/lazyloading.vb#300)]  
  
## <a name="additional-considerations"></a><span data-ttu-id="e5d3e-136">その他の考慮事項</span><span class="sxs-lookup"><span data-stu-id="e5d3e-136">Additional Considerations</span></span>  
 <span data-ttu-id="e5d3e-137">前のコード例は、ジャストイン タイム データの読み込みの例として提供されます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-137">The previous code examples are provided as a demonstration of just-in-time data loading.</span></span> <span data-ttu-id="e5d3e-138">効率を最大化を実現するために、独自のニーズのコードを変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-138">You will need to modify the code for your own needs to achieve maximum efficiency.</span></span> <span data-ttu-id="e5d3e-139">少なくともは、キャッシュ内のデータの 1 ページあたりの行の数の適切な値を選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-139">At minimum, you will need to choose an appropriate value for the number of rows per page of data in the cache.</span></span> <span data-ttu-id="e5d3e-140">この値に渡される、`Cache`コンス トラクター。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-140">This value is passed into the `Cache` constructor.</span></span> <span data-ttu-id="e5d3e-141">1 ページあたりの行の数が同時に表示できる行の数以上する必要があります、<xref:System.Windows.Forms.DataGridView>コントロール。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-141">The number of rows per page should be no less than the number of rows that can be displayed simultaneously in your <xref:System.Windows.Forms.DataGridView> control.</span></span>  
  
 <span data-ttu-id="e5d3e-142">最良の結果はパフォーマンス テストと使いやすさがシステムとユーザーの要件を決定するテストを実施する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-142">For best results, you will need to conduct performance testing and usability testing to determine the requirements of your system and your users.</span></span> <span data-ttu-id="e5d3e-143">考慮する必要がありますをいくつかの要因には、アプリケーション、使用すると、ネットワーク接続の使用可能な帯域幅、および使用するサーバーの待機時間を実行しているクライアント コンピューターでメモリの量が含まれます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-143">Several factors that you will need to take into consideration include the amount of memory in the client machines running your application, the available bandwidth of the network connection used, and the latency of the server used.</span></span> <span data-ttu-id="e5d3e-144">帯域幅と待機時間は、ピーク時決定してください。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-144">The bandwidth and latency should be determined at times of peak usage.</span></span>  
  
 <span data-ttu-id="e5d3e-145">アプリケーションのスクロールのパフォーマンスを向上させるのには、ローカルに格納されているデータの量を変更できます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-145">To improve the scrolling performance of your application, you can increase the amount of data stored locally.</span></span> <span data-ttu-id="e5d3e-146">起動時間を向上させるため、ただし、回避しなければならない大量のデータを最初に読み込みます。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-146">To improve startup time, however, you must avoid loading too much data initially.</span></span> <span data-ttu-id="e5d3e-147">変更することも、`Cache`クラスを格納できるデータ ページの数を増やしてください。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-147">You may want to modify the `Cache` class to increase the number of data pages it can store.</span></span> <span data-ttu-id="e5d3e-148">スクロールの効率を向上させる複数のデータ ページを使用することができますが、使用可能な帯域幅とサーバーの待機時間に応じて、データ ページ内の行の理想的な数を決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-148">Using more data pages can improve scrolling efficiency, but you will need to determine the ideal number of rows in a data page, depending on the available bandwidth and the server latency.</span></span> <span data-ttu-id="e5d3e-149">サイズの小さいページでは、サーバーは、アクセス頻度の高いより短時間で要求されたデータを返します。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-149">With smaller pages, the server will be accessed more frequently, but will take less time to return the requested data.</span></span> <span data-ttu-id="e5d3e-150">待機時間がより多くの帯域幅よりも問題の場合は、大規模なデータ ページを使用したい場合があります。</span><span class="sxs-lookup"><span data-stu-id="e5d3e-150">If latency is more of an issue than bandwidth, you may want to use larger data pages.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e5d3e-151">関連項目</span><span class="sxs-lookup"><span data-stu-id="e5d3e-151">See also</span></span>

- <xref:System.Windows.Forms.DataGridView>
- <xref:System.Windows.Forms.DataGridView.VirtualMode%2A>
- [<span data-ttu-id="e5d3e-152">Windows フォーム DataGridView コントロールでのパフォーマンス チューニング</span><span class="sxs-lookup"><span data-stu-id="e5d3e-152">Performance Tuning in the Windows Forms DataGridView Control</span></span>](performance-tuning-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="e5d3e-153">Windows フォーム DataGridView コントロールを拡張するための推奨される手順</span><span class="sxs-lookup"><span data-stu-id="e5d3e-153">Best Practices for Scaling the Windows Forms DataGridView Control</span></span>](best-practices-for-scaling-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="e5d3e-154">Windows フォーム DataGridView コントロールでの仮想モード</span><span class="sxs-lookup"><span data-stu-id="e5d3e-154">Virtual Mode in the Windows Forms DataGridView Control</span></span>](virtual-mode-in-the-windows-forms-datagridview-control.md)
- [<span data-ttu-id="e5d3e-155">チュートリアル: Windows フォームの DataGridView コントロールで仮想モードの実装</span><span class="sxs-lookup"><span data-stu-id="e5d3e-155">Walkthrough: Implementing Virtual Mode in the Windows Forms DataGridView Control</span></span>](implementing-virtual-mode-wf-datagridview-control.md)
- [<span data-ttu-id="e5d3e-156">方法: Windows フォームの DataGridView コントロールでジャストイン タイムのデータ読み込みによる仮想モードの実装</span><span class="sxs-lookup"><span data-stu-id="e5d3e-156">How to: Implement Virtual Mode with Just-In-Time Data Loading in the Windows Forms DataGridView Control</span></span>](virtual-mode-with-just-in-time-data-loading-in-the-datagrid.md)
