---
title: エラーの送受信
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- handling faults [WCF], sending
ms.assetid: 7be6fb96-ce2a-450b-aebe-f932c6a4bc5d
ms.openlocfilehash: 5a4b4dc79b0f0dad661d99fae6377d1c86b673b6
ms.sourcegitcommit: 15109844229ade1c6449f48f3834db1b26907824
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/07/2018
---
# <a name="sending-and-receiving-faults"></a><span data-ttu-id="a9970-102">エラーの送受信</span><span class="sxs-lookup"><span data-stu-id="a9970-102">Sending and Receiving Faults</span></span>
<span data-ttu-id="a9970-103">SOAP エラーは、エラー状態情報をサービスからクライアントに伝達します。双方向通信の場合は、相互運用可能な方法でクライアントからサービスにも伝達します。</span><span class="sxs-lookup"><span data-stu-id="a9970-103">SOAP faults convey error condition information from a service to a client and in the duplex case from a client to a service in an interoperable way.</span></span> <span data-ttu-id="a9970-104">通常、サービスは、カスタムのエラー コンテンツを定義し、そのエラー コンテンツを返すことができる操作を指定します </span><span class="sxs-lookup"><span data-stu-id="a9970-104">Typically a service defines custom fault content and specifies which operations can return them.</span></span> <span data-ttu-id="a9970-105">(詳細については、次を参照してください[を指定するエラーの定義および](../../../docs/framework/wcf/defining-and-specifying-faults.md)。)。ここでは、対応するエラー状態が発生したときにサービスまたは双方向クライアントがエラーを送信する方法、およびクライアントまたはサービス アプリケーションがエラーを処理する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a9970-105">(For more information, see [Defining and Specifying Faults](../../../docs/framework/wcf/defining-and-specifying-faults.md).) This topic discusses how a service or duplex client can send those faults when the corresponding error condition has occurred and how a client or service application handles these faults.</span></span> <span data-ttu-id="a9970-106">Windows Communication Foundation (WCF) アプリケーションのエラー処理の概要については、次を参照してください。[を指定すると処理のエラー コントラクトおよびサービスの](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)します。</span><span class="sxs-lookup"><span data-stu-id="a9970-106">For an overview of error handling in Windows Communication Foundation (WCF) applications, see [Specifying and Handling Faults in Contracts and Services](../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md).</span></span>  
  
## <a name="sending-soap-faults"></a><span data-ttu-id="a9970-107">SOAP エラーの送信</span><span class="sxs-lookup"><span data-stu-id="a9970-107">Sending SOAP Faults</span></span>  
 <span data-ttu-id="a9970-108">宣言された SOAP エラーは、カスタム SOAP エラーの種類を指定する <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> を含む操作で発生します。</span><span class="sxs-lookup"><span data-stu-id="a9970-108">Declared SOAP faults are those in which an operation has a <xref:System.ServiceModel.FaultContractAttribute?displayProperty=nameWithType> that specifies a custom SOAP fault type.</span></span> <span data-ttu-id="a9970-109">宣言されていない SOAP エラーとは、操作のコントラクトに指定されていないエラーです。</span><span class="sxs-lookup"><span data-stu-id="a9970-109">Undeclared SOAP faults are those that are not specified in the contract for an operation.</span></span>  
  
### <a name="sending-declared-faults"></a><span data-ttu-id="a9970-110">宣言されたエラーの送信</span><span class="sxs-lookup"><span data-stu-id="a9970-110">Sending Declared Faults</span></span>  
 <span data-ttu-id="a9970-111">宣言された SOAP エラーを送信するには、SOAP エラーに該当するエラー状態を検出し、新しい <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> をスローします。この場合、型パラメーターは、その操作の <xref:System.ServiceModel.FaultContractAttribute> に指定されている型の新しいオブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="a9970-111">To send a declared SOAP fault, detect the error condition for which the SOAP fault is appropriate and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> where the type parameter is a new object of the type specified in the <xref:System.ServiceModel.FaultContractAttribute> for that operation.</span></span> <span data-ttu-id="a9970-112">次のコード例は、<xref:System.ServiceModel.FaultContractAttribute> 操作で `SampleMethod` の詳細な型と共に SOAP エラーを返すことができることを指定するために、`GreetingFault` を使用しています。</span><span class="sxs-lookup"><span data-stu-id="a9970-112">The following code example shows the use of <xref:System.ServiceModel.FaultContractAttribute> to specify that the `SampleMethod` operation can return a SOAP fault with the detail type of `GreetingFault`.</span></span>  
  
 [!code-csharp[FaultContractAttribute#4](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#4)]
 [!code-vb[FaultContractAttribute#4](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#4)]  
  
 <span data-ttu-id="a9970-113">`GreetingFault` エラー情報をクライアントに伝達するには、適切なエラー状態をキャッチし、次のコード例に示すように、新しい <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> オブジェクトを引数として使用して `GreetingFault` 型の新しい `GreetingFault` をスローします。</span><span class="sxs-lookup"><span data-stu-id="a9970-113">To convey the `GreetingFault` error information to the client, catch the appropriate error condition and throw a new <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault` with a new `GreetingFault` object as the argument, as in the following code example.</span></span> <span data-ttu-id="a9970-114">これが、型がマネージ例外として発生、クライアントが WCF クライアント アプリケーションの場合は、<xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType>型の`GreetingFault`します。</span><span class="sxs-lookup"><span data-stu-id="a9970-114">If the client is an WCF client application, it experiences this as a managed exception where the type is <xref:System.ServiceModel.FaultException%601?displayProperty=nameWithType> of type `GreetingFault`.</span></span>  
  
 [!code-csharp[FaultContractAttribute#5](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/services.cs#5)]
 [!code-vb[FaultContractAttribute#5](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/services.vb#5)]  
  
### <a name="sending-undeclared-faults"></a><span data-ttu-id="a9970-115">宣言されていないエラーの送信</span><span class="sxs-lookup"><span data-stu-id="a9970-115">Sending Undeclared Faults</span></span>  
 <span data-ttu-id="a9970-116">送信元の宣言されていないエラーは、すばやく診断してデバッグ ツールとして、WCF アプリケーションがその有用性の問題をデバッグする非常に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="a9970-116">Sending undeclared faults can be very useful to quickly diagnose and debug problems in WCF applications, but its usefulness as a debugging tool is limited.</span></span> <span data-ttu-id="a9970-117">一般的に、デバッグ時には <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> プロパティを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a9970-117">More generally, when debugging it is recommended that you use the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="a9970-118">この値を true に設定すると、クライアントはこのエラーを <xref:System.ServiceModel.FaultException%601> 型の <xref:System.ServiceModel.ExceptionDetail> 例外として認識します。</span><span class="sxs-lookup"><span data-stu-id="a9970-118">When you set this value to true, clients experience such faults as <xref:System.ServiceModel.FaultException%601> exceptions of type <xref:System.ServiceModel.ExceptionDetail>.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="a9970-119">設定するため、マネージ コードの例外は、内部アプリケーション情報を公開できますが、<xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>または<xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>に`true`個人など、内部サービス操作例外に関する情報を取得する WCF クライアントを許可します。特定できる情報やその他の機密情報。</span><span class="sxs-lookup"><span data-stu-id="a9970-119">Because managed exceptions can expose internal application information, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` can permit WCF clients to obtain information about internal service operation exceptions, including personally identifiable or other sensitive information.</span></span>  
>   
>  <span data-ttu-id="a9970-120">したがって、<xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> または <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> を `true` に設定することは、サービス アプリケーションを一時的にデバッグする方法としてのみお勧めできます。</span><span class="sxs-lookup"><span data-stu-id="a9970-120">Therefore, setting <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> to `true` is only recommended as a way of temporarily debugging a service application.</span></span> <span data-ttu-id="a9970-121">さらに、このようにして未処理のマネージ例外を返すメソッドの WSDL には、<xref:System.ServiceModel.FaultException%601> 型の <xref:System.ServiceModel.ExceptionDetail> のコントラクトが含まれません。</span><span class="sxs-lookup"><span data-stu-id="a9970-121">In addition, the WSDL for a method that returns unhandled managed exceptions in this way does not contain the contract for the <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="a9970-122">クライアントが不明な SOAP エラーの可能性を求める必要があります (として WCF クライアントに返される<xref:System.ServiceModel.FaultException?displayProperty=nameWithType>オブジェクト) を正しくデバッグ情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="a9970-122">Clients must expect the possibility of an unknown SOAP fault (returned to WCF clients as <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> objects) to obtain the debugging information properly.</span></span>  
  
 <span data-ttu-id="a9970-123">宣言されていない SOAP エラーを送信するには、<xref:System.ServiceModel.FaultException?displayProperty=nameWithType> (つまり、ジェネリック型の <xref:System.ServiceModel.FaultException%601> でない) オブジェクトをスローし、文字列をコンストラクターに渡します。</span><span class="sxs-lookup"><span data-stu-id="a9970-123">To send an undeclared SOAP fault, throw a <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> object (that is, not the generic type <xref:System.ServiceModel.FaultException%601>) and pass the string to the constructor.</span></span> <span data-ttu-id="a9970-124">これは、スローされたとして WCF クライアント アプリケーションに公開される<xref:System.ServiceModel.FaultException?displayProperty=nameWithType>例外が格納されている文字列を呼び出して、<xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>メソッドです。</span><span class="sxs-lookup"><span data-stu-id="a9970-124">This is exposed to the WCF client applications as a thrown <xref:System.ServiceModel.FaultException?displayProperty=nameWithType> exception where the string is available by calling the <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> method.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a9970-125">文字列型の SOAP エラーを宣言し、これを型パラメーターが <xref:System.ServiceModel.FaultException%601> の <xref:System.String?displayProperty=nameWithType> としてサービス内でスローすると、文字列値が <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> プロパティに割り当てられるため、<xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType> から使用できません。</span><span class="sxs-lookup"><span data-stu-id="a9970-125">If you declare a SOAP fault of type string, and then throw this in your service as a <xref:System.ServiceModel.FaultException%601> where the type parameter is a <xref:System.String?displayProperty=nameWithType> the string value is assigned to the <xref:System.ServiceModel.FaultException%601.Detail%2A?displayProperty=nameWithType> property, and is not available from <xref:System.ServiceModel.FaultException%601.ToString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="handling-faults"></a><span data-ttu-id="a9970-126">エラーの処理</span><span class="sxs-lookup"><span data-stu-id="a9970-126">Handling Faults</span></span>  
 <span data-ttu-id="a9970-127">WCF クライアントでクライアント アプリケーションに関心のある通信中に発生した SOAP エラーは、マネージ例外として発生します。</span><span class="sxs-lookup"><span data-stu-id="a9970-127">In WCF clients, SOAP faults that occur during communication that are of interest to client applications are raised as managed exceptions.</span></span> <span data-ttu-id="a9970-128">任意のプログラムの実行中に発生することが多くの例外があるときに、WCF クライアント プログラミング モデルを使用するアプリケーションが通信の結果として次の 2 種類の例外を処理すると想定できます。</span><span class="sxs-lookup"><span data-stu-id="a9970-128">While there are many exceptions that can occur during the execution of any program, applications using the WCF client programming model can expect to handle exceptions of the following two types as a result of communication.</span></span>  
  
-   <xref:System.TimeoutException>  
  
-   <xref:System.ServiceModel.CommunicationException>  
  
 <span data-ttu-id="a9970-129"><xref:System.TimeoutException> オブジェクトは、操作が、指定されたタイムアウト期間を超えた場合にスローされます。</span><span class="sxs-lookup"><span data-stu-id="a9970-129"><xref:System.TimeoutException> objects are thrown when an operation exceeds the specified timeout period.</span></span>  
  
 <span data-ttu-id="a9970-130"><xref:System.ServiceModel.CommunicationException> オブジェクトは、回復可能な通信エラー状態がサービスまたはクライアントで発生した場合にスローされます。</span><span class="sxs-lookup"><span data-stu-id="a9970-130"><xref:System.ServiceModel.CommunicationException> objects are thrown when there is some recoverable communication error condition on either the service or the client.</span></span>  
  
 <span data-ttu-id="a9970-131"><xref:System.ServiceModel.CommunicationException> クラスには、<xref:System.ServiceModel.FaultException> および一般的な <xref:System.ServiceModel.FaultException%601> 型という 2 つの重要な派生型があります。</span><span class="sxs-lookup"><span data-stu-id="a9970-131">The <xref:System.ServiceModel.CommunicationException> class has two important derived types, <xref:System.ServiceModel.FaultException> and the generic <xref:System.ServiceModel.FaultException%601> type.</span></span>  
  
 <span data-ttu-id="a9970-132"><xref:System.ServiceModel.FaultException> 例外は、予期しないエラーまたは操作コントラクト内に指定されていないエラーをリスナーが受信した場合にスローされます。この例外は、通常、サービスの <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> プロパティを `true` に設定してアプリケーションをデバッグしている場合に発生します。</span><span class="sxs-lookup"><span data-stu-id="a9970-132"><xref:System.ServiceModel.FaultException> exceptions are thrown when a listener receives a fault that is not expected or specified in the operation contract; usually this occurs when the application is being debugged and the service has the <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true`.</span></span>  
  
 <span data-ttu-id="a9970-133"><xref:System.ServiceModel.FaultException%601> 例外は、操作コントラクト内に指定されたエラーが、双方向操作 (つまり、<xref:System.ServiceModel.OperationContractAttribute> に <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> が設定されている `false` 属性を持つメソッド) への応答で受信された場合に、クライアントでスローされます。</span><span class="sxs-lookup"><span data-stu-id="a9970-133"><xref:System.ServiceModel.FaultException%601> exceptions are thrown on the client when a fault that is specified in the operation contract is received in response to a two-way operation (that is, a method with an <xref:System.ServiceModel.OperationContractAttribute> attribute with <xref:System.ServiceModel.OperationContractAttribute.IsOneWay%2A> set to `false`).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a9970-134">WCF サービス発生した場合、<xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>または<xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType>プロパティに設定`true`として宣言されていないは、クライアントでこの<xref:System.ServiceModel.FaultException%601>型の<xref:System.ServiceModel.ExceptionDetail>します。</span><span class="sxs-lookup"><span data-stu-id="a9970-134">When an WCF service has the <xref:System.ServiceModel.ServiceBehaviorAttribute.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.ServiceDebugBehavior.IncludeExceptionDetailInFaults%2A?displayProperty=nameWithType> property set to `true` the client experiences this as an undeclared <xref:System.ServiceModel.FaultException%601> of type <xref:System.ServiceModel.ExceptionDetail>.</span></span> <span data-ttu-id="a9970-135">クライアントは、この特定のエラーをキャッチするか、<xref:System.ServiceModel.FaultException> の catch ブロックで処理できます。</span><span class="sxs-lookup"><span data-stu-id="a9970-135">Clients can either catch this specific fault or handle the fault in a catch block for <xref:System.ServiceModel.FaultException>.</span></span>  
  
 <span data-ttu-id="a9970-136">通常、クライアントとサービスには、<xref:System.ServiceModel.FaultException%601>、<xref:System.TimeoutException>、および <xref:System.ServiceModel.CommunicationException> の各例外だけが関係します。</span><span class="sxs-lookup"><span data-stu-id="a9970-136">Typically, only <xref:System.ServiceModel.FaultException%601>, <xref:System.TimeoutException>, and <xref:System.ServiceModel.CommunicationException> exceptions are of interest to clients and services.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a9970-137">上記以外の例外も発生します。</span><span class="sxs-lookup"><span data-stu-id="a9970-137">Other exceptions, of course, do occur.</span></span> <span data-ttu-id="a9970-138">予期しない例外には <xref:System.OutOfMemoryException?displayProperty=nameWithType> のような致命的なエラーも含まれますが、通常、アプリケーションでは、このようなメソッドをキャッチしません。</span><span class="sxs-lookup"><span data-stu-id="a9970-138">Unexpected exceptions include catastrophic failures like <xref:System.OutOfMemoryException?displayProperty=nameWithType>; typically applications should not catch such methods.</span></span>  
  
### <a name="catch-fault-exceptions-in-the-correct-order"></a><span data-ttu-id="a9970-139">正しい順序でエラー例外をキャッチする</span><span class="sxs-lookup"><span data-stu-id="a9970-139">Catch Fault Exceptions in the Correct Order</span></span>  
 <span data-ttu-id="a9970-140"><xref:System.ServiceModel.FaultException%601> は <xref:System.ServiceModel.FaultException> から派生します。また、<xref:System.ServiceModel.FaultException> は <xref:System.ServiceModel.CommunicationException> からも派生します。したがって、これらの例外を正しい順序でキャッチすることが重要になります。</span><span class="sxs-lookup"><span data-stu-id="a9970-140">Because <xref:System.ServiceModel.FaultException%601> derives from <xref:System.ServiceModel.FaultException>, and <xref:System.ServiceModel.FaultException> derives from <xref:System.ServiceModel.CommunicationException>, it is important to catch these exceptions in the proper order.</span></span> <span data-ttu-id="a9970-141">たとえば、try/catch ブロックで最初に <xref:System.ServiceModel.CommunicationException> がキャッチされたとします。その場合、すべての SOAP エラー (指定されている SOAP エラーおよび指定されていない SOAP エラー) はそこで処理され、カスタムの <xref:System.ServiceModel.FaultException%601> 例外を処理する後続の catch ブロックは呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="a9970-141">If, for example, you have a try/catch block in which you first catch <xref:System.ServiceModel.CommunicationException>, all specified and unspecified SOAP faults are handled there; any subsequent catch blocks to handle a custom <xref:System.ServiceModel.FaultException%601> exception are never invoked.</span></span>  
  
 <span data-ttu-id="a9970-142">指定した例外が 1 つの操作から複数返される場合があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="a9970-142">Remember that one operation can return any number of specified faults.</span></span> <span data-ttu-id="a9970-143">その場合は、エラーごとに型が異なるため、個別に処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a9970-143">Each fault is a unique type and must be handled separately.</span></span>  
  
### <a name="handle-exceptions-when-closing-the-channel"></a><span data-ttu-id="a9970-144">チャネルを閉じるときに例外を処理する</span><span class="sxs-lookup"><span data-stu-id="a9970-144">Handle Exceptions When Closing the Channel</span></span>  
 <span data-ttu-id="a9970-145">までの説明のほとんどでは、クライアント アプリケーションでの WCF クライアント オブジェクトの操作を呼び出すときに、クライアントによって明示的に送信されるメッセージには、アプリケーション メッセージの処理の過程で送信されるエラーしないでください。</span><span class="sxs-lookup"><span data-stu-id="a9970-145">Most of the preceding discussion has to do with faults sent in the course of processing application messages, that is, messages explicitly sent by the client when the client application calls operations on the WCF client object.</span></span>  
  
 <span data-ttu-id="a9970-146">ローカル オブジェクトでも、オブジェクトを破棄すると、リサイクル プロセスで起こる例外が発生したり、マスクされたりする場合があります。</span><span class="sxs-lookup"><span data-stu-id="a9970-146">Even with local objects disposing the object can either raise or mask exceptions that occur during the recycling process.</span></span> <span data-ttu-id="a9970-147">以下のように WCF クライアント オブジェクトを使用するときに発生します。</span><span class="sxs-lookup"><span data-stu-id="a9970-147">Something similar can occur when you use WCF client objects.</span></span> <span data-ttu-id="a9970-148">操作を呼び出すと、既に確立されている接続を通じてメッセージが送信されます。</span><span class="sxs-lookup"><span data-stu-id="a9970-148">When you call operations you are sending messages over an established connection.</span></span> <span data-ttu-id="a9970-149">また、チャネルを閉じると、すべての操作が正常に返されたとしても、接続を完全に閉じることができなかったり、接続が既に閉じたりしている場合には、例外がスローされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="a9970-149">Closing the channel can throw exceptions if the connection cannot be cleanly closed or is already closed, even if all the operations returned properly.</span></span>  
  
 <span data-ttu-id="a9970-150">通常、クライアント オブジェクトのチャネルは、次のいずれかが発生すると閉じられます。</span><span class="sxs-lookup"><span data-stu-id="a9970-150">Typically, client object channels are closed in one of the following ways:</span></span>  
  
-   <span data-ttu-id="a9970-151">WCF クライアント オブジェクトがリサイクルされるときです。</span><span class="sxs-lookup"><span data-stu-id="a9970-151">When the WCF client object is recycled.</span></span>  
  
-   <span data-ttu-id="a9970-152">クライアント アプリケーションが <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> を呼び出すとき。</span><span class="sxs-lookup"><span data-stu-id="a9970-152">When the client application calls <xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="a9970-153">クライアント アプリケーションが <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> を呼び出すとき。</span><span class="sxs-lookup"><span data-stu-id="a9970-153">When the client application calls <xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType>.</span></span>  
  
-   <span data-ttu-id="a9970-154">クライアント アプリケーションが、セッションの終了操作となる操作を呼び出すとき。</span><span class="sxs-lookup"><span data-stu-id="a9970-154">When the client application calls an operation that is a terminating operation for a session.</span></span>  
  
 <span data-ttu-id="a9970-155">いずれの場合でも、チャネルを閉じると、アプリケーション レベルで複雑な機能をサポートするためにメッセージを送信している可能性がある基になるチャネルをすべて閉じる操作を開始するように、チャネルに通知されます。</span><span class="sxs-lookup"><span data-stu-id="a9970-155">In all cases, closing the channel instructs the channel to begin closing any underlying channels that may be sending messages to support complex functionality at the application level.</span></span> <span data-ttu-id="a9970-156">たとえば、コントラクトがセッションを要求している場合、バインディングは、セッションが確立されるまでサービス チャネルとメッセージを交換してセッションを確立しようとします。</span><span class="sxs-lookup"><span data-stu-id="a9970-156">For example, when a contract requires sessions a binding attempts to establish a session by exchanging messages with the service channel until a session is established.</span></span> <span data-ttu-id="a9970-157">チャネルが閉じられると、基になるセッション チャネルは、セッションが終了したことをサービスに通知します。</span><span class="sxs-lookup"><span data-stu-id="a9970-157">When the channel is closed, the underlying session channel notifies the service that the session is terminated.</span></span> <span data-ttu-id="a9970-158">この場合、チャネルが既に中止されたり閉じられたりしている、または使用できない (たとえば、ネットワーク ケーブルが外れている) ときには、クライアント チャネルはサービス チャネルに対し、セッションが終了し例外が発生する可能性があることを通知できません。</span><span class="sxs-lookup"><span data-stu-id="a9970-158">In this case, if the channel has already aborted, closed, or is otherwise unusable (for example, when a network cable is unplugged), the client channel cannot inform the service channel that the session is terminated and an exception can result.</span></span>  
  
### <a name="abort-the-channel-if-necessary"></a><span data-ttu-id="a9970-159">必要に応じてチャネルを中止する</span><span class="sxs-lookup"><span data-stu-id="a9970-159">Abort the Channel If Necessary</span></span>  
 <span data-ttu-id="a9970-160">チャネルを閉じると例外がスローされる可能性があるため、正しい順序でエラー状態をキャッチするだけでなく、呼び出しに使用されたチャネルを catch ブロックで中止することが重要です。</span><span class="sxs-lookup"><span data-stu-id="a9970-160">Because closing the channel can also throw exceptions, then, it is recommended that in addition to catching fault exceptions in the correct order, it is important to abort the channel that was used in making the call in the catch block.</span></span>  
  
 <span data-ttu-id="a9970-161">エラーによって操作に固有のエラー情報が伝えられた場合、他のユーザーがそのエラー情報を使用できるときはチャネルを中止する必要はありません (ただし、このような状況は非常にまれです)。</span><span class="sxs-lookup"><span data-stu-id="a9970-161">If the fault conveys error information specific to an operation and it remains possible that others can use it, there is no need to abort the channel (although these cases are rare).</span></span> <span data-ttu-id="a9970-162">それ以外の場合は、チャネルを中止することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a9970-162">In all other cases, it is recommended that you abort the channel.</span></span> <span data-ttu-id="a9970-163">これらのポイントのすべてを示すサンプルについては、次を参照してください。[予想例外](../../../docs/framework/wcf/samples/expected-exceptions.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9970-163">For a sample that demonstrates all of these points, see [Expected Exceptions](../../../docs/framework/wcf/samples/expected-exceptions.md).</span></span>  
  
 <span data-ttu-id="a9970-164">次のコード例は、基本的なクライアント アプリケーションで、宣言されたエラーと宣言されていないエラーを含む SOAP エラー例外を処理する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="a9970-164">The following code example shows how to handle SOAP fault exceptions in a basic client application, including a declared fault and an undeclared fault.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="a9970-165">このサンプル コードは、`using` コンストラクトを使用していません。</span><span class="sxs-lookup"><span data-stu-id="a9970-165">This sample code does not use the `using` construct.</span></span> <span data-ttu-id="a9970-166">チャネルを閉じると、例外がスローすることができます、ために、アプリケーションを作成する WCF クライアントと、開き、および閉じる、WCF クライアントを同じ try ブロックことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="a9970-166">Because closing channels can throw exceptions, it is recommended that applications create a WCF client first, and then open, use, and close the WCF client in the same try block.</span></span> <span data-ttu-id="a9970-167">詳細については、「 [WCF クライアントの概要](../../../docs/framework/wcf/wcf-client-overview.md)と[Using ステートメントに関する問題を回避](../../../docs/framework/wcf/samples/avoiding-problems-with-the-using-statement.md)です。</span><span class="sxs-lookup"><span data-stu-id="a9970-167">For details, see [WCF Client Overview](../../../docs/framework/wcf/wcf-client-overview.md) and [Avoiding Problems with the Using Statement](../../../docs/framework/wcf/samples/avoiding-problems-with-the-using-statement.md).</span></span>  
  
 [!code-csharp[FaultContractAttribute#3](../../../samples/snippets/csharp/VS_Snippets_CFX/faultcontractattribute/cs/client.cs#3)]
 [!code-vb[FaultContractAttribute#3](../../../samples/snippets/visualbasic/VS_Snippets_CFX/faultcontractattribute/vb/client.vb#3)]  
  
## <a name="see-also"></a><span data-ttu-id="a9970-168">関連項目</span><span class="sxs-lookup"><span data-stu-id="a9970-168">See Also</span></span>  
 <xref:System.ServiceModel.FaultException>  
 <xref:System.ServiceModel.FaultException%601>  
 <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>  
 [<span data-ttu-id="a9970-169">予期される例外</span><span class="sxs-lookup"><span data-stu-id="a9970-169">Expected Exceptions</span></span>](../../../docs/framework/wcf/samples/expected-exceptions.md)  
 [<span data-ttu-id="a9970-170">Using ステートメントに関する問題の回避</span><span class="sxs-lookup"><span data-stu-id="a9970-170">Avoiding Problems with the Using Statement</span></span>](../../../docs/framework/wcf/samples/avoiding-problems-with-the-using-statement.md)
