---
title: Windows サービス アプリケーションのホスト
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: cc95634745aa0c0246cf139d19e0777fde7e1aba
ms.sourcegitcommit: bab17fd81bab7886449217356084bf4881d6e7c8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/26/2019
ms.locfileid: "67402162"
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="6b381-102">Windows サービス アプリケーションのホスト</span><span class="sxs-lookup"><span data-stu-id="6b381-102">Hosting in a Windows Service Application</span></span>
<span data-ttu-id="6b381-103">Windows サービス (従来 Windows NT サービスと呼ばれていたもの) が提供するプロセス モデルが特に適しているのは、長い期間にわたって動作し続ける必要があり、どのような形式でもユーザー インターフェイスを表示することのないアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="6b381-103">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="6b381-104">Windows サービス アプリケーションのプロセスの有効期間を管理するのは、サービス コントロール マネージャー (SCM) です。SCM を使用して、Windows サービス アプリケーションを起動、停止、および一時停止できます。</span><span class="sxs-lookup"><span data-stu-id="6b381-104">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="6b381-105">「常時オン」のアプリケーションの適切なホスティング環境のため、コンピューターの起動時に自動的に開始する、Windows サービスのプロセスを構成することができます。</span><span class="sxs-lookup"><span data-stu-id="6b381-105">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="6b381-106">Windows サービス アプリケーションの詳細については、次を参照してください。 [Windows サービス アプリケーション](https://go.microsoft.com/fwlink/?LinkId=89450)します。</span><span class="sxs-lookup"><span data-stu-id="6b381-106">For more information about Windows service applications, see [Windows Service Applications](https://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="6b381-107">実行時間の長い Windows Communication Foundation (WCF) サービスをホストしているアプリケーションは、Windows サービスとの特性の多くを共有します。</span><span class="sxs-lookup"><span data-stu-id="6b381-107">Applications that host long-running Windows Communication Foundation (WCF) services share many characteristics with Windows services.</span></span> <span data-ttu-id="6b381-108">具体的には、WCF サービスは、実行時間の長いサーバー実行可能ファイルは、ユーザーと直接対話しないのすべてのユーザー インターフェイスを実装しないでください。</span><span class="sxs-lookup"><span data-stu-id="6b381-108">In particular, WCF services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="6b381-109">そのため、Windows サービス アプリケーションの内部で WCF サービスをホストしているは、実行時間の長い、堅牢な WCF アプリケーションを構築するための 1 つのオプションです。</span><span class="sxs-lookup"><span data-stu-id="6b381-109">As such, hosting WCF services inside of a Windows service application is one option for building robust, long-running, WCF applications.</span></span>  
  
 <span data-ttu-id="6b381-110">多くの場合、WCF の開発者では Windows サービス アプリケーションの内部で、またはインターネット インフォメーション サービス (IIS) または Windows プロセス アクティブ化サービス (WAS) のホスティング環境の内部では、WCF アプリケーションをホストするかどうかを決める必要があります。</span><span class="sxs-lookup"><span data-stu-id="6b381-110">Often, WCF developers must decide whether to host their WCF application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="6b381-111">次のような場合、Windows サービス上でホストする方法を使用できないか検討してください。</span><span class="sxs-lookup"><span data-stu-id="6b381-111">You should consider using Windows service applications under the following conditions:</span></span>  
  
- <span data-ttu-id="6b381-112">アプリケーションを明示的にアクティブ化する必要がある場合。</span><span class="sxs-lookup"><span data-stu-id="6b381-112">Your application requires explicit activation.</span></span> <span data-ttu-id="6b381-113">たとえば、サーバー起動時に自動的にアプリケーションも起動しなければならず、最初に届いたメッセージに応答して動的に起動するのでは困るような場合です。</span><span class="sxs-lookup"><span data-stu-id="6b381-113">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
- <span data-ttu-id="6b381-114">アプリケーションをホストするプロセスが、起動されたらそのまま動作し続けなければならない場合。</span><span class="sxs-lookup"><span data-stu-id="6b381-114">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="6b381-115">一度起動した Windows サービスのプロセスは、サーバー管理者がサービス コントロール マネージャーで明示的にシャットダウンしない限り、そのまま動作し続けます。</span><span class="sxs-lookup"><span data-stu-id="6b381-115">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="6b381-116">IIS や WAS 上でホストするアプリケーションは、動的に起動および停止して、システム リソースを効率よく使うことができます。</span><span class="sxs-lookup"><span data-stu-id="6b381-116">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="6b381-117">しかし、ホストするプロセスの有効期間にわたって明示的に制御しなければならない場合、IIS や WAS ではなく Windows サービスを使う必要があります。</span><span class="sxs-lookup"><span data-stu-id="6b381-117">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
- <span data-ttu-id="6b381-118">WCF サービスは、Windows Server 2003 で実行され、HTTP 以外のトランスポートを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="6b381-118">Your WCF service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="6b381-119">Windows Server 2003 で IIS 6.0 のホスティング環境では、HTTP 通信のみに制限されています。</span><span class="sxs-lookup"><span data-stu-id="6b381-119">On Windows Server 2003, the IIS 6.0 hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="6b381-120">Windows サービス アプリケーションは、この制限が適用されないし、net.tcp、net.pipe、net.msmq など、トランスポート WCF のサポートを使用できます。</span><span class="sxs-lookup"><span data-stu-id="6b381-120">Windows service applications are not subject to this restriction and can use any transport WCF supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="6b381-121">Windows サービス アプリケーションの内部で WCF をホストするには</span><span class="sxs-lookup"><span data-stu-id="6b381-121">To host WCF inside of a Windows service application</span></span>  
  
1. <span data-ttu-id="6b381-122">Windows サービス アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="6b381-122">Create a Windows service application.</span></span> <span data-ttu-id="6b381-123">Windows サービス アプリケーションは、<xref:System.ServiceProcess> 名前空間のクラスを使用して、マネージ コードとして記述することができます。</span><span class="sxs-lookup"><span data-stu-id="6b381-123">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="6b381-124">このアプリケーションには、<xref:System.ServiceProcess.ServiceBase> から派生したクラスを 1 つ含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="6b381-124">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2. <span data-ttu-id="6b381-125">WCF サービスの有効期間を Windows サービス アプリケーションの有効期間にリンクします。</span><span class="sxs-lookup"><span data-stu-id="6b381-125">Link the lifetime of the WCF services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="6b381-126">通常、ホスティング サービス開始時にアクティブになる、ホスティング、サービスが停止すると、WCF サービスには、エラーが発生したときに、ホスト プロセスをシャット ダウン場合に、メッセージのリッスンを停止する Windows サービス アプリケーションでホストされる WCF サービスをします。</span><span class="sxs-lookup"><span data-stu-id="6b381-126">Typically, you want WCF services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the WCF service encounters an error.</span></span> <span data-ttu-id="6b381-127">これは次のようにして実装します。</span><span class="sxs-lookup"><span data-stu-id="6b381-127">This can be accomplished as follows:</span></span>  
  
    - <span data-ttu-id="6b381-128"><xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> をオーバーライドして、<xref:System.ServiceModel.ServiceHost> のインスタンスを必要な個数開くようにします。</span><span class="sxs-lookup"><span data-stu-id="6b381-128">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="6b381-129">1 つの Windows サービス アプリケーションは、開始時刻と停止をグループとして複数の WCF サービスをホストできます。</span><span class="sxs-lookup"><span data-stu-id="6b381-129">A single Windows service application can host multiple WCF services that start and stop as a group.</span></span>  
  
    - <span data-ttu-id="6b381-130">オーバーライド<xref:System.ServiceProcess.ServiceBase.OnStop%2A>を呼び出す<xref:System.ServiceModel.Channels.CommunicationObject.Closed>上、<xref:System.ServiceModel.ServiceHost>中に開始された実行中の WCF サービス<xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>します。</span><span class="sxs-lookup"><span data-stu-id="6b381-130">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running WCF services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    - <span data-ttu-id="6b381-131"><xref:System.ServiceModel.Channels.CommunicationObject.Faulted> の <xref:System.ServiceModel.ServiceHost> イベントを定期受信し、エラー時には、<xref:System.ServiceProcess.ServiceController> クラスを使用して Windows サービス アプリケーションをシャットダウンします。</span><span class="sxs-lookup"><span data-stu-id="6b381-131">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="6b381-132">WCF サービスをホストする Windows サービス アプリケーションが展開され、WCF のない Windows サービス アプリケーションを使用して、としては、同じ方法で管理されています。</span><span class="sxs-lookup"><span data-stu-id="6b381-132">Windows service applications that host WCF services are deployed and managed in the same way as Windows service applications that do not make use of WCF.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6b381-133">関連項目</span><span class="sxs-lookup"><span data-stu-id="6b381-133">See also</span></span>

- <xref:System.ServiceProcess>
- [<span data-ttu-id="6b381-134">チュートリアル: コンポーネント デザイナーによる Windows サービス アプリケーションの作成</span><span class="sxs-lookup"><span data-stu-id="6b381-134">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](https://go.microsoft.com/fwlink/?LinkId=94875)
- [<span data-ttu-id="6b381-135">方法: マネージ Windows サービスでの WCF サービスをホストします。</span><span class="sxs-lookup"><span data-stu-id="6b381-135">How to: Host a WCF Service in a Managed Windows Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [<span data-ttu-id="6b381-136">Windows サービス ホスト</span><span class="sxs-lookup"><span data-stu-id="6b381-136">Windows Service Host</span></span>](../../../../docs/framework/wcf/samples/windows-service-host.md)
- [<span data-ttu-id="6b381-137">サービス アプリケーションのプログラミング アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="6b381-137">Service Application Programming Architecture</span></span>](https://go.microsoft.com/fwlink/?LinkId=94876)
- [<span data-ttu-id="6b381-138">AppFabric のホスティング機能</span><span class="sxs-lookup"><span data-stu-id="6b381-138">Windows Server App Fabric Hosting Features</span></span>](https://go.microsoft.com/fwlink/?LinkId=201276)
