---
title: 信頼できるセッションのベスト プラクティス
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 1d9671e7e3124d535b66de8cd8468f76dcb32b10
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
ms.locfileid: "33491628"
---
# <a name="best-practices-for-reliable-sessions"></a>信頼できるセッションのベスト プラクティス

このトピックでは、信頼できるセッションのベスト プラクティスについて説明します。

## <a name="setting-maxtransferwindowsize"></a>MaxTransferWindowSize の設定

信頼できるセッションで Windows Communication Foundation (WCF) では、転送ウィンドウを使用して、クライアントとサービスでメッセージを保持します。 <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> プロパティは、この転送ウィンドウに保持できるメッセージの最大数を表します。

送信者は、このことを示します。 受信確認の待機中に転送ウィンドウが保持できるメッセージの数受信側、サービス用にバッファーにメッセージの数を示します。

ネットワークの効率性と、サービスの容量の最適な適切なサイズの選択に影響します。 次のセクションでは、このプロパティと値の影響の値を選択する際の考慮事項を詳しく説明します。

既定の転送ウィンドウ サイズは、8 つのメッセージです。

### <a name="efficient-use-of-the-network"></a>ネットワークの効率的な使用

このコンテキストで用語*ネットワーク*(送信者) のクライアントとサービス (受信側) の間の通信の基礎として使用するすべてに対応しています。 これは、SOAP ルーターや HTTP プロキシ/ファイアウォールなどのトランスポート接続や任意の仲介者間のブリッジ含まれます。

ネットワーク効率が高いとは、その伝送容量を最大限に活用できるということです。 ネットワーク経由で 1 秒あたりに転送できるデータの量 (*データ レート*) と、送信者から受信側にデータを転送する所要時間 (*待機時間*) どのくらい効果的に影響を与えるネットワーク利用します。

送信側については、転送ウィンドウに保持できる受信確認の到着を待機しているメッセージの数が <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> プロパティによって表されます。 ネットワークの待機時間が高いと、応答性を高めてネットワーク利用効率を確保できるように、転送ウィンドウ サイズを増やす必要があります。

たとえば、送信者から最新の状態がデータ レートを場合でも、待機時間でした高場合にいくつかの中継ぎ局が送信者と受信者の間に存在するか、またはデータが損失を伴う中継ぎ局またはネットワークを通過する必要があります。 したがって、送信者を待っている転送ウィンドウにメッセージに対する受信確認、ネットワーク上で送信するための新しいメッセージを受け入れる前にします。 待機時間の長い、有効性は小さくのバッファー、ネットワーク使用率。 その一方で、転送ウィンドウ サイズが大きすぎる可能性がありますに影響を与えるサービスのため、サービスは、クライアントによって送信されるデータの速度が高速に遅延を解消する必要があります。

### <a name="running-the-service-to-capacity"></a>容量にサービスを実行します。

ネットワークを効率的に使用すると、できるだけ多くことをお勧めするも最適処理能力で実行するサービスです。 受信側の転送ウィンドウ サイズは、処理待ちのメッセージをいくつまで保持しておけるかを表します。 メッセージをこのようにバッファーに保持することは、ネットワークのフロー制御だけでなく、処理能力を最大限に活用したサービス稼働にも役立ちます。 たとえば、バッファーが 1 つのメッセージと、サービスが処理できるよりも早くメッセージが到着した場合、ネットワーク メッセージを削除する場合があり、容量を無駄になるまたは使用率が低い可能性があります。

同時に受信して、以前に受信したメッセージの処理中にメッセージをバッファーすると、バッファーを使用して、サービスの可用性が大きくなります。

同じを使用することをお勧め`MaxTransferWindowSize`送信者および受信者の両方にします。

### <a name="enabling-flow-control"></a>フロー制御を有効にします。

*フロー制御*により、送信者と受信者、互いに対応する、メッセージし、処理が処理する機構は、生成されている高速です。 クライアントとサービスの転送ウィンドウ サイズは、送信側と受信側が妥当な許容範囲内で同期できるように設定しなければなりません。

プロパティを設定することを強くお勧め<xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A>に`true`WCF クライアントと WCF サービスの間の信頼できるセッションを使用しているときにします。

## <a name="setting-maxpendingchannels"></a>MaxPendingChannels の設定

さまざまなクライアントからの通信を信頼できるセッションを有効にするサービスを記述する場合、多くのクライアントが同時に、サービスに信頼できるセッションを確立することができます。 このとき、サービスの応答性は、`MaxPendingChannels` プロパティによって決まります。

信頼できるセッション チャネルが送信側によって作成されると、両者のハンドシェイクによって信頼できるセッションが確立します。 これが終わるとチャネルは保留チャネル キューに入り、サービス側からの応答を待機する状態になります。 `MaxPendingChannels` プロパティは、この状態にできるチャネルの数を表します。

サービス チャネルを受け付けられない状態にすることができます。 キューがいっぱいの場合、信頼できるセッションを確立しようとするは拒否され、クライアントは再試行する必要があります。

キューに入った保留チャネルが長期間キューに残っていることもできます。 その間は、信頼できるセッションのアイドル タイムアウトが発生し、エラーが発生した状態に遷移するチャネルの原因します。

複数のクライアントのサービスを同時にサービスを記述する場合は、お客様のニーズに適した値を設定してください。 設定の値が高すぎる、`MaxPendingChannels`プロパティ、ワーキング セットに影響を与えます。

既定値<xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A>4 つのチャンネルがします。

## <a name="reliable-sessions-and-hosting"></a>信頼できるセッションとホスティング

信頼できるセッションを使用するサービスをホストしているときに web は、次の重要な考慮事項に注意してください。

- 信頼できるセッションはステートフルであり、状態は AppDomain で管理されます。 したがって、信頼できるセッションでやりとりするメッセージはすべて、同じ AppDomain で処理する必要があります。 Web ファームと web ガーデン ファームやガーデンのサイズが 1 つのノードより大きいは、この制約を保証できません。

- 双方向 HTTP チャネルを使用して、信頼できるセッション (たとえばを使用して`WsDualHttpBinding`) の 2 つ HTTP 接続クライアントごとの既定値よりも多く必要なことができます。 つまり、双方向の信頼できるセッションは同時実行アプリケーションとプロトコル メッセージは、特定の時点で各方法転送可能性があるために最大 2 つの接続を要求できます。 状況によって、サービスのメッセージ交換パターンによって、つまり、双方向 HTTP と信頼できるセッションを使用して、web でホストされるサービスのデッドロックを起こす可能性があること。 クライアントごとの許容の HTTP 接続の数を増やすには、関連する構成ファイルに次の追加 (たとえば、 *web.config*当該サービスの)。

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  値、`maxconnection`属性が必要な接続の数。 ここでは、最小値は、4 つの接続を指定する必要があります。
