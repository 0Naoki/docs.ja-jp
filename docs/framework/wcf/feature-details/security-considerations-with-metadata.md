---
title: "メタデータを使用する場合のセキュリティ上の考慮事項"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: e78ef8ab-4f63-4656-ab93-b1deab2666d5
caps.latest.revision: "10"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload: dotnet
ms.openlocfilehash: 098b31e479322d9de3a299f06652e819a5388c42
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/22/2017
---
# <a name="security-considerations-with-metadata"></a><span data-ttu-id="d37be-102">メタデータを使用する場合のセキュリティ上の考慮事項</span><span class="sxs-lookup"><span data-stu-id="d37be-102">Security Considerations with Metadata</span></span>
<span data-ttu-id="d37be-103">[!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] のメタデータの機能を使用するときは、サービス メタデータの公開、取得、および使用によって生じるセキュリティへの影響を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d37be-103">When using the metadata features in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)], consider the security implications of publishing, retrieving, and using service metadata.</span></span>  
  
## <a name="when-to-publish-metadata"></a><span data-ttu-id="d37be-104">メタデータを公開する場合と公開しない場合</span><span class="sxs-lookup"><span data-stu-id="d37be-104">When to Publish Metadata</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="d37be-105"> サービスは、既定ではメタデータを公開しない設定になっています。</span><span class="sxs-lookup"><span data-stu-id="d37be-105"> services do not publish metadata by default.</span></span> <span data-ttu-id="d37be-106">メタデータを公開する、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]サービスをサービス メタデータ エンドポイントを追加することでメタデータ公開を有効にする必要があります明示的に (を参照してください[メタデータの公開](../../../../docs/framework/wcf/feature-details/publishing-metadata.md))。</span><span class="sxs-lookup"><span data-stu-id="d37be-106">To publish metadata for a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service you must explicitly enable metadata publishing by adding metadata endpoints to your service (see [Publishing Metadata](../../../../docs/framework/wcf/feature-details/publishing-metadata.md)).</span></span> <span data-ttu-id="d37be-107">メタデータの公開を無効のままにしておけば、攻撃者にとっては侵入経路が少ないことになり、したがって情報漏洩の危険を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="d37be-107">Leaving metadata publishing disabled reduces the attack surface for your service and lowers the risk of unintentional information disclosure.</span></span> <span data-ttu-id="d37be-108">メタデータを公開する必要のないサービスもあります。</span><span class="sxs-lookup"><span data-stu-id="d37be-108">Not all services must publish metadata.</span></span> <span data-ttu-id="d37be-109">必要ないのであれば無効のままにしておくようお勧めします。</span><span class="sxs-lookup"><span data-stu-id="d37be-109">If you do not have to publish metadata, consider leaving it turned off.</span></span> <span data-ttu-id="d37be-110">使用して、サービス アセンブリから直接メタデータとクライアントのコードを生成することもできます注、 [ServiceModel メタデータ ユーティリティ ツール (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)です。</span><span class="sxs-lookup"><span data-stu-id="d37be-110">Note that you can still generate metadata and client code directly from your service assemblies using the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="d37be-111">Svcutil.exe を使用してメタデータをエクスポートするを参照してください[する方法: コンパイル済みサービス コードからメタデータのエクスポートに使用する Svcutil.exe](../../../../docs/framework/wcf/feature-details/how-to-use-svcutil-exe-to-export-metadata-from-compiled-service-code.md)です。</span><span class="sxs-lookup"><span data-stu-id="d37be-111"> using Svcutil.exe to export metadata, see [How to: Use Svcutil.exe to Export Metadata from Compiled Service Code](../../../../docs/framework/wcf/feature-details/how-to-use-svcutil-exe-to-export-metadata-from-compiled-service-code.md).</span></span>  
  
## <a name="publishing-metadata-using-a-secure-binding"></a><span data-ttu-id="d37be-112">セキュリティ保護されたバインディングによるメタデータの公開</span><span class="sxs-lookup"><span data-stu-id="d37be-112">Publishing Metadata Using a Secure Binding</span></span>  
 <span data-ttu-id="d37be-113">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] に組み込まれた既定のメタデータ バインディングはセキュリティ保護されておらず、メタデータへの匿名アクセスを許可するようになっています。</span><span class="sxs-lookup"><span data-stu-id="d37be-113">The default metadata bindings that [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] provides are not secure and they allow anonymous access to the metadata.</span></span> <span data-ttu-id="d37be-114">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] サービスが公開するサービス メタデータにはサービスに関する詳細な記述があるので、故意または過失により、重要な情報が漏洩するおそれがあります。</span><span class="sxs-lookup"><span data-stu-id="d37be-114">The service metadata that a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service publishes contains a detailed description about the service and may intentionally or unintentionally contain sensitive information.</span></span> <span data-ttu-id="d37be-115">たとえば、一般に公開するべきではない、インフラストラクチャ操作に関する情報が入った状態で発行される可能性があるのです。</span><span class="sxs-lookup"><span data-stu-id="d37be-115">For example, service metadata may contain information about infrastructure operations that was not intended to be broadcast publicly.</span></span> <span data-ttu-id="d37be-116">権限のないアクセスを拒否する方法として、メタデータ エンドポイントで、セキュリティ保護されたバインディングを使う、というものがあります。</span><span class="sxs-lookup"><span data-stu-id="d37be-116">To protect service metadata from unauthorized access, you can use a secure binding for your metadata endpoint.</span></span> <span data-ttu-id="d37be-117">メタデータ エンドポイントは HTTP/GET 要求に応答しますが、ここに SSL (Secure Sockets Layer) を使用すれば、メタデータを保護できます。</span><span class="sxs-lookup"><span data-stu-id="d37be-117">Metadata endpoints respond to HTTP/GET requests that can use Secure Sockets Layer (SSL) to secure the metadata.</span></span> [!INCLUDE[crdefault](../../../../includes/crdefault-md.md)]<span data-ttu-id="d37be-118">[する方法: メタデータ エンドポイントをセキュリティで保護された](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)です。</span><span class="sxs-lookup"><span data-stu-id="d37be-118"> [How to: Secure Metadata Endpoints](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md).</span></span>  
  
 <span data-ttu-id="d37be-119">メタデータ エンドポイントを保護することで、正当なユーザーが、改ざんやなりすましを恐れずに安全にサービス メタデータを取得できる手段も提供されます。</span><span class="sxs-lookup"><span data-stu-id="d37be-119">Securing your metadata endpoints also provides a way for requesters to securely retrieve service metadata without the risk of tampering or spoofing.</span></span>  
  
## <a name="using-only-trusted-metadata"></a><span data-ttu-id="d37be-120">信頼できるメタデータのみを使用</span><span class="sxs-lookup"><span data-stu-id="d37be-120">Using Only Trusted Metadata</span></span>  
 <span data-ttu-id="d37be-121">サービス メタデータを使用すると、サービスの呼び出しに必要なランタイム コンポーネントを自動構築できます。</span><span class="sxs-lookup"><span data-stu-id="d37be-121">You can use service metadata to automatically construct the run-time components required to call the service.</span></span> <span data-ttu-id="d37be-122">たとえば、設計時には、クライアント アプリケーションを開発するためにメタデータを利用できます。また、実行時には、メタデータを利用して、クライアントがサービス呼び出しのために使用するバインディングを動的に更新できます。</span><span class="sxs-lookup"><span data-stu-id="d37be-122">You can also use metadata at design time to develop a client application or at runtime to dynamically update the binding a client uses to call a service.</span></span>  
  
 <span data-ttu-id="d37be-123">サービス メタデータを取得する際、セキュリティ保護された方法を使わないと、改ざんやなりすましのおそれがあります。</span><span class="sxs-lookup"><span data-stu-id="d37be-123">Service metadata can be tampered with or spoofed when retrieved in an insecure manner.</span></span> <span data-ttu-id="d37be-124">メタデータが改ざんされると、知らない間に悪質なサービスに接続されたり、セキュリティ上問題のある設定に切り替えられたり、XML 構造が破壊されたりすることがあります。</span><span class="sxs-lookup"><span data-stu-id="d37be-124">Tampered metadata can redirect your client to a malicious service, contain compromised security settings, or contain malicious XML structures.</span></span> <span data-ttu-id="d37be-125">メタデータ ドキュメントはかなりの容量になることがあるので、多くの場合、ファイル システムに保存することになります。</span><span class="sxs-lookup"><span data-stu-id="d37be-125">Metadata documents can be large and are frequently saved to the file system.</span></span> <span data-ttu-id="d37be-126">改ざんやなりすましを防ぐために、サービス メタデータを要求するときには、できるだけセキュリティで保護されたバインディングを使用してください。</span><span class="sxs-lookup"><span data-stu-id="d37be-126">To protect against tampering and spoofing, use a secure binding to request service metadata when one is available.</span></span>  
  
## <a name="using-safe-techniques-for-processing-metadata"></a><span data-ttu-id="d37be-127">安全な技術を使ってメタデータを処理</span><span class="sxs-lookup"><span data-stu-id="d37be-127">Using Safe Techniques for Processing Metadata</span></span>  
 <span data-ttu-id="d37be-128">サービス メタデータは多くの場合、MEX (WS-Metadata Exchange) などの標準的なプロトコルを使用して、ネットワーク経由で伝送されます。</span><span class="sxs-lookup"><span data-stu-id="d37be-128">Service metadata is frequently retrieved from a service over a network using standardized protocols such as WS-MetadataExchange (MEX).</span></span> <span data-ttu-id="d37be-129">メタデータの形式を見ると、多くの場合、他のメタデータを参照する旨の記述ができるようになっています。</span><span class="sxs-lookup"><span data-stu-id="d37be-129">Many metadata formats include referencing mechanisms for pointing to additional metadata.</span></span> <span data-ttu-id="d37be-130"><xref:System.ServiceModel.Description.MetadataExchangeClient> 型は、Web サービス記述言語 (WSDL) ドキュメント、XML スキーマ、および MEX ドキュメント内の参照を自動的に処理します。</span><span class="sxs-lookup"><span data-stu-id="d37be-130">The <xref:System.ServiceModel.Description.MetadataExchangeClient> type automatically processes references for you in Web Services Description Language (WSDL) documents, XML Schema, and MEX documents.</span></span> <span data-ttu-id="d37be-131">取得したメタデータから生成される <xref:System.ServiceModel.Description.MetadataSet> オブジェクトのサイズは、使用されている <xref:System.ServiceModel.Description.MetadataExchangeClient.MaximumResolvedReferences%2A> インスタンスの <xref:System.ServiceModel.Description.MetadataExchangeClient> の値と、この `MaxReceivedMessageSize` インスタンスが使用するバインディングの <xref:System.ServiceModel.Description.MetadataExchangeClient> の値に比例します。</span><span class="sxs-lookup"><span data-stu-id="d37be-131">The size of the <xref:System.ServiceModel.Description.MetadataSet> object created from the retrieved metadata is directly proportional to the <xref:System.ServiceModel.Description.MetadataExchangeClient.MaximumResolvedReferences%2A> value for the <xref:System.ServiceModel.Description.MetadataExchangeClient> instance that is used and the `MaxReceivedMessageSize` value for the binding being used by that <xref:System.ServiceModel.Description.MetadataExchangeClient> instance.</span></span> <span data-ttu-id="d37be-132">動作環境に合わせてこのクォータ値を適切に設定してください。</span><span class="sxs-lookup"><span data-stu-id="d37be-132">Set these quotas to appropriate values as dictated by your scenario.</span></span>  
  
 <span data-ttu-id="d37be-133">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] では、サービス メタデータは XML の形で処理されます。</span><span class="sxs-lookup"><span data-stu-id="d37be-133">In [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)], service metadata is processed as XML.</span></span> <span data-ttu-id="d37be-134">XML ドキュメントを処理するアプリケーションは、悪質な XML 構造が現れても破綻しないようになっていなければなりません。</span><span class="sxs-lookup"><span data-stu-id="d37be-134">When processing XML documents, applications should protect themselves against malicious XML structures.</span></span> <span data-ttu-id="d37be-135">使用して、`XmlDictionaryReader`クォータの適切な XML を処理するときに、そのも設定、<xref:System.Xml.XmlTextReader.DtdProcessing%2A>プロパティを`Prohibit`です。</span><span class="sxs-lookup"><span data-stu-id="d37be-135">Use the `XmlDictionaryReader` with appropriate quotas when processing XML and also set the <xref:System.Xml.XmlTextReader.DtdProcessing%2A> property to `Prohibit`.</span></span>  
  
 <span data-ttu-id="d37be-136">メタデータ システム[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]は拡張可能であり、アプリケーション構成ファイルにメタデータ拡張を登録することができます (を参照してください[メタデータ システムの拡張](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md))。</span><span class="sxs-lookup"><span data-stu-id="d37be-136">The metadata system in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] is extensible and metadata extensions can be registered in your application configuration file (see [Extending the Metadata System](../../../../docs/framework/wcf/extending/extending-the-metadata-system.md)).</span></span> <span data-ttu-id="d37be-137">メタデータ拡張はどのようなコードでも実行できるので、適切なアクセス制御リスト (ACL) でアプリケーション構成ファイルを保護し、信頼できるメタデータ拡張以外は登録しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d37be-137">Metadata extensions can run arbitrary code, so you should protect your application configuration file with appropriate access control lists (ACLs) and register only trusted metadata extension implementations.</span></span>  
  
## <a name="validating-generated-clients"></a><span data-ttu-id="d37be-138">生成されたクライアントの検証</span><span class="sxs-lookup"><span data-stu-id="d37be-138">Validating Generated Clients</span></span>  
 <span data-ttu-id="d37be-139">信頼できないソースから取得したメタデータを基にクライアント コードを生成した場合、これがクライアント アプリケーションのセキュリティ ポリシーに合致しているかどうか検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d37be-139">When generating client code from metadata retrieved from a source that is not trusted, validate the generated client code to ensure that the generated client conforms to your client applications security policies.</span></span> <span data-ttu-id="d37be-140">動作を検証するための専用クライアントを使うか、あるいはツールが生成したコードを目視で検査してください。</span><span class="sxs-lookup"><span data-stu-id="d37be-140">You can use a validating behavior to check settings on your client binding or visually inspect code generated by tools.</span></span> <span data-ttu-id="d37be-141">動作を検証するクライアントを実装する方法の例は、次を参照してください。[クライアント検証](../../../../docs/framework/wcf/samples/client-validation.md)です。</span><span class="sxs-lookup"><span data-stu-id="d37be-141">For an example of how to implement a client that validates behaviors, see [Client Validation](../../../../docs/framework/wcf/samples/client-validation.md).</span></span>  
  
## <a name="protecting-application-configuration-files"></a><span data-ttu-id="d37be-142">アプリケーション構成ファイルの保護</span><span class="sxs-lookup"><span data-stu-id="d37be-142">Protecting Application Configuration Files</span></span>  
 <span data-ttu-id="d37be-143">サービスのアプリケーション構成ファイルでは、メタデータを公開する方法、および公開の有無を制御できます。</span><span class="sxs-lookup"><span data-stu-id="d37be-143">A service's application configuration file may control how and if metadata is published.</span></span> <span data-ttu-id="d37be-144">攻撃者が設定を変更できないように、適切なアクセス制御リスト (ACL) でアプリケーション構成ファイルを保護することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="d37be-144">It is a good idea to protect the application configuration file with appropriate access control lists (ACLs) to ensure an attacker cannot modify such settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d37be-145">参照</span><span class="sxs-lookup"><span data-stu-id="d37be-145">See Also</span></span>  
 [<span data-ttu-id="d37be-146">方法 : セキュリティで保護されたメタデータ エンドポイント</span><span class="sxs-lookup"><span data-stu-id="d37be-146">How to: Secure Metadata Endpoints</span></span>](../../../../docs/framework/wcf/feature-details/how-to-secure-metadata-endpoints.md)  
 [<span data-ttu-id="d37be-147">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="d37be-147">Security</span></span>](../../../../docs/framework/wcf/feature-details/security.md)
