---
title: "部分信頼のベスト プラクティス"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 0d052bc0-5b98-4c50-8bb5-270cc8a8b145
caps.latest.revision: "17"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: cbe782d117fee7c1cd8b8cb6fd3710e2adac77e5
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/21/2017
---
# <a name="partial-trust-best-practices"></a><span data-ttu-id="8c28c-102">部分信頼のベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="8c28c-102">Partial Trust Best Practices</span></span>
<span data-ttu-id="8c28c-103">このトピックでは、部分信頼環境で [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] を実行する場合のベスト プラクティスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8c28c-103">This topic describes best practices when running [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] in a partial trust environment.</span></span>  
  
## <a name="serialization"></a><span data-ttu-id="8c28c-104">シリアル化</span><span class="sxs-lookup"><span data-stu-id="8c28c-104">Serialization</span></span>  
 <span data-ttu-id="8c28c-105">部分信頼アプリケーションで <xref:System.Runtime.Serialization.DataContractSerializer> を使用する場合は、次の方法を適用します。</span><span class="sxs-lookup"><span data-stu-id="8c28c-105">Apply the following practices when using the <xref:System.Runtime.Serialization.DataContractSerializer> in a partially-trusted application.</span></span>  
  
-   <span data-ttu-id="8c28c-106">すべてのシリアル化可能な型は、`[DataContract]` 属性で明示的にマークする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-106">All serializable types must be explicitly marked with the `[DataContract]` attribute.</span></span> <span data-ttu-id="8c28c-107">次の手法は、部分信頼環境ではサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="8c28c-107">The following techniques are not supported in a partial trust environment:</span></span>  
  
-   <span data-ttu-id="8c28c-108">シリアル化するクラスを <xref:System.SerializableAttribute> でマークする。</span><span class="sxs-lookup"><span data-stu-id="8c28c-108">Marking classes to be serialized with the <xref:System.SerializableAttribute>.</span></span>  
  
-   <span data-ttu-id="8c28c-109">クラスでシリアル化プロセスを制御できるように <xref:System.Runtime.Serialization.ISerializable> インターフェイスを実装する。</span><span class="sxs-lookup"><span data-stu-id="8c28c-109">Implementing the <xref:System.Runtime.Serialization.ISerializable> interface to allow a class to control its serialization process.</span></span>  
  
### <a name="using-datacontractserializer"></a><span data-ttu-id="8c28c-110">DataContractSerializer の使用</span><span class="sxs-lookup"><span data-stu-id="8c28c-110">Using DataContractSerializer</span></span>  
  
-   <span data-ttu-id="8c28c-111">`[DataContract]` 属性でマークされたすべての型は、パブリックである必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-111">All types marked with the `[DataContract]` attribute must be public.</span></span> <span data-ttu-id="8c28c-112">部分信頼環境では、非パブリック型はシリアル化できません。</span><span class="sxs-lookup"><span data-stu-id="8c28c-112">Non-public types cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="8c28c-113">シリアル化できる `[DataContract]` 型のすべての `[DataContract]` メンバーは、パブリックである必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-113">All `[DataContract]` members in a serializable `[DataContract]` type must be public.</span></span> <span data-ttu-id="8c28c-114">部分信頼環境では、非パブリック `[DataMember]` 型はシリアル化できません。</span><span class="sxs-lookup"><span data-stu-id="8c28c-114">A type with a non-public `[DataMember]` cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="8c28c-115">`OnSerializing`、`OnSerialized`、`OnDeserializing`、`OnDeserialized` などのシリアル化イベントを処理するメソッドは、パブリックとして宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-115">Methods that handle serialization events (such as `OnSerializing`, `OnSerialized`, `OnDeserializing`, and `OnDeserialized`) must be declared as public.</span></span> <span data-ttu-id="8c28c-116">ただし、明示的および暗黙的な <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> の実装は、いずれもサポートされています。</span><span class="sxs-lookup"><span data-stu-id="8c28c-116">However, both explicit and implicit implementations of <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> are supported.</span></span>  
  
-   <span data-ttu-id="8c28c-117">`[DataContract]` は、逆シリアル化の間に新しくインスタンス化されたオブジェクトのコンストラクターを呼び出さないため、<xref:System.Security.AllowPartiallyTrustedCallersAttribute> でマークされて、アセンブリで実装された <xref:System.Runtime.Serialization.DataContractSerializer> 型は、型コンストラクターでセキュリティ関連の操作を実行することはできません。</span><span class="sxs-lookup"><span data-stu-id="8c28c-117">`[DataContract]` types implemented in assemblies marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> must not perform security-related actions in the type constructor, as the <xref:System.Runtime.Serialization.DataContractSerializer> does not call the constructor of the newly-instantiated object during deserialization.</span></span> <span data-ttu-id="8c28c-118">特に、`[DataContract]` 型では、次の一般的なセキュリティ手法の使用を避ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-118">Specifically, the following common security techniques must be avoided for `[DataContract]` types:</span></span>  
  
-   <span data-ttu-id="8c28c-119">型のコンストラクターを内部またはプライベートにすることにより、部分信頼アクセスを制限する。</span><span class="sxs-lookup"><span data-stu-id="8c28c-119">Attempting to restrict partial trust access by making the type's constructor internal or private.</span></span>  
  
-   <span data-ttu-id="8c28c-120">型のコンストラクターに `[LinkDemand]` を追加することにより、型へのアクセスを制限する。</span><span class="sxs-lookup"><span data-stu-id="8c28c-120">Restricting access to the type by adding a `[LinkDemand]` to the type's constructor.</span></span>  
  
-   <span data-ttu-id="8c28c-121">オブジェクトが正常にインスタンス化されたため、コンストラクターが強制するチェックがすべて正常に終了したと仮定する。</span><span class="sxs-lookup"><span data-stu-id="8c28c-121">Assuming that because the object has been successfully instantiated, any validation checks enforced by the constructor have passed successfully.</span></span>  
  
### <a name="using-ixmlserializable"></a><span data-ttu-id="8c28c-122">IXmlSerializable の使用</span><span class="sxs-lookup"><span data-stu-id="8c28c-122">Using IXmlSerializable</span></span>  
 <span data-ttu-id="8c28c-123"><xref:System.Xml.Serialization.IXmlSerializable> を実装し、<xref:System.Runtime.Serialization.DataContractSerializer> を使用してシリアル化される型に適用されるベスト プラクティスを次に示します。</span><span class="sxs-lookup"><span data-stu-id="8c28c-123">The following best practices apply for types that implement <xref:System.Xml.Serialization.IXmlSerializable> and are serialized using the <xref:System.Runtime.Serialization.DataContractSerializer>:</span></span>  
  
-   <span data-ttu-id="8c28c-124">静的 <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> メソッドの実装は、`public` とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-124">The <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> static method implementations must be `public`.</span></span>  
  
-   <span data-ttu-id="8c28c-125"><xref:System.Xml.Serialization.IXmlSerializable> インターフェイスを実装するインスタンス メソッドは、`public` とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-125">The instance methods that implement the <xref:System.Xml.Serialization.IXmlSerializable> interface must be `public`.</span></span>  
  
## <a name="using-wcf-from-fully-trusted-platform-code-that-allows-calls-from-partially-trusted-callers"></a><span data-ttu-id="8c28c-126">部分信頼の呼び出し元から呼び出せる完全信頼のプラットフォーム コードで WCF を使用する</span><span class="sxs-lookup"><span data-stu-id="8c28c-126">Using WCF from Fully-Trusted Platform Code that Allows Calls from Partially Trusted Callers</span></span>  
 <span data-ttu-id="8c28c-127">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] の部分信頼セキュリティ モデルでは、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] パブリック メソッドまたはプロパティのすべての呼び出し元は、ホスト アプリケーションのコード アクセス セキュリティ (CAS: Code Access Security) コンテキストで実行されていることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="8c28c-127">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] partial trust security model assumes that any caller of a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] public method or property is running in the code access security (CAS) context of the hosting application.</span></span> <span data-ttu-id="8c28c-128">また、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] は、各 <xref:System.AppDomain> に対して存在するアプリケーション セキュリティ コンテキストが 1 つのみであり、このコンテキストが <xref:System.AppDomain> への呼び出しや ASP.NET アプリケーション マネージャーなどの信頼されているホストにより、<xref:System.AppDomain.CreateDomain%2A> 作成時に確立されることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="8c28c-128">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] also assumes that only one application security context exists for each <xref:System.AppDomain>, and that this context is established at <xref:System.AppDomain> creation time by a trusted host (for example, by a call to <xref:System.AppDomain.CreateDomain%2A> or by the ASP.NET Application Manager).</span></span>  
  
 <span data-ttu-id="8c28c-129">このセキュリティ モデルは、信頼性が "中" の ASP.NET アプリケーションで実行されているユーザー コードなど、追加の CAS アクセス許可をアサートできないユーザー記述のアプリケーションに適用されます。</span><span class="sxs-lookup"><span data-stu-id="8c28c-129">This security model applies to user-written applications that cannot assert additional CAS permissions, such as user code running in a Medium Trust ASP.NET application.</span></span> <span data-ttu-id="8c28c-130">ただし、完全信頼のプラットフォーム コード (たとえば、グローバル アセンブリ キャッシュにインストールされているサード パーティ アセンブリや、部分信頼コードからの呼び出しを受け入れるサード パーティ アセンブリなど) は、アプリケーション レベルのセキュリティの脆弱性が発生しないよう、部分信頼アプリケーションに代わって [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] を呼び出す場合に、明示的な注意を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-130">However, fully-trusted platform code (for example, a third-party assembly that is installed in the global assembly cache and accepts calls from partially-trusted code) must take explicit care when calling into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] on behalf of a partially-trusted application to avoid introducing application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="8c28c-131">完全信頼コードでは、部分信頼コードに代わって <xref:System.Security.PermissionSet.Assert%2A> API を呼び出す前に、<xref:System.Security.PermissionSet.PermitOnly%2A>、<xref:System.Security.PermissionSet.Deny%2A>、または [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] を呼び出して、現在のスレッドの CAS アクセス許可セットを変更しないようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-131">Full-trust code should avoid altering the CAS permission set of the current thread (by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>) prior to calling [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] APIs on behalf of partially-trusted code.</span></span> <span data-ttu-id="8c28c-132">アプリケーション レベルのセキュリティ コンテキストに依存しないスレッド固有のアクセス許可コンテキストのアサート、拒否、または作成により、予期しない動作が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-132">Asserting, denying, or otherwise creating a thread-specific permission context that is independent of the application-level security context can result in unexpected behavior.</span></span> <span data-ttu-id="8c28c-133">アプリケーションによっては、この動作がアプリケーション レベルのセキュリティの脆弱性となることがあります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-133">Depending on the application, this behavior may result in application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="8c28c-134">次のような状況の発生に対処するには、スレッド固有のアクセス許可コンテキストを使用して [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] を呼び出すコードを準備する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-134">Code that calls into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] using a thread-specific permission context must be prepared to handle the following situations that may arise:</span></span>  
  
-   <span data-ttu-id="8c28c-135">スレッド固有のセキュリティ コンテキストを処理の期間全体にわたっては保持できない場合があり、このときセキュリティの例外が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-135">The thread-specific security context may not be maintained for the duration of the operation, which results in potential security exceptions.</span></span>  
  
-   <span data-ttu-id="8c28c-136">内部 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] コードとユーザーが指定したコールバックが、呼び出しが開始された元のセキュリティ コンテキストとは異なるセキュリティ コンテキストで実行される場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c28c-136">Internal [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] code as well as any user-provided callbacks may run in a different security context than the one under which the call was originally initiated.</span></span> <span data-ttu-id="8c28c-137">次のようなコンテキストが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c28c-137">These contexts include:</span></span>  
  
    -   <span data-ttu-id="8c28c-138">アプリケーションのアクセス許可コンテキスト。</span><span class="sxs-lookup"><span data-stu-id="8c28c-138">The application permission context.</span></span>  
  
    -   <span data-ttu-id="8c28c-139">現在実行している [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] の有効期間中に、<xref:System.AppDomain> の呼び出しに使用される他のユーザー スレッドが以前に作成したスレッド固有のアクセス許可コンテキスト。</span><span class="sxs-lookup"><span data-stu-id="8c28c-139">Any thread-specific permission context previously created by other user threads used to call into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] during the lifetime of the currently running <xref:System.AppDomain>.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="8c28c-140"> パブリック API の呼び出しの前に、完全信頼コンポーネントによってこのようなアクセス許可がアサートされない限り、[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] では、部分信頼コードで完全信頼アクセス許可を取得できないことが保証されます。</span><span class="sxs-lookup"><span data-stu-id="8c28c-140"> guarantees that partially-trusted code cannot obtain full-trust permissions unless such permissions are asserted by a fully-trusted component prior to calling into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] public APIs.</span></span> <span data-ttu-id="8c28c-141">ただし、完全信頼をアサートした効果が特定のスレッド、操作、またはユーザー操作として隔離されることは保証されません。</span><span class="sxs-lookup"><span data-stu-id="8c28c-141">However, it does not guarantee that the effects of asserting full trust is isolated to a particular thread, operation, or user action.</span></span>  
  
 <span data-ttu-id="8c28c-142"><xref:System.Security.PermissionSet.Assert%2A>、<xref:System.Security.PermissionSet.PermitOnly%2A>、または <xref:System.Security.PermissionSet.Deny%2A> を呼び出すことにより、スレッド固有のアクセス許可コンテキストを作成しないことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8c28c-142">As a best practice, avoid creating thread-specific permission context by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>.</span></span> <span data-ttu-id="8c28c-143">代わりに、<xref:System.Security.PermissionSet.Assert%2A>、<xref:System.Security.PermissionSet.Deny%2A>、または <xref:System.Security.PermissionSet.PermitOnly%2A> が不要となるように、アプリケーション自体に特権を付与するか、特権を拒否します。</span><span class="sxs-lookup"><span data-stu-id="8c28c-143">Instead, grant or deny the privilege to the application itself, so that no <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A>, or <xref:System.Security.PermissionSet.PermitOnly%2A> is required.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="8c28c-144">関連項目</span><span class="sxs-lookup"><span data-stu-id="8c28c-144">See Also</span></span>  
 <xref:System.Runtime.Serialization.DataContractSerializer>  
 <xref:System.Xml.Serialization.IXmlSerializable>
