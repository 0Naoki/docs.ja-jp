---
title: サポートされていないシナリオ
ms.date: 03/30/2017
ms.assetid: 72027d0f-146d-40c5-9d72-e94392c8bb40
ms.openlocfilehash: 48ed292b3bb22ae4966680805a74b40b249d8a32
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "64637749"
---
# <a name="unsupported-scenarios"></a><span data-ttu-id="e38f3-102">サポートされていないシナリオ</span><span class="sxs-lookup"><span data-stu-id="e38f3-102">Unsupported Scenarios</span></span>
<span data-ttu-id="e38f3-103">さまざまな理由は、Windows Communication Foundation (WCF) は一部の特定のセキュリティ シナリオをサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="e38f3-103">For various reasons, Windows Communication Foundation (WCF) does not support some specific security scenarios.</span></span> <span data-ttu-id="e38f3-104">たとえば、 [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition は SSPI または Kerberos 認証プロトコルを実装していないため WCF サポートしていないプラットフォームで Windows 認証を使用したサービスを実行します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-104">For example, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition does not implement the SSPI or Kerberos authentication protocols, and therefore WCF does not support running a service with Windows authentication on that platform.</span></span> <span data-ttu-id="e38f3-105">ユーザー名/パスワードや HTTP/HTTPS 統合認証などの他の認証メカニズムは、Windows XP Home Edition で WCF を実行している場合にサポートされます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-105">Other authentication mechanisms, such as username/password and HTTP/HTTPS integrated authentication are supported when running WCF under Windows XP Home Edition.</span></span>  
  
## <a name="impersonation-scenarios"></a><span data-ttu-id="e38f3-106">偽装シナリオ</span><span class="sxs-lookup"><span data-stu-id="e38f3-106">Impersonation Scenarios</span></span>  
  
### <a name="impersonated-identity-might-not-flow-when-clients-make-asynchronous-calls"></a><span data-ttu-id="e38f3-107">クライアントが非同期呼び出しを行うと、偽装 ID はフローしない場合がある</span><span class="sxs-lookup"><span data-stu-id="e38f3-107">Impersonated Identity Might Not Flow When Clients Make Asynchronous Calls</span></span>  
 <span data-ttu-id="e38f3-108">WCF クライアントが、偽装で Windows 認証を使用して WCF サービスへの非同期呼び出しを行うと、偽装 ID ではなくクライアント プロセスの ID で認証が行われる場合があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-108">When a WCF client makes asynchronous calls to a WCF service using Windows authentication under impersonation, authentication might occur with the identity of the client process instead of the impersonated identity.</span></span>  
  
### <a name="windows-xp-and-secure-context-token-cookie-enabled"></a><span data-ttu-id="e38f3-109">Windows XP と有効化されたセキュリティ コンテキスト トークン クッキー</span><span class="sxs-lookup"><span data-stu-id="e38f3-109">Windows XP and Secure Context Token Cookie Enabled</span></span>  
 <span data-ttu-id="e38f3-110">WCF が偽装をサポートしていません、<xref:System.InvalidOperationException>が、次の条件が存在する場合にスローされます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-110">WCF does not support impersonation and an <xref:System.InvalidOperationException> is thrown when the following conditions exist:</span></span>  
  
- <span data-ttu-id="e38f3-111">オペレーティング システムが [!INCLUDE[wxp](../../../../includes/wxp-md.md)] である。</span><span class="sxs-lookup"><span data-stu-id="e38f3-111">The operating system is [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>  
  
- <span data-ttu-id="e38f3-112">認証モードで Windows ID が生成された。</span><span class="sxs-lookup"><span data-stu-id="e38f3-112">The authentication mode results in a Windows identity.</span></span>  
  
- <span data-ttu-id="e38f3-113"><xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> の <xref:System.ServiceModel.OperationBehaviorAttribute> プロパティが <xref:System.ServiceModel.ImpersonationOption.Required> に設定されます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-113">The <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute> is set to <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
- <span data-ttu-id="e38f3-114">状態ベースのセキュリティ コンテキスト トークン (SCT: Security Context Token) が作成された (既定では、作成は無効になっています)。</span><span class="sxs-lookup"><span data-stu-id="e38f3-114">A state-based security context token (SCT) is created (by default, creation is disabled).</span></span>  
  
 <span data-ttu-id="e38f3-115">状態ベースの SCT はカスタム バインドの使用によってのみ作成できます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-115">The state-based SCT can only be created using a custom binding.</span></span> <span data-ttu-id="e38f3-116">詳細については、「[方法 :セキュリティ コンテキストを作成、セキュリティで保護されたセッションのトークン](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md))。コードでトークンを有効にするには、<xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> メソッドまたは <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement> メソッドを使用して、セキュリティ バインディング要素 (<xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> または <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType>) を作成し、`requireCancellation` パラメーターを `false` に設定します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-116">For more information, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).) In code, the token is enabled by creating a security binding element (either <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> or <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>) using the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> or the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType> method and setting the `requireCancellation` parameter to `false`.</span></span> <span data-ttu-id="e38f3-117">このパラメーターは、SCT のキャッシュを参照します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-117">The parameter refers to the caching of the SCT.</span></span> <span data-ttu-id="e38f3-118">値を `false` に設定することによって、状態ベースの SCT 機能が有効になります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-118">Setting the value to `false` enables the state-based SCT feature.</span></span>  
  
 <span data-ttu-id="e38f3-119">または、構成において、<`customBinding`> を作成し、<`security`> 要素を追加して `authenticationMode` 属性に SecureConversation および `requireSecurityContextCancellation` 属性に `true` を設定することによってもトークンが有効になります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-119">Alternatively, in configuration, the token is enabled by creating a <`customBinding`>, then adding a <`security`> element, and setting the `authenticationMode` attribute to SecureConversation and the `requireSecurityContextCancellation` attribute to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e38f3-120">上記の要件は限定的です。</span><span class="sxs-lookup"><span data-stu-id="e38f3-120">The preceding requirements are specific.</span></span> <span data-ttu-id="e38f3-121">たとえば、<xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> は Windows ID を生成するバインド要素を作成しますが、SCT を確立しません。</span><span class="sxs-lookup"><span data-stu-id="e38f3-121">For example, the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> creates a binding element that results in a Windows identity, but does not establish an SCT.</span></span> <span data-ttu-id="e38f3-122">したがって、`Required` で [!INCLUDE[wxp](../../../../includes/wxp-md.md)] オプションと共に使用できます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-122">Therefore, you can use it with the `Required` option on [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>  
  
### <a name="possible-aspnet-conflict"></a><span data-ttu-id="e38f3-123">考えられる ASP.NET との競合</span><span class="sxs-lookup"><span data-stu-id="e38f3-123">Possible ASP.NET Conflict</span></span>  
 <span data-ttu-id="e38f3-124">WCF と[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]両方を有効にしたり、偽装を無効にします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-124">WCF and [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] can both enable or disable impersonation.</span></span> <span data-ttu-id="e38f3-125">ときに[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]WCF アプリケーションをホスト、WCF との間の競合が存在し、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]構成設定。</span><span class="sxs-lookup"><span data-stu-id="e38f3-125">When [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] hosts an WCF application, a conflict may exist between the WCF and [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] configuration settings.</span></span> <span data-ttu-id="e38f3-126">競合が発生した場合、WCF 設定が優先しない限り、<xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>プロパティに設定されて<xref:System.ServiceModel.ImpersonationOption.NotAllowed>、その場合、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]権限借用の設定が優先されます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-126">In case of conflict, the WCF setting takes precedence, unless the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.NotAllowed>, in which case the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] impersonation setting takes precedence.</span></span>  
  
### <a name="assembly-loads-may-fail-under-impersonation"></a><span data-ttu-id="e38f3-127">偽装を有効にすると、アセンブリの読み込みに失敗する場合がある</span><span class="sxs-lookup"><span data-stu-id="e38f3-127">Assembly Loads May Fail Under Impersonation</span></span>  
 <span data-ttu-id="e38f3-128">偽装されたコンテキストにアセンブリを読み込むためのアクセス権がない場合、共通言語ランタイム (CLR: Common Language Runtime) が AppDomain のアセンブリを初めて読み込もうとしたときに、その <xref:System.AppDomain> はエラーをキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-128">If the impersonated context does not have access rights to load an assembly and if it is the first time the common language runtime (CLR) is attempting to load the assembly for that AppDomain, the <xref:System.AppDomain> caches the failure.</span></span> <span data-ttu-id="e38f3-129">この場合、偽装を元に戻した後、元に戻されたコンテキストにアセンブリを読み込むためのアクセス権があったとしても、それ以降のアセンブリの読み込みは失敗します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-129">Subsequent attempts to load that assembly (or assemblies) fail, even after reverting the impersonation, and even if the reverted context has access rights to load the assembly.</span></span> <span data-ttu-id="e38f3-130">これは、ユーザー コンテキストの変更後に、CLR が読み込みを再試行しないためです。</span><span class="sxs-lookup"><span data-stu-id="e38f3-130">This is because the CLR does not re-attempt the load after the user context is changed.</span></span> <span data-ttu-id="e38f3-131">このエラーから回復するには、アプリケーション ドメインを再起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-131">You must restart the application domain to recover from the failure.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e38f3-132"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> クラスの <xref:System.ServiceModel.Security.WindowsClientCredential> プロパティの既定値は <xref:System.Security.Principal.TokenImpersonationLevel.Identification> です。</span><span class="sxs-lookup"><span data-stu-id="e38f3-132">The default value for the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class is <xref:System.Security.Principal.TokenImpersonationLevel.Identification>.</span></span> <span data-ttu-id="e38f3-133">ほとんどの場合、ID レベルの偽装コンテキストには、追加のアセンブリを読み込むための権限がありません。</span><span class="sxs-lookup"><span data-stu-id="e38f3-133">In most cases, an identification-level impersonation context has no rights to load any additional assemblies.</span></span> <span data-ttu-id="e38f3-134">これは既定値であるため、非常に一般的な状態として認識しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-134">This is the default value, so this is a very common condition to be aware of.</span></span> <span data-ttu-id="e38f3-135">ID レベルの偽装は、偽装プロセスが `SeImpersonate` 権限を持たない場合にも発生します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-135">Identification-level impersonation also occurs when the impersonating process does not have the `SeImpersonate` privilege.</span></span> <span data-ttu-id="e38f3-136">詳細については、次を参照してください。[委任と偽装](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-136">For more information, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="e38f3-137">委任には資格情報ネゴシエーションが必要</span><span class="sxs-lookup"><span data-stu-id="e38f3-137">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="e38f3-138">委任で Kerberos 認証プロトコルを使用するには、資格情報ネゴシエーションを使用する Kerberos プロトコル ("マルチレッグ" Kerberos または "マルチステップ" Kerberos とも呼ばれます) を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-138">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called multi-leg or multi-step Kerberos).</span></span> <span data-ttu-id="e38f3-139">資格情報ネゴシエーションを使用しない Kerberos 認証 (ワンショット Kerberos またはシングルレッグ Kerberos とも呼ばれる) を実装した場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-139">If you implement Kerberos authentication without credential negotiation (sometimes called one-shot or single-leg Kerberos), an exception is thrown.</span></span> <span data-ttu-id="e38f3-140">資格情報ネゴシエーションを実装する方法の詳細については、次を参照してください。 [Windows 認証エラーのデバッグ](../../../../docs/framework/wcf/feature-details/debugging-windows-authentication-errors.md)します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-140">For more information about how to implement credential negotiation, see [Debugging Windows Authentication Errors](../../../../docs/framework/wcf/feature-details/debugging-windows-authentication-errors.md).</span></span>  
  
## <a name="cryptography"></a><span data-ttu-id="e38f3-141">暗号</span><span class="sxs-lookup"><span data-stu-id="e38f3-141">Cryptography</span></span>  
  
### <a name="sha-256-supported-only-for-symmetric-key-usages"></a><span data-ttu-id="e38f3-142">対称キーを使用する場合にのみサポートされる SHA-256</span><span class="sxs-lookup"><span data-stu-id="e38f3-142">SHA-256 Supported Only for Symmetric Key Usages</span></span>  
 <span data-ttu-id="e38f3-143">WCF には、さまざまな暗号化と、システム指定のバインディングでアルゴリズム スイートを使用して指定できる署名ダイジェスト作成アルゴリズムがサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e38f3-143">WCF supports a variety of encryption and signature digest creation algorithms that you can specify using the algorithm suite in the system-provided bindings.</span></span> <span data-ttu-id="e38f3-144">セキュリティを強化は、WCF は、署名ダイジェスト ハッシュを作成するため、セキュア ハッシュ アルゴリズム (SHA) 2 アルゴリズムでは、具体的にはの SHA 256 をサポートします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-144">For improved security, WCF supports Secure Hash Algorithm (SHA) 2 algorithms, specifically SHA-256, for creating signature digest hashes.</span></span> <span data-ttu-id="e38f3-145">このリリースは、Kerberos キーなどの対称キーを使用する場合、およびメッセージに署名するために X.509 証明書を使用しない場合に限り SHA-256 をサポートします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-145">This release supports SHA-256 only for symmetric key usages, such as Kerberos keys, and where an X.509 certificate is not used to sign the message.</span></span> <span data-ttu-id="e38f3-146">WCF ではサポートしていません (X.509 証明書で使用する) RSA 署名で rsa-sha256 を現在のサポートがないのための SHA 256 ハッシュを使用して、[!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-146">WCF does not support RSA signatures (used in X.509 certificates) using SHA-256 hash due to the current lack of support for RSA-SHA256 in the [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)].</span></span>  
  
### <a name="fips-compliant-sha-256-hashes-not-supported"></a><span data-ttu-id="e38f3-147">サポートされていない FIPS 準拠の SHA-256 ハッシュ</span><span class="sxs-lookup"><span data-stu-id="e38f3-147">FIPS-Compliant SHA-256 Hashes not Supported</span></span>  
 <span data-ttu-id="e38f3-148">WCF は sha-256 FIPS 準拠のハッシュをサポートしていないため、システムが FIPS 準拠アルゴリズムの使用が必要な場合の WCF でサポートされていないことを SHA 256 を使用するアルゴリズム スイート。</span><span class="sxs-lookup"><span data-stu-id="e38f3-148">WCF does not support SHA-256 FIPS-compliant hashes, so algorithm suites that use SHA-256 are not supported by WCF on systems where use of FIPS compliant algorithms is required.</span></span>  
  
### <a name="fips-compliant-algorithms-may-fail-if-registry-is-edited"></a><span data-ttu-id="e38f3-149">レジストリを編集すると、FIPS 準拠のアルゴリズムが失敗する場合がある</span><span class="sxs-lookup"><span data-stu-id="e38f3-149">FIPS-Compliant Algorithms May Fail if Registry Is Edited</span></span>  
 <span data-ttu-id="e38f3-150">連邦情報処理規格 (FIPS: Federal Information Processing Standards) 準拠のアルゴリズムを有効または無効にするには、Microsoft 管理コンソール (MMC: Microsoft Management Console) のローカル セキュリティ設定スナップインを使用します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-150">You can enable and disable Federal Information Processing Standards (FIPS)-compliant algorithms by using the Local Security Settings Microsoft Management Console (MMC) snap-in.</span></span> <span data-ttu-id="e38f3-151">レジストリでこの設定にアクセスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-151">You can also access the setting in the registry.</span></span> <span data-ttu-id="e38f3-152">ただし、WCF はサポートされないこと、レジストリを使用して、設定をリセットします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-152">Note, however, that WCF does not support using the registry to reset the setting.</span></span> <span data-ttu-id="e38f3-153">値を 1 または 0 以外に設定すると、CLR とオペレーティング システム間で不整合が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-153">If the value is set to anything other than 1 or 0, inconsistent results can occur between the CLR and the operating system.</span></span>  
  
### <a name="fips-compliant-aes-encryption-limitation"></a><span data-ttu-id="e38f3-154">FIPS 準拠の AES 暗号化の制限</span><span class="sxs-lookup"><span data-stu-id="e38f3-154">FIPS-Compliant AES Encryption Limitation</span></span>  
 <span data-ttu-id="e38f3-155">FIPS 準拠の AES 暗号化は、ID レベルの偽装での双方向コールバックでは機能しません。</span><span class="sxs-lookup"><span data-stu-id="e38f3-155">FIPS compliant AES encryption does not work in duplex callbacks under identification level impersonation.</span></span>  
  
### <a name="cngksp-certificates"></a><span data-ttu-id="e38f3-156">CNG/KSP 証明書</span><span class="sxs-lookup"><span data-stu-id="e38f3-156">CNG/KSP Certificates</span></span>  
 <span data-ttu-id="e38f3-157">*Cryptography API:Next Generation (CNG)* 長期にわたって置き換え、CryptoAPI のです。</span><span class="sxs-lookup"><span data-stu-id="e38f3-157">*Cryptography API: Next Generation (CNG)* is the long-term replacement for the CryptoAPI.</span></span> <span data-ttu-id="e38f3-158">この API は、アンマネージ コードで使用できる[!INCLUDE[wv](../../../../includes/wv-md.md)]、[!INCLUDE[lserver](../../../../includes/lserver-md.md)]以降の Windows バージョン。</span><span class="sxs-lookup"><span data-stu-id="e38f3-158">This API is available in unmanaged code on [!INCLUDE[wv](../../../../includes/wv-md.md)],  [!INCLUDE[lserver](../../../../includes/lserver-md.md)] and later Windows versions.</span></span>  
  
 <span data-ttu-id="e38f3-159">.NET framework 4.6.1 と以前のバージョンは、従来の CryptoAPI CNG/KSP 証明書を処理するために使用されるため、これらの証明書をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e38f3-159">.NET Framework 4.6.1 and earlier versions do not support these certificates because they use the legacy CryptoAPI to handle CNG/KSP certificates.</span></span> <span data-ttu-id="e38f3-160">.NET Framework 4.6.1 と以前のバージョンでこれらの証明書の使用には、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-160">The use of these certificates with   .NET Framework 4.6.1 and earlier versions will cause an exception.</span></span>  
  
 <span data-ttu-id="e38f3-161">証明書に KSP が使用されているかどうかを知る方法は 2 つあります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-161">There are two possible ways to tell if a certificate uses KSP:</span></span>  
  
- <span data-ttu-id="e38f3-162">`p/invoke` を `CertGetCertificateContextProperty` に対して実行し、返された `dwProvType` で `CertGetCertificateContextProperty` を調べる。</span><span class="sxs-lookup"><span data-stu-id="e38f3-162">Do a `p/invoke` of `CertGetCertificateContextProperty`, and inspect `dwProvType` on the returned `CertGetCertificateContextProperty`.</span></span>  
  
- <span data-ttu-id="e38f3-163">使用して、`certutil`証明書を調べるためのコマンドラインからコマンド。</span><span class="sxs-lookup"><span data-stu-id="e38f3-163">Use the  `certutil` command from the command line for querying certificates.</span></span> <span data-ttu-id="e38f3-164">詳細については、次を参照してください。[証明書のトラブルシューティングに関する Certutil タスク](https://go.microsoft.com/fwlink/?LinkId=120056)します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-164">For more information, see [Certutil tasks for troubleshooting certificates](https://go.microsoft.com/fwlink/?LinkId=120056).</span></span>  
  
## <a name="message-security-fails-if-using-aspnet-impersonation-and-aspnet-compatibility-is-required"></a><span data-ttu-id="e38f3-165">ASP.NET の偽装と ASP.NET 互換を使用する必要がある場合にメッセージ セキュリティが失敗する</span><span class="sxs-lookup"><span data-stu-id="e38f3-165">Message Security Fails if Using ASP.NET Impersonation and ASP.NET Compatibility Is Required</span></span>  
 <span data-ttu-id="e38f3-166">WCF では、クライアント認証を防止するため、次の設定の組み合わせはサポートされません。</span><span class="sxs-lookup"><span data-stu-id="e38f3-166">WCF does not support the following combination of settings because they can prevent client authentication from occurring:</span></span>  
  
- [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] <span data-ttu-id="e38f3-167">の偽装を有効にしている。</span><span class="sxs-lookup"><span data-stu-id="e38f3-167">Impersonation is enabled.</span></span> <span data-ttu-id="e38f3-168">これを行うには、Web.config ファイルで <`identity`> 要素の `impersonate` 属性を `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-168">This is done in the Web.config file by setting the `impersonate` attribute of the <`identity`> element to `true`.</span></span>  
  
- [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] <span data-ttu-id="e38f3-169">互換性モードが有効になって、`aspNetCompatibilityEnabled`の属性、 [ \<serviceHostingEnvironment >](../../../../docs/framework/configure-apps/file-schema/wcf/servicehostingenvironment.md)に`true`します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-169">compatibility mode is enabled by setting the `aspNetCompatibilityEnabled` attribute of the [\<serviceHostingEnvironment>](../../../../docs/framework/configure-apps/file-schema/wcf/servicehostingenvironment.md) to `true`.</span></span>  
  
- <span data-ttu-id="e38f3-170">メッセージ モード セキュリティを使用している。</span><span class="sxs-lookup"><span data-stu-id="e38f3-170">Message mode security is used.</span></span>  
  
 <span data-ttu-id="e38f3-171">これを回避するには、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 互換モードを無効にします。</span><span class="sxs-lookup"><span data-stu-id="e38f3-171">The work-around is to turn off the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] compatibility mode.</span></span> <span data-ttu-id="e38f3-172">または、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]互換モードが必要ですが、無効にする、[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]権限借用機能し、WCF が提供する偽装の代わりに使用します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-172">Or, if the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] compatibility mode is required, disable the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] impersonation feature and use WCF-provided impersonation instead.</span></span> <span data-ttu-id="e38f3-173">詳細については、次を参照してください。[委任と偽装](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-173">For more information, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="ipv6-literal-address-failure"></a><span data-ttu-id="e38f3-174">IPv6 リテラル アドレス エラー</span><span class="sxs-lookup"><span data-stu-id="e38f3-174">IPv6 Literal Address Failure</span></span>  
 <span data-ttu-id="e38f3-175">クライアントとサービスが同じコンピューター上に存在し、サービスに対して IPv6 リテラル アドレスが使用されている場合は、セキュリティ要求が失敗します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-175">Security requests fail when the client and service are on the same machine, and IPv6 literal addresses are used for the service.</span></span>  
  
 <span data-ttu-id="e38f3-176">IPv6 リテラル アドレスは、サービスとクライアントがそれぞれ異なるコンピューター上に存在する場合に機能します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-176">Literal IPv6 addresses work if the service and client are on different machines.</span></span>  
  
## <a name="wsdl-retrieval-failures-with-federated-trust"></a><span data-ttu-id="e38f3-177">フェデレーション信頼での WSDL 取得エラー</span><span class="sxs-lookup"><span data-stu-id="e38f3-177">WSDL Retrieval Failures with Federated Trust</span></span>  
 <span data-ttu-id="e38f3-178">WCF では、フェデレーション信頼チェーン内の各ノードの 1 つだけの WSDL ドキュメントが必要です。</span><span class="sxs-lookup"><span data-stu-id="e38f3-178">WCF requires exactly one WSDL document for each node in the federated trust chain.</span></span> <span data-ttu-id="e38f3-179">エンドポイントを指定するときにループにならないように注意する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-179">Be careful not to set up a loop when specifying endpoints.</span></span> <span data-ttu-id="e38f3-180">ループになる場合の例の 1 つは、フェデレーション信頼チェーンの WSDL ダウンロードの使用で、同じ WSDL ドキュメントの中に複数のリンクがある場合です。</span><span class="sxs-lookup"><span data-stu-id="e38f3-180">One way in which loops can arise is using a WSDL download of federated trust chains with two or more links in the same WSDL document.</span></span> <span data-ttu-id="e38f3-181">この問題がよく発生するシナリオは、セキュリティ トークン サーバーとセキュリティ トークン サービスが同じ ServiceHost の中にあるフェデレーション サービスです。</span><span class="sxs-lookup"><span data-stu-id="e38f3-181">A common scenario that can produce this problem is a federated service where the Security Token Server and the service are contained inside the same ServiceHost.</span></span>  
  
 <span data-ttu-id="e38f3-182">そのような状況の例は次の 3 つのエンドポイント アドレスを使うサービスです。</span><span class="sxs-lookup"><span data-stu-id="e38f3-182">An example of this situation is a service with the following three endpoint addresses:</span></span>  
  
- <span data-ttu-id="e38f3-183">`http://localhost/CalculatorService/service` (サービス)</span><span class="sxs-lookup"><span data-stu-id="e38f3-183">`http://localhost/CalculatorService/service` (the service)</span></span>  
  
- <span data-ttu-id="e38f3-184">`http://localhost/CalculatorService/issue_ticket` (STS)</span><span class="sxs-lookup"><span data-stu-id="e38f3-184">`http://localhost/CalculatorService/issue_ticket` (the STS)</span></span>  
  
- <span data-ttu-id="e38f3-185">`http://localhost/CalculatorService/mex` (メタデータ エンドポイント)</span><span class="sxs-lookup"><span data-stu-id="e38f3-185">`http://localhost/CalculatorService/mex` (the metadata endpoint)</span></span>  
  
 <span data-ttu-id="e38f3-186">これによって例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-186">This throws an exception.</span></span>  
  
 <span data-ttu-id="e38f3-187">このシナリオでエラーを避けるには、`issue_ticket` エンドポイントを別のところに置きます。</span><span class="sxs-lookup"><span data-stu-id="e38f3-187">You can make this scenario work by putting the `issue_ticket` endpoint elsewhere.</span></span>  
  
## <a name="wsdl-import-attributes-can-be-lost"></a><span data-ttu-id="e38f3-188">WSDL インポート属性が失われる可能性</span><span class="sxs-lookup"><span data-stu-id="e38f3-188">WSDL Import Attributes can be Lost</span></span>  
 <span data-ttu-id="e38f3-189">WSDL インポートの際に、WCF は `<wst:Claims>` テンプレート内の `RST` 要素にあるインポート属性を追跡できなくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-189">WCF loses track of the attributes on a `<wst:Claims>` element in an `RST` template when doing a WSDL import.</span></span> <span data-ttu-id="e38f3-190">これは、クレームの種類のコレクションを直接使用する代わりに `<Claims>` を直接 `WSFederationHttpBinding.Security.Message.TokenRequestParameters` または `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters` 内で指定した場合に、WSDL インポートの際に発生します。</span><span class="sxs-lookup"><span data-stu-id="e38f3-190">This happens during a WSDL import if you specify `<Claims>` directly in `WSFederationHttpBinding.Security.Message.TokenRequestParameters` or `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters` instead of using the claim type collections directly.</span></span>  <span data-ttu-id="e38f3-191">インポートが属性を失うので、WSDL を介して正しいバインディングのラウンド トリップが行われません。したがって、クライアント側で不適切になります。</span><span class="sxs-lookup"><span data-stu-id="e38f3-191">Since the import loses the attributes, the binding does not round trip properly through WSDL and hence is incorrect on the client side.</span></span>  
  
 <span data-ttu-id="e38f3-192">解決策は、インポートを行った後、クライアント側で直接バインディングを変更することです。</span><span class="sxs-lookup"><span data-stu-id="e38f3-192">The fix is to modify the binding directly on the client after doing the import.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e38f3-193">関連項目</span><span class="sxs-lookup"><span data-stu-id="e38f3-193">See also</span></span>

- [<span data-ttu-id="e38f3-194">セキュリティの考慮事項</span><span class="sxs-lookup"><span data-stu-id="e38f3-194">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)
- [<span data-ttu-id="e38f3-195">情報の漏えい</span><span class="sxs-lookup"><span data-stu-id="e38f3-195">Information Disclosure</span></span>](../../../../docs/framework/wcf/feature-details/information-disclosure.md)
- [<span data-ttu-id="e38f3-196">権限の昇格</span><span class="sxs-lookup"><span data-stu-id="e38f3-196">Elevation of Privilege</span></span>](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)
- [<span data-ttu-id="e38f3-197">サービス拒否</span><span class="sxs-lookup"><span data-stu-id="e38f3-197">Denial of Service</span></span>](../../../../docs/framework/wcf/feature-details/denial-of-service.md)
- [<span data-ttu-id="e38f3-198">改変</span><span class="sxs-lookup"><span data-stu-id="e38f3-198">Tampering</span></span>](../../../../docs/framework/wcf/feature-details/tampering.md)
- [<span data-ttu-id="e38f3-199">リプレイ攻撃</span><span class="sxs-lookup"><span data-stu-id="e38f3-199">Replay Attacks</span></span>](../../../../docs/framework/wcf/feature-details/replay-attacks.md)
