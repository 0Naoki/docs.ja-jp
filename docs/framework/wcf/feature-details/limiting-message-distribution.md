---
title: "メッセージ配布の制限"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 8b5ec4b8-1ce9-45ef-bb90-2c840456bcc1
caps.latest.revision: "10"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: ab46b1c908e8eb61ea49315e120973f1ea381bc6
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/18/2017
---
# <a name="limiting-message-distribution"></a><span data-ttu-id="1a7cc-102">メッセージ配布の制限</span><span class="sxs-lookup"><span data-stu-id="1a7cc-102">Limiting Message Distribution</span></span>
<span data-ttu-id="1a7cc-103">ピア チャネルは仕様上はブロードキャスト メッシュです。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-103">Peer Channel is by design a broadcast mesh.</span></span> <span data-ttu-id="1a7cc-104">その基本的な大量転送モデルでは、メッシュの任意のメンバーが送信した各メッセージをそのメッシュの他のメンバー全員に配布します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-104">Its basic flooding model involves distributing each message sent by any member of a mesh to all other members of that mesh.</span></span> <span data-ttu-id="1a7cc-105">これは、1 人のメンバーが生成した各メッセージが他のメンバー全員に関係していて、役立つものであるような状況 (チャット ルームなど) に最適です。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-105">This is ideal in situations where every message generated by a member is relevant and useful to all other members (for example, a chat room).</span></span> <span data-ttu-id="1a7cc-106">ただし、多くのアプリケーションではメッセージの配布を制限する必要が生じることがあります。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-106">However, many applications have an occasional need for limiting message distribution.</span></span> <span data-ttu-id="1a7cc-107">たとえば、新しいメンバーがメッシュに参加し、メッシュを経由して送信された最新のメッセージを取得しようとする場合、この要求をメッシュのメンバー全員に転送する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-107">For example, if a new member joins a mesh and wants to retrieve the last message sent through the mesh, this request does not need to be flooded to every member of the mesh.</span></span> <span data-ttu-id="1a7cc-108">要求は近くの近隣ノードに制限できます。また、ローカルで生成されたメッセージをフィルターで除外することもできます。メッセージはメッシュの個別のノードに送信することもできます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-108">The request could be limited to near neighbors, or locally generated messages can be filtered out. Messages can also be sent to an individual node on the mesh.</span></span> <span data-ttu-id="1a7cc-109">このトピックでは、ホップ数、メッセージ伝達フィルター、ローカル フィルター、または直接接続を使用し、メッシュを経由してメッセージを転送する方法について説明し、1 つの方法を選択するための一般的なガイドラインを示します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-109">This topic discusses using Hop Count, a Message Propagation Filter, a local filter, or a direct connection to control how messages are forwarded throughout the mesh, and provides general guidelines for choosing an approach.</span></span>  
  
## <a name="hop-counts"></a><span data-ttu-id="1a7cc-110">ホップ数</span><span class="sxs-lookup"><span data-stu-id="1a7cc-110">Hop Counts</span></span>  
 <span data-ttu-id="1a7cc-111">`PeerHopCount` の概念は、IP プロトコルで使用される TTL (Time-To-Live) に似ています。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-111">The concept of `PeerHopCount` is similar to TTL (Time-To-Live) used in IP protocol.</span></span> <span data-ttu-id="1a7cc-112">`PeerHopCount` の値はメッセージのインスタンスに関連付けられ、メッセージを破棄するまでの転送回数を指定します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-112">The value of `PeerHopCount` is tied to a message instance, and it specifies how many times a message should be forwarded before being dropped.</span></span> <span data-ttu-id="1a7cc-113">ピア チャネル クライアントがメッセージを受信するたびに、クライアントはメッセージに `PeerHopCount` が指定されているかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-113">Each time a message is received by a Peer Channel client, the client examines the message to see if `PeerHopCount` is specified.</span></span> <span data-ttu-id="1a7cc-114">指定されている場合、クライアントはメッセージを近隣ノードに転送する前に、ホップ数の値を 1 つデクリメントします。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-114">If it is specified, then the client decrements the hop count value by one before forwarding the message to neighboring nodes.</span></span> <span data-ttu-id="1a7cc-115">クライアントがゼロのホップ数値を持つメッセージを受信した場合、そのメッセージは処理されますが、近隣ノードには転送されません。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-115">When a client receives a message with a hop count value of zero, the client processes the message, but does not forward the message to neighbors.</span></span>  
  
 <span data-ttu-id="1a7cc-116">ホップ数をメッセージに追加するには、メッセージ クラスの実装で、適切なプロパティまたはフィールドに `PeerHopCount` を属性として追加します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-116">Hop count may be added to a message by adding `PeerHopCount` as an attribute to the applicable property or field in the implementation of the message class.</span></span> <span data-ttu-id="1a7cc-117">この値は、メッセージをメッシュに送信する前に特定の値に設定できます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-117">You can set this to a specific value before sending the message to the mesh.</span></span> <span data-ttu-id="1a7cc-118">このように、ホップ数を使用するとメッシュを経由したメッセージの配布を必要に応じて制限し、不要なメッセージの重複を避けることができます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-118">In this manner, you can use hop count to limit distribution of messages throughout the mesh when necessary, potentially avoiding unnecessary message duplication.</span></span> <span data-ttu-id="1a7cc-119">これは、メッシュに大量の重複データが含まれている場合や、メッセージをすぐ隣の近隣ノードまたはいくつかのホップ内の近隣ノードに送信する場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-119">This is useful in cases where the mesh contains a high amount of redundant data, or for sending a message to immediate neighbors, or neighbors within a few hops.</span></span>  
  
-   <span data-ttu-id="1a7cc-120">コード スニペットと関連情報については、次を参照してください。、[ピア チャネルのブログ](http://go.microsoft.com/fwlink/?LinkID=114531)(http://go.microsoft.com/fwlink/?LinkID=114531)。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-120">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114531) (http://go.microsoft.com/fwlink/?LinkID=114531).</span></span>  
  
## <a name="message-propagation-filter"></a><span data-ttu-id="1a7cc-121">メッセージ伝達フィルター</span><span class="sxs-lookup"><span data-stu-id="1a7cc-121">Message Propagation Filter</span></span>  
 <span data-ttu-id="1a7cc-122">`MessagePropagationFilter` は、特にメッセージの内容や他の特定のシナリオによってメッセージを伝達するかどうかを決定する場合など、メッセージの大量転送の制御をカスタマイズするために使用できます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-122">`MessagePropagationFilter` can be used for customized control of message flooding, especially when the content of the message or other specific scenarios determine propagation.</span></span> <span data-ttu-id="1a7cc-123">このフィルターにより、ノードを通過する各メッセージを伝達するかどうかが決定されます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-123">The filter makes propagation decisions for every message that passes through the node.</span></span> <span data-ttu-id="1a7cc-124">これは、メッシュ内の他の場所から送信され、使用しているノードで受信したメッセージと、使用しているアプリケーションで作成したメッセージの両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-124">This is true for messages that originated elsewhere in the mesh that your node has received as well as messages created by your application.</span></span> <span data-ttu-id="1a7cc-125">フィルターはメッセージとその発信元の両方にアクセスできるため、利用できるすべての情報に基づいてメッセージを転送するか、破棄するかを決定します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-125">The filter has access to both the message and its origination, so decisions about forwarding or dropping the message can be based on the full information available.</span></span>  
  
 <span data-ttu-id="1a7cc-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> は、単一の関数 <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A> を持つ抽象基本クラスです。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-126"><xref:System.ServiceModel.PeerMessagePropagationFilter> is a base abstract class with a single function, <xref:System.ServiceModel.PeerMessagePropagationFilter.ShouldMessagePropagate%2A>.</span></span> <span data-ttu-id="1a7cc-127">メソッド呼び出しの最初の引数には、メッセージの完全なコピーを渡します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-127">The first argument of the method call passes in a full copy of the message.</span></span> <span data-ttu-id="1a7cc-128">このメッセージに対して行われた変更が実際のメッセージに影響することはありません。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-128">Any changes made to the message do not affect the actual message.</span></span> <span data-ttu-id="1a7cc-129">このメソッド呼び出しの最後の引数は、メッセージの送信元 (`PeerMessageOrigination.Local` または `PeerMessageOrigination.Remote`) を識別します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-129">The last argument of the method call identifies the origin of the message (`PeerMessageOrigination.Local` or `PeerMessageOrigination.Remote`).</span></span> <span data-ttu-id="1a7cc-130">このメソッドの具体的な実装は、メッセージの転送先 (ローカル アプリケーション (<xref:System.ServiceModel.PeerMessagePropagation>)、リモート クライアント (`Local`)、ローカル アプリケーションとリモート クライアントの両方 (`Remote`)、どちらにも転送しない (`LocalAndRemote`)) を示す `None` 列挙体から定数を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-130">Concrete implementations of this method must return a constant from the <xref:System.ServiceModel.PeerMessagePropagation> enumeration indicating that the message is to be forwarded to the local application (`Local`), forwarded to remote clients (`Remote`), both (`LocalAndRemote`), or neither (`None`).</span></span> <span data-ttu-id="1a7cc-131">このフィルターは、対応する `PeerNode` オブジェクトにアクセスし、`PeerNode.MessagePropagationFilter` プロパティで伝達フィルター派生クラスのインスタンスを指定することによって適用できます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-131">This filter can be applied by accessing the corresponding `PeerNode` object and specifying an instance of the derived propagation filter class in the `PeerNode.MessagePropagationFilter` property.</span></span> <span data-ttu-id="1a7cc-132">ピア チャネルを開く前に、伝達フィルターがアタッチされていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-132">Ensure that the propagation filter is attached before opening the Peer Channel.</span></span>  
  
-   <span data-ttu-id="1a7cc-133">コード スニペットと関連情報については、次を参照してください。、[ピア チャネルのブログ](http://go.microsoft.com/fwlink/?LinkID=114532)(http://go.microsoft.com/fwlink/?LinkID=114532)。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-133">For code snippets and related information, see the [Peer Channel blog](http://go.microsoft.com/fwlink/?LinkID=114532) (http://go.microsoft.com/fwlink/?LinkID=114532).</span></span>  
  
## <a name="contacting-an-individual-node-in-the-mesh"></a><span data-ttu-id="1a7cc-134">メッシュ内の個別ノードへのアクセス</span><span class="sxs-lookup"><span data-stu-id="1a7cc-134">Contacting an Individual Node in the Mesh</span></span>  
 <span data-ttu-id="1a7cc-135">メッシュ内の個別のノードには、ローカル フィルターを設定するか、直接接続を設定することでアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-135">An individual node in a mesh can be contacted by setting up a local filter, or by setting up a direct connection.</span></span>  
  
 <span data-ttu-id="1a7cc-136">メッシュ内の各ノードに個別の ID が割り当てられている場合は、メッセージの実装に宛先 ID を指定できます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-136">If the nodes in a mesh each have an individual ID, a destination ID can be specified in the implementation of your message.</span></span> <span data-ttu-id="1a7cc-137">ローカル フィルターを設定するには、指定した宛先 ID にノードの ID が一致する場合にのみメッセージを現在のノードに表示する関数をメッセージ コントラクト内に作成します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-137">A local filter can be set up by writing a function in your message contract that will only display the message to the current node if its ID matches the destination ID you specified.</span></span> <span data-ttu-id="1a7cc-138">メッセージはメッシュが転送するため、新しい接続を設定するオーバーヘッドが発生しません。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-138">The mesh transports the message, so the overhead of setting up a new connection does not have to be incurred.</span></span> <span data-ttu-id="1a7cc-139">ただし、メッセージはメッシュを経由して何度も送信されるため、効率が低下します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-139">However, there is a loss of efficiency since the message is sent many times throughout the mesh.</span></span> <span data-ttu-id="1a7cc-140">この方法は、メッセージのサイズが大きくなく、メッセージを頻繁に送信しない限り、メッシュの個別のメンバーにメッセージを送信する場合に適しています。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-140">This works well for sending messages to individual members of a mesh as long as the messages are neither too big nor too frequent.</span></span>  
  
 <span data-ttu-id="1a7cc-141">帯域幅の広い長時間の接続には、直接接続が適しています。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-141">For long-lasting, high-bandwidth connections, direct connections are preferable.</span></span> <span data-ttu-id="1a7cc-142">接続情報はメッシュを経由して送信でき、その後、メッセージを送受信するために選択した直接接続を設定できます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-142">You can send connection information over the mesh, and then set up a direct connection of your choosing to send/receive messages.</span></span>  
  
## <a name="choosing-an-approach-for-limiting-message-distribution"></a><span data-ttu-id="1a7cc-143">メッセージ配布の制限方法の選択</span><span class="sxs-lookup"><span data-stu-id="1a7cc-143">Choosing an Approach for Limiting Message Distribution</span></span>  
 <span data-ttu-id="1a7cc-144">メッセージの配布を制限する必要があるシナリオに遭遇した場合は、次の点を検討してください。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-144">When you discover a scenario in which you need to limit message distribution, ask yourself the following questions:</span></span>  
  
-   <span data-ttu-id="1a7cc-145">**ユーザー**メッセージを受信する必要がありますか。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-145">**Who** needs to receive the message?</span></span> <span data-ttu-id="1a7cc-146">1 つの近隣ノードのみか。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-146">Just one neighbor node?</span></span> <span data-ttu-id="1a7cc-147">メッシュ内の別の場所にあるノードか。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-147">A node somewhere else in the mesh?</span></span> <span data-ttu-id="1a7cc-148">メッシュ内の半分のノードか。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-148">Half the mesh?</span></span>  
  
-   <span data-ttu-id="1a7cc-149">**どのくらいの頻度**は、このメッセージを送信しますか?</span><span class="sxs-lookup"><span data-stu-id="1a7cc-149">**How often** will this message be sent?</span></span>  
  
-   <span data-ttu-id="1a7cc-150">どのような種類の**帯域幅**はこのメッセージを使用しますか?</span><span class="sxs-lookup"><span data-stu-id="1a7cc-150">What kind of **bandwidth** will this message use?</span></span>  
  
 <span data-ttu-id="1a7cc-151">これらの質問の回答は、ホップ数、メッセージ伝達フィルター、ローカル フィルター、直接接続のいずれを使用するかを決定するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-151">The answers to these questions can help you determine whether to use Hop Count, a Message Propagation Filter, a local filter, or a direct connection.</span></span> <span data-ttu-id="1a7cc-152">次の一般的なガイドラインを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-152">Consider the following general guidelines:</span></span>  
  
-   <span data-ttu-id="1a7cc-153">**誰が**</span><span class="sxs-lookup"><span data-stu-id="1a7cc-153">**Who**</span></span>  
  
    -   <span data-ttu-id="1a7cc-154">*個々 のノード*: ローカル フィルターまたは直接接続します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-154">*Individual node*:  Local filter or direct connection.</span></span>  
  
    -   <span data-ttu-id="1a7cc-155">*特定の領域内の近隣ノード*: PeerHopCount です。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-155">*Neighbors within a certain vicinity*:  PeerHopCount.</span></span>  
  
    -   <span data-ttu-id="1a7cc-156">*メッシュの複雑なサブセット*: MessagePropagationFilter です。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-156">*Complex subset of the mesh*:  MessagePropagationFilter.</span></span>  
  
-   <span data-ttu-id="1a7cc-157">**どのくらいの頻度**</span><span class="sxs-lookup"><span data-stu-id="1a7cc-157">**How often**</span></span>  
  
    -   <span data-ttu-id="1a7cc-158">*非常に高い頻度*: 直接接続、PeerHopCount、MessagePropagationFilter です。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-158">*Very frequent*:  Direct connection, PeerHopCount, MessagePropagationFilter.</span></span>  
  
    -   <span data-ttu-id="1a7cc-159">*不定期*: ローカル フィルター。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-159">*Occasional*:  Local filter.</span></span>  
  
-   <span data-ttu-id="1a7cc-160">**帯域幅の使用**</span><span class="sxs-lookup"><span data-stu-id="1a7cc-160">**Bandwidth use**</span></span>  
  
    -   <span data-ttu-id="1a7cc-161">*高*: 直接接続、小さい MessagePropagationFilter またはローカル フィルターを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-161">*High*:  Direct connection, less advisable to use MessagePropagationFilter or local filter.</span></span>  
  
    -   <span data-ttu-id="1a7cc-162">*低*: 必要な可能性があります、直接接続します。</span><span class="sxs-lookup"><span data-stu-id="1a7cc-162">*Low*:  Any, direct connection probably not needed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1a7cc-163">関連項目</span><span class="sxs-lookup"><span data-stu-id="1a7cc-163">See Also</span></span>  
 [<span data-ttu-id="1a7cc-164">ピア チャネル アプリケーションの構築</span><span class="sxs-lookup"><span data-stu-id="1a7cc-164">Building a Peer Channel Application</span></span>](../../../../docs/framework/wcf/feature-details/building-a-peer-channel-application.md)
