---
title: 'チュートリアル: Win32 での WPF コンテンツのホスト'
ms.date: 03/30/2017
dev_langs:
- cpp
helpviewer_keywords:
- hosting WPF content in Win32 window [WPF]
ms.assetid: 38ce284a-4303-46dd-b699-c9365b22a7dc
ms.openlocfilehash: 3396604d94b2b0fb3f4a178d3bb3a25b00ef91ac
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2019
ms.locfileid: "59166648"
---
# <a name="walkthrough-hosting-wpf-content-in-win32"></a><span data-ttu-id="aedde-102">チュートリアル: Win32 での WPF コンテンツのホスト</span><span class="sxs-lookup"><span data-stu-id="aedde-102">Walkthrough: Hosting WPF Content in Win32</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] <span data-ttu-id="aedde-103">アプリケーションを作成するための豊富な環境を提供します。</span><span class="sxs-lookup"><span data-stu-id="aedde-103">provides a rich environment for creating applications.</span></span> <span data-ttu-id="aedde-104">ただし、[!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] コードにかなりの投資がある場合は、元のコードを書き換えるより、アプリケーションに [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] の機能を追加するほうがより効果的であることがあります。</span><span class="sxs-lookup"><span data-stu-id="aedde-104">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to add [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] functionality to your application rather than rewriting your original code.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="aedde-105">ホストするための簡単なメカニズムを提供します。[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]でコンテンツを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="aedde-105">provides a straightforward mechanism for hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span>  
  
 <span data-ttu-id="aedde-106">このチュートリアルは、サンプル アプリケーションを記述する方法を説明します[Win32 ウィンドウのサンプルで WPF コンテンツをホストしている](https://go.microsoft.com/fwlink/?LinkID=160004)、そのホスト[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]でコンテンツを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="aedde-106">This tutorial describes how to write a sample application, [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004), that hosts [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="aedde-107">このサンプルを拡張すると、いずれの [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] ウィンドウでもホストできます。</span><span class="sxs-lookup"><span data-stu-id="aedde-107">You can extend this sample to host any [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="aedde-108">マネージド コードとアンマネージド コードの混在が関係しているため、このアプリケーションは [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] で記述されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-108">Because it involves mixing managed and unmanaged code, the application is written in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span>  

<a name="requirements"></a>   
## <a name="requirements"></a><span data-ttu-id="aedde-109">必要条件</span><span class="sxs-lookup"><span data-stu-id="aedde-109">Requirements</span></span>  
 <span data-ttu-id="aedde-110">このチュートリアルは、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] と [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] プログラミングの基礎知識があることを前提としています。</span><span class="sxs-lookup"><span data-stu-id="aedde-110">This tutorial assumes a basic familiarity with both [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming.</span></span> <span data-ttu-id="aedde-111">基本的な事柄[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]プログラミングを参照してください[Getting Started](../getting-started/index.md)します。</span><span class="sxs-lookup"><span data-stu-id="aedde-111">For a basic introduction to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming, see [Getting Started](../getting-started/index.md).</span></span> <span data-ttu-id="aedde-112">概要については[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]プログラミングでは、参照すること、この主題に関する数多くの書籍の特に*プログラミング Windows* Charles Petzold 著。</span><span class="sxs-lookup"><span data-stu-id="aedde-112">For an introduction to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming, you should reference any of the numerous books on the subject, in particular *Programming Windows* by Charles Petzold.</span></span>  
  
 <span data-ttu-id="aedde-113">このチュートリアルに付属するサンプルがで実装されているため[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]、このチュートリアルの使用に関する知識を前提としています[!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)]プログラムに、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)]マネージ コード プログラミングの理解。</span><span class="sxs-lookup"><span data-stu-id="aedde-113">Because the sample that accompanies this tutorial is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], this tutorial assumes familiarity with the use of [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] to program the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] plus an understanding of managed code programming.</span></span> <span data-ttu-id="aedde-114">[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] の知識があることは、役立ちますが、必須ではありません。</span><span class="sxs-lookup"><span data-stu-id="aedde-114">Familiarity with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] is helpful but not essential.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="aedde-115">このチュートリアルには、関連するサンプルからのコード例が多数含まれています。</span><span class="sxs-lookup"><span data-stu-id="aedde-115">This tutorial includes a number of code examples from the associated sample.</span></span> <span data-ttu-id="aedde-116">しかし、読みやすくするため、完全なサンプル コードは含まれていません。</span><span class="sxs-lookup"><span data-stu-id="aedde-116">However, for readability, it does not include the complete sample code.</span></span> <span data-ttu-id="aedde-117">完全なサンプル コードで、次を参照してください。 [Win32 ウィンドウのサンプルで WPF のコンテンツをホストしている](https://go.microsoft.com/fwlink/?LinkID=160004)します。</span><span class="sxs-lookup"><span data-stu-id="aedde-117">For the complete sample code, see [Hosting WPF Content in a Win32 Window Sample](https://go.microsoft.com/fwlink/?LinkID=160004).</span></span>  
  
<a name="basic_procedure"></a>   
## <a name="the-basic-procedure"></a><span data-ttu-id="aedde-118">基本手順</span><span class="sxs-lookup"><span data-stu-id="aedde-118">The Basic Procedure</span></span>  
 <span data-ttu-id="aedde-119">このセクションで説明を使用する基本手順ホスト[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]でコンテンツを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="aedde-119">This section outlines the basic procedure you use to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="aedde-120">残りのセクションでは、各手順の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="aedde-120">The remaining sections explain the details of each step.</span></span>  
  
 <span data-ttu-id="aedde-121">ホストする鍵[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]でコンテンツを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ウィンドウは、<xref:System.Windows.Interop.HwndSource>クラス。</span><span class="sxs-lookup"><span data-stu-id="aedde-121">The key to hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="aedde-122">このクラスは、ラップ、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]でコンテンツを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]に組み込むことができるように、ウィンドウ、[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]子ウィンドウとして。</span><span class="sxs-lookup"><span data-stu-id="aedde-122">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, allowing it to be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="aedde-123">次の方法では、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] および [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] を単一のアプリケーションに統合します。</span><span class="sxs-lookup"><span data-stu-id="aedde-123">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1.  <span data-ttu-id="aedde-124">実装、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]マネージ クラスとしてコンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-124">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a managed class.</span></span>  
  
2.  <span data-ttu-id="aedde-125">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] アプリケーションを [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] で実装します。</span><span class="sxs-lookup"><span data-stu-id="aedde-125">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="aedde-126">既存のアプリケーションとアンマネージドの [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] コードで使用を開始する場合、通常は、プロジェクトの設定を `/clr` コンパイラ フラグを含めるように変更して、マネージド コードを呼び出せるようにします。</span><span class="sxs-lookup"><span data-stu-id="aedde-126">If you are starting with an existing application and unmanaged [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] code, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag.</span></span>  
  
3.  <span data-ttu-id="aedde-127">スレッド処理モデルをシングル スレッド アパートメント (STA: Single Threaded Apartment) に設定します。</span><span class="sxs-lookup"><span data-stu-id="aedde-127">Set the threading model to single-threaded apartment (STA).</span></span>  
  
4.  <span data-ttu-id="aedde-128">処理、 [WM_CREATE](/windows/desktop/winmsg/wm-create)ウィンドウ プロシージャと次の操作で通知します。</span><span class="sxs-lookup"><span data-stu-id="aedde-128">Handle the [WM_CREATE](/windows/desktop/winmsg/wm-create)notification in your window procedure and do the following:</span></span>  
  
    1.  <span data-ttu-id="aedde-129">新しい <xref:System.Windows.Interop.HwndSource> オブジェクトを、親ウィンドウがその `parent` パラメーターとなるように指定して作成します。</span><span class="sxs-lookup"><span data-stu-id="aedde-129">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window as its `parent` parameter.</span></span>  
  
    2.  <span data-ttu-id="aedde-130">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="aedde-130">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3.  <span data-ttu-id="aedde-131">参照を割り当てる、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ オブジェクト、<xref:System.Windows.Interop.HwndSource.RootVisual%2A>のプロパティ、<xref:System.Windows.Interop.HwndSource>します。</span><span class="sxs-lookup"><span data-stu-id="aedde-131">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>  
  
    4.  <span data-ttu-id="aedde-132">コンテンツの HWND を取得します。</span><span class="sxs-lookup"><span data-stu-id="aedde-132">Get the HWND for the content.</span></span> <span data-ttu-id="aedde-133"><xref:System.Windows.Interop.HwndSource.Handle%2A> オブジェクトの <xref:System.Windows.Interop.HwndSource> プロパティにウィンドウ ハンドル (HWND) が格納されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-133">The <xref:System.Windows.Interop.HwndSource.Handle%2A> property of the <xref:System.Windows.Interop.HwndSource> object contains the window handle (HWND).</span></span> <span data-ttu-id="aedde-134">アプリケーションのアンマネージ部分で使用できる HWND を取得するには、`Handle.ToPointer()` を HWND にキャストします。</span><span class="sxs-lookup"><span data-stu-id="aedde-134">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
5.  <span data-ttu-id="aedde-135">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツへの参照を保持する静的フィールドを含むマネージド クラスを実装します。</span><span class="sxs-lookup"><span data-stu-id="aedde-135">Implement a managed class that contains a static field to hold a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-136">このクラスを使用すると、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コードから [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コンテンツへの参照を取得できるようになります。</span><span class="sxs-lookup"><span data-stu-id="aedde-136">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
6.  <span data-ttu-id="aedde-137">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツを静的フィールドに割り当てます。</span><span class="sxs-lookup"><span data-stu-id="aedde-137">Assign the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the static field.</span></span>  
  
7.  <span data-ttu-id="aedde-138">通知を受信、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツを 1 つまたは複数のハンドラーをアタッチすることにより、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]イベント。</span><span class="sxs-lookup"><span data-stu-id="aedde-138">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events.</span></span>  
  
8.  <span data-ttu-id="aedde-139">静的フィールドに格納した参照を使用して [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツと通信し、プロパティの設定などを行います。</span><span class="sxs-lookup"><span data-stu-id="aedde-139">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by using the reference that you stored in the static field to set properties, and so on.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="aedde-140">使用することも[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]実装するために、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-140">You can also use [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] to implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-141">ただし、このコンテンツは [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] として別にコンパイルしてから、その [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] に [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] アプリケーションから参照する必要があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-141">However, you will have to compile it separately as a [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] and reference that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="aedde-142">手順の残りの部分は、前述の手順と同様です。</span><span class="sxs-lookup"><span data-stu-id="aedde-142">The remainder of the procedure is similar to that outlined above.</span></span>

<a name="implementing_the_application"></a>
## <a name="implementing-the-host-application"></a><span data-ttu-id="aedde-143">ホスト アプリケーションの実装</span><span class="sxs-lookup"><span data-stu-id="aedde-143">Implementing the Host Application</span></span>
 <span data-ttu-id="aedde-144">このセクションの説明をホストする方法[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]で基本的なコンテンツ[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="aedde-144">This section describes how to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="aedde-145">コンテンツ自体は、マネージド クラスとして [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] に実装されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-145">The content itself is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] as a managed class.</span></span> <span data-ttu-id="aedde-146">ほとんどの部分が、簡単な [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] のプログラミングです。</span><span class="sxs-lookup"><span data-stu-id="aedde-146">For the most part, it is straightforward [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming.</span></span> <span data-ttu-id="aedde-147">コンテンツの実装の重要な側面は、後ほど[WPF コンテンツを実装する](#implementing_the_wpf_page)します。</span><span class="sxs-lookup"><span data-stu-id="aedde-147">The key aspects of the content implementation are discussed in [Implementing the WPF Content](#implementing_the_wpf_page).</span></span>

<a name="autoNestedSectionsOUTLINE1"></a>
-   [<span data-ttu-id="aedde-148">基本的なアプリケーション</span><span class="sxs-lookup"><span data-stu-id="aedde-148">The Basic Application</span></span>](#the_basic_application)

-   [<span data-ttu-id="aedde-149">WPF コンテンツのホスティング</span><span class="sxs-lookup"><span data-stu-id="aedde-149">Hosting the WPF Content</span></span>](#hosting_the_wpf_page)

-   [<span data-ttu-id="aedde-150">WPF コンテンツへの参照の保持</span><span class="sxs-lookup"><span data-stu-id="aedde-150">Holding a Reference to the WPF Content</span></span>](#holding_a_reference)

-   [<span data-ttu-id="aedde-151">WPF コンテンツとの通信</span><span class="sxs-lookup"><span data-stu-id="aedde-151">Communicating with the WPF Content</span></span>](#communicating_with_the_page)

<a name="the_basic_application"></a>
### <a name="the-basic-application"></a><span data-ttu-id="aedde-152">基本的なアプリケーション</span><span class="sxs-lookup"><span data-stu-id="aedde-152">The Basic Application</span></span>
 <span data-ttu-id="aedde-153">ホスト アプリケーションの開始点は、Visual Studio 2005 テンプレートを作成しました。</span><span class="sxs-lookup"><span data-stu-id="aedde-153">The starting point for the host application was to create a Visual Studio 2005 template.</span></span>

1.  <span data-ttu-id="aedde-154">Visual Studio 2005 を開き、選択**新しいプロジェクト**から、**ファイル**メニュー。</span><span class="sxs-lookup"><span data-stu-id="aedde-154">Open Visual Studio 2005, and select **New Project** from the **File** menu.</span></span>

2.  <span data-ttu-id="aedde-155">選択**Win32**の一覧から[!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)]プロジェクトの種類。</span><span class="sxs-lookup"><span data-stu-id="aedde-155">Select **Win32** from the list of [!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)] project types.</span></span> <span data-ttu-id="aedde-156">既定の言語がない場合[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]、これらのプロジェクト タイプの下に表示されます**他の言語**します。</span><span class="sxs-lookup"><span data-stu-id="aedde-156">If your default language is not [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], you will find these project types under **Other Languages**.</span></span>

3.  <span data-ttu-id="aedde-157">選択、 **Win32 プロジェクト**テンプレート、プロジェクトに名前を割り当てるし、をクリックして**OK**を起動する、 **Win32 アプリケーション ウィザード**。</span><span class="sxs-lookup"><span data-stu-id="aedde-157">Select a **Win32 Project** template, assign a name to the project and click **OK** to launch the **Win32 Application Wizard**.</span></span>

4.  <span data-ttu-id="aedde-158">ウィザードの既定の設定をそのまま使用し、をクリックして**完了**プロジェクトを開始します。</span><span class="sxs-lookup"><span data-stu-id="aedde-158">Accept the wizard's default settings and click **Finish** to start the project.</span></span>

 <span data-ttu-id="aedde-159">このテンプレートは、次のような基本的な [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="aedde-159">The template creates a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application, including:</span></span>

-   <span data-ttu-id="aedde-160">アプリケーションのエントリ ポイント。</span><span class="sxs-lookup"><span data-stu-id="aedde-160">An entry point for the application.</span></span>

-   <span data-ttu-id="aedde-161">関連するウィンドウ プロシージャ (WndProc) を含むウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="aedde-161">A window, with an associated window procedure (WndProc).</span></span>

-   <span data-ttu-id="aedde-162">持つメニュー**ファイル**と**ヘルプ**見出し。</span><span class="sxs-lookup"><span data-stu-id="aedde-162">A menu with **File** and **Help** headings.</span></span> <span data-ttu-id="aedde-163">**ファイル**メニューがあります、**終了**項目をアプリケーションを閉じます。</span><span class="sxs-lookup"><span data-stu-id="aedde-163">The **File** menu has an **Exit** item that closes the application.</span></span> <span data-ttu-id="aedde-164">**ヘルプ**メニューがあります、**について**簡単なダイアログ ボックスを起動する項目。</span><span class="sxs-lookup"><span data-stu-id="aedde-164">The **Help** menu has an **About** item that launches a simple dialog box.</span></span>

 <span data-ttu-id="aedde-165">ホストにコードを記述する前に、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ、する必要がある 2 つの基本的なテンプレートを変更します。</span><span class="sxs-lookup"><span data-stu-id="aedde-165">Before you start writing code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, you need to make two modifications to the basic template.</span></span>

 <span data-ttu-id="aedde-166">1 つ目は、プロジェクトをマネージド コードとしてコンパイルすることです。</span><span class="sxs-lookup"><span data-stu-id="aedde-166">The first is to compile the project as managed code.</span></span> <span data-ttu-id="aedde-167">既定では、プロジェクトはアンマネージ コードとしてコンパイルされます。</span><span class="sxs-lookup"><span data-stu-id="aedde-167">By default, the project compiles as unmanaged code.</span></span> <span data-ttu-id="aedde-168">ただし、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] はマネージド コードで実装されているため、プロジェクトは状況に応じてコンパイルする必要があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-168">However, because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is implemented in managed code, the project must be compiled accordingly.</span></span>

1.  <span data-ttu-id="aedde-169">プロジェクト名を右クリックして**ソリューション エクスプ ローラー**選択**プロパティ**を起動するコンテキスト メニューから、**プロパティ ページ** ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="aedde-169">Right-click the project name in **Solution Explorer** and select **Properties** from the context menu to launch the **Property Pages** dialog box.</span></span>

2.  <span data-ttu-id="aedde-170">選択**構成プロパティ**左側のウィンドウで、ツリー ビューから。</span><span class="sxs-lookup"><span data-stu-id="aedde-170">Select **Configuration Properties** from the tree view in the left pane.</span></span>

3.  <span data-ttu-id="aedde-171">選択**共通言語ランタイム**からサポート、**プロジェクトの既定値**右側のウィンドウの一覧。</span><span class="sxs-lookup"><span data-stu-id="aedde-171">Select **Common Language Runtime** support from the **Project Defaults** list in the right pane.</span></span>

4.  <span data-ttu-id="aedde-172">選択**共通言語ランタイム サポート (/clr)** ドロップダウン リスト ボックスから。</span><span class="sxs-lookup"><span data-stu-id="aedde-172">Select **Common Language Runtime Support (/clr)** from the drop-down list box.</span></span>

> [!NOTE]
>  <span data-ttu-id="aedde-173">このコンパイラ フラグを使用すると、アプリケーションでマネージド コードを使用できますが、アンマネージド コードは以前と同様にコンパイルされます。</span><span class="sxs-lookup"><span data-stu-id="aedde-173">This compiler flag allows you to use managed code in your application, but your unmanaged code will still compile as before.</span></span>

 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <span data-ttu-id="aedde-174">シングル スレッド アパートメント (STA) スレッド モデルを使用します。</span><span class="sxs-lookup"><span data-stu-id="aedde-174">uses the single-threaded apartment (STA) threading model.</span></span> <span data-ttu-id="aedde-175">正しく動作するために、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ コードは、する必要があります設定するアプリケーションのスレッド モデルを STA にエントリ ポイントに属性を適用しています。</span><span class="sxs-lookup"><span data-stu-id="aedde-175">In order to work properly with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content code, you must set the application's threading model to STA by applying an attribute to the entry point.</span></span>

 [!code-cpp[Win32HostingWPFPage#WinMain](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#winmain)]

<a name="hosting_the_wpf_page"></a>
### <a name="hosting-the-wpf-content"></a><span data-ttu-id="aedde-176">WPF コンテンツのホスティング</span><span class="sxs-lookup"><span data-stu-id="aedde-176">Hosting the WPF Content</span></span>
 <span data-ttu-id="aedde-177">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツは、単純なアドレス入力アプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="aedde-177">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is a simple address entry application.</span></span> <span data-ttu-id="aedde-178">それは、ユーザー名やアドレスなどを取得する複数の <xref:System.Windows.Controls.TextBox> コントロールで構成されています。</span><span class="sxs-lookup"><span data-stu-id="aedde-178">It consists of several <xref:System.Windows.Controls.TextBox> controls to take user name, address, and so on.</span></span> <span data-ttu-id="aedde-179">2 つあります<xref:System.Windows.Controls.Button>コントロール、 **OK**と**キャンセル**します。</span><span class="sxs-lookup"><span data-stu-id="aedde-179">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**.</span></span> <span data-ttu-id="aedde-180">ユーザーがクリックすると **[ok]**、ボタンの<xref:System.Windows.Controls.Primitives.ButtonBase.Click>からデータを収集するイベント ハンドラー、<xref:System.Windows.Controls.TextBox>を制御に対応するプロパティは、代入、およびカスタム イベントを発生させます`OnButtonClicked`します。</span><span class="sxs-lookup"><span data-stu-id="aedde-180">When the user clicks **OK**, the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler collects the data from the <xref:System.Windows.Controls.TextBox> controls, assigns it to corresponding properties, and raises a custom event, `OnButtonClicked`.</span></span> <span data-ttu-id="aedde-181">ユーザーがクリックすると**キャンセル**、ハンドラーが発生させるだけです`OnButtonClicked`します。</span><span class="sxs-lookup"><span data-stu-id="aedde-181">When the user clicks **Cancel**, the handler simply raises `OnButtonClicked`.</span></span> <span data-ttu-id="aedde-182">`OnButtonClicked` のイベント引数オブジェクトには、どのボタンをクリックしたかを示すブール型フィールドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="aedde-182">The event argument object for `OnButtonClicked` contains a Boolean field that indicates which button was clicked.</span></span>

 <span data-ttu-id="aedde-183">ホストするコード、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]のハンドラーでコンテンツが実装されている、 [WM_CREATE](/windows/desktop/winmsg/wm-create)ホスト ウィンドウに通知します。</span><span class="sxs-lookup"><span data-stu-id="aedde-183">The code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in a handler for the [WM_CREATE](/windows/desktop/winmsg/wm-create) notification on the host window.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCreate](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcreate)]

 <span data-ttu-id="aedde-184">`GetHwnd`メソッドのサイズと位置情報および親ウィンドウ ハンドルを受け取るし、ホスト型のウィンドウ ハンドルを返します[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-184">The `GetHwnd` method takes size and position information plus the parent window handle and returns the window handle of the hosted [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

> [!NOTE]
>  <span data-ttu-id="aedde-185">`#using` 名前空間に `System::Windows::Interop` ディレクティブを使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="aedde-185">You cannot use a `#using` directive for the `System::Windows::Interop` namespace.</span></span> <span data-ttu-id="aedde-186">使用すると、その名前空間の <xref:System.Windows.Interop.MSG> 構造体と winuser.h で宣言した MSG 構造体の間で名前の競合が発生します。</span><span class="sxs-lookup"><span data-stu-id="aedde-186">Doing so creates a name collision between the <xref:System.Windows.Interop.MSG> structure in that namespace and the MSG structure declared in winuser.h.</span></span> <span data-ttu-id="aedde-187">代わりに、その名前空間のコンテンツにアクセスするための完全修飾名を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-187">You must instead use fully-qualified names to access the contents of that namespace.</span></span>

 [!code-cpp[Win32HostingWPFPage#GetHwnd](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#gethwnd)]

 <span data-ttu-id="aedde-188">ホストすることはできません、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツを直接アプリケーション ウィンドウ。</span><span class="sxs-lookup"><span data-stu-id="aedde-188">You cannot host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content directly in your application window.</span></span> <span data-ttu-id="aedde-189">代わりに、まず <xref:System.Windows.Interop.HwndSource> コンテンツをラップするための [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="aedde-189">Instead, you first create an <xref:System.Windows.Interop.HwndSource> object to wrap the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-190">このオブジェクトをホストするように設計されたウィンドウで、基本的に、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-190">This object is basically a window that is designed to host a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-191">ホストする、<xref:System.Windows.Interop.HwndSource>親ウィンドウの子として作成することでオブジェクトを[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ウィンドウは、アプリケーションの一部であります。</span><span class="sxs-lookup"><span data-stu-id="aedde-191">You host the <xref:System.Windows.Interop.HwndSource> object in the parent window by creating it as a child of a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window that is part of your application.</span></span> <span data-ttu-id="aedde-192"><xref:System.Windows.Interop.HwndSource> コンストラクターのパラメーターには、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] の子ウィンドウの作成時に CreateWindow に渡される情報とほとんど同じ情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="aedde-192">The <xref:System.Windows.Interop.HwndSource> constructor parameters contain much the same information that you would pass to CreateWindow when you create a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] child window.</span></span>

 <span data-ttu-id="aedde-193">次のインスタンスを作成、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="aedde-193">You next create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="aedde-194">この場合は、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツは、`WPFPage` を使用して、別のクラス [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] として実装されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-194">In this case, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented as a separate class, `WPFPage`, using [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="aedde-195">さらに、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツを [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] で実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="aedde-195">You could also implement the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content with [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="aedde-196">ただし、これを行うにする必要がある別のプロジェクトを設定して、ビルド、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツとして、[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]します。</span><span class="sxs-lookup"><span data-stu-id="aedde-196">However, to do so you need to set up a separate project and build the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)].</span></span> <span data-ttu-id="aedde-197">プロジェクトにその [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] への参照を追加し、その参照を使用して [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="aedde-197">You can add a reference to that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] to your project, and use that reference to create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>

 <span data-ttu-id="aedde-198">表示する、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツへの参照を割り当てることで、子ウィンドウに、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツを<xref:System.Windows.Interop.HwndSource.RootVisual%2A>のプロパティ、<xref:System.Windows.Interop.HwndSource>します。</span><span class="sxs-lookup"><span data-stu-id="aedde-198">You display the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in your child window by assigning a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>

 <span data-ttu-id="aedde-199">次のコード行は、イベント ハンドラー `WPFButtonClicked` を [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツの `OnButtonClicked` イベントにアタッチしています。</span><span class="sxs-lookup"><span data-stu-id="aedde-199">The next line of code attaches an event handler, `WPFButtonClicked`, to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content `OnButtonClicked` event.</span></span> <span data-ttu-id="aedde-200">ユーザーがクリックしたときに、このハンドラーが呼び出されます、 **OK**または**キャンセル**ボタン。</span><span class="sxs-lookup"><span data-stu-id="aedde-200">This handler is called when the user clicks the **OK** or **Cancel** button.</span></span> <span data-ttu-id="aedde-201">参照してください[communicating_with_the_WPF コンテンツ](#communicating_with_the_page)このイベント ハンドラーの詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="aedde-201">See [communicating_with_the_WPF content](#communicating_with_the_page) for further discussion of this event handler.</span></span>

 <span data-ttu-id="aedde-202">示されているコードの最後の行は、<xref:System.Windows.Interop.HwndSource> オブジェクトに関連付けられているウィンドウ ハンドル (HWND) を返します。</span><span class="sxs-lookup"><span data-stu-id="aedde-202">The final line of code shown returns the window handle (HWND) that is associated with the <xref:System.Windows.Interop.HwndSource> object.</span></span> <span data-ttu-id="aedde-203">このハンドルは、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コードから使用してホストされたウィンドウにメッセージを送信することができます。ただし、サンプルではこれはできません。</span><span class="sxs-lookup"><span data-stu-id="aedde-203">You can use this handle from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code to send messages to the hosted window, although the sample does not do so.</span></span> <span data-ttu-id="aedde-204"><xref:System.Windows.Interop.HwndSource> オブジェクトは、メッセージを受信するたびにイベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="aedde-204">The <xref:System.Windows.Interop.HwndSource> object raises an event every time it receives a message.</span></span> <span data-ttu-id="aedde-205">メッセージを処理するには、<xref:System.Windows.Interop.HwndSource.AddHook%2A> メソッドを呼び出してメッセージ ハンドラーをアタッチしてから、そのハンドラーでメッセージを処理します。</span><span class="sxs-lookup"><span data-stu-id="aedde-205">To process the messages, call the <xref:System.Windows.Interop.HwndSource.AddHook%2A> method to attach a message handler and then process the messages in that handler.</span></span>

<a name="holding_a_reference"></a>
### <a name="holding-a-reference-to-the-wpf-content"></a><span data-ttu-id="aedde-206">WPF コンテンツへの参照の保持</span><span class="sxs-lookup"><span data-stu-id="aedde-206">Holding a Reference to the WPF Content</span></span>
 <span data-ttu-id="aedde-207">多くのアプリケーションでは、後で [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツと通信することができます。</span><span class="sxs-lookup"><span data-stu-id="aedde-207">For many applications, you will want to communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content later.</span></span> <span data-ttu-id="aedde-208">たとえば、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツのプロパティを変更したり、場合によっては <xref:System.Windows.Interop.HwndSource> オブジェクトが異なる [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツをホストするようにしたりできます。</span><span class="sxs-lookup"><span data-stu-id="aedde-208">For example, you might want to modify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, or perhaps have the <xref:System.Windows.Interop.HwndSource> object host different [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-209">そのためには、<xref:System.Windows.Interop.HwndSource> オブジェクトまたは [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツへの参照が必要です。</span><span class="sxs-lookup"><span data-stu-id="aedde-209">To do this, you need a reference to the <xref:System.Windows.Interop.HwndSource> object or the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-210"><xref:System.Windows.Interop.HwndSource> オブジェクトと関連する [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツは、ウィンドウ ハンドルを破棄するまでメモリに残ります。</span><span class="sxs-lookup"><span data-stu-id="aedde-210">The <xref:System.Windows.Interop.HwndSource> object and its associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content remain in memory until you destroy the window handle.</span></span> <span data-ttu-id="aedde-211">ただし、<xref:System.Windows.Interop.HwndSource> オブジェクトに割り当てる変数は、ウィンドウ プロシージャから戻ると同時にスコープの外に出ます。</span><span class="sxs-lookup"><span data-stu-id="aedde-211">However, the variable you assign to the <xref:System.Windows.Interop.HwndSource> object will go out of scope as soon as you return from the window procedure.</span></span> <span data-ttu-id="aedde-212">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] アプリケーションでこの問題を処理するためによく使用される方法は、静的変数またはグローバル変数を使用することです。</span><span class="sxs-lookup"><span data-stu-id="aedde-212">The customary way to handle this issue with [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications is to use a static or global variable.</span></span> <span data-ttu-id="aedde-213">残念ながら、このような変数の種類に対してマネージド オブジェクトを割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="aedde-213">Unfortunately, you cannot assign a managed object to those types of variables.</span></span> <span data-ttu-id="aedde-214"><xref:System.Windows.Interop.HwndSource> オブジェクトに関連付けられているウィンドウ ハンドルを、グローバル変数または静的変数に割り当てることができますが、オブジェクト自体にアクセスすることはできません。</span><span class="sxs-lookup"><span data-stu-id="aedde-214">You can assign the window handle associated with <xref:System.Windows.Interop.HwndSource> object to a global or static variable, but that doe not provide access to the object itself.</span></span>

 <span data-ttu-id="aedde-215">この問題の最も簡単な解決法は、静的フィールドのセットを含むマネージド クラスを実装して、アクセスが必要なすべてのマネージド オブジェクトへの参照を保持することです。</span><span class="sxs-lookup"><span data-stu-id="aedde-215">The simplest solution to this issue is to implement a managed class that contains a set of static fields to hold references to any managed objects that you need access to.</span></span> <span data-ttu-id="aedde-216">サンプルでは、`WPFPageHost` クラスを使用して、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツへの参照、および後でユーザーが変更する可能性があるプロパティの数の初期値を保持します。</span><span class="sxs-lookup"><span data-stu-id="aedde-216">The sample uses the `WPFPageHost` class to hold a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, plus the initial values of a number of its properties that might be changed later by the user.</span></span> <span data-ttu-id="aedde-217">これは、ヘッダーで定義します。</span><span class="sxs-lookup"><span data-stu-id="aedde-217">This is defined in the header.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageHost](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.h#wpfpagehost)]

 <span data-ttu-id="aedde-218">`GetHwnd` 関数の後半部分では、後に、`myPage` がスコープ内にある間に使用するため、対象のフィールドに値を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="aedde-218">The latter part of the `GetHwnd` function assigns values to those fields for later use while `myPage` is still in scope.</span></span>

<a name="communicating_with_the_page"></a>
### <a name="communicating-with-the-wpf-content"></a><span data-ttu-id="aedde-219">WPF コンテンツとの通信</span><span class="sxs-lookup"><span data-stu-id="aedde-219">Communicating with the WPF Content</span></span>
 <span data-ttu-id="aedde-220">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツとの通信には次の 2 種類があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-220">There are two types of communication with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-221">アプリケーションから情報を受信する、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ、ユーザーがクリックしたときに、 **OK**または**キャンセル**ボタン。</span><span class="sxs-lookup"><span data-stu-id="aedde-221">The application receives information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content when the user clicks the **OK** or **Cancel** buttons.</span></span> <span data-ttu-id="aedde-222">アプリケーションには、背景色や既定のフォント サイズなどのさまざまな [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] コンテンツのプロパティをユーザーが変更できるようにする [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-222">The application also has a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that allows the user to change various [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, such as the background color or default font size.</span></span>

 <span data-ttu-id="aedde-223">前述のように、ユーザーがいずれかのボタンをクリックすると、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツは `OnButtonClicked` イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="aedde-223">As mentioned above, when the user clicks either button the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content raises an `OnButtonClicked` event.</span></span> <span data-ttu-id="aedde-224">アプリケーションは、これらの通知を受信するため、このイベントにハンドラーをアタッチします。</span><span class="sxs-lookup"><span data-stu-id="aedde-224">The application attaches a handler to this event to receive these notifications.</span></span> <span data-ttu-id="aedde-225">場合、 **OK**ボタンがクリックされた、ハンドラーからのユーザー情報を取得する、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツし、一連の静的コントロールで表示されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-225">If the **OK** button was clicked, the handler gets the user information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content and displays it in a set of static controls.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wpfbuttonclicked)]

 <span data-ttu-id="aedde-226">ハンドラーは、カスタム イベント引数オブジェクトを [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] のコンテンツ、`MyPageEventArgs` から受信します。</span><span class="sxs-lookup"><span data-stu-id="aedde-226">The handler receives a custom event argument object from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, `MyPageEventArgs`.</span></span> <span data-ttu-id="aedde-227">オブジェクトの`IsOK`プロパティに設定されて`true`場合、 **OK**ボタンがクリックされたと`false`場合、**キャンセル**ボタンがクリックされました。</span><span class="sxs-lookup"><span data-stu-id="aedde-227">The object's `IsOK` property is set to `true` if the **OK** button was clicked, and `false` if the **Cancel** button was clicked.</span></span>

 <span data-ttu-id="aedde-228">場合、 **OK**ボタンがクリックされた、ハンドラーへの参照を取得する、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテナー クラスからのコンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-228">If the **OK** button was clicked, the handler gets a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from the container class.</span></span> <span data-ttu-id="aedde-229">その後、関連する [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ プロパティが保持するユーザー情報を収集し、静的コントロールを使用して親ウィンドウに情報を表示します。</span><span class="sxs-lookup"><span data-stu-id="aedde-229">It then collects the user information that is held by the associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties and uses the static controls to display the information on the parent window.</span></span> <span data-ttu-id="aedde-230">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツ データは、マネージド文字列の形式であるため、[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] コントロールによってマーシャリングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="aedde-230">Because the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content data is in the form of a managed string, it has to be marshaled for use by a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control.</span></span> <span data-ttu-id="aedde-231">場合、**キャンセル**ボタンがクリックされ、ハンドラーは、スタティック コントロールからデータをクリアします。</span><span class="sxs-lookup"><span data-stu-id="aedde-231">If the **Cancel** button was clicked, the handler clears the data from the static controls.</span></span>

 <span data-ttu-id="aedde-232">アプリケーション [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] には、ユーザーが [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツの背景色を変更できるようにするラジオ ボタンのセット、および複数のフォント関連のプロパティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="aedde-232">The application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] provides a set of radio buttons that allow the user to modify the background color of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and several font-related properties.</span></span> <span data-ttu-id="aedde-233">次の例は、アプリケーションのウィンドウ プロシージャ (WndProc)、および背景色など、各種のメッセージに対してさまざまなプロパティを設定するそのプロシージャのメッセージ処理からの抜粋です。</span><span class="sxs-lookup"><span data-stu-id="aedde-233">The following example is an excerpt from the application's window procedure (WndProc) and its message handling that sets various properties on different messages, including the background color.</span></span> <span data-ttu-id="aedde-234">その他は類似しているため、示していません。</span><span class="sxs-lookup"><span data-stu-id="aedde-234">The others are similar, and are not shown.</span></span> <span data-ttu-id="aedde-235">詳細とコンテキストについては、完全なサンプルを参照してください。</span><span class="sxs-lookup"><span data-stu-id="aedde-235">See the complete sample for details and context.</span></span>

 [!code-cpp[Win32HostingWPFPage#WMCommandToBG](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcommandtobg)]

 <span data-ttu-id="aedde-236">背景色を設定するには、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] から `hostedPage` コンテンツ (`WPFPageHost`) への参照を取得して、背景色のプロパティを適切な色に設定します。</span><span class="sxs-lookup"><span data-stu-id="aedde-236">To set the background color, get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (`hostedPage`) from `WPFPageHost` and set the background color property to the appropriate color.</span></span> <span data-ttu-id="aedde-237">サンプルでは、元の色、明るい緑、または明るいサーモン色の 3 つの色のオプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="aedde-237">The sample uses three color options: the original color, light green, or light salmon.</span></span> <span data-ttu-id="aedde-238">元の背景色は静的フィールドとして `WPFPageHost` クラスに格納されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-238">The original background color is stored as a static field in the `WPFPageHost` class.</span></span> <span data-ttu-id="aedde-239">他の 2 つの色を設定するには、新しい <xref:System.Windows.Media.SolidColorBrush> オブジェクトを作成して、<xref:System.Windows.Media.Colors> オブジェクトからコンストラクターに静的な色の値を渡します。</span><span class="sxs-lookup"><span data-stu-id="aedde-239">To set the other two, you create a new <xref:System.Windows.Media.SolidColorBrush> object and pass the constructor a static colors value from the <xref:System.Windows.Media.Colors> object.</span></span>

<a name="implementing_the_wpf_page"></a>
## <a name="implementing-the-wpf-page"></a><span data-ttu-id="aedde-240">WPF ページの実装</span><span class="sxs-lookup"><span data-stu-id="aedde-240">Implementing the WPF Page</span></span>
 <span data-ttu-id="aedde-241">ホストして、使用することができます、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]実際の実装の知識がなくてもコンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-241">You can host and use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content without any knowledge of the actual implementation.</span></span> <span data-ttu-id="aedde-242">場合、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]別でコンテンツをパッケージ化されていた[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]、いずれかで構築されたでした[!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)]言語。</span><span class="sxs-lookup"><span data-stu-id="aedde-242">If the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content had been packaged in a separate [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)], it could have been built in any [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] language.</span></span> <span data-ttu-id="aedde-243">以下は、このサンプルで使用する [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] の実装の簡単なチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="aedde-243">Following is a brief walkthrough of the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] implementation that is used in the sample.</span></span> <span data-ttu-id="aedde-244">このセクションには、次のサブセクションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="aedde-244">This section contains the following subsections.</span></span>

<a name="autoNestedSectionsOUTLINE2"></a>
-   [<span data-ttu-id="aedde-245">レイアウト</span><span class="sxs-lookup"><span data-stu-id="aedde-245">Layout</span></span>](#page_layout)

-   [<span data-ttu-id="aedde-246">データをホスト ウィンドウに返す</span><span class="sxs-lookup"><span data-stu-id="aedde-246">Returning the Data to the Host Window</span></span>](#returning_data_to_window)

-   [<span data-ttu-id="aedde-247">WPF のプロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="aedde-247">Setting the WPF Properties</span></span>](#set_page_properties)

<a name="page_layout"></a>
### <a name="layout"></a><span data-ttu-id="aedde-248">レイアウト</span><span class="sxs-lookup"><span data-stu-id="aedde-248">Layout</span></span>
 <span data-ttu-id="aedde-249">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]内の要素、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツから成る 5<xref:System.Windows.Controls.TextBox>制御は、関連付けられている<xref:System.Windows.Controls.Label>コントロール。名前、アドレス、市区町村、状態、および Zip です。</span><span class="sxs-lookup"><span data-stu-id="aedde-249">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content consist of five <xref:System.Windows.Controls.TextBox> controls, with associated <xref:System.Windows.Controls.Label> controls: Name, Address, City, State, and Zip.</span></span> <span data-ttu-id="aedde-250">2 つある<xref:System.Windows.Controls.Button>コントロール、 **OK**と**キャンセル**</span><span class="sxs-lookup"><span data-stu-id="aedde-250">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**</span></span>

 <span data-ttu-id="aedde-251">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツは `WPFPage` クラスに実装されています。</span><span class="sxs-lookup"><span data-stu-id="aedde-251">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in the `WPFPage` class.</span></span> <span data-ttu-id="aedde-252">レイアウトは、<xref:System.Windows.Controls.Grid> レイアウト要素で処理されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-252">Layout is handled with a <xref:System.Windows.Controls.Grid> layout element.</span></span> <span data-ttu-id="aedde-253">クラスは <xref:System.Windows.Controls.Grid> から継承されます。これにより、クラスは効果的に [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] コンテンツのルート要素になります。</span><span class="sxs-lookup"><span data-stu-id="aedde-253">The class inherits from <xref:System.Windows.Controls.Grid>, which effectively makes it the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content root element.</span></span>

 <span data-ttu-id="aedde-254">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツのコンス トラクターは、必要な幅と高さ、およびサイズ、<xref:System.Windows.Controls.Grid>それに応じて。</span><span class="sxs-lookup"><span data-stu-id="aedde-254">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content constructor takes the required width and height, and sizes the <xref:System.Windows.Controls.Grid> accordingly.</span></span> <span data-ttu-id="aedde-255">セットを作成して基本的なレイアウトを定義し<xref:System.Windows.Controls.ColumnDefinition>と<xref:System.Windows.Controls.RowDefinition>オブジェクトと追加すること、<xref:System.Windows.Controls.Grid>オブジェクトの基本<xref:System.Windows.Controls.Grid.ColumnDefinitions%2A>と<xref:System.Windows.Controls.Grid.RowDefinitions%2A>コレクション、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="aedde-255">It then defines the basic layout by creating a set of <xref:System.Windows.Controls.ColumnDefinition> and <xref:System.Windows.Controls.RowDefinition> objects and adding them to the <xref:System.Windows.Controls.Grid> object base <xref:System.Windows.Controls.Grid.ColumnDefinitions%2A> and <xref:System.Windows.Controls.Grid.RowDefinitions%2A> collections, respectively.</span></span> <span data-ttu-id="aedde-256">これにより、5 つの行と、7 つの列のグリッドが定義され、セルの内容によって大きさが決定します。</span><span class="sxs-lookup"><span data-stu-id="aedde-256">This defines a grid of five rows and seven columns, with the dimensions determined by the contents of the cells.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorToGridDef](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortogriddef)]

 <span data-ttu-id="aedde-257">次に、コンストラクターは [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 要素を <xref:System.Windows.Controls.Grid> に追加します。</span><span class="sxs-lookup"><span data-stu-id="aedde-257">Next, the constructor adds the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to the <xref:System.Windows.Controls.Grid>.</span></span> <span data-ttu-id="aedde-258">最初の要素はタイトルのテキストです。これは、グリッドの 1 行目の中央に表示される <xref:System.Windows.Controls.Label> コントロールです。</span><span class="sxs-lookup"><span data-stu-id="aedde-258">The first element is the title text, which is a <xref:System.Windows.Controls.Label> control that is centered in the first row of the grid.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorTitle](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortitle)]

 <span data-ttu-id="aedde-259">次の行には、名前の <xref:System.Windows.Controls.Label> コントロールと関連する <xref:System.Windows.Controls.TextBox> コントロールが格納されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-259">The next row contains the Name <xref:System.Windows.Controls.Label> control and its associated <xref:System.Windows.Controls.TextBox> control.</span></span> <span data-ttu-id="aedde-260">ラベルとテキスト ボックスの各ペアに同じコードが使用されるため、コードはプライベート メソッドのペアに配置され、5 つのラベルとテキスト ボックスのペアすべてに使用されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-260">Because the same code is used for each label/textbox pair, it is placed in a pair of private methods and used for all five label/textbox pairs.</span></span> <span data-ttu-id="aedde-261">メソッドは適切な制御を作成し、<xref:System.Windows.Controls.Grid> クラスの静的な <xref:System.Windows.Controls.Grid.SetColumn%2A> および <xref:System.Windows.Controls.Grid.SetRow%2A> メソッドを呼び出して、適切なセルにコントロールを配置します。</span><span class="sxs-lookup"><span data-stu-id="aedde-261">The methods create the appropriate control, and call the <xref:System.Windows.Controls.Grid> class static <xref:System.Windows.Controls.Grid.SetColumn%2A> and <xref:System.Windows.Controls.Grid.SetRow%2A> methods to place the controls in the appropriate cell.</span></span> <span data-ttu-id="aedde-262">コントロールが作成されると、サンプルは <xref:System.Windows.Controls.UIElementCollection.Add%2A> の <xref:System.Windows.Controls.Panel.Children%2A> プロパティの <xref:System.Windows.Controls.Grid> メソッドを呼び出して、グリッドにコントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="aedde-262">After the control is created, the sample calls the <xref:System.Windows.Controls.UIElementCollection.Add%2A> method on the <xref:System.Windows.Controls.Panel.Children%2A> property of the <xref:System.Windows.Controls.Grid> to add the control to the grid.</span></span> <span data-ttu-id="aedde-263">残りのラベルとテキスト ボックスのペアを追加するコードは似ています。</span><span class="sxs-lookup"><span data-stu-id="aedde-263">The code to add the remaining label/textbox pairs is similar.</span></span> <span data-ttu-id="aedde-264">詳細については、サンプル コードを参照してください。</span><span class="sxs-lookup"><span data-stu-id="aedde-264">See the sample code for details.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorName](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorname)]

 <span data-ttu-id="aedde-265">2 つのメソッドの実装は、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="aedde-265">The implementation of the two methods is as follows:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCreateHelpers](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagecreatehelpers)]

 <span data-ttu-id="aedde-266">最後に、サンプルは、追加、 **[ok]** と**キャンセル**] ボタンし、[イベント ハンドラーをアタッチします、<xref:System.Windows.Controls.Primitives.ButtonBase.Click>イベント。</span><span class="sxs-lookup"><span data-stu-id="aedde-266">Finally, the sample adds the **OK** and **Cancel** buttons and attaches an event handler to their <xref:System.Windows.Controls.Primitives.ButtonBase.Click> events.</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageCtorButtonsEvents](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorbuttonsevents)]

<a name="returning_data_to_window"></a>
### <a name="returning-the-data-to-the-host-window"></a><span data-ttu-id="aedde-267">データをホスト ウィンドウに返す</span><span class="sxs-lookup"><span data-stu-id="aedde-267">Returning the Data to the Host Window</span></span>
 <span data-ttu-id="aedde-268">いずれかのボタンをクリックすると、その <xref:System.Windows.Controls.Primitives.ButtonBase.Click> イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="aedde-268">When either button is clicked, its <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is raised.</span></span> <span data-ttu-id="aedde-269">ホスト ウィンドウはこれらのイベントにハンドラーをアタッチして、<xref:System.Windows.Controls.TextBox> コントロールから直接データを取得します。</span><span class="sxs-lookup"><span data-stu-id="aedde-269">The host window could simply attach handlers to these events and get the data directly from the <xref:System.Windows.Controls.TextBox> controls.</span></span> <span data-ttu-id="aedde-270">サンプルは、いくぶん直接的ではない方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="aedde-270">The sample uses a somewhat less direct approach.</span></span> <span data-ttu-id="aedde-271">処理、<xref:System.Windows.Controls.Primitives.ButtonBase.Click>内、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ、およびカスタム イベントが発生し、`OnButtonClicked`に通知する、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツ。</span><span class="sxs-lookup"><span data-stu-id="aedde-271">It handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and then raises a custom event `OnButtonClicked`, to notify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="aedde-272">これにより、[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツをホストに通知する前にパラメーターの検証を実行します。</span><span class="sxs-lookup"><span data-stu-id="aedde-272">This allows the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to do some parameter validation before notifying the host.</span></span> <span data-ttu-id="aedde-273">ハンドラーは、<xref:System.Windows.Controls.TextBox> コントロールからテキストを取得し、パブリック プロパティに割り当てます。ここからホストは情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="aedde-273">The handler gets the text from the <xref:System.Windows.Controls.TextBox> controls and assigns it to public properties, from which the host can retrieve the information.</span></span>

 <span data-ttu-id="aedde-274">WPFPage.h でのイベント宣言:</span><span class="sxs-lookup"><span data-stu-id="aedde-274">The event declaration, in WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageEventDecl](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpageeventdecl)]

 <span data-ttu-id="aedde-275">WPFPage.cpp での <xref:System.Windows.Controls.Primitives.ButtonBase.Click> イベント ハンドラー:</span><span class="sxs-lookup"><span data-stu-id="aedde-275">The <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler, in WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageButtonClicked](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagebuttonclicked)]

<a name="set_page_properties"></a>
### <a name="setting-the-wpf-properties"></a><span data-ttu-id="aedde-276">WPF のプロパティを設定する</span><span class="sxs-lookup"><span data-stu-id="aedde-276">Setting the WPF Properties</span></span>
 <span data-ttu-id="aedde-277">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ホストにより、ユーザーがいくつか変更[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]コンテンツのプロパティ。</span><span class="sxs-lookup"><span data-stu-id="aedde-277">The [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] host allows the user to change several [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties.</span></span> <span data-ttu-id="aedde-278">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 側では、これはプロパティの変更の問題にすぎません。</span><span class="sxs-lookup"><span data-stu-id="aedde-278">From the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] side, it is simply a matter of changing the properties.</span></span> <span data-ttu-id="aedde-279">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] のコンテンツ クラスの実装はいくらか複雑になります。これは、全コントロールのフォントを制御する 1 つのグローバル プロパティがないためです。</span><span class="sxs-lookup"><span data-stu-id="aedde-279">The implementation in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class is somewhat more complicated, because there is no single global property that controls the fonts for all controls.</span></span> <span data-ttu-id="aedde-280">代わりに、各コントロールの適切なプロパティは、プロパティの set アクセサーで変更されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-280">Instead, the appropriate property for each control is changed in the properties' set accessors.</span></span> <span data-ttu-id="aedde-281">次の例のコードを示しています、`DefaultFontFamily`プロパティ。</span><span class="sxs-lookup"><span data-stu-id="aedde-281">The following example shows the code for the `DefaultFontFamily` property.</span></span> <span data-ttu-id="aedde-282">プロパティを設定すると、プライベート メソッドが呼び出され、さまざまなコントロールに <xref:System.Windows.Controls.Control.FontFamily%2A> プロパティが設定されます。</span><span class="sxs-lookup"><span data-stu-id="aedde-282">Setting the property calls a private method that in turn sets the <xref:System.Windows.Controls.Control.FontFamily%2A> properties for the various controls.</span></span>

 <span data-ttu-id="aedde-283">WPFPage.h から:</span><span class="sxs-lookup"><span data-stu-id="aedde-283">From WPFPage.h:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageFontFamilyProperty](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpagefontfamilyproperty)]

 <span data-ttu-id="aedde-284">WPFPage.cpp から:</span><span class="sxs-lookup"><span data-stu-id="aedde-284">From WPFPage.cpp:</span></span>

 [!code-cpp[Win32HostingWPFPage#WPFPageSetFontFamily](~/samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagesetfontfamily)]

## <a name="see-also"></a><span data-ttu-id="aedde-285">関連項目</span><span class="sxs-lookup"><span data-stu-id="aedde-285">See also</span></span>

- <xref:System.Windows.Interop.HwndSource>
- [<span data-ttu-id="aedde-286">WPF と Win32 の相互運用性</span><span class="sxs-lookup"><span data-stu-id="aedde-286">WPF and Win32 Interoperation</span></span>](wpf-and-win32-interoperation.md)