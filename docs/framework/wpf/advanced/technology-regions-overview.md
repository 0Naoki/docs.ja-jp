---
title: 技術領域の概要
ms.date: 03/30/2017
helpviewer_keywords:
- window regions [WPF]
- Win32 code [WPF], WPF interoperation
- Win32 code [WPF], airspace
- airspace [WPF]
- interoperability [WPF], airspace
- Win32 code [WPF], window regions
ms.assetid: b7cc350f-b9e2-48b1-be14-60f3d853222e
ms.openlocfilehash: a169064052a567694b1cbd1e2f8ac2f00b047a68
ms.sourcegitcommit: 3eeea78f52ca771087a6736c23f74600cc662658
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/31/2019
ms.locfileid: "68671831"
---
# <a name="technology-regions-overview"></a><span data-ttu-id="36147-102">技術領域の概要</span><span class="sxs-lookup"><span data-stu-id="36147-102">Technology Regions Overview</span></span>
<span data-ttu-id="36147-103">WPF、Win32、DirectX などのアプリケーションで複数のプレゼンテーションテクノロジが使用されている場合は、一般的なトップレベルウィンドウ内でレンダリング領域を共有する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36147-103">If multiple presentation technologies are used in an application, such as WPF, Win32, or DirectX, they must share the rendering areas within a common top-level window.</span></span> <span data-ttu-id="36147-104">このトピックでは、WPF 相互運用アプリケーションのプレゼンテーションと入力に影響する可能性がある問題について説明します。</span><span class="sxs-lookup"><span data-stu-id="36147-104">This topic describes issues that might influence the presentation and input for your WPF interoperation application.</span></span>  
  
## <a name="regions"></a><span data-ttu-id="36147-105">領域</span><span class="sxs-lookup"><span data-stu-id="36147-105">Regions</span></span>  
 <span data-ttu-id="36147-106">最上位レベルのウィンドウでは、相互運用アプリケーションのいずれかのテクノロジを構成する各 HWND が独自のリージョン ("空域" とも呼ばれます) を持つことを概念にすることができます。</span><span class="sxs-lookup"><span data-stu-id="36147-106">Within a top-level window, you can conceptualize that each HWND that comprises one of the technologies of an interoperation application has its own region (also called "airspace").</span></span> <span data-ttu-id="36147-107">ウィンドウ内の各ピクセルは、その HWND の領域を構成する1つの HWND に属します。</span><span class="sxs-lookup"><span data-stu-id="36147-107">Each pixel within the window belongs to exactly one HWND, which constitutes the region of that HWND.</span></span> <span data-ttu-id="36147-108">(厳密に言えば、複数の[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] HWND がある場合は複数の領域がありますが、この説明では、1つだけを想定できます)。</span><span class="sxs-lookup"><span data-stu-id="36147-108">(Strictly speaking, there is more than one [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] region if there is more than one [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] HWND, but for purposes of this discussion, you can assume there is only one).</span></span> <span data-ttu-id="36147-109">この領域は、アプリケーションの有効期間中にそのピクセルの上にレンダリングを試みるすべてのレイヤーまたはその他のウィンドウが、同じレンダリングレベルのテクノロジに含まれる必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="36147-109">The region implies that all layers or other windows that attempt to render above that pixel during application lifetime must be part of the same render-level technology.</span></span> <span data-ttu-id="36147-110">このような[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]場合、 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]望ましくない結果に対してピクセルをレンダリングしようとすると、相互運用 api を使用して可能な限り許可されなくなります。</span><span class="sxs-lookup"><span data-stu-id="36147-110">Attempting to render [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] pixels over [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] leads to undesirable results, and is disallowed as much as possible through the interoperation APIs.</span></span>  
  
### <a name="region-examples"></a><span data-ttu-id="36147-111">領域の例</span><span class="sxs-lookup"><span data-stu-id="36147-111">Region Examples</span></span>  
 <span data-ttu-id="36147-112">次の図は、、DirectX、 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]および[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]をミキシングするアプリケーションを示しています。</span><span class="sxs-lookup"><span data-stu-id="36147-112">The following illustration shows an application that mixes [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)], DirectX, and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)].</span></span> <span data-ttu-id="36147-113">各テクノロジでは、重複しない個別のピクセルセットが使用され、リージョンに関する問題はありません。</span><span class="sxs-lookup"><span data-stu-id="36147-113">Each technology uses its own separate, non-overlapping set of pixels, and there are no region issues.</span></span>  
  
 ![Win32、DirectX、WPF を混在させるアプリケーションの例。](./media/technology-regions-overview/win32-directx-windows-presentation-foundation-application.png)  
  
 <span data-ttu-id="36147-115">このアプリケーションがマウスポインターの位置を使用して、これら3つの領域のいずれかにレンダリングしようとするアニメーションを作成するとします。</span><span class="sxs-lookup"><span data-stu-id="36147-115">Suppose that this application uses the mouse pointer position to create an animation that attempts to render over any of these three regions.</span></span> <span data-ttu-id="36147-116">どのテクノロジがアニメーション自体を担当するかにかかわらず、そのテクノロジは他の2つの領域に違反します。</span><span class="sxs-lookup"><span data-stu-id="36147-116">No matter which technology was responsible for the animation itself, that technology would violate the region of the other two.</span></span> <span data-ttu-id="36147-117">次の図は、Win32 領域に WPF の円を表示しようとした場合を示しています。</span><span class="sxs-lookup"><span data-stu-id="36147-117">The following illustration shows an attempt to render a WPF circle over a Win32 region.</span></span>  
  
 ![Win32 領域の上に WPF の円を表示しようとしました。](./media/technology-regions-overview/render-windows-presentation-foundation-circle-over-win32-region.png)  
  
 <span data-ttu-id="36147-119">異なるテクノロジ間で透明度/アルファブレンドを使用しようとすると、別の違反があります。</span><span class="sxs-lookup"><span data-stu-id="36147-119">Another violation is if you try to use transparency/alpha blending between different technologies.</span></span>  <span data-ttu-id="36147-120">次の図では、 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]ボックスがおよび[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] DirectX 領域に違反しています。</span><span class="sxs-lookup"><span data-stu-id="36147-120">In the following illustration, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] box violates the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and DirectX regions.</span></span> <span data-ttu-id="36147-121">この[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]ボックス内のピクセルは半透明であるため、DirectX と[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]の両方によって共同で所有されている必要がありますが、これは不可能です。</span><span class="sxs-lookup"><span data-stu-id="36147-121">Because pixels in that [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] box are semi-transparent, they would have to be owned jointly by both DirectX and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)], which is not possible.</span></span>  <span data-ttu-id="36147-122">これは別の違反であるため、ビルドできません。</span><span class="sxs-lookup"><span data-stu-id="36147-122">So this is another violation and cannot be built.</span></span>  
  
 ![Win32 および DirectX 領域に違反している WPF ボックスを示す図。](./media/technology-regions-overview/windows-foundation-presentation-box-violate-win32-directx-region.png)  
  
 <span data-ttu-id="36147-124">前の3つの例では、四角形の領域を使用していましたが、さまざまな形状が考えられます。</span><span class="sxs-lookup"><span data-stu-id="36147-124">The previous three examples used rectangular regions, but different shapes are possible.</span></span>  <span data-ttu-id="36147-125">たとえば、領域には穴を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="36147-125">For example, a region can have a hole.</span></span> <span data-ttu-id="36147-126">次の図は、 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]四角形の穴がある領域を示しています[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 。これは、と DirectX 領域の組み合わせのサイズです。</span><span class="sxs-lookup"><span data-stu-id="36147-126">The following illustration shows a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] region with a rectangular hole this is the size of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and DirectX regions combined.</span></span>  
  
 ![四角形の穴を持つ Win32 領域を示す図。](./media/technology-regions-overview/win32-region-rectangular-hole.png)  
  
 <span data-ttu-id="36147-128">また、領域は完全に四角形ではなく、または[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] HRGN (region) によって describable された形でもかまいません。</span><span class="sxs-lookup"><span data-stu-id="36147-128">Regions can also be completely nonrectangular, or any shape describable by a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] HRGN (region).</span></span>  
  
 ![四角形以外の領域を示す図。](./media/technology-regions-overview/nonrectangular-win32-region.png)  
  
## <a name="transparency-and-top-level-windows"></a><span data-ttu-id="36147-130">透明度とトップレベルウィンドウ</span><span class="sxs-lookup"><span data-stu-id="36147-130">Transparency and Top-Level Windows</span></span>  
 <span data-ttu-id="36147-131">Windows のウィンドウマネージャーは、実際に[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]は hwnd のみを処理します。</span><span class="sxs-lookup"><span data-stu-id="36147-131">The window manager in Windows only really processes [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] HWNDs.</span></span> <span data-ttu-id="36147-132">したがって、 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]はすべて<xref:System.Windows.Window> HWND です。</span><span class="sxs-lookup"><span data-stu-id="36147-132">Therefore, every [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Window> is an HWND.</span></span> <span data-ttu-id="36147-133">Hwnd <xref:System.Windows.Window>は、すべての hwnd の一般的な規則に従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="36147-133">The <xref:System.Windows.Window> HWND must abide by the general rules for any HWND.</span></span> <span data-ttu-id="36147-134">その HWND 内で[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 、コードは api 全体[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]をサポートします。</span><span class="sxs-lookup"><span data-stu-id="36147-134">Within that HWND, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] code can do whatever the overall [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] APIs support.</span></span> <span data-ttu-id="36147-135">ただし、デスクトップ上の他の hwnd との[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]対話につい[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]ては、は処理と表示の規則を遵守する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36147-135">But for interactions with other HWNDs on the desktop, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] must abide by [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] processing and rendering rules.</span></span>  [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="36147-136">では、api を使用[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]して四角形以外のウィンドウをサポートしています。非四角形ウィンドウの場合は hrgns、ピクセル単位のアルファの場合はレイヤードウィンドウです。</span><span class="sxs-lookup"><span data-stu-id="36147-136">supports non-rectangular windows by using [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] APIs—HRGNs for non-rectangular windows, and layered windows for a per-pixel alpha.</span></span>  
  
 <span data-ttu-id="36147-137">定数アルファおよびカラーキーはサポートされていません。</span><span class="sxs-lookup"><span data-stu-id="36147-137">Constant alpha and color keys are not supported.</span></span>  [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]<span data-ttu-id="36147-138">レイヤードウィンドウの機能は、プラットフォームによって異なります。</span><span class="sxs-lookup"><span data-stu-id="36147-138">layered window capabilities vary by platform.</span></span>  
  
 <span data-ttu-id="36147-139">レイヤードウィンドウでは、ウィンドウ内のすべてのピクセルに適用するアルファ値を指定することで、ウィンドウ全体を半透明 (半透明) にすることができます。</span><span class="sxs-lookup"><span data-stu-id="36147-139">Layered windows can make the entire window translucent (semi-transparent) by specifying an alpha value to apply to every pixel in the window.</span></span>  <span data-ttu-id="36147-140">([!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]実際にはピクセル単位のアルファはサポートされていますが、このモードでは、ダイアログやドロップダウンを含む子 HWND を自分で描画する必要があるため、実際のプログラムでは使用するのが非常に困難です。</span><span class="sxs-lookup"><span data-stu-id="36147-140">([!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] in fact supports per-pixel alpha, but this is very difficult to use in practical programs because in this mode you would need to draw any child HWND yourself, including dialogs and dropdowns).</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="36147-141">HRGNs をサポートします。ただし、この機能にはマネージ Api はありません。</span><span class="sxs-lookup"><span data-stu-id="36147-141">supports HRGNs; however, there are no managed APIs for this functionality.</span></span> <span data-ttu-id="36147-142">プラットフォーム呼び出しおよびを使用し<xref:System.Windows.Interop.HwndSource>て、関連[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]する api を呼び出すことができます。</span><span class="sxs-lookup"><span data-stu-id="36147-142">You can use platform invoke and <xref:System.Windows.Interop.HwndSource> to call the relevant [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] APIs.</span></span> <span data-ttu-id="36147-143">詳細については、「[マネージコードからのネイティブ関数の呼び出し](/cpp/dotnet/calling-native-functions-from-managed-code)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36147-143">For more information, see [Calling Native Functions from Managed Code](/cpp/dotnet/calling-native-functions-from-managed-code).</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="36147-144">階層化されたウィンドウの機能は、オペレーティングシステムによって異なります。</span><span class="sxs-lookup"><span data-stu-id="36147-144">layered windows have different capabilities on different operating systems.</span></span> <span data-ttu-id="36147-145">これは、 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]が directx を使用してレンダリングするためです。また、レイヤー化されたウィンドウは、主に directx レンダリングではなく GDI レンダリング用に設計されています。</span><span class="sxs-lookup"><span data-stu-id="36147-145">This is because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses DirectX to render, and layered windows were primarily designed for GDI rendering, not DirectX rendering.</span></span>  
  
- [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="36147-146">以降では、ハードウェアアクセラレータ[!INCLUDE[TLA#tla_longhorn](../../../../includes/tlasharptla-longhorn-md.md)]によるレイヤードウィンドウをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="36147-146">supports hardware accelerated layered windows on [!INCLUDE[TLA#tla_longhorn](../../../../includes/tlasharptla-longhorn-md.md)] and later.</span></span> <span data-ttu-id="36147-147">ハードウェアアクセラレータに[!INCLUDE[TLA2#tla_winxp](../../../../includes/tla2sharptla-winxp-md.md)]よるレイヤードウィンドウは、microsoft directx のサポートを必要とします。そのため、機能は、そのコンピューター上の microsoft directx のバージョンによって異なります。</span><span class="sxs-lookup"><span data-stu-id="36147-147">Hardware accelerated layered windows on [!INCLUDE[TLA2#tla_winxp](../../../../includes/tla2sharptla-winxp-md.md)] require support from Microsoft DirectX, so the capabilities will depend on the version of Microsoft DirectX on that machine.</span></span>  
  
- [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="36147-148">は透明色キーをサポートして[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]いません。これは、特にレンダリングがハードウェアアクセラレータを使用する場合に、要求した色が正確にレンダリングされることを保証できないためです。</span><span class="sxs-lookup"><span data-stu-id="36147-148">does not support transparency color keys, because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] cannot guarantee to render the exact color you requested, particularly when rendering is hardware-accelerated.</span></span>  
  
- <span data-ttu-id="36147-149">アプリケーションがで[!INCLUDE[TLA2#tla_winxp](../../../../includes/tla2sharptla-winxp-md.md)]実行されている場合、directx アプリケーションがレンダリングされると、directx サーフェイス上のレイヤードウィンドウがちらつきます。</span><span class="sxs-lookup"><span data-stu-id="36147-149">If your application is running on [!INCLUDE[TLA2#tla_winxp](../../../../includes/tla2sharptla-winxp-md.md)], layered windows on top of DirectX surfaces flicker when the DirectX application renders.</span></span>  <span data-ttu-id="36147-150">(実際の表示順序は、Microsoft Windows グラフィックスデバイスインターフェイス (GDI) によってレイヤードウィンドウが非表示になり、DirectX が描画され、Microsoft Windows グラフィックスデバイスインターフェイス (GDI) によって階層化されたウィンドウが元に戻されるということです。</span><span class="sxs-lookup"><span data-stu-id="36147-150">(The actual rendering sequence is that Microsoft Windows Graphics Device Interface (GDI) hides the layered window, then DirectX draws, and then Microsoft Windows Graphics Device Interface (GDI) puts the layered window back).</span></span>  <span data-ttu-id="36147-151">階層化[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]されていないウィンドウにもこの制限があります。</span><span class="sxs-lookup"><span data-stu-id="36147-151">Non-[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] layered windows also have this limitation.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="36147-152">関連項目</span><span class="sxs-lookup"><span data-stu-id="36147-152">See also</span></span>

- [<span data-ttu-id="36147-153">WPF と Win32 の相互運用性</span><span class="sxs-lookup"><span data-stu-id="36147-153">WPF and Win32 Interoperation</span></span>](wpf-and-win32-interoperation.md)
- [<span data-ttu-id="36147-154">チュートリアル: Win32 での WPF クロックのホスト</span><span class="sxs-lookup"><span data-stu-id="36147-154">Walkthrough: Hosting a WPF Clock in Win32</span></span>](walkthrough-hosting-a-wpf-clock-in-win32.md)
- [<span data-ttu-id="36147-155">WPF での Win32 コンテンツのホスト</span><span class="sxs-lookup"><span data-stu-id="36147-155">Hosting Win32 Content in WPF</span></span>](hosting-win32-content-in-wpf.md)
