---
title: WIF を使用したクレーム ベースの承認
ms.date: 03/30/2017
ms.assetid: e24000a3-8fd8-4c0e-bdf0-39882cc0f6d8
author: BrucePerlerMS
ms.openlocfilehash: 0c99053610c8df9b6825c773a09cb1330d1e22f4
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2019
ms.locfileid: "64650449"
---
# <a name="claims-based-authorization-using-wif"></a><span data-ttu-id="dac3e-102">WIF を使用したクレーム ベースの承認</span><span class="sxs-lookup"><span data-stu-id="dac3e-102">Claims Based Authorization Using WIF</span></span>
<span data-ttu-id="dac3e-103">証明書利用者アプリケーションでは、承認によって、認証済み ID がアクセスできるリソースと、そのリソースで実行できる操作が決まります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-103">In a relying party application, authorization determines what resources an authenticated identity is allowed to access and what operations it is allowed to perform on those resources.</span></span> <span data-ttu-id="dac3e-104">承認が不適切だったり弱かったりすると、それは情報漏えいとデータの改ざんにつながります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-104">Improper or weak authorization leads to information disclosure and data tampering.</span></span> <span data-ttu-id="dac3e-105">ここでは、Windows Identity Foundation (WIF) とセキュリティ トークン サービス (STS)、たとえば Microsoft Azure のアクセス制御サービス (ACS) を使用して、クレーム対応 ASP.NET の Web アプリケーションとサービスの承認を実装する方法の概要を説明します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-105">This topic outlines the available approaches to implementing authorization for claims-aware ASP.NET web applications and services using Windows Identity Foundation (WIF) and a Security Token Service (STS), for example, the Windows Azure Access Control Service (ACS).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="dac3e-106">概要</span><span class="sxs-lookup"><span data-stu-id="dac3e-106">Overview</span></span>  
 <span data-ttu-id="dac3e-107">.NET Framework は、最初のバージョンから柔軟な承認実装機構を提供してきました。</span><span class="sxs-lookup"><span data-stu-id="dac3e-107">Since its first version, the .NET Framework has offered a flexible mechanism for implementing authorization.</span></span> <span data-ttu-id="dac3e-108">この機構は、2 つのシンプルなインターフェイス、**IPrincipal** と **IIdentity** に基づいています。</span><span class="sxs-lookup"><span data-stu-id="dac3e-108">This mechanism is based on two simple interfaces—**IPrincipal** and **IIdentity**.</span></span> <span data-ttu-id="dac3e-109">**IIdentity** の具体的な実装は、認証されたユーザーを表します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-109">Concrete implementations of **IIdentity** represent an authenticated user.</span></span> <span data-ttu-id="dac3e-110">たとえば、**WindowsIdentity** 実装は、Active Directory で認証されているユーザーを表します。また、**GenericIdentity** は、ID がカスタム認証プロセスによって検証されるユーザーを表します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-110">For example, the **WindowsIdentity** implementation represents a user who is authenticated by Active Directory, and **GenericIdentity** represents a user whose identity is verified via a custom authentication process.</span></span> <span data-ttu-id="dac3e-111">**IPrincipal** の具体的な実装は、ロール ストアに応じて、ロールを使用してアクセス許可を確認する際に役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-111">Concrete implementations of **IPrincipal** help to check permissions using roles depending on the role store.</span></span> <span data-ttu-id="dac3e-112">たとえば、**WindowsPrincipal** は、**WindowsIdentity** で、Active Directory グループのメンバーシップがないかどうかをチェックします。</span><span class="sxs-lookup"><span data-stu-id="dac3e-112">For example, **WindowsPrincipal** checks **WindowsIdentity** for membership in Active Directory groups.</span></span> <span data-ttu-id="dac3e-113">このチェックを実行するには、**IPrincipal** インターフェイスで **IsInRole** メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-113">This check is performed by calling the **IsInRole** method on the **IPrincipal** interface.</span></span> <span data-ttu-id="dac3e-114">ロールに基づいたアクセス チェックは、ロール ベースのアクセス制御 (RBAC) と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-114">Checking access based on roles is called Role-Based Access Control (RBAC).</span></span> <span data-ttu-id="dac3e-115">詳細については、「[ロール ベースのアクセス制御](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dac3e-115">For more information, see [Role-Based Access Control](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_1).</span></span>  <span data-ttu-id="dac3e-116">ロールに関する情報をクレームに含めると、使い慣れたロール ベースの承認機構をサポートできます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-116">Claims can be used to carry information about roles to support familiar, role-based authorization mechanisms.</span></span>  
  
 <span data-ttu-id="dac3e-117">また、クレームを使用して、ロールの枠を越えた、より複雑な承認決定を行うこともできます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-117">Claims can also be used to enable more complicated authorization decisions beyond roles.</span></span> <span data-ttu-id="dac3e-118">クレームは、ユーザーの年齢、郵便番号、靴のサイズなど、ほぼすべての情報に基づいて指定できます。任意のクレームに基づくアクセス制御メカニズムは、クレームベースの承認と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-118">Claims can be based on virtually any information about the user - age, zip code, shoe size, etc. An access control mechanism that is based on arbitrary claims is called claims-based authorization.</span></span> <span data-ttu-id="dac3e-119">詳細については、「[クレーム ベースの承認](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="dac3e-119">For more information, see [Claims-based Authorization](../../../docs/framework/security/claims-based-authorization-using-wif.md#BKMK_2).</span></span>  
  
<a name="BKMK_1"></a>   
## <a name="role-based-access-control"></a><span data-ttu-id="dac3e-120">ロール ベースのアクセス制御</span><span class="sxs-lookup"><span data-stu-id="dac3e-120">Role-Based Access Control</span></span>  
 <span data-ttu-id="dac3e-121">RBAC による承認では、ユーザーのアクセス許可は、ユーザー ロールに基づいてアプリケーションによって管理および適用されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-121">RBAC is an authorization approach in which user permissions are managed and enforced by an application based on user roles.</span></span> <span data-ttu-id="dac3e-122">アクションの実行に必要なロールがユーザーにある場合、アクセスは許可され、それ以外の場合は拒否されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-122">If a user has a role that is required to perform an action, the access is granted; otherwise, access is denied.</span></span>  
  
### <a name="iprincipalisinrole-method"></a><span data-ttu-id="dac3e-123">IPrincipal.IsInRole メソッド</span><span class="sxs-lookup"><span data-stu-id="dac3e-123">IPrincipal.IsInRole Method</span></span>  
 <span data-ttu-id="dac3e-124">クレーム対応アプリケーションで RBAC アプローチを実装するには、クレーム対応ではないアプリケーションと同じように、**IPrinicpal** インターフェイスで **IsInRole()** メソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-124">To implement the RBAC approach in claims-aware applications, use the **IsInRole()** method in the **IPrinicpal** interface, just as you would in non-claims-aware applications.</span></span> <span data-ttu-id="dac3e-125">**IsInRole()** メソッドを使用する方法は複数あります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-125">There are several ways of using the **IsInRole()** method:</span></span>  
  
- <span data-ttu-id="dac3e-126">**IPrincipal.IsInRole(“Administrator”)** で明示的に呼び出す。</span><span class="sxs-lookup"><span data-stu-id="dac3e-126">Explicitly calling on **IPrincipal.IsInRole("Administrator")**.</span></span> <span data-ttu-id="dac3e-127">この場合、結果はブール値になります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-127">In this approach, the outcome is a Boolean.</span></span> <span data-ttu-id="dac3e-128">これを条件付きステートメントで使用します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-128">Use it in your conditional statements.</span></span> <span data-ttu-id="dac3e-129">これはコード内のすべての場所で任意に使用できます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-129">It can be used arbitrarily any place in your code.</span></span>  
  
- <span data-ttu-id="dac3e-130">セキュリティ要求 **PrincipalPermission.Demand()** を使用する。</span><span class="sxs-lookup"><span data-stu-id="dac3e-130">Using the security demand **PrincipalPermission.Demand()**.</span></span> <span data-ttu-id="dac3e-131">この場合、要求が満たされないと、結果は例外になります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-131">In this approach, the outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="dac3e-132">これは例外処理の方針に適合している必要があります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-132">This should fit your exception handling strategy.</span></span> <span data-ttu-id="dac3e-133">パフォーマンスの観点から見た場合、例外をスローすることは、ブール値を返すよりもはるかに高くつきます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-133">Throwing exceptions is much more expensive from a performance perspective compared to returning Boolean.</span></span> <span data-ttu-id="dac3e-134">これはコード内の任意の場所で使用できます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-134">This can be used any place in your code.</span></span>  
  
- <span data-ttu-id="dac3e-135">宣言属性 **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]** を使用する。</span><span class="sxs-lookup"><span data-stu-id="dac3e-135">Using the declarative attributes **[PrincipalPermission(SecurityAction.Demand, Role = "Administrator")]**.</span></span> <span data-ttu-id="dac3e-136">この方法は、メソッドの修飾に使用されるため宣言と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-136">This approach is called declarative, because it is used to decorate methods.</span></span> <span data-ttu-id="dac3e-137">メソッドの実装内のコード ブロックで使用することはできません。</span><span class="sxs-lookup"><span data-stu-id="dac3e-137">It cannot be used in code blocks inside the method’s implementations.</span></span> <span data-ttu-id="dac3e-138">要求が満たされない場合、結果は例外になります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-138">The outcome is an exception in case the demand is not satisfied.</span></span> <span data-ttu-id="dac3e-139">これが例外処理の方針に適合していることを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-139">You should make sure that it fits your exception-handling strategy.</span></span>  
  
- <span data-ttu-id="dac3e-140">**web.config** の **\<authorization>** セクションを使って、URL 承認を使用する。URL レベルで承認を管理している場合は、この方法が適しています。</span><span class="sxs-lookup"><span data-stu-id="dac3e-140">Using URL authorization, using the **\<authorization>** section in **web.config**. This approach is suitable when you are managing authorization on a URL level.</span></span> <span data-ttu-id="dac3e-141">これは、前に説明した方法の中では最も大雑把です。</span><span class="sxs-lookup"><span data-stu-id="dac3e-141">This is the most coarse level among those previously mentioned.</span></span> <span data-ttu-id="dac3e-142">この方法の利点は、構成ファイルに変更が行われるため、コードをコンパイルしなくても変更を利用できるということです。</span><span class="sxs-lookup"><span data-stu-id="dac3e-142">The advantage of this approach is that changes are made in the configuration file, which means that the code should not be compiled to take advantage of the change.</span></span>  
  
### <a name="expressing-roles-as-claims"></a><span data-ttu-id="dac3e-143">クレームとしてのロールの表現</span><span class="sxs-lookup"><span data-stu-id="dac3e-143">Expressing Roles as Claims</span></span>  
 <span data-ttu-id="dac3e-144">**IsInRole()** メソッドが呼び出されると、現在のユーザーにそのロールがあるかどうかがチェックされます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-144">When the **IsInRole()** method is called, there is a check made to see if the current user has that role.</span></span> <span data-ttu-id="dac3e-145">クレーム対応アプリケーションでは、ロールは、トークンで使用できるロール クレームの種類によって表されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-145">In claims-aware applications, the role is expressed by a role claim type that should be available in the token.</span></span> <span data-ttu-id="dac3e-146">ロール クレームの種類は、次の URI を使用して表されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-146">The role claim type is expressed using the following URI:</span></span>  
  
 `http://schemas.microsoft.com/ws/2008/06/identity/claims/role`
  
 <span data-ttu-id="dac3e-147">ロール クレームの種類でトークンを強化する方法は複数あります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-147">There are several ways to enrich a token with a role claim type:</span></span>  
  
- <span data-ttu-id="dac3e-148">**トークン発行中**。</span><span class="sxs-lookup"><span data-stu-id="dac3e-148">**During token issuance**.</span></span> <span data-ttu-id="dac3e-149">ユーザーが認証されるときに、Microsoft Azure のアクセス制御サービス (ACS) などのフェデレーション プロバイダーや ID プロバイダー STS によってロール クレームを発行できます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-149">When a user is authenticated the role claim can be issued by the identity provider STS or by a federation provider such as the Windows Azure Access Control Service (ACS).</span></span>  
  
- <span data-ttu-id="dac3e-150">**ClaimsAuthenticationManager を使用して、任意のクレームを、ロール タイプのクレームに変換する**。</span><span class="sxs-lookup"><span data-stu-id="dac3e-150">**Transforming arbitrary claims into of claims role type using ClaimsAuthenticationManager**.</span></span> <span data-ttu-id="dac3e-151">ClaimsAuthenticationManager は、WIF に含まれているコンポーネントです。</span><span class="sxs-lookup"><span data-stu-id="dac3e-151">The ClaimsAuthenticationManager is a component that ships as part of WIF.</span></span> <span data-ttu-id="dac3e-152">このコンポーネントは、トークンを調べ、クレームを追加、変更、または削除することでそれを変換し、アプリケーションの起動時に要求を受け取れるようにします。</span><span class="sxs-lookup"><span data-stu-id="dac3e-152">It allows requests to be intercepted when they launch an application, inspecting tokens and transforming them by adding, changing, or removing claims.</span></span> <span data-ttu-id="dac3e-153">ClaimsAuthenticationManager を使用しての要求を変換する方法の詳細については、次を参照してください[How To:。WIF および ACS を使用してクレーム対応 ASP.NET アプリケーションで実装ロール ベースのアクセス制御 (RBAC)](https://go.microsoft.com/fwlink/?LinkID=247445)します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-153">For more information about how to use ClaimsAuthenticationManager for transforming claims, see [How To: Implement Role Based Access Control (RBAC) in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247445).</span></span>  
  
- <span data-ttu-id="dac3e-154">**samlSecurityTokenRequirement 構成セクションを使用して、任意のクレームをロールの種類に対応付ける**。宣言を使用したアプローチで、構成のみを使ってクレーム変換が行われます。その際、コーディングは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="dac3e-154">**Mapping arbitrary claims to a role type using the samlSecurityTokenRequirement configuration section**—A declarative approach where the claims transformation is done using only the configuration and no coding is required.</span></span>  
  
<a name="BKMK_2"></a>   
## <a name="claims-based-authorization"></a><span data-ttu-id="dac3e-155">クレーム ベースの承認</span><span class="sxs-lookup"><span data-stu-id="dac3e-155">Claims-based Authorization</span></span>  
 <span data-ttu-id="dac3e-156">クレーム ベースの承認では、アクセスの許可または拒否の承認決定が、クレームで使用できるデータを使って決定を行う任意のロジックに基づいています。</span><span class="sxs-lookup"><span data-stu-id="dac3e-156">Claims-based authorization is an approach where the authorization decision to grant or deny access is based on arbitrary logic that uses data available in claims to make the decision.</span></span> <span data-ttu-id="dac3e-157">RBAC の場合は、使用される唯一のクレームがロール タイプのクレームでした。</span><span class="sxs-lookup"><span data-stu-id="dac3e-157">Recall that in the case of RBAC, the only claim used was role type claim.</span></span> <span data-ttu-id="dac3e-158">ロール タイプのクレームは、ユーザーが特定のロールに所属するかどうかを確認するときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-158">A role type claim was used to check if the user belongs to specific role or not.</span></span> <span data-ttu-id="dac3e-159">クレーム ベースの承認を使用した承認決定のプロセスを説明するために、次の手順について考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="dac3e-159">To illustrate the process of making the authorization decisions using claims-based authorization approach, consider the following steps:</span></span>  
  
1. <span data-ttu-id="dac3e-160">アプリケーションは、ユーザー認証を求める要求を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-160">The application receives a request that requires the user is authenticated.</span></span>  
  
2. <span data-ttu-id="dac3e-161">WIF はユーザーを ID プロバイダーにリダイレクトします。ユーザーが認証されたら、アプリケーション要求が、ユーザーを表す関連セキュリティ トークンを使用して行われます。そのトークンには、ユーザーに関するクレームが含まれています。</span><span class="sxs-lookup"><span data-stu-id="dac3e-161">WIF redirects the user to their identity provider, after they are authenticated the application request is made with an associated security token representing the user containing claims about them.</span></span> <span data-ttu-id="dac3e-162">WIF は、そのクレームを、ユーザーを表すプリンシパルに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-162">WIF associates those claims with the principal that represents the user.</span></span>  
  
3. <span data-ttu-id="dac3e-163">アプリケーションは、クレームを決定ロジック機構に渡します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-163">The application passes the claims to the decision logic mechanism.</span></span> <span data-ttu-id="dac3e-164">これには Web サービスへの呼び出し、データベースに対するクエリ、または高度な規則エンジンを使用できます。また、ClaimsAuthorizationManager を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-164">It can be in-memory code, a call to a web service, a query to a database, a sophisticated rules engine, or using the ClaimsAuthorizationManager.</span></span>  
  
4. <span data-ttu-id="dac3e-165">決定機構では、クレームに基づいて結果が計算されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-165">The decision mechanism calculates the outcome based on the claims.</span></span>  
  
5. <span data-ttu-id="dac3e-166">結果が true の場合はアクセスが許可され、false の場合は拒否されます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-166">Access is granted if the outcome is true and denied if it is false.</span></span> <span data-ttu-id="dac3e-167">たとえば、ワシントン州に住む 21 歳以上のユーザーという規則を使用できます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-167">For example, the rule might be that the user is of age 21 or above and lives in Washington State.</span></span>  
  
 <span data-ttu-id="dac3e-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> は、アプリケーションでクレーム ベースの承認の決定ロジックを外部化するときに役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-168"><xref:System.Security.Claims.ClaimsAuthorizationManager> is useful for externalizing the decision logic for  claims-based authorization in your applications.</span></span> <span data-ttu-id="dac3e-169">ClaimsAuthorizationManager は、.NET 4.5 に含まれている WIF コンポーネントです。</span><span class="sxs-lookup"><span data-stu-id="dac3e-169">ClaimsAuthorizationManager is a WIF component that ships as part of .NET 4.5.</span></span> <span data-ttu-id="dac3e-170">ClaimsAuthorizationManager を使用すると、着信要求を受け取り、任意のロジックを実装して、受信クレームに基づいて承認決定を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="dac3e-170">ClaimsAuthorizationManager allows you to intercept incoming requests and implement any logic of your choice to make authorization decisions based on the incoming claims.</span></span> <span data-ttu-id="dac3e-171">これは、承認ロジックを変更する必要があるときに重要になります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-171">This becomes important when authorization logic needs to be changed.</span></span> <span data-ttu-id="dac3e-172">この状況で ClaimsAuthorizationManager を使用してもアプリケーションの整合性には影響しないため、変更によってアプリケーション エラーが発生する可能性は少なくなります。</span><span class="sxs-lookup"><span data-stu-id="dac3e-172">In that case, using ClaimsAuthorizationManager will not affect the application’s integrity, thereby reducing the likelihood of an application error as a result of the change.</span></span> <span data-ttu-id="dac3e-173">ClaimsAuthorizationManager を使用して、クレーム ベースのアクセス制御を実装する方法の詳細については、次を参照してください[How To:。要求承認を WIF および ACS を使用してクレーム対応 ASP.NET アプリケーションで実装](https://go.microsoft.com/fwlink/?LinkID=247446)します。</span><span class="sxs-lookup"><span data-stu-id="dac3e-173">To learn more about how to use ClaimsAuthorizationManager to implement claims-based access control, see [How To: Implement Claims Authorization in a Claims Aware ASP.NET Application Using WIF and ACS](https://go.microsoft.com/fwlink/?LinkID=247446).</span></span>
