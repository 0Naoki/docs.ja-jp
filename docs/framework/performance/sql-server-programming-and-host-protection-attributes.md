---
title: SQL Server プログラミングとホスト保護属性
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088720"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>SQL Server プログラミングとホスト保護属性
SQL Server ホストにマネージド コードを読み込み、実行する機能を利用するには、コード アクセス セキュリティとホスト リソース保護の両方においてホストの要件を満たす必要があります。  コード アクセス セキュリティの要件については、次の 3 つの SQL Server アクセス許可セットのいずれかで指定します。SAFE、EXTERNAL-ACCESS、または UNSAFE です。 SAFE アクセス許可セット内か EXTERNAL-ACCESS アクセス許可セット内でコードを実行する場合、<xref:System.Security.Permissions.HostProtectionAttribute> 属性が適用されている特定の型またはメンバーを避ける必要があります。 <xref:System.Security.Permissions.HostProtectionAttribute> はセキュリティ アクセス許可ではなく、むしろ信頼性保証であり、ホストが許可しない可能性がある特定のコード コンストラクト (型またはメソッド) を識別します。  <xref:System.Security.Permissions.HostProtectionAttribute> を使用することで、ホストの安定性を保護するプログラミング モデルを適用します。  
  
## <a name="host-protection-attributes"></a>ホスト保護属性  
 ホスト保護属性は、ホスト プログラミング モデルに合わない型またはメンバーを特定し、以下の信頼性レベルの脅威の増加を表します。  
  
-   それ以外は害がない。  
  
-   サーバーが管理するユーザー コードが不安定になる可能性がある。  
  
-   サーバー プロセス自体が不安定になる可能性がある。  
  
 SQL Server は、<xref:System.Security.Permissions.HostProtectionResource> 値として <xref:System.Security.Permissions.HostProtectionResource.SharedState>、<xref:System.Security.Permissions.HostProtectionResource.Synchronization>、<xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort>、<xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt> を指定する <xref:System.Security.Permissions.HostProtectionAttribute> を持つ型またはメンバーの使用を禁止します。 これにより、共有状態を有効にし、同期を実行し、終了時にリソースを漏洩する可能性があり、SQL Server プロセスの整合性に影響を与えるメンバーの呼び出しをアセンブリに禁止します。  
  
### <a name="disallowed-types-and-members"></a>禁止されている型とメンバー  
 次の表は、<xref:System.Security.Permissions.HostProtectionResource> 値が SQL Server により禁止される型とメンバーをまとめたものです。  
  
|名前空間|型またはメンバー|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.SystemEvents> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> delegate<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> class|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> メソッド|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> class<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> delegate<br /><br /> <xref:System.ComponentModel.ArrayConverter> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.AsyncOperation> class<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> class<br /><br /> <xref:System.ComponentModel.AttributeCollection> class<br /><br /> <xref:System.ComponentModel.BackgroundWorker> class<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> class<br /><br /> <xref:System.ComponentModel.BindingList%601> class<br /><br /> <xref:System.ComponentModel.BooleanConverter> class<br /><br /> <xref:System.ComponentModel.ByteConverter> class<br /><br /> <xref:System.ComponentModel.CancelEventArgs> class<br /><br /> <xref:System.ComponentModel.CancelEventHandler> delegate<br /><br /> <xref:System.ComponentModel.CharConverter> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> delegate<br /><br /> <xref:System.ComponentModel.CollectionConverter> class<br /><br /> <xref:System.ComponentModel.ComponentCollection> class<br /><br /> <xref:System.ComponentModel.ComponentConverter> class<br /><br /> <xref:System.ComponentModel.ComponentEditor> class<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> class<br /><br /> <xref:System.ComponentModel.Container> class<br /><br /> <xref:System.ComponentModel.ContainerFilterService> class<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> class<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> class<br /><br /> <xref:System.ComponentModel.DateTimeConverter> class<br /><br /> <xref:System.ComponentModel.DecimalConverter> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> class<br /><br /> <xref:System.ComponentModel.Design.CommandID> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> class<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> class<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> delegate<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> class<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> class<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> delegate<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> class<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> class<br /><br /> <xref:System.ComponentModel.DoubleConverter> class<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> class<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> delegate<br /><br /> <xref:System.ComponentModel.EnumConverter> class<br /><br /> <xref:System.ComponentModel.EventDescriptor> class<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.EventHandlerList> class<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> class<br /><br /> <xref:System.ComponentModel.HandledEventArgs> class<br /><br /> <xref:System.ComponentModel.HandledEventHandler> delegate<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> class<br /><br /> <xref:System.ComponentModel.Int16Converter> class<br /><br /> <xref:System.ComponentModel.Int32Converter> class<br /><br /> <xref:System.ComponentModel.Int64Converter> class<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> class<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> class<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> メソッド<br /><br /> <xref:System.ComponentModel.License> class<br /><br /> <xref:System.ComponentModel.LicenseContext> class<br /><br /> <xref:System.ComponentModel.LicenseException> class<br /><br /> <xref:System.ComponentModel.LicenseManager> class<br /><br /> <xref:System.ComponentModel.LicenseProvider> class<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> class<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.ListSortDescription> class<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> class<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> class<br /><br /> <xref:System.ComponentModel.MemberDescriptor> class<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> class<br /><br /> <xref:System.ComponentModel.NestedContainer> class<br /><br /> <xref:System.ComponentModel.NullableConverter> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> class<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.ReferenceConverter> class<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> class<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> delegate<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> delegate<br /><br /> <xref:System.ComponentModel.SByteConverter> class<br /><br /> <xref:System.ComponentModel.SingleConverter> class<br /><br /> <xref:System.ComponentModel.StringConverter> class<br /><br /> <xref:System.ComponentModel.SyntaxCheck> class<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> class<br /><br /> <xref:System.ComponentModel.TypeConverter> class<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> class<br /><br /> <xref:System.ComponentModel.TypeDescriptor> class<br /><br /> <xref:System.ComponentModel.TypeListConverter> class<br /><br /> <xref:System.ComponentModel.UInt16Converter> class<br /><br /> <xref:System.ComponentModel.UInt32Converter> class<br /><br /> <xref:System.ComponentModel.UInt64Converter> class<br /><br /> <xref:System.ComponentModel.WarningException> class<br /><br /> <xref:System.ComponentModel.Win32Exception> class|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> property<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> class<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> class<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> class<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> class<br /><br /> <xref:System.Diagnostics.PerformanceCounter> class<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> class<br /><br /> <xref:System.Diagnostics.Process> class<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> class<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceListener> class<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> property|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> メソッド|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> class<br /><br /> <xref:System.Reflection.Emit.EventBuilder> class<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> class<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodRental> class<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> class<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> class<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> class<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> class|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> メソッド|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> class<br /><br /> <xref:System.Threading.EventWaitHandle> class<br /><br /> <xref:System.Threading.ManualResetEvent> class<br /><br /> <xref:System.Threading.Monitor> class<br /><br /> <xref:System.Threading.Mutex> class<br /><br /> <xref:System.Threading.ReaderWriterLock> class<br /><br /> <xref:System.Threading.Semaphore> class<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> メソッド<br /><br /> <xref:System.Threading.ThreadPool> class<br /><br /> <xref:System.Threading.Timer> class|  
|`System.Timers`|<xref:System.Timers.Timer> class|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> class|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> property|  
  
## <a name="sql-server-permission-sets"></a>SQL Server アクセス許可セット  
 SQL Server では、データベースに展開されたコードの信頼性要件をユーザーは指定できます。 アセンブリがデータベースにアップロードされると、アセンブリの作成者を指定できます 3 つのアクセス許可セットのいずれかのアセンブリ。SAFE、EXTERNAL-ACCESS、または UNSAFE です。  
  
|アクセス許可セット|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|コード アクセス セキュリティ|実行のみ|実行 + 外部リソースへのアクセス|無制限|  
|プログラミング モデルの制限事項|はい|はい|無制限|  
|検証可能性の要件|はい|[はい]|いいえ|  
|ネイティブ コードを呼び出す機能|いいえ|×|はい|  
  
 SAFE は、許可されるプログラミング モデルに関して、制限が関連付けられた、最も信頼性があり、安全なモードです。 SAFE コードには、信頼性とセキュリティの高い機能があります。 SAFE アセンブリには、実行、計算の実行、ローカル データベースにアクセスするために十分なアクセス許可が与えられます。 SAFE アセンブリは検証可能なタイプ セーフでなければなりません。また、アンマネージ コードの呼び出しを禁止する必要があります。  
  
 EXTERNAL-ACCESS はセキュリティとして中間の選択肢であり、データベースの外にあるリソースへのアクセスをコードに許可しますが、SAFE の信頼性と安全性も備えています。  
  
 UNSAFE は信頼性が高いコードであり、データベース管理者のみが作成できます。 信頼性の高いこのコードにはコード アクセス制限がなく、アンマネージ (ネイティブ) コードを呼び出すことができます。  
  
 SQL Server はホスト レベルのコード アクセス セキュリティ ポリシー層を利用し、SQL Server カタログに保存されているアクセス許可セットに基づき、3 つのアクセス許可セットのいずれかを与えるホスト ポリシーを設定します。 マネージド コードをデータベース内で実行するとき、常に、3 つのコード アクセス許可セットのいずれかが取得されます。  
  
## <a name="programming-model-restrictions"></a>プログラミング モデルの制限  
 SQL Server のマネージド コードのプログラミング モデルは、複数の呼び出しで状態を維持すること、または、複数のユーザー セッションで状態を共有することを要求しない関数、プロシージャ、型を必要とします。 また、前述のように、共有状態の存在は、アプリケーションの拡張性と信頼性に影響を与える重大な例外を引き起こす可能性があります。  
  
 以上を考慮した上で、SQL Server は静的変数と静的データ メンバーの使用を禁止します。 SAFE アセンブリと EXTERNAL-ACCESS アセンブリに関しては、SQL Server は CREATE ASSEMBLY 時にアセンブリのメタデータを調べ、静的データ メンバーや静的変数の使用が見つかった場合、SAFE アセンブリまたは EXTERNAL-ACCESS アセンブリの作成に失敗します。  
  
## <a name="see-also"></a>関連項目

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
