---
title: 例外
ms.date: 03/30/2017
ms.assetid: 065205cc-52dd-4f30-9578-b17d8d113136
ms.openlocfilehash: 64a8338133c265ee1b4c7acbd9b4d168318b66a5
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2019
ms.locfileid: "61773634"
---
# <a name="exceptions"></a><span data-ttu-id="ca562-102">例外</span><span class="sxs-lookup"><span data-stu-id="ca562-102">Exceptions</span></span>
<span data-ttu-id="ca562-103">ワークフローは、<xref:System.Activities.Statements.TryCatch> アクティビティを使用して、ワークフローの実行中に発生した例外を処理することができます。</span><span class="sxs-lookup"><span data-stu-id="ca562-103">Workflows can use the <xref:System.Activities.Statements.TryCatch> activity to handle exceptions that are raised during the execution of a workflow.</span></span> <span data-ttu-id="ca562-104">これらの例外は、処理することも可能ですが、<xref:System.Activities.Statements.Rethrow> アクティビティを使用して再スローすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ca562-104">These exceptions can be handled or they can be re-thrown using the <xref:System.Activities.Statements.Rethrow> activity.</span></span> <span data-ttu-id="ca562-105"><xref:System.Activities.Statements.TryCatch.Finally%2A> セクションのアクティビティは、<xref:System.Activities.Statements.TryCatch.Try%2A> セクションまたは <xref:System.Activities.Statements.TryCatch.Catches%2A> セクションが完了したときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-105">Activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section are executed when either the <xref:System.Activities.Statements.TryCatch.Try%2A> section or the <xref:System.Activities.Statements.TryCatch.Catches%2A> section completes.</span></span> <span data-ttu-id="ca562-106">によってホストされるワークフローを<xref:System.Activities.WorkflowApplication>インスタンスを使用することも、<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>によって処理されない例外を処理するイベント ハンドラーを<xref:System.Activities.Statements.TryCatch>アクティビティ。</span><span class="sxs-lookup"><span data-stu-id="ca562-106">Workflows hosted by a <xref:System.Activities.WorkflowApplication> instance can also use the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> event handler to handle exceptions that are not handled by a <xref:System.Activities.Statements.TryCatch> activity.</span></span>  
  
## <a name="causes-of-exceptions"></a><span data-ttu-id="ca562-107">例外の原因</span><span class="sxs-lookup"><span data-stu-id="ca562-107">Causes of Exceptions</span></span>  
 <span data-ttu-id="ca562-108">ワークフローでは、例外は、次の方法で生成されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-108">In a workflow, exceptions can be generated in the following ways:</span></span>  
  
- <span data-ttu-id="ca562-109"><xref:System.Activities.Statements.TransactionScope> でのトランザクションのタイムアウト</span><span class="sxs-lookup"><span data-stu-id="ca562-109">A time-out of transactions in <xref:System.Activities.Statements.TransactionScope>.</span></span>  
  
- <span data-ttu-id="ca562-110"><xref:System.Activities.Statements.Throw> アクティビティを使用してワークフローからスローされた明示的な例外</span><span class="sxs-lookup"><span data-stu-id="ca562-110">An explicit exception thrown by the workflow using the <xref:System.Activities.Statements.Throw> activity.</span></span>  
  
- <span data-ttu-id="ca562-111">アクティビティからスローされた [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] 例外</span><span class="sxs-lookup"><span data-stu-id="ca562-111">A [!INCLUDE[netfx_current_short](../../../includes/netfx-current-short-md.md)] exception thrown from an activity.</span></span>  
  
- <span data-ttu-id="ca562-112">ワークフローで使用されているライブラリ、コンポーネント、サービスなどの外部コードからスローされた例外</span><span class="sxs-lookup"><span data-stu-id="ca562-112">An exception thrown from external code, such as libraries, components, or services that are used in the workflow.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="ca562-113">例外処理</span><span class="sxs-lookup"><span data-stu-id="ca562-113">Handling Exceptions</span></span>  
 <span data-ttu-id="ca562-114">アクティビティからスローされた例外が処理されない場合、既定の動作では、ワークフロー インスタンスが終了します。</span><span class="sxs-lookup"><span data-stu-id="ca562-114">If an exception is thrown by an activity and is unhandled, the default behavior is to terminate the workflow instance.</span></span> <span data-ttu-id="ca562-115">カスタムの <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> ハンドラーが存在する場合、このハンドラーで既定の動作をオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="ca562-115">If a custom <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is present, it can override this default behavior.</span></span> <span data-ttu-id="ca562-116">このハンドラーがあると、ワークフロー ホストの作成者は、カスタムのログ記録、ワークフローの中止、ワークフローのキャンセル、ワークフローの終了などの適切な処理を実行できます。</span><span class="sxs-lookup"><span data-stu-id="ca562-116">This handler gives the workflow host author an opportunity to provide the appropriate handling, such as custom logging, aborting the workflow, canceling the workflow, or terminating the workflow.</span></span>  <span data-ttu-id="ca562-117">ワークフローが処理されない例外を発生する場合、<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> ハンドラーが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-117">If a workflow raises an exception that is not handled, the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="ca562-118"><xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> から戻された 3 つの可能なアクションがあり、これによりワークフローの最終結果が決定されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-118">There are three possible actions returned from <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> which determine the final outcome of the workflow.</span></span>  
  
- <span data-ttu-id="ca562-119">**キャンセル**-キャンセルされたワークフロー インスタンスは分岐実行の正常な終了します。</span><span class="sxs-lookup"><span data-stu-id="ca562-119">**Cancel** - A cancelled workflow instance is a graceful exit of a branch execution.</span></span> <span data-ttu-id="ca562-120">キャンセルの動作をモデル化できます (たとえば、CancellationScope アクティビティを使用して)。</span><span class="sxs-lookup"><span data-stu-id="ca562-120">You can model cancelation behavior (for example, by using a CancellationScope activity).</span></span> <span data-ttu-id="ca562-121">完了済みハンドラーはキャンセル プロセスが完了したときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-121">The Completed handler is invoked when the cancellation process completes.</span></span> <span data-ttu-id="ca562-122">取り消されたワーク フローはキャンセル状態にあります。</span><span class="sxs-lookup"><span data-stu-id="ca562-122">A cancelled workflow is in the Cancelled state.</span></span>  
  
- <span data-ttu-id="ca562-123">**終了**-終了したワークフロー インスタンスは再開または再起動することはできません。</span><span class="sxs-lookup"><span data-stu-id="ca562-123">**Terminate** - A terminated workflow instance cannot be resumed or restarted.</span></span>  <span data-ttu-id="ca562-124">これにより完了イベントがトリガーされ、中断されたという理由の例外を提供できます。</span><span class="sxs-lookup"><span data-stu-id="ca562-124">This triggers the Completed event in which you can provide an exception as the reason it was terminated.</span></span> <span data-ttu-id="ca562-125">終了したハンドラーはキャンセル プロセスが終了したときに呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-125">The Terminated handler is invoked when the termination process completes.</span></span> <span data-ttu-id="ca562-126">終了したワークフローは失敗状態です。</span><span class="sxs-lookup"><span data-stu-id="ca562-126">A terminated workflow is in the Faulted state.</span></span>  
  
- <span data-ttu-id="ca562-127">**中止**-永続的に構成されている場合にのみ、中止されたワークフロー インスタンスを再開できます。</span><span class="sxs-lookup"><span data-stu-id="ca562-127">**Abort** - An aborted workflow instances can be resumed only if it has been configured to be persistent.</span></span>  <span data-ttu-id="ca562-128">永続化がない場合、ワークフローは再開できません。</span><span class="sxs-lookup"><span data-stu-id="ca562-128">Without persistence, a workflow cannot be resumed.</span></span>  <span data-ttu-id="ca562-129">ワークフローが中止したポイントで、最後の永続性ポイントが失われるため (メモリ内で)、どの作業も終了します。</span><span class="sxs-lookup"><span data-stu-id="ca562-129">At the point a workflow is aborted, any work done (in memory) since the last persistence point will be lost.</span></span> <span data-ttu-id="ca562-130">中止されたワーク フローに対して、中止プロセスが完了したときの例外を使用して、中止されたハンドラーが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-130">For an aborted workflow, the Aborted handler is invoked using the exception as the reason when the abort process completes.</span></span> <span data-ttu-id="ca562-131">しかし、キャンセルおよび終了と異なり、完了ハンドラーは呼び出されません。</span><span class="sxs-lookup"><span data-stu-id="ca562-131">However, unlike Cancelled and Terminated, the Completed handler is not invoked.</span></span> <span data-ttu-id="ca562-132">中止されたワーク フローが中断状態にあります。</span><span class="sxs-lookup"><span data-stu-id="ca562-132">An aborted workflow is in an Aborted state.</span></span>  
  
 <span data-ttu-id="ca562-133">次の例では、例外をスローするワークフローを呼び出しています。</span><span class="sxs-lookup"><span data-stu-id="ca562-133">The following example invokes a workflow that throws an exception.</span></span> <span data-ttu-id="ca562-134">ワークフローで例外が処理されないため、<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> ハンドラーが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-134">The exception is unhandled by the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="ca562-135">例外に関する情報を提供するために <xref:System.Activities.WorkflowApplicationUnhandledExceptionEventArgs> が調査され、ワークフローは終了します。</span><span class="sxs-lookup"><span data-stu-id="ca562-135">The <xref:System.Activities.WorkflowApplicationUnhandledExceptionEventArgs> are inspected to provide information about the exception, and the workflow is terminated.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1)]  
  
### <a name="handling-exceptions-with-the-trycatch-activity"></a><span data-ttu-id="ca562-136">TryCatch アクティビティでの例外処理</span><span class="sxs-lookup"><span data-stu-id="ca562-136">Handling Exceptions with the TryCatch Activity</span></span>  
 <span data-ttu-id="ca562-137">ワークフロー内部での例外処理は、<xref:System.Activities.Statements.TryCatch> アクティビティで実行されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-137">Handling exceptions inside a workflow is performed with the <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="ca562-138"><xref:System.Activities.Statements.TryCatch> アクティビティには、それぞれが特定の <xref:System.Activities.Statements.TryCatch.Catches%2A> 型に関連付けられている <xref:System.Activities.Statements.Catch> アクティビティの <xref:System.Exception> コレクションがあります。</span><span class="sxs-lookup"><span data-stu-id="ca562-138">The <xref:System.Activities.Statements.TryCatch> activity has a <xref:System.Activities.Statements.TryCatch.Catches%2A> collection of <xref:System.Activities.Statements.Catch> activities that are each associated with a specific <xref:System.Exception> type.</span></span> <span data-ttu-id="ca562-139"><xref:System.Activities.Statements.TryCatch.Try%2A> アクティビティの <xref:System.Activities.Statements.TryCatch> セクションに含まれているアクティビティからスローされた例外が、<xref:System.Activities.Statements.Catch%601> コレクションの <xref:System.Activities.Statements.TryCatch.Catches%2A> アクティビティの例外に一致する場合、スローされた例外が処理されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-139">If the exception thrown by an activity that is contained in the <xref:System.Activities.Statements.TryCatch.Try%2A> section of a <xref:System.Activities.Statements.TryCatch> activity matches the exception of a <xref:System.Activities.Statements.Catch%601> activity in the <xref:System.Activities.Statements.TryCatch.Catches%2A> collection, then the exception is handled.</span></span> <span data-ttu-id="ca562-140">例外が明示的に再スローされるか、新しい例外がスローされた場合、この例外は親アクティビティに渡されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-140">If the exception is explicitly re-thrown or a new exception is thrown then this exception passes up to the parent activity.</span></span> <span data-ttu-id="ca562-141">次のコード例は、<xref:System.Activities.Statements.TryCatch> セクションで <xref:System.ApplicationException> アクティビティからスローされた <xref:System.Activities.Statements.TryCatch.Try%2A> を処理する <xref:System.Activities.Statements.Throw> アクティビティを示しています。</span><span class="sxs-lookup"><span data-stu-id="ca562-141">The following code example shows a <xref:System.Activities.Statements.TryCatch> activity that handles an <xref:System.ApplicationException> that is thrown in the <xref:System.Activities.Statements.TryCatch.Try%2A> section by a <xref:System.Activities.Statements.Throw> activity.</span></span> <span data-ttu-id="ca562-142">例外のメッセージが <xref:System.Activities.Statements.Catch%601> アクティビティによってコンソールに書き込まれた後、<xref:System.Activities.Statements.TryCatch.Finally%2A> セクションでメッセージがコンソールに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="ca562-142">The exception's message is written to the console by the <xref:System.Activities.Statements.Catch%601> activity, and then a message is written to the console in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#33](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#33)]  
  
 <span data-ttu-id="ca562-143"><xref:System.Activities.Statements.TryCatch.Finally%2A> セクションのアクティビティは、<xref:System.Activities.Statements.TryCatch.Try%2A> セクションまたは <xref:System.Activities.Statements.TryCatch.Catches%2A> セクションが正常に完了したときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-143">The activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> section are executed when either the <xref:System.Activities.Statements.TryCatch.Try%2A> section or the <xref:System.Activities.Statements.TryCatch.Catches%2A> section successfully completes.</span></span> <span data-ttu-id="ca562-144">例外がスローされない場合 <xref:System.Activities.Statements.TryCatch.Try%2A> セクションは正常に完了し、例外がスローまたは再スローされない場合 <xref:System.Activities.Statements.TryCatch.Catches%2A> セクションは正常に完了します。</span><span class="sxs-lookup"><span data-stu-id="ca562-144">The <xref:System.Activities.Statements.TryCatch.Try%2A> section successfully completes if no exceptions are thrown from it, and the <xref:System.Activities.Statements.TryCatch.Catches%2A> section successfully completes if no exceptions are thrown or rethrown from it.</span></span> <span data-ttu-id="ca562-145">例外が <xref:System.Activities.Statements.TryCatch.Try%2A> の <xref:System.Activities.Statements.TryCatch> セクションでスローされ、<xref:System.Activities.Statements.Catch%601> セクションの <xref:System.Activities.Statements.TryCatch.Catches%2A> で処理されないか、または <xref:System.Activities.Statements.TryCatch.Catches%2A> から再スローされる場合、<xref:System.Activities.Statements.TryCatch.Finally%2A> のアクティビティは以下のいずれかが発生しない限り実行されません。</span><span class="sxs-lookup"><span data-stu-id="ca562-145">If an exception is thrown in the <xref:System.Activities.Statements.TryCatch.Try%2A> section of a <xref:System.Activities.Statements.TryCatch> and is either not handled by a <xref:System.Activities.Statements.Catch%601> in the <xref:System.Activities.Statements.TryCatch.Catches%2A> section, or is rethrown from the <xref:System.Activities.Statements.TryCatch.Catches%2A>, the activities in the <xref:System.Activities.Statements.TryCatch.Finally%2A> will not be executed unless the one of the following occurs.</span></span>  
  
- <span data-ttu-id="ca562-146">高レベルの <xref:System.Activities.Statements.TryCatch> から再スローされるかにかかわらず、例外がワーク フローの高レベルの <xref:System.Activities.Statements.TryCatch> アクティビティによって取得されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-146">The exception is caught by a higher level <xref:System.Activities.Statements.TryCatch> activity in the workflow, regardless of whether it is rethrown from that higher level <xref:System.Activities.Statements.TryCatch>.</span></span>  
  
- <span data-ttu-id="ca562-147">例外は高レベルの <xref:System.Activities.Statements.TryCatch> では扱われず、ワークフローのルートをエスケープし、ワーク フローが完了または中止ではなく取り消すように構成されます。</span><span class="sxs-lookup"><span data-stu-id="ca562-147">The exception is not handled by a higher level <xref:System.Activities.Statements.TryCatch>, escapes the root of the workflow, and the workflow is configured to cancel instead of terminate or abort.</span></span> <span data-ttu-id="ca562-148"><xref:System.Activities.WorkflowApplication> を使用してホストされたワークフローは、<xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> を処理し <xref:System.Activities.UnhandledExceptionAction.Cancel> を返してこれを構成できます。</span><span class="sxs-lookup"><span data-stu-id="ca562-148">Workflows hosted using <xref:System.Activities.WorkflowApplication> can configure this by handling <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> and returning <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="ca562-149"><xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> を処理する例は、このトピックで既に提供されています。</span><span class="sxs-lookup"><span data-stu-id="ca562-149">An example of handling <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> is provided previously in this topic.</span></span> <span data-ttu-id="ca562-150">ワークフロー サービスは <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> を使用し <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel> を指定してこれを構成できます。</span><span class="sxs-lookup"><span data-stu-id="ca562-150">Workflow services can configure this by using <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior> and specifying <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="ca562-151">構成の例については<xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior>を参照してください[ワークフロー サービス ホストの拡張機能](../wcf/feature-details/workflow-service-host-extensibility.md)します。</span><span class="sxs-lookup"><span data-stu-id="ca562-151">For an example of configuring <xref:System.ServiceModel.Activities.Description.WorkflowUnhandledExceptionBehavior>, see [Workflow Service Host Extensibility](../wcf/feature-details/workflow-service-host-extensibility.md).</span></span>  
  
## <a name="exception-handling-versus-compensation"></a><span data-ttu-id="ca562-152">例外処理と補正の比較</span><span class="sxs-lookup"><span data-stu-id="ca562-152">Exception Handling versus Compensation</span></span>  
 <span data-ttu-id="ca562-153">例外処理は、アクティビティの実行中に発生するという点で補正と異なります。</span><span class="sxs-lookup"><span data-stu-id="ca562-153">The difference between exception handling and compensation is that exception handling occurs during the execution of an activity.</span></span> <span data-ttu-id="ca562-154">補正が発生するのは、アクティビティが正常に完了した後です。</span><span class="sxs-lookup"><span data-stu-id="ca562-154">Compensation occurs after an activity has successfully completed.</span></span> <span data-ttu-id="ca562-155">例外処理では、アクティビティが例外を生成した後でクリーン アップを実行できます。また、補正処理では、前に完了したアクティビティの正常に完了した作業を元に戻すことが可能です。</span><span class="sxs-lookup"><span data-stu-id="ca562-155">Exception handling provides an opportunity to clean up after the activity raises the exception, whereas compensation provides a mechanism by which the successfully completed work of a previously completed activity can be undone.</span></span> <span data-ttu-id="ca562-156">詳細については、次を参照してください。[補正](compensation.md)します。</span><span class="sxs-lookup"><span data-stu-id="ca562-156">For more information, see [Compensation](compensation.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ca562-157">関連項目</span><span class="sxs-lookup"><span data-stu-id="ca562-157">See also</span></span>

- <xref:System.Activities.Statements.TryCatch>
- <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A>
- <xref:System.Activities.Statements.CompensableActivity>
