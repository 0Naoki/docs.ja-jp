---
title: CancellationScope の使用
ms.date: 03/30/2017
ms.assetid: 39c5c338-b316-43d6-b7fe-a543281dd1ec
ms.openlocfilehash: 62b798b29149e30a2fae680b507f62ef0a2e23d7
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/04/2018
ms.locfileid: "33517467"
---
# <a name="using-cancellationscope"></a><span data-ttu-id="6636b-102">CancellationScope の使用</span><span class="sxs-lookup"><span data-stu-id="6636b-102">Using CancellationScope</span></span>
<span data-ttu-id="6636b-103">このサンプルでは、<xref:System.Activities.Statements.CancellationScope> アクティビティを使用してアプリケーション内の処理を取り消す方法を示します。</span><span class="sxs-lookup"><span data-stu-id="6636b-103">This sample demonstrates how to use the <xref:System.Activities.Statements.CancellationScope> activity to cancel work in an application.</span></span>  
  
 <span data-ttu-id="6636b-104">中間層のコンポーネントやサービスの多くでは、既知のプログラミング構成要素であるトランザクションを使用して取り消しを処理します。</span><span class="sxs-lookup"><span data-stu-id="6636b-104">Many middle tier components and services rely on the well-known programming construct of transactions to handle cancellation for them.</span></span>  <span data-ttu-id="6636b-105">ただし、トランザクションでは実行できない処理を取り消さなければならない場合も数多くあります。</span><span class="sxs-lookup"><span data-stu-id="6636b-105">However, there are many situations in which work that cannot be done in a transaction must be canceled.</span></span>  <span data-ttu-id="6636b-106">取り消しを使用することがトランザクションを使用することよりも難しいのは、取り消す必要がある処理を先に追跡しなければならないからです。</span><span class="sxs-lookup"><span data-stu-id="6636b-106">Using cancellation is more difficult than using transactions, because work that must be canceled must first be tracked.</span></span> [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)]<span data-ttu-id="6636b-107"> には、この処理に役立つ <xref:System.Activities.Statements.CancellationScope> アクティビティが用意されています。</span><span class="sxs-lookup"><span data-stu-id="6636b-107"> helps you with this by providing a <xref:System.Activities.Statements.CancellationScope> activity.</span></span>  
  
 <span data-ttu-id="6636b-108">取り消しはアクティビティ内またはアクティビティの親からトリガーできます。</span><span class="sxs-lookup"><span data-stu-id="6636b-108">Cancellation can be triggered either from within an activity or from the activity's parent.</span></span>  <span data-ttu-id="6636b-109">子アクティビティは、親アクティビティ (<xref:System.Activities.Statements.Sequence>、<xref:System.Activities.Statements.Parallel>、<xref:System.Activities.Statements.Flowchart>、またはカスタム複合アクティビティ) によってスケジュールされます。</span><span class="sxs-lookup"><span data-stu-id="6636b-109">Child activities are scheduled by their parent activity (such as a <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.Parallel>, <xref:System.Activities.Statements.Flowchart>, or a custom composite activity).</span></span>  <span data-ttu-id="6636b-110">親アクティビティは、どのような理由でも子アクティビティを取り消すことができます。</span><span class="sxs-lookup"><span data-stu-id="6636b-110">The parent activity can cancel child activities for any reason.</span></span>  <span data-ttu-id="6636b-111">たとえば、3 つの子分岐がある <xref:System.Activities.Statements.Parallel> アクティビティでは、1 つの分岐が完了し、<xref:System.Activities.Statements.Parallel.CompletionCondition%2A> 式の評価結果が `true` であれば、残りの子分岐を取り消します。</span><span class="sxs-lookup"><span data-stu-id="6636b-111">For example, a <xref:System.Activities.Statements.Parallel> activity with three child branches will cancel the remaining child branches whenever it completes a branch and the <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> expression evaluates to `true`.</span></span> <span data-ttu-id="6636b-112">ワークフローは、ホスト アプリケーションで <xref:System.Activities.WorkflowApplication.Cancel%2A> を呼び出すことで外部から取り消すこともできます。</span><span class="sxs-lookup"><span data-stu-id="6636b-112">The workflow can also be canceled externally by the host application by calling <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span>  
  
 <span data-ttu-id="6636b-113"><xref:System.Activities.Statements.CancellationScope> アクティビティを使用するには、取り消す必要がある処理を <xref:System.Activities.Statements.CancellationScope.Body%2A> プロパティに設定し、取り消し後に実行する処理を <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> プロパティに設定します。</span><span class="sxs-lookup"><span data-stu-id="6636b-113">To use the <xref:System.Activities.Statements.CancellationScope> activity, put the work that needs to be canceled into the <xref:System.Activities.Statements.CancellationScope.Body%2A> property, and put the work that is performed after cancellation into the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> property.</span></span>  
  
 <span data-ttu-id="6636b-114">このサンプルでは、アクティビティ自体からアクティビティを取り消す方法を示します。</span><span class="sxs-lookup"><span data-stu-id="6636b-114">This sample demonstrates cancelling an activity from within the activity itself.</span></span>  
  
 <span data-ttu-id="6636b-115">このサンプルでは、マイアミ行きのチケットをできるだけ早く購入する必要があるクライアントのシナリオを使用して、<xref:System.Activities.Statements.CancellationScope> アクティビティの例を示します。</span><span class="sxs-lookup"><span data-stu-id="6636b-115">The scenario that the sample uses to demonstrate the <xref:System.Activities.Statements.CancellationScope> activity is a client wanting to buy a ticket to Miami as soon as possible.</span></span> <span data-ttu-id="6636b-116">取り引きを検討している旅行代理店が 2 社あり、</span><span class="sxs-lookup"><span data-stu-id="6636b-116">There are two travel agencies that want the business.</span></span> <span data-ttu-id="6636b-117">このビジネス ロジックを、<xref:System.Activities.Statements.CancellationScope> アクティビティ内の 2 つの <xref:System.Activities.Statements.Parallel> を使用してモデル化しています。</span><span class="sxs-lookup"><span data-stu-id="6636b-117">The sample uses two <xref:System.Activities.Statements.CancellationScope> within a <xref:System.Activities.Statements.Parallel> activity to model this business logic.</span></span> <span data-ttu-id="6636b-118"><xref:System.Activities.Statements.Parallel.CompletionCondition%2A> アクティビティの <xref:System.Activities.Statements.Parallel> は `true` に設定されています。分岐の完了後に <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> が確認されるため、最初の分岐が完了すると残りの分岐が取り消されます。</span><span class="sxs-lookup"><span data-stu-id="6636b-118">The <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> of the <xref:System.Activities.Statements.Parallel> activity is set to `true`; since the <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is checked after any branch completes, this will cause the remaining branch to be canceled after the first branch completes.</span></span> <span data-ttu-id="6636b-119">クライアント アプリケーションは、両方の代理店にチケットを注文し、どちらかでチケットを購入できた時点でもう一方の代理店の注文を取り消します。</span><span class="sxs-lookup"><span data-stu-id="6636b-119">The client application asks both agencies to buy the ticket, and when the first one confirms that the ticket has been bought, the application cancels the order at the other agency.</span></span>  
  
## <a name="to-use-this-sample"></a><span data-ttu-id="6636b-120">このサンプルを使用するには</span><span class="sxs-lookup"><span data-stu-id="6636b-120">To use this sample</span></span>  
  
1.  <span data-ttu-id="6636b-121">[!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] を使用して、CancelationScopeXAML.sln ソリューション ファイルを開きます。</span><span class="sxs-lookup"><span data-stu-id="6636b-121">Using [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], open the CancelationScopeXAML.sln solution file.</span></span>  
  
2.  <span data-ttu-id="6636b-122">ソリューションをビルドするには、Ctrl キーと Shift キーを押しながら B キーを押します。</span><span class="sxs-lookup"><span data-stu-id="6636b-122">To build the solution, press CTRL+SHIFT+B.</span></span>  
  
3.  <span data-ttu-id="6636b-123">ソリューションを実行するには、Ctrl キーを押しながら F5 キーを押します。</span><span class="sxs-lookup"><span data-stu-id="6636b-123">To run the solution, press CTRL+F5.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="6636b-124">サンプルは、既にコンピューターにインストールされている場合があります。</span><span class="sxs-lookup"><span data-stu-id="6636b-124">The samples may already be installed on your machine.</span></span> <span data-ttu-id="6636b-125">続行する前に、次の (既定の) ディレクトリを確認してください。</span><span class="sxs-lookup"><span data-stu-id="6636b-125">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="6636b-126">このディレクトリが存在しない場合に、 [Windows Communication Foundation (WCF) および .NET Framework 4 向けの Windows Workflow Foundation (WF) サンプル](http://go.microsoft.com/fwlink/?LinkId=150780)すべて Windows Communication Foundation (WCF) をダウンロードして[!INCLUDE[wf1](../../../../includes/wf1-md.md)]サンプルです。</span><span class="sxs-lookup"><span data-stu-id="6636b-126">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](http://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="6636b-127">このサンプルは、次のディレクトリに格納されます。</span><span class="sxs-lookup"><span data-stu-id="6636b-127">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Basic\Built-InActivities\CancellationScope`