---
title: null 許容参照型
description: この記事では、C# 8 で追加された null 許容参照型の概要を説明します。 新規および既存のプロジェクトにおいて、その機能によって null 参照例外に対する安全性がどのように提供されるかを学習します。
ms.date: 02/19/2019
ms.openlocfilehash: 1eb4ccb5ec4397cb81aab37c13a31c41533238e9
ms.sourcegitcommit: 41c0637e894fbcd0713d46d6ef1866f08dc321a2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/01/2019
ms.locfileid: "57411547"
---
# <a name="nullable-reference-types"></a><span data-ttu-id="14526-104">null 許容参照型</span><span class="sxs-lookup"><span data-stu-id="14526-104">Nullable reference types</span></span>

<span data-ttu-id="14526-105">C# 8.0 で導入された **null 許容参照型**および **null 非許容参照型**を使用すると、参照型変数のプロパティについて重要なことを表明できます。</span><span class="sxs-lookup"><span data-stu-id="14526-105">C# 8.0 introduces **nullable reference types** and **non-nullable reference types** that enable you to make important statements about the properties for reference type variables:</span></span>

- <span data-ttu-id="14526-106">**参照が null になることはない**。</span><span class="sxs-lookup"><span data-stu-id="14526-106">**A reference is not supposed to be null**.</span></span> <span data-ttu-id="14526-107">変数が null にならない場合、コンパイラでは最初に変数が null ではないことをチェックしないで変数を逆参照しても安全であることを保証する規則が適用されます。</span><span class="sxs-lookup"><span data-stu-id="14526-107">When variables aren't supposed to be null, the compiler enforces rules that ensure it is safe to dereference these variables without first checking that it isn't null:</span></span>
  - <span data-ttu-id="14526-108">変数は、null 以外の値に初期化される必要があります。</span><span class="sxs-lookup"><span data-stu-id="14526-108">The variable must be initialized to a non-null value.</span></span>
  - <span data-ttu-id="14526-109">変数に値 `null` を割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="14526-109">The variable can never be assigned the value `null`.</span></span>
- <span data-ttu-id="14526-110">**参照は null になることがある**。</span><span class="sxs-lookup"><span data-stu-id="14526-110">**A reference may be null**.</span></span> <span data-ttu-id="14526-111">変数が null になる可能性がある場合、コンパイラでは別の規則が適用されて、null 参照を正しくチェックしていることが確認されます。</span><span class="sxs-lookup"><span data-stu-id="14526-111">When variables may be null, the compiler enforces different rules to ensure that you've correctly checked for a null reference:</span></span>
  - <span data-ttu-id="14526-112">値が null ではないことをコンパイラが保証できる場合にのみ、変数を逆参照できます。</span><span class="sxs-lookup"><span data-stu-id="14526-112">The variable may only be dereferenced when the compiler can guarantee that the value isn't null.</span></span>
  - <span data-ttu-id="14526-113">これらの変数は、既定値 `null` で初期化される場合があり、他のコードで値 `null` を割り当てられる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="14526-113">These variables may be initialized with the default `null` value and may be assigned the value `null` in other code.</span></span>

<span data-ttu-id="14526-114">以前のバージョンの C# では変数の宣言から設計の意図を判断できなかったので、この新機能には参照変数の処理について大きなメリットがあります。</span><span class="sxs-lookup"><span data-stu-id="14526-114">This new feature provides significant benefits over the handling of reference variables in earlier versions of C# where the design intent couldn't be determined from the variable declaration.</span></span> <span data-ttu-id="14526-115">コンパイラでは、参照型の null 参照例外に対する安全性は提供されませんでした。</span><span class="sxs-lookup"><span data-stu-id="14526-115">The compiler didn't provide safety against null reference exceptions for reference types:</span></span>

- <span data-ttu-id="14526-116">**参照は null にできる**。</span><span class="sxs-lookup"><span data-stu-id="14526-116">**A reference can be null**.</span></span> <span data-ttu-id="14526-117">参照型を null に初期化したり、後で null を割り当てたりしても、警告は発行されません。</span><span class="sxs-lookup"><span data-stu-id="14526-117">No warnings are issued when a reference type is initialized to null, or later assigned to null.</span></span>
- <span data-ttu-id="14526-118">**参照は null ではないと見なされる**。</span><span class="sxs-lookup"><span data-stu-id="14526-118">**A reference is assumed to be not null**.</span></span> <span data-ttu-id="14526-119">参照型が逆参照されても、コンパイラでは警告は発行されません。</span><span class="sxs-lookup"><span data-stu-id="14526-119">The compiler doesn't issue any warnings when reference types are dereferenced.</span></span> <span data-ttu-id="14526-120">(null 許容参照では、null の可能性がある変数を逆参照するたびに、コンパイラで警告が発行されます)。</span><span class="sxs-lookup"><span data-stu-id="14526-120">(With nullable references,  the compiler issues warnings whenever you dereference a variable that may be null).</span></span>

<span data-ttu-id="14526-121">null 許容参照型の追加により、いっそう明確に意図を宣言できます。</span><span class="sxs-lookup"><span data-stu-id="14526-121">With the addition of nullable reference types, you can declare your intent more clearly.</span></span> <span data-ttu-id="14526-122">`null` 値は、変数で値が参照されていないことを表すための正しい方法です。</span><span class="sxs-lookup"><span data-stu-id="14526-122">The `null` value is the correct way to represent that a variable doesn't refer to a value.</span></span> <span data-ttu-id="14526-123">コードからすべての `null` 値を削除するために、この機能を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="14526-123">Don't use this feature to remove all `null` values from your code.</span></span> <span data-ttu-id="14526-124">そうではなく、コンパイラと、コードを読む他の開発者に対し、自分の意図を宣言する必要があります。</span><span class="sxs-lookup"><span data-stu-id="14526-124">Rather, you should declare your intent to the compiler and other developers that read your code.</span></span> <span data-ttu-id="14526-125">意図を宣言することにより、その意図と矛盾するコードを記述すると、コンパイラによって通知されます。</span><span class="sxs-lookup"><span data-stu-id="14526-125">By declaring your intent, the compiler informs you when you write code that is inconsistent with that intent.</span></span>

<span data-ttu-id="14526-126">**null 許容参照型**は、[null 許容値型](programming-guide/nullable-types/index.md)と同じ構文を使用して記述し、変数の型の後に `?` を追加します。</span><span class="sxs-lookup"><span data-stu-id="14526-126">A **nullable reference type** is noted using the same syntax as [nullable value types](programming-guide/nullable-types/index.md): a `?` is appended to the type of the variable.</span></span> <span data-ttu-id="14526-127">たとえば、次の変数宣言は、null 許容型の文字列変数 `name` を表します。</span><span class="sxs-lookup"><span data-stu-id="14526-127">For example, the following variable declaration represents a nullable string variable, `name`:</span></span>

```csharp
string? name;
```

<span data-ttu-id="14526-128">型の名前に `?` が追加されていないすべての変数は、**null 非許容参照型**です。</span><span class="sxs-lookup"><span data-stu-id="14526-128">Any variable where the `?` is not appended to the type name is a **non-nullable reference type**.</span></span> <span data-ttu-id="14526-129">この機能を有効にすると、既存のコードのすべての参照型変数がそれに含まれます。</span><span class="sxs-lookup"><span data-stu-id="14526-129">That includes all reference type variables in existing code when you have enabled this feature.</span></span>

<span data-ttu-id="14526-130">コンパイラでは、静的分析を使用して、null 許容参照が非 null として認識されているかどうかが判定されます。</span><span class="sxs-lookup"><span data-stu-id="14526-130">The compiler uses static analysis to determine if a nullable reference is known to be non-null.</span></span> <span data-ttu-id="14526-131">コンパイラは、null の可能性があるときに null 許容参照を逆参照していると警告します。</span><span class="sxs-lookup"><span data-stu-id="14526-131">The compiler warns you if you dereference a nullable reference when it may be null.</span></span> <span data-ttu-id="14526-132">この動作は、変数名の後に **null 免除演算子** (`!`) を使用することでオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="14526-132">You can override this behavior by using the **null-forgiving operator** (`!`) following a variable name.</span></span> <span data-ttu-id="14526-133">たとえば、変数 `name` は null ではないことがわかっているのに、コンパイラで警告が出る場合は、次のようにコードを記述することで、コンパイラの分析をオーバーライドできます。</span><span class="sxs-lookup"><span data-stu-id="14526-133">For example, if you know the `name` variable isn't null but the compiler issues a warning, you can write the following code to override the compiler's analysis:</span></span>

```csharp
name!.Length;
```

<span data-ttu-id="14526-134">この演算子について詳しくは、GitHub で [null 許容参照型のドラフト](https://github.com/dotnet/csharplang/blob/master/proposals/csharp-8.0/nullable-reference-types-specification.md#the-null-forgiving-operator)仕様の提案をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="14526-134">You can read details about this operator in the [draft nullable reference types](https://github.com/dotnet/csharplang/blob/master/proposals/csharp-8.0/nullable-reference-types-specification.md#the-null-forgiving-operator) specification proposal on GitHub.</span></span>

## <a name="nullability-of-types"></a><span data-ttu-id="14526-135">型の null 値の許容</span><span class="sxs-lookup"><span data-stu-id="14526-135">Nullability of types</span></span>

<span data-ttu-id="14526-136">すべての参照型には、4 種類の "*null 値の許容*" のいずれかを指定でき、それぞれで警告が生成される場合が示されています。</span><span class="sxs-lookup"><span data-stu-id="14526-136">Any reference type can have one of four *nullabilities*, which describes when warnings are generated:</span></span>

- <span data-ttu-id="14526-137">"*null 非許容*" : この型の変数には、null を割り当てることはできません。</span><span class="sxs-lookup"><span data-stu-id="14526-137">*Nonnullable*: Null can't be assigned to variables of this type.</span></span> <span data-ttu-id="14526-138">この型の変数については、逆参照する前に null チェックを行う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="14526-138">Variables of this type don't need to be null-checked before dereferencing.</span></span>
- <span data-ttu-id="14526-139">"*null 許容*" : この型の変数には、null を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="14526-139">*Nullable*: Null can be assigned to variables of this type.</span></span> <span data-ttu-id="14526-140">先に `null` をチェックしないでこの型の変数を逆参照すると、警告が生成されます。</span><span class="sxs-lookup"><span data-stu-id="14526-140">Dereferencing variables of this type without first checking for `null` causes a warning.</span></span>
- <span data-ttu-id="14526-141">"*無関係*" : これは、C# 8 より前の状態です。</span><span class="sxs-lookup"><span data-stu-id="14526-141">*Oblivious*: This is the pre-C# 8 state.</span></span> <span data-ttu-id="14526-142">この型の変数を逆参照したり割り当てたりしても、警告は発生しません。</span><span class="sxs-lookup"><span data-stu-id="14526-142">Variables of this type can be dereferenced or assigned without warnings.</span></span>
- <span data-ttu-id="14526-143">"*不明*" : これは一般に、型が "*null 許容*" または "*null 非許容*" でなければならないことが制約によってコンパイラに指示されない、型パラメーターの場合です。</span><span class="sxs-lookup"><span data-stu-id="14526-143">*Unknown*: This is generally for type parameters where constraints don't tell the compiler that the type must be *nullable* or *nonnullable*.</span></span>

<span data-ttu-id="14526-144">変数宣言での型の null 値の許容は、変数が宣言されている "*null 許容コンテキスト*" によって制御されます。</span><span class="sxs-lookup"><span data-stu-id="14526-144">The nullability of a type in a variable declaration is controlled by the *nullable context* in which the variable is declared.</span></span>

## <a name="nullable-contexts"></a><span data-ttu-id="14526-145">null 許容コンテキスト</span><span class="sxs-lookup"><span data-stu-id="14526-145">Nullable contexts</span></span>

<span data-ttu-id="14526-146">null 許容コンテキストでは、コンパイラによる参照型変数の解釈方法を細かく制御できます。</span><span class="sxs-lookup"><span data-stu-id="14526-146">Nullable contexts enable fine-grained control for how the compiler interprets reference type variables.</span></span> <span data-ttu-id="14526-147">特定のソース行の **null 許容注釈コンテキスト**は、`enabled` または `disabled` です。</span><span class="sxs-lookup"><span data-stu-id="14526-147">The **nullable annotation context** of any given source line is `enabled` or `disabled`.</span></span> <span data-ttu-id="14526-148">C# 8 より前のコンパイラでは、`disabled` null 許容コンテキスト内のすべてのコードがコンパイルされるものと考えることができます。すべての参照型は null になることができます。</span><span class="sxs-lookup"><span data-stu-id="14526-148">You can think of the pre-C# 8 compiler as compiling all your code in a `disabled` nullable context: Any reference type may be null.</span></span> <span data-ttu-id="14526-149">**null 許容警告コンテキスト**は、`enabled`、`disabled`、または `safeonly` に設定することができます。</span><span class="sxs-lookup"><span data-stu-id="14526-149">The **nullable warnings context** may be set to `enabled`, `disabled`, or `safeonly`.</span></span> <span data-ttu-id="14526-150">null 許容警告コンテキストでは、フロー分析を使用するコンパイラによって生成される警告が指定されます。</span><span class="sxs-lookup"><span data-stu-id="14526-150">The nullable warnings context specifies the warnings generated by the compiler using its flow analysis.</span></span>

<span data-ttu-id="14526-151">プロジェクトの null 許容注釈コンテキストと null 許容警告コンテキストは、`csproj` ファイルの `NullableContextOptions` 要素を使用して設定することができます。</span><span class="sxs-lookup"><span data-stu-id="14526-151">The nullable annotation context and nullable warning context can be set for a project using the `NullableContextOptions` element in your `csproj` file.</span></span> <span data-ttu-id="14526-152">この要素では、コンパイラによって型の null 値の許容が解釈される方法と、生成される警告を構成します。</span><span class="sxs-lookup"><span data-stu-id="14526-152">This element configures how the compiler interprets the nullability of types and what warnings are generated.</span></span> <span data-ttu-id="14526-153">有効な設定は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="14526-153">Valid settings are:</span></span>

- <span data-ttu-id="14526-154">`enable`:null 許容注釈コンテキストは**有効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-154">`enable`: The nullable annotation context is **enabled**.</span></span> <span data-ttu-id="14526-155">null 許容警告コンテキストは**有効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-155">The nullable warning context is **enabled**.</span></span>
  - <span data-ttu-id="14526-156">参照型の変数 (`string` など) は、null 非許容です。</span><span class="sxs-lookup"><span data-stu-id="14526-156">Variables of a reference type, `string` for example, are non-nullable.</span></span>  <span data-ttu-id="14526-157">null 値の許容のすべての警告は有効です。</span><span class="sxs-lookup"><span data-stu-id="14526-157">All nullability warnings are enabled.</span></span>
- <span data-ttu-id="14526-158">`disable`:null 許容注釈コンテキストは**無効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-158">`disable`: The nullable annotation context is **disabled**.</span></span> <span data-ttu-id="14526-159">null 許容警告コンテキストは**無効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-159">The nullable warning context is **disabled**.</span></span>
  - <span data-ttu-id="14526-160">参照型の変数は無関係であり、以前のバージョンの C# と同じです。</span><span class="sxs-lookup"><span data-stu-id="14526-160">Variables of a reference type are oblivious, just like earlier versions of C#.</span></span> <span data-ttu-id="14526-161">null 値の許容のすべての警告は無効です。</span><span class="sxs-lookup"><span data-stu-id="14526-161">All nullability warnings are disabled.</span></span>
- <span data-ttu-id="14526-162">`safeonly`:null 許容注釈コンテキストは**有効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-162">`safeonly`: The nullable annotation context is **enabled**.</span></span> <span data-ttu-id="14526-163">null 許容警告コンテキストは**安全のみ**です。</span><span class="sxs-lookup"><span data-stu-id="14526-163">The nullable warning context is **safeonly**.</span></span>
  - <span data-ttu-id="14526-164">参照型の変数は、null 非許容です。</span><span class="sxs-lookup"><span data-stu-id="14526-164">Variables of a reference type are nonnullable.</span></span> <span data-ttu-id="14526-165">安全性に関する null 値の許容のすべての警告は有効です。</span><span class="sxs-lookup"><span data-stu-id="14526-165">All safety nullability warnings are enabled.</span></span>
- <span data-ttu-id="14526-166">`warnings`:null 許容注釈コンテキストは**無効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-166">`warnings`: The nullable annotation context is **disabled**.</span></span> <span data-ttu-id="14526-167">null 許容警告コンテキストは**有効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-167">The nullable warning context is **enabled**.</span></span>
  - <span data-ttu-id="14526-168">参照型の変数は、無関係です。</span><span class="sxs-lookup"><span data-stu-id="14526-168">Variables of a reference type are oblivious.</span></span> <span data-ttu-id="14526-169">null 値の許容のすべての警告は有効です。</span><span class="sxs-lookup"><span data-stu-id="14526-169">All nullability warnings are enabled.</span></span>
- <span data-ttu-id="14526-170">`safeonlywarnings`:null 許容注釈コンテキストは**無効**です。</span><span class="sxs-lookup"><span data-stu-id="14526-170">`safeonlywarnings`: The nullable annotation context is **disabled**.</span></span> <span data-ttu-id="14526-171">null 許容警告コンテキストは**安全のみ**です。</span><span class="sxs-lookup"><span data-stu-id="14526-171">The nullable warning context is **safeonly**.</span></span>
  - <span data-ttu-id="14526-172">参照型の変数は、無関係です。</span><span class="sxs-lookup"><span data-stu-id="14526-172">Variables of a reference type are oblivious.</span></span> <span data-ttu-id="14526-173">安全性に関する null 値の許容のすべての警告は有効です。</span><span class="sxs-lookup"><span data-stu-id="14526-173">All safety nullability warnings are enabled.</span></span>

<span data-ttu-id="14526-174">ディレクティブを使用して、プロジェクト内の任意の場所にこれらと同じコンテキストを設定することもできます。</span><span class="sxs-lookup"><span data-stu-id="14526-174">You can also use directives to set these same contexts anywhere in your project:</span></span>

- <span data-ttu-id="14526-175">`#nullable enable`:null 許容注釈コンテキストと null 許容警告コンテキストを、**有効**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-175">`#nullable enable`: Sets the nullable annotation context and nullable warning context to **enabled**.</span></span>
- <span data-ttu-id="14526-176">`#nullable disable`:null 許容注釈コンテキストと null 許容警告コンテキストを、**無効**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-176">`#nullable disable`: Sets the nullable annotation context and nullable warning context to **disabled**.</span></span>
- <span data-ttu-id="14526-177">`#nullable safeonly`:null 許容注釈コンテキストを**有効**に設定し、null 許容警告コンテキストを**安全のみ**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-177">`#nullable safeonly`: Set the nullable annotation context to **enabled**, and the warning context to **safeonly**.</span></span>
- <span data-ttu-id="14526-178">`#nullable restore`:null 許容注釈コンテキストと null 許容警告コンテキストを、プロジェクトの設定に戻します。</span><span class="sxs-lookup"><span data-stu-id="14526-178">`#nullable restore`: Restores the nullable annotation context and nullable warning context to the project settings.</span></span>
- <span data-ttu-id="14526-179">`#pragma warning disable nullable`:null 許容警告コンテキストを**無効**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-179">`#pragma warning disable nullable`: Set the nullable warning context to **disabled**.</span></span>
- <span data-ttu-id="14526-180">`#pragma warning enable nullable`:null 許容警告コンテキストを**有効**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-180">`#pragma warning enable nullable`: Set the nullable warning context to **enabled**.</span></span>
- <span data-ttu-id="14526-181">`#pragma warning restore nullable`:null 許容警告コンテキストをプロジェクトの設定に戻します。</span><span class="sxs-lookup"><span data-stu-id="14526-181">`#pragma warning restore nullable`: Restores the nullable warning context to the project settings.</span></span>
- <span data-ttu-id="14526-182">`#pragma warning safeonly nullable`:null 許容警告コンテキストを**安全のみ**に設定します。</span><span class="sxs-lookup"><span data-stu-id="14526-182">`#pragma warning safeonly nullable`: Sets the nullable warning context to **safeonly**.</span></span>

<span data-ttu-id="14526-183">既定の null 許容注釈および警告コンテキストは `disabled` です。</span><span class="sxs-lookup"><span data-stu-id="14526-183">The default nullable annotation and warning contexts are `disabled`.</span></span> <span data-ttu-id="14526-184">その決定は、既存のコードを変更せずにコンパイルできて新しい警告は生成されないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="14526-184">That decision means that your existing code compiles without changes and without generating any new warnings.</span></span>

<span data-ttu-id="14526-185">null 許容警告コンテキストの `enabled` と `safeonly` の違いは、null 非許容参照への null 許容参照の割り当てに対する警告です。</span><span class="sxs-lookup"><span data-stu-id="14526-185">The differences between the `enabled` and `safeonly` nullable warning contexts are warnings for assigning a nullable reference to a non-nullable reference.</span></span> <span data-ttu-id="14526-186">次の割り当てに対し、`enabled` 警告コンテキストでは警告が生成されますが、`safeonly` 警告コンテキストでは生成されません。</span><span class="sxs-lookup"><span data-stu-id="14526-186">The following assignment generates a warning in an `enabled` warning context, but not a `safeonly` warning context.</span></span> <span data-ttu-id="14526-187">一方、`s` が逆参照されている 2 行目では、`safeonly` コンテキストで警告が生成されます。</span><span class="sxs-lookup"><span data-stu-id="14526-187">However, the second line, where `s` is dereferenced, generates a warning in a `safeonly` context:</span></span>

```csharp
string s = null; // warning when nullable warning context is enabled.
var txt = s.ToString(); // warning when nullable warnings context is safeonly, or enabled.
```

### <a name="nullable-annotation-context"></a><span data-ttu-id="14526-188">null 許容注釈コンテキスト</span><span class="sxs-lookup"><span data-stu-id="14526-188">Nullable annotation context</span></span>

<span data-ttu-id="14526-189">null 許容注釈コンテキストが無効になっていると、コンパイラでは次の規則が使用されます。</span><span class="sxs-lookup"><span data-stu-id="14526-189">The compiler uses the following rules in a disabled nullable annotation context:</span></span>

- <span data-ttu-id="14526-190">無効コンテキスト内で null 許容参照を宣言することはできません。</span><span class="sxs-lookup"><span data-stu-id="14526-190">You can't declare nullable references in a disabled context.</span></span>
- <span data-ttu-id="14526-191">すべての参照変数には、null を割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="14526-191">All reference variables may be assigned to null.</span></span>
- <span data-ttu-id="14526-192">参照型の変数が逆参照されても、警告は生成されません。</span><span class="sxs-lookup"><span data-stu-id="14526-192">No warnings are generated when a variable of a reference type is dereferenced.</span></span>
- <span data-ttu-id="14526-193">無効コンテキスト内では、null 免除演算子を使用できません。</span><span class="sxs-lookup"><span data-stu-id="14526-193">The null-forgiving operator may not be used in a disabled context.</span></span>

<span data-ttu-id="14526-194">動作は、以前のバージョンの C# と同じです。</span><span class="sxs-lookup"><span data-stu-id="14526-194">The behavior is the same as previous versions of C#.</span></span>

<span data-ttu-id="14526-195">null 許容注釈コンテキストが有効になっていると、コンパイラでは次の規則が使用されます。</span><span class="sxs-lookup"><span data-stu-id="14526-195">The compiler uses the following rules in an enabled nullable annotation context:</span></span>

- <span data-ttu-id="14526-196">参照型のすべての変数は、**null 非許容参照**です。</span><span class="sxs-lookup"><span data-stu-id="14526-196">Any variable of a reference type is a **non-nullable reference**.</span></span>
- <span data-ttu-id="14526-197">すべての null 非許容参照は、安全に逆参照できます。</span><span class="sxs-lookup"><span data-stu-id="14526-197">Any non-nullable reference may be dereferenced safely.</span></span>
- <span data-ttu-id="14526-198">すべての null 許容参照型 (変数宣言で型の後に `?` を付けて示されているもの) は、null にすることができます。</span><span class="sxs-lookup"><span data-stu-id="14526-198">Any nullable reference type (noted by `?` after the type in the variable declaration) may be null.</span></span> <span data-ttu-id="14526-199">静的分析によって、逆参照されるときに値が null 以外であることがわかっているかどうかが決定されます。</span><span class="sxs-lookup"><span data-stu-id="14526-199">Static analysis determines if the value is known to be non-null when it is dereferenced.</span></span> <span data-ttu-id="14526-200">そうでない場合、コンパイラで警告が出ます。</span><span class="sxs-lookup"><span data-stu-id="14526-200">If not, the compiler warns you.</span></span>
- <span data-ttu-id="14526-201">null 免除演算子を使用して、null 許容参照が null ではないことを宣言できます。</span><span class="sxs-lookup"><span data-stu-id="14526-201">You can use the null-forgiving operator to declare that a nullable reference isn't null.</span></span>

<span data-ttu-id="14526-202">null 許容注釈コンテキストが有効になっていると、参照型に追加された `?` 文字により、**null 許容参照型**が宣言されます。</span><span class="sxs-lookup"><span data-stu-id="14526-202">In an enabled nullable annotation context, the `?` character appended to a reference type declares a **nullable reference type**.</span></span> <span data-ttu-id="14526-203">**null 免除演算子** (`!`) を式に追加して、式が null ではないことを宣言できます。</span><span class="sxs-lookup"><span data-stu-id="14526-203">The **null forgiveness operator** (`!`) may be appended to an expression to declare that the expression isn't null.</span></span>

## <a name="nullable-warning-context"></a><span data-ttu-id="14526-204">null 許容警告コンテキスト</span><span class="sxs-lookup"><span data-stu-id="14526-204">Nullable warning context</span></span>

<span data-ttu-id="14526-205">null 許容警告コンテキストは、null 許容注釈コンテキストとは異なります。</span><span class="sxs-lookup"><span data-stu-id="14526-205">The nullable warning context is distinct from the nullable annotation context.</span></span> <span data-ttu-id="14526-206">新しい注釈が無効になっている場合でも、警告を有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="14526-206">Warnings can be enabled even when the new annotations are disabled.</span></span> <span data-ttu-id="14526-207">コンパイラでは、静的フロー解析を使用して、参照の **null 状態**が決定されます。</span><span class="sxs-lookup"><span data-stu-id="14526-207">The compiler uses static flow analysis to determine the **null state** of any reference.</span></span> <span data-ttu-id="14526-208">*null 許容警告コンテキスト*が**無効**ではない場合、null 状態は **null ではない**または **null かもしれない**です。</span><span class="sxs-lookup"><span data-stu-id="14526-208">The null state is either **not null** or **maybe null** when the *nullable warning context* isn't **disabled**.</span></span> <span data-ttu-id="14526-209">コンパイラが **null かもしれない**と判断したときに、参照を逆参照した場合は、コンパイラで警告が出ます。</span><span class="sxs-lookup"><span data-stu-id="14526-209">If you dereference a reference when the compiler has determined it's **maybe null**, the compiler warns you.</span></span> <span data-ttu-id="14526-210">コンパイラが次の 2 つの条件のいずれかであると判断できない場合、参照の状態は **null かもしれない**になります。</span><span class="sxs-lookup"><span data-stu-id="14526-210">The state of a reference is **maybe null** unless the compiler can determine one of two conditions:</span></span>

1. <span data-ttu-id="14526-211">変数に null 以外の値が確実に割り当てられている。</span><span class="sxs-lookup"><span data-stu-id="14526-211">The variable has been definitely assigned to a non-null value.</span></span>
1. <span data-ttu-id="14526-212">変数または式は、それを逆参照する前に null かどうかをチェックされている。</span><span class="sxs-lookup"><span data-stu-id="14526-212">The variable or expression has been checked against null before de-referencing it.</span></span>

<span data-ttu-id="14526-213">null 許容警告コンテキストが `enabled` または `safeonly` の場合、**null かもしれない**状態の変数または式を逆参照すると常に、コンパイラで警告が生成されます。</span><span class="sxs-lookup"><span data-stu-id="14526-213">The compiler generates warnings whenever you dereference a variable or expression in a **maybe null** state when the nullable warning context is `enabled` or `safeonly`.</span></span> <span data-ttu-id="14526-214">さらに、null 許容注釈コンテキストが `enabled` のときに、**null かもしれない**状態の変数または式を null 非許容参照型に割り当てると、警告が生成されます。</span><span class="sxs-lookup"><span data-stu-id="14526-214">Furthermore, warnings are generated when a **maybe null** variable or expression is assigned to a nonnullable reference type when the nullable annotation context is `enabled`.</span></span>

## <a name="learn-more"></a><span data-ttu-id="14526-215">詳細情報</span><span class="sxs-lookup"><span data-stu-id="14526-215">Learn more</span></span>

- [<span data-ttu-id="14526-216">null 許容参照のドラフト仕様</span><span class="sxs-lookup"><span data-stu-id="14526-216">Draft Nullable reference specification</span></span>](https://github.com/dotnet/csharplang/blob/master/proposals/csharp-8.0/nullable-reference-types-specification.md)
- [<span data-ttu-id="14526-217">null 許容参照の概要チュートリアル</span><span class="sxs-lookup"><span data-stu-id="14526-217">Intro to nullable references tutorial</span></span>](tutorials/nullable-reference-types.md)
- [<span data-ttu-id="14526-218">既存のコードベースを null 許容参照に移行する</span><span class="sxs-lookup"><span data-stu-id="14526-218">Migrate an existing codebase to nullable references</span></span>](tutorials/upgrade-to-nullable-references.md)
