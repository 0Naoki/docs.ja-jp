---
title: マネージド アセンブリの読み込みアルゴリズム - .NET Core
description: .NET Core でのマネージド アセンブリ読み込みアルゴリズムの詳細の説明
ms.date: 08/09/2019
author: sdmaclea
ms.author: stmaclea
ms.openlocfilehash: bf95cbd0eebed064f0198ae9b0f7a4288a938f8a
ms.sourcegitcommit: 6f28b709592503d27077b16fff2e2eacca569992
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/28/2019
ms.locfileid: "72303630"
---
# <a name="managed-assembly-loading-algorithm"></a><span data-ttu-id="4003c-103">マネージド アセンブリの読み込みアルゴリズム</span><span class="sxs-lookup"><span data-stu-id="4003c-103">Managed assembly loading algorithm</span></span>

<span data-ttu-id="4003c-104">マネージド アセンブリは、さまざまな段階を伴うアルゴリズムを使用して検出され、読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="4003c-104">Managed assemblies are located and loaded with an algorithm involving various stages.</span></span>

<span data-ttu-id="4003c-105">サテライト アセンブリと `WinRT` アセンブリを除くすべてのマネージド アセンブリで同じアルゴリズムが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-105">All managed assemblies except satellite assemblies and `WinRT` assemblies use the same algorithm.</span></span>

## <a name="when-are-managed-assemblies-loaded"></a><span data-ttu-id="4003c-106">マネージド アセンブリが読み込まれるタイミング</span><span class="sxs-lookup"><span data-stu-id="4003c-106">When are managed assemblies loaded?</span></span>

<span data-ttu-id="4003c-107">マネージド アセンブリの読み込みをトリガーするための最も一般的なメカニズムは、静的アセンブリ参照です。</span><span class="sxs-lookup"><span data-stu-id="4003c-107">The most common mechanism to trigger a managed assembly load is a static assembly reference.</span></span> <span data-ttu-id="4003c-108">これらの参照は、コードが別のアセンブリで定義されている型を使用するときに、コンパイラによって挿入されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-108">These references are inserted by the compiler whenever code uses a type defined in another assembly.</span></span> <span data-ttu-id="4003c-109">これらのアセンブリは、ランタイムによって必要に応じて読み込まれます (`load-by-name`)。</span><span class="sxs-lookup"><span data-stu-id="4003c-109">These assemblies are loaded (`load-by-name`) as needed by the runtime.</span></span>

<span data-ttu-id="4003c-110">特定の API を直接使用によっても、読み込みがトリガーされます。</span><span class="sxs-lookup"><span data-stu-id="4003c-110">The direct use of specific APIs will also trigger loads:</span></span>

|<span data-ttu-id="4003c-111">API</span><span class="sxs-lookup"><span data-stu-id="4003c-111">API</span></span>  |<span data-ttu-id="4003c-112">説明</span><span class="sxs-lookup"><span data-stu-id="4003c-112">Description</span></span>  |<span data-ttu-id="4003c-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span><span class="sxs-lookup"><span data-stu-id="4003c-113">`Active` <xref:System.Runtime.Loader.AssemblyLoadContext></span></span> |
|---------|---------|---------|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyName%2A?displayProperty=nameWithType>|`Load-by-name`|<span data-ttu-id="4003c-114">[this](../../csharp/language-reference/keywords/this.md) インスタンス</span><span class="sxs-lookup"><span data-stu-id="4003c-114">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromAssemblyPath%2A?displayProperty=nameWithType><p><xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromNativeImagePath%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-115">パスから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-115">Load from path.</span></span>|<span data-ttu-id="4003c-116">[this](../../csharp/language-reference/keywords/this.md) インスタンス</span><span class="sxs-lookup"><span data-stu-id="4003c-116">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
<xref:System.Runtime.Loader.AssemblyLoadContext.LoadFromStream%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-117">オブジェクトから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-117">Load from object.</span></span>|<span data-ttu-id="4003c-118">[this](../../csharp/language-reference/keywords/this.md) インスタンス</span><span class="sxs-lookup"><span data-stu-id="4003c-118">The [this](../../csharp/language-reference/keywords/this.md) instance.</span></span>|
|<xref:System.Reflection.Assembly.LoadFile%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-119">新しい <xref:System.Runtime.Loader.AssemblyLoadContext> インスタンスにパスから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-119">Load from path in a new <xref:System.Runtime.Loader.AssemblyLoadContext> instance</span></span>|<span data-ttu-id="4003c-120">新しい <xref:System.Runtime.Loader.AssemblyLoadContext> インスタンス。</span><span class="sxs-lookup"><span data-stu-id="4003c-120">The new <xref:System.Runtime.Loader.AssemblyLoadContext> instance.</span></span>|
<xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-121">新しい <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> インスタンスにパスから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-121">Load from path in the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span><p><span data-ttu-id="4003c-122"><xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> ハンドラーを <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> に追加します。</span><span class="sxs-lookup"><span data-stu-id="4003c-122">Adds a <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving> handler to <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="4003c-123">ハンドラーは、そのディレクトリからアセンブリの依存関係を読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-123">The handler will load the assembly's dependencies from its directory.</span></span>|<span data-ttu-id="4003c-124"><xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> インスタンス。</span><span class="sxs-lookup"><span data-stu-id="4003c-124">The <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instance.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Reflection.AssemblyName)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.String)?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.LoadWithPartialName%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-125">`Load-by-name`。</span><span class="sxs-lookup"><span data-stu-id="4003c-125">`Load-by-name`.</span></span>|<span data-ttu-id="4003c-126">呼び出し元から推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-126">Inferred from caller.</span></span><p><span data-ttu-id="4003c-127"><xref:System.Runtime.Loader.AssemblyLoadContext> メソッドが優先されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-127">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
|<xref:System.Reflection.Assembly.Load(System.Byte[])?displayProperty=nameWithType><p><xref:System.Reflection.Assembly.Load(System.Byte[],System.Byte[])?displayProperty=nameWithType>|<span data-ttu-id="4003c-128">オブジェクトから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-128">Load from object.</span></span>|<span data-ttu-id="4003c-129">呼び出し元から推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-129">Inferred from caller.</span></span><p><span data-ttu-id="4003c-130"><xref:System.Runtime.Loader.AssemblyLoadContext> メソッドが優先されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-130">Prefer <xref:System.Runtime.Loader.AssemblyLoadContext> methods.</span></span>|
<xref:System.Type.GetType(System.String)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean)?displayProperty=nameWithType><p><xref:System.Type.GetType(System.String,System.Boolean,System.Boolean)?displayProperty=nameWithType>|<span data-ttu-id="4003c-131">`Load-by-name`。</span><span class="sxs-lookup"><span data-stu-id="4003c-131">`Load-by-name`.</span></span>|<span data-ttu-id="4003c-132">呼び出し元から推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-132">Inferred from caller.</span></span><p><span data-ttu-id="4003c-133">`assemblyResolver` 引数を使用した <xref:System.Type.GetType%2A?displayProperty=nameWithType> メソッドが優先されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-133">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> methods with an `assemblyResolver` argument.</span></span>|
<xref:System.Reflection.Assembly.GetType%2A?displayProperty=nameWithType>|<span data-ttu-id="4003c-134">型 `name` がアセンブリ修飾ジェネリック型を記述している場合は、`Load-by-name` をトリガーします。</span><span class="sxs-lookup"><span data-stu-id="4003c-134">If type `name` describes an assembly qualified generic type, trigger a `Load-by-name`.</span></span>|<span data-ttu-id="4003c-135">呼び出し元から推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-135">Inferred from caller.</span></span><p><span data-ttu-id="4003c-136">アセンブリ修飾型名を使用する場合は、<xref:System.Type.GetType%2A?displayProperty=nameWithType> が優先されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-136">Prefer <xref:System.Type.GetType%2A?displayProperty=nameWithType> when using assembly qualified type names.</span></span>|
<xref:System.Activator.CreateInstance(System.String,System.String)?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Object[])?displayProperty=nameWithType><p><xref:System.Activator.CreateInstance(System.String,System.String,System.Boolean,System.Reflection.BindingFlags,System.Reflection.Binder,System.Object[],System.Globalization.CultureInfo,System.Object[])?displayProperty=nameWithType>|<span data-ttu-id="4003c-137">`Load-by-name`。</span><span class="sxs-lookup"><span data-stu-id="4003c-137">`Load-by-name`.</span></span>|<span data-ttu-id="4003c-138">呼び出し元から推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-138">Inferred from caller.</span></span><p><span data-ttu-id="4003c-139"><xref:System.Type> 引数を取る <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> メソッドが優先されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-139">Prefer <xref:System.Activator.CreateInstance%2A?displayProperty=nameWithType> methods taking a <xref:System.Type> argument.</span></span>|

## <a name="algorithm"></a><span data-ttu-id="4003c-140">アルゴリズム</span><span class="sxs-lookup"><span data-stu-id="4003c-140">Algorithm</span></span>

<span data-ttu-id="4003c-141">次のアルゴリズムでは、ランタイムがマネージド アセンブリを読み込む方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="4003c-141">The following algorithm describes how the runtime loads a managed assembly.</span></span>

1. <span data-ttu-id="4003c-142">`active` <xref:System.Runtime.Loader.AssemblyLoadContext> を決定します。</span><span class="sxs-lookup"><span data-stu-id="4003c-142">Determine the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span>

    - <span data-ttu-id="4003c-143">静的アセンブリ参照の場合、`active` <xref:System.Runtime.Loader.AssemblyLoadContext> は、参照元のアセンブリを読み込んだインスタンスです。</span><span class="sxs-lookup"><span data-stu-id="4003c-143">For a static assembly reference, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> is the instance that loaded the referring assembly.</span></span>
    - <span data-ttu-id="4003c-144">優先 API の場合、`active` <xref:System.Runtime.Loader.AssemblyLoadContext> は明示されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-144">Preferred APIs make the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> explicit.</span></span>
    - <span data-ttu-id="4003c-145">その他の API の場合、`active` <xref:System.Runtime.Loader.AssemblyLoadContext> は推論されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-145">Other APIs infer the `active` <xref:System.Runtime.Loader.AssemblyLoadContext>.</span></span> <span data-ttu-id="4003c-146">これらの API では、<xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> プロパティが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-146">For these APIs, the <xref:System.Runtime.Loader.AssemblyLoadContext.CurrentContextualReflectionContext?displayProperty=nameWithType> property is used.</span></span> <span data-ttu-id="4003c-147">その値が `null` 場合、推論される <xref:System.Runtime.Loader.AssemblyLoadContext> インスタンスが使用されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-147">If its value is `null`, then the inferred <xref:System.Runtime.Loader.AssemblyLoadContext> instance is used.</span></span>
    - <span data-ttu-id="4003c-148">上記の表を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4003c-148">See table above.</span></span>

2. <span data-ttu-id="4003c-149">`Load-by-name` メソッドでは、アクティブな <xref:System.Runtime.Loader.AssemblyLoadContext> によってアセンブリが読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="4003c-149">For the `Load-by-name` methods, the active <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="4003c-150">優先順位は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="4003c-150">In priority order by:</span></span>
    - <span data-ttu-id="4003c-151">`cache-by-name` を検査します。</span><span class="sxs-lookup"><span data-stu-id="4003c-151">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="4003c-152"><xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> 関数を呼び出します。</span><span class="sxs-lookup"><span data-stu-id="4003c-152">Calling the <xref:System.Runtime.Loader.AssemblyLoadContext.Load%2A?displayProperty=nameWithType> function.</span></span>

    - <span data-ttu-id="4003c-153"><xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> インスタンスのキャッシュを確認し、[マネージド アセンブリの既定のプローブ](default-probing.md#managed-assembly-default-probing) ロジックを実行します。</span><span class="sxs-lookup"><span data-stu-id="4003c-153">Checking the <xref:System.Runtime.Loader.AssemblyLoadContext.Default%2A?displayProperty=nameWithType> instances' cache and running [managed assembly default probing](default-probing.md#managed-assembly-default-probing) logic.</span></span>

    - <span data-ttu-id="4003c-154">アクティブな AssemblyLoadContext の <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="4003c-154">Raising the <xref:System.Runtime.Loader.AssemblyLoadContext.Resolving?displayProperty=nameWithType> event for the active AssemblyLoadContext.</span></span>

    - <span data-ttu-id="4003c-155"><xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> イベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="4003c-155">Raising the <xref:System.AppDomain.AssemblyResolve?displayProperty=nameWithType> event.</span></span>

3. <span data-ttu-id="4003c-156">その他の種類の読み込みでは、`active` <xref:System.Runtime.Loader.AssemblyLoadContext> がアセンブリを読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-156">For the other types of loads, the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> loads the assembly.</span></span> <span data-ttu-id="4003c-157">優先順位は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="4003c-157">In priority order by:</span></span>
    - <span data-ttu-id="4003c-158">`cache-by-name` を検査します。</span><span class="sxs-lookup"><span data-stu-id="4003c-158">Checking its `cache-by-name`.</span></span>

    - <span data-ttu-id="4003c-159">指定されたパスまたは未加工のアセンブリ オブジェクトから読み込みます。</span><span class="sxs-lookup"><span data-stu-id="4003c-159">Loading from the specified path or raw assembly object.</span></span>

4. <span data-ttu-id="4003c-160">どちらの場合も、アセンブリが新しく読み込まれた場合は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="4003c-160">In either case, if an assembly is newly loaded, then:</span></span>
   - <span data-ttu-id="4003c-161"><xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="4003c-161">The <xref:System.AppDomain.AssemblyLoad?displayProperty=nameWithType> event is raised.</span></span>
   - <span data-ttu-id="4003c-162">アセンブリの <xref:System.Runtime.Loader.AssemblyLoadContext> インスタンスの `cache-by-name` に参照が追加されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-162">A reference is added to the assembly's <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>

5. <span data-ttu-id="4003c-163">アセンブリが見つかった場合は、必要に応じて参照が `active` <xref:System.Runtime.Loader.AssemblyLoadContext> インスタンスの `cache-by-name` に追加されます。</span><span class="sxs-lookup"><span data-stu-id="4003c-163">If the assembly is found, a reference is added as needed to the `active` <xref:System.Runtime.Loader.AssemblyLoadContext> instance's `cache-by-name`.</span></span>
